window.__require=function t(e,i,o){function a(r,s){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var p="function"==typeof __require&&__require;if(!s&&p)return p(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return a(e[r][1][t]||t)},h,h.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<o.length;r++)a(o[r]);return a}({archerEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"ca213kxakNHBIunPHVXnBBk","archerEnemy");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./player"),s=cc._decorator,c=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletPrefab=null,e.attackSound=null,e.killedSound=null,e.gameManager=null,e.target=null,e.detectRange=300,e.attackRange=5,e.attackCooldown=2,e.nextAttackTime=0,e.moveSpeed=70,e.moveDir=cc.Vec2.ZERO,e.moveDuration=2,e.waitDuration=2,e.nextWaitTime=0,e.nextMoveTime=0,e.nextTraceTime=0,e.waitRandomFactor=.1,e.enemyLife=85,e.enemyMaxLife=85,e.enemyLifeProgress=null,e.anim=null,e.animateState=null,e.attacking=!1,e.aiming=!1,e.targetDirection="",e.targetAngle=0,e.targetPosition=cc.v2(0,0),e.damage=10,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){this.gameManager=cc.find("gameManager");var t=this.node.parent.name.slice(-1);try{var e=JSON.parse(cc.sys.localStorage.getItem("p"+t)).job;console.log("JOB "+e),e&&(this.target=cc.find("Canvas/player"+t).getChildByName(e))}catch(s){}this.enemyLifeProgress=this.node.getChildByName("lifeBar"),this.anim=this.getComponent(cc.Animation)},e.prototype.wandering=function(t){var e,i=cc.director.getTotalTime()/1e3;i>=this.nextMoveTime&&(this.nextWaitTime=i+this.moveDuration,this.nextMoveTime=this.nextWaitTime+this.waitDuration*(1+this.waitRandomFactor*(2*Math.random()-1)),this.moveDir=(e=Math.random()*Math.PI*2,new cc.Vec2(Math.cos(e),Math.sin(e)))),i<this.nextWaitTime&&(this.node.x+=this.moveDir.x*this.moveSpeed*t,this.node.y+=this.moveDir.y*this.moveSpeed*t)},e.prototype.detectRangePlayer=function(){return this.node.convertToWorldSpaceAR(cc.v2(0,0)).sub(this.target.convertToWorldSpaceAR(cc.v2(0,0))).mag()<this.detectRange?this.aiming=!0:this.aiming=!1,0},e.prototype.enemyWalkAnimation=function(){this.attacking||this.aiming||(this.moveDir.x>0?null!=this.animateState&&"walkRight"==this.animateState.name||(this.animateState=this.anim.play("walkRight")):this.moveDir.x<0?null!=this.animateState&&"walkLeft"==this.animateState.name||(this.animateState=this.anim.play("walkLeft")):this.moveDir.y>0?null!=this.animateState&&"walkUp"==this.animateState.name||(this.animateState=this.anim.play("walkUp")):this.moveDir.y<0?null!=this.animateState&&"walkDown"==this.animateState.name||(this.animateState=this.anim.play("walkDown")):(this.animateState=null,this.anim.stop()))},e.prototype.enemyAttackAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,cc.audioEngine.playEffect(this.attackSound,!1),"E"==this.targetDirection?this.animateState=this.anim.play("attackRight"):"W"==this.targetDirection?this.animateState=this.anim.play("attackLeft"):"N"==this.targetDirection?this.animateState=this.anim.play("attackUp"):"S"==this.targetDirection&&(this.animateState=this.anim.play("attackDown")),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.enemyHurt=function(t){this.enemyLife-=t,this.enemyLifeProgress.getComponent(cc.ProgressBar).progress=this.enemyLife/this.enemyMaxLife,this.enemyLife<=0&&(cc.audioEngine.playEffect(this.killedSound,!1),this.node.active=!1,"enemy1"==this.node.parent.name?this.gameManager.getComponent("gamerManager").addcoin(1,15):"enemy2"==this.node.parent.name&&this.gameManager.getComponent("gamerManager").addcoin(2,15),this.gameManager.getComponent("gamerManager").enemyReduce(this.node.x),this.node.destroy())},e.prototype.createBullet=function(){var t,e,i=cc.instantiate(this.bulletPrefab),o=this.node.convertToWorldSpaceAR(cc.v2(0,0));this.targetPosition=this.target.convertToWorldSpaceAR(cc.v2(0,0)),this.targetAngle=(t=this.targetPosition.x-o.x,e=this.targetPosition.y-o.y,180*Math.atan2(e,t)/Math.PI),this.targetAngle<45&&this.targetAngle>=-45?this.targetDirection="E":this.targetAngle<135&&this.targetAngle>=45?this.targetDirection="N":this.targetAngle<225&&this.targetAngle>=135?this.targetDirection="W":this.targetDirection="S",i.getComponent("enemyBullet").init(this.node,this.targetDirection,this.targetAngle)},e.prototype.update=function(t){var e=cc.director.getTotalTime()/1e3;this.detectRangePlayer(),this.aiming?e>=this.nextAttackTime&&(this.nextAttackTime=e+this.attackCooldown,this.createBullet(),this.enemyAttackAnimation()):this.wandering(t),this.enemyWalkAnimation()},e.prototype.onBeginContact=function(t,e,i){1==i.tag&&i.node.getComponent(r.default).lifeDamage(this.damage)},n([p(cc.Prefab)],e.prototype,"bulletPrefab",void 0),n([p(cc.AudioClip)],e.prototype,"attackSound",void 0),n([p({type:cc.AudioClip})],e.prototype,"killedSound",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"./player":"player"}],bullet:[function(t,e,i){"use strict";cc._RF.push(e,"bec3eXqZSlO66PUx9KBHkrL","bullet");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletManager=null,e.bulletSpeed=15,e.initPosOffset=60,e.damage=1,e.speedX=0,e.speedY=0,e.isTriggered=!1,e}return a(e,t),e.prototype.init=function(t,e,i,o){var a=this;this.setInitPos(t,e),this.speedX=Math.cos(i*Math.PI/180),this.speedY=Math.sin(i*Math.PI/180),this.damage=o,"archer"==t.name&&(this.node.angle=i+135),this.scheduleOnce(function(){a.bulletManager.put(a.node)},1)},e.prototype.reuse=function(t){this.bulletManager=t,this.isTriggered=!1},e.prototype.setInitPos=function(t,e){switch(this.node.parent=t.parent,e){case"N":this.node.setPosition(cc.v2(0,this.initPosOffset));break;case"S":this.node.setPosition(cc.v2(0,-1*this.initPosOffset));break;case"E":this.node.setPosition(cc.v2(this.initPosOffset,0));break;case"W":this.node.setPosition(cc.v2(-1*this.initPosOffset,0));break;case"NE":this.node.setPosition(cc.v2(this.initPosOffset,this.initPosOffset));break;case"NW":this.node.setPosition(cc.v2(-1*this.initPosOffset,this.initPosOffset));break;case"SW":this.node.setPosition(cc.v2(-1*this.initPosOffset,-1*this.initPosOffset));break;case"SE":this.node.setPosition(cc.v2(this.initPosOffset,-1*this.initPosOffset))}this.node.position=this.node.position.addSelf(t.position)},e.prototype.update=function(){this.node.x+=this.bulletSpeed*this.speedX,this.node.y+=this.bulletSpeed*this.speedY},e.prototype.onBeginContact=function(t,e,i){var o=this;1!=i.tag&&3!=i.tag?(2==i.tag&&i.getComponent(i.node.name).enemyHurt(this.damage),this.node.stopAllActions(),this.unscheduleAllCallbacks(),this.scheduleOnce(function(){o.bulletManager.put(o.node)},.005)):t.disabled=!0},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],camera1:[function(t,e,i){"use strict";cc._RF.push(e,"cdd6cwECgZKlqYzqCX7cw+5","camera1");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player1=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("p1")).job;t&&(this.player1=cc.find("Canvas/player1/"+t))}catch(r){}},e.prototype.update=function(){var t=this.player1.x-1080;t>-850?t=-850:t<-1920&&(t=-1920);var e=this.player1.y;e>530?e=530:e<-530&&(e=-530),this.node.setPosition(cc.v2(t,e))},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],camera2:[function(t,e,i){"use strict";cc._RF.push(e,"ec7a6iiPzFB/I5GAIHuHwXj","camera2");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.player2=null,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("p2")).job;t&&(this.player2=cc.find("Canvas/player2/"+t))}catch(r){}},e.prototype.update=function(){var t=this.player2.x+1080;t>1920?t=1920:t<850&&(t=850);var e=this.player2.y;e>530?e=530:e<-530&&(e=-530),this.node.setPosition(cc.v2(t,e))},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],cancel:[function(t,e,i){"use strict";cc._RF.push(e,"9a9a4Vcqh5FNZymV9RupPsu","cancel");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shopManager=null,e}return a(e,t),e.prototype.onLoad=function(){this.shopManager=cc.find("Canvas/shopManager");var t=new cc.Component.EventHandler;t.target=this.node,t.component="cancel",t.handler="reply",cc.find("Canvas/confirm/cancel").getComponent(cc.Button).clickEvents.push(t)},e.prototype.reply=function(){this.node.parent.getComponent("confirm").equipClean(),this.shopManager.getComponent("shopManager").equipClean(),this.node.parent.destroy()},n([c(cc.Node)],e.prototype,"shopManager",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],confirm:[function(t,e,i){"use strict";cc._RF.push(e,"3a31cKmhWFL2bWwm9Nm0u+L","confirm");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(t,e,i,o){this.node.parent=t.parent;var a,n=this.node.getChildByName("Label");if(e&&(a=JSON.parse(cc.sys.localStorage.getItem(e)).price),1==i)if("buy"==o){this.node.position=cc.v3(-300,40);var r=this;cc.loader.loadRes("equipPrefabs/"+e,function(t,i){r.temEquip=cc.instantiate(i),r.temEquip.getComponent("playerEquip").init(r.node,1,"weapon",e,-300,60)}),n.getComponent(cc.Label).string="Do you want to pay "+a+" dollar for it?"}else"sell"==o&&(this.node.position=cc.v3(-450,-170),r=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,i){r.temEquip=cc.instantiate(i),r.temEquip.getComponent("playerEquip").init(r.node,1,"weapon",e,-450,-150)}),n.getComponent(cc.Label).string="Do you want to sell it for "+Math.floor(.7*a)+" dollar?");else 2==i?"buy"==o?(this.node.position=cc.v3(350,40),r=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,i){r.temEquip=cc.instantiate(i),r.temEquip.getComponent("playerEquip").init(r.node,1,"weapon",e,350,60)}),n.getComponent(cc.Label).string="Do you want to pay "+a+" dollar for it?"):"sell"==o&&(this.node.position=cc.v3(430,-170),r=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,i){r.temEquip=cc.instantiate(i),r.temEquip.getComponent("playerEquip").init(r.node,1,"weapon",e,430,-150)}),n.getComponent(cc.Label).string="Do you want to sell it for "+Math.floor(.7*a)+" dollar?"):(this.node.position=cc.v3(0,0),n.y-=50,n.getComponent(cc.Label).string="Are you both ready?")},e.prototype.equipClean=function(){this.temEquip&&this.temEquip.destroy()},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],dataBox:[function(t,e,i){"use strict";cc._RF.push(e,"f1e78S3JzxFkpx3+HWp49hU","dataBox");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(t,e,i,o,a,n,r){this.node.parent=t.parent,1==e?"shop"==i?this.node.position=cc.v3(140,-50):"player"==i&&(this.node.position=cc.v3(140,100)):2==e&&("shop"==i?this.node.position=cc.v3(-140,-50):"player"==i&&(this.node.position=cc.v3(-140,100))),this.node.position=this.node.position.addSelf(t.position),this.node.getChildByName("data").getComponent(cc.Label).string="ATK: "+o+"\nDEF: "+a+"\nHP: "+n+"\nSPD: "+r},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],endgame:[function(t,e,i){"use strict";cc._RF.push(e,"e048d5opNFIHKjdsFDVru/W","endgame");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.winnername=null,e.winID=0,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){cc.audioEngine.stopMusic();var t=JSON.parse(cc.sys.localStorage.getItem("playerdata"));"winner1"==cc.sys.localStorage.getItem("winstate")?(this.winID=t.p1id,this.label.string=t.p1name+"\nWON"):(this.winID=t.p2id,this.label.string=t.p2name+"\nWON")},e.prototype.backhome=function(){cc.director.loadScene("start")},n([c(cc.Label)],e.prototype,"label",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],enemyBullet:[function(t,e,i){"use strict";cc._RF.push(e,"66aabWwApNLRrjuDuxURfYv","enemyBullet");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletSpeed=5,e.initPosOffset=32,e.speedX=0,e.speedY=0,e.damage=10,e}return a(e,t),e.prototype.init=function(t,e,i){var o=this;this.setInitPos(t,e),this.speedX=Math.cos(i*Math.PI/180),this.speedY=Math.sin(i*Math.PI/180),"archerEnemy"==t.name&&(this.node.angle=i+135),this.scheduleOnce(function(){o.node.destroy()},3)},e.prototype.setInitPos=function(t,e){switch(this.node.parent=t.parent.parent,e){case"N":this.node.setPosition(cc.v2(0,this.initPosOffset));break;case"S":this.node.setPosition(cc.v2(0,-1*this.initPosOffset));break;case"E":this.node.setPosition(cc.v2(this.initPosOffset,0));break;case"W":this.node.setPosition(cc.v2(-1*this.initPosOffset,0))}this.node.position=this.node.position.addSelf(t.position)},e.prototype.update=function(){this.node.x+=this.bulletSpeed*this.speedX,this.node.y+=this.bulletSpeed*this.speedY},e.prototype.onBeginContact=function(t,e,i){2!=i.tag&&3!=i.tag?(1==i.tag&&i.node.getComponent("player").lifeDamage(this.damage),this.unscheduleAllCallbacks(),this.node.destroy()):t.disabled=!0},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],equipBg:[function(t,e,i){"use strict";cc._RF.push(e,"e108ePizhVBiJumNVz69Ri6","equipBg");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(t,e,i){this.node.parent=t.parent,this.node.position=cc.v3(e,i)},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],fightBullet:[function(t,e,i){"use strict";cc._RF.push(e,"1c686p2pT5Pl6Yk9F6SvaV9","fightBullet");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletManager=null,e.bulletSpeed=40,e.initPosOffset=60,e.damage=1,e.owner=0,e.speedX=0,e.speedY=0,e.isTriggered=!1,e}return a(e,t),e.prototype.init=function(t,e,i,o,a){var n=this;this.setInitPos(t,e),this.speedX=Math.cos(i*Math.PI/180),this.speedY=Math.sin(i*Math.PI/180),this.damage=o,this.owner=a,this.scheduleOnce(function(){n.bulletManager.put(n.node)},1),"archer"==t.name&&(this.node.angle=i+135)},e.prototype.reuse=function(t){this.bulletManager=t,this.isTriggered=!1},e.prototype.setInitPos=function(t,e){switch(this.node.parent=t.parent,e){case"N":this.node.setPosition(cc.v2(0,this.initPosOffset));break;case"S":this.node.setPosition(cc.v2(0,-1*this.initPosOffset));break;case"E":this.node.setPosition(cc.v2(this.initPosOffset,0));break;case"W":this.node.setPosition(cc.v2(-1*this.initPosOffset,0));break;case"NE":this.node.setPosition(cc.v2(this.initPosOffset,this.initPosOffset));break;case"NW":this.node.setPosition(cc.v2(-1*this.initPosOffset,this.initPosOffset));break;case"SW":this.node.setPosition(cc.v2(-1*this.initPosOffset,-1*this.initPosOffset));break;case"SE":this.node.setPosition(cc.v2(this.initPosOffset,-1*this.initPosOffset))}this.node.position=this.node.position.addSelf(t.position)},e.prototype.update=function(){this.node.x+=this.bulletSpeed*this.speedX,this.node.y+=this.bulletSpeed*this.speedY},e.prototype.onBeginContact=function(t,e,i){var o=this;if(3!=i.tag){if(1==i.tag){if(parseInt(i.node.parent.name.slice(-1))==this.owner)return void(t.disabled=!0);i.node.getComponent("fightPlayer").lifeDamage(this.damage)}this.node.stopAllActions(),this.unscheduleAllCallbacks(),this.scheduleOnce(function(){o.bulletManager.put(o.node)},.03)}else t.disabled=!0},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],fightManager:[function(t,e,i){"use strict";cc._RF.push(e,"c2759oAL8dOEYbPnKZKkQ5E","fightManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./fightPlayer"),s=cc._decorator,c=s.ccclass,p=s.property,h={},l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.archer=null,e.warrior=null,e.knight=null,e.slinger=null,e.bgm=null,e.player1=null,e.player2=null,e.map=null,e.pause=!1,e.physicManager=null,e}return a(e,t),e.prototype.onLoad=function(){this.physicManager=cc.director.getPhysicsManager(),this.physicManager.enabled=!0,this.initPlayer(),this.map=cc.find("Canvas/pkMap").getComponent(cc.TiledMap)},e.prototype.start=function(){this.playBGM(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.initWall(this.map)},e.prototype.playBGM=function(){cc.audioEngine.play(this.bgm,!0,.5)},e.prototype.endBGM=function(){cc.audioEngine.stopMusic()},e.prototype.initPlayer=function(){var t,e;switch(JSON.parse(cc.sys.localStorage.getItem("p1")).job){case"archer":t=cc.instantiate(this.archer);break;case"warrior":t=cc.instantiate(this.warrior);break;case"slinger":t=cc.instantiate(this.slinger);break;case"knight":t=cc.instantiate(this.knight)}switch(t.parent=cc.find("Canvas/player1"),t.setPosition(cc.v2(-450,0)),JSON.parse(cc.sys.localStorage.getItem("p2")).job){case"archer":e=cc.instantiate(this.archer);break;case"warrior":e=cc.instantiate(this.warrior);break;case"slinger":e=cc.instantiate(this.slinger);break;case"knight":e=cc.instantiate(this.knight)}e.parent=cc.find("Canvas/player2"),e.setPosition(cc.v2(450,0)),this.player1=t.getComponent(r.default),this.player2=e.getComponent(r.default)},e.prototype.initWall=function(t){for(var e=t.getTileSize(),i=t.getLayer("wall"),o=i.getLayerSize(),a=0;a<o.width;a++)for(var n=0;n<o.height;n++){var r=i.getTiledTileAt(a,n,!0);if(0!=r.gid){r.node.group="wall",r.node.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static;var s=r.node.addComponent(cc.PhysicsBoxCollider);s.offset=cc.v2(e.width/2,e.height/2),s.size=e,s.apply()}}},e.prototype.onKeyDown=function(t){h[t.keyCode]=1},e.prototype.onKeyUp=function(t){h[t.keyCode]=0},e.prototype.keyboardUpdate=function(){this.pause||(this.player1.playerMoveDir("IDLE"),this.player2.playerMoveDir("IDLE"),h[cc.macro.KEY.space]&&this.player1.playerAttack(),h[cc.macro.KEY.m]&&this.player1.playerPower(),h[cc.macro.KEY.s]&&h[cc.macro.KEY.d]?this.player1.playerMoveDir("SE"):h[cc.macro.KEY.d]&&h[cc.macro.KEY.w]?this.player1.playerMoveDir("NE"):h[cc.macro.KEY.w]&&h[cc.macro.KEY.a]?this.player1.playerMoveDir("NW"):h[cc.macro.KEY.a]&&h[cc.macro.KEY.s]?this.player1.playerMoveDir("SW"):h[cc.macro.KEY.a]?this.player1.playerMoveDir("W"):h[cc.macro.KEY.s]?this.player1.playerMoveDir("S"):h[cc.macro.KEY.d]?this.player1.playerMoveDir("E"):h[cc.macro.KEY.w]&&this.player1.playerMoveDir("N"),h[cc.macro.KEY.forwardslash]&&this.player2.playerAttack(),h[cc.macro.KEY.period]&&this.player2.playerPower(),h[cc.macro.KEY.down]&&h[cc.macro.KEY.right]?this.player2.playerMoveDir("SE"):h[cc.macro.KEY.right]&&h[cc.macro.KEY.up]?this.player2.playerMoveDir("NE"):h[cc.macro.KEY.up]&&h[cc.macro.KEY.left]?this.player2.playerMoveDir("NW"):h[cc.macro.KEY.left]&&h[cc.macro.KEY.down]?this.player2.playerMoveDir("SW"):h[cc.macro.KEY.up]?this.player2.playerMoveDir("N"):h[cc.macro.KEY.down]?this.player2.playerMoveDir("S"):h[cc.macro.KEY.right]?this.player2.playerMoveDir("E"):h[cc.macro.KEY.left]&&this.player2.playerMoveDir("W"))},e.prototype.gameOver=function(t){if(this.endBGM(),this.pause=!0,"winner1"==t)(e=cc.find("Canvas/Win")).getComponent(cc.Label).string="Player 1 Win",e.active=!0,this.scheduleOnce(function(){cc.director.loadScene("endgame")},3);else if("winner2"==t){var e;(e=cc.find("Canvas/Win")).getComponent(cc.Label).string="Player 2 Win",e.active=!0,this.scheduleOnce(function(){cc.director.loadScene("endgame")},3)}},e.prototype.update=function(){this.keyboardUpdate()},n([p(cc.Prefab)],e.prototype,"archer",void 0),n([p(cc.Prefab)],e.prototype,"warrior",void 0),n([p(cc.Prefab)],e.prototype,"knight",void 0),n([p(cc.Prefab)],e.prototype,"slinger",void 0),n([p(cc.AudioClip)],e.prototype,"bgm",void 0),n([c],e)}(cc.Component);i.default=l,cc._RF.pop()},{"./fightPlayer":"fightPlayer"}],fightPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"82b31mKDmZOoK0QAyEEDnM0","fightPlayer");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletPrefab=null,e.powerBulletprefab=null,e.attackSound=null,e.moveDir="S",e.aimDir=cc.v2(0,0),e.speed=250,e.anim=null,e.animateState=null,e.maxBullet=5,e.bulletPool=null,e.powerBulletpool=null,e.nextAttackTime=0,e.nextReloadTime=0,e.attackCooldown=.5,e.powerCooltime=5,e.reloadCooldown=5,e.attackRange=300,e.attacking=!1,e.rangeTarget={},e.powerCooldown=!1,e.targetNode=null,e.targetPosition=cc.v2(0,0),e.targetDirection="S",e.targetAngle=0,e.life=10,e.lifeMax=10,e.lifeprogress=null,e.powerprogress=null,e.colorOfpower=null,e.characterName="knight",e.characterTag=0,e.otherPlayerIndex="0",e.otherPlayerJob="knight",e}return a(e,t),e.prototype.onLoad=function(){this.bulletPool=new cc.NodePool("fightBullet"),this.powerBulletpool=new cc.NodePool("powerBullet"),this.anim=this.getComponent(cc.Animation),this.lifeprogress=this.node.getChildByName("lifeBar"),this.powerprogress=this.node.getChildByName("powerBar"),this.colorOfpower=this.powerprogress.getChildByName("bar");var t=this.node.parent.name.slice(-1);this.playerData=JSON.parse(cc.sys.localStorage.getItem("p"+t)),this.speed=75*this.playerData.spd,this.playerData=this.dataUpdata(this.playerData),this.lifeMax=this.playerData.hp,this.otherPlayerIndex="1"==t?"2":"1";try{var e=JSON.parse(cc.sys.localStorage.getItem("p"+t)).job;if(e)switch(this.characterName=e,e){case"archer":this.characterTag=0;break;case"slinger":this.characterTag=1;break;case"warrior":this.characterTag=2;break;case"knight":this.characterTag=3}this.otherPlayerJob=JSON.parse(cc.sys.localStorage.getItem("p"+this.otherPlayerIndex)).job}catch(r){}},e.prototype.start=function(){this.targetNode=cc.find("Canvas/player"+this.otherPlayerIndex+"/"+this.otherPlayerJob);for(var t=0;t<this.maxBullet;t++){var e=cc.instantiate(this.bulletPrefab);this.bulletPool.put(e)}var i=cc.instantiate(this.powerBulletprefab);this.powerBulletpool.put(i),null==this.lifeprogress?cc.log("fail"):this.lifeprogress.getComponent(cc.ProgressBar).progress=1,this.powerprogress.getComponent(cc.ProgressBar).progress=1,this.colorOfpower.color=new cc.Color(0,255,80)},e.prototype.playerMoveDir=function(t){this.moveDir=t},e.prototype.playerMove=function(t){switch(this.moveDir){case"N":this.aimDir=cc.v2(0,1),this.node.y+=this.speed*t;break;case"S":this.aimDir=cc.v2(0,-1),this.node.y-=this.speed*t;break;case"E":this.aimDir=cc.v2(1,0),this.node.x+=this.speed*t;break;case"W":this.aimDir=cc.v2(-1,0),this.node.x-=this.speed*t;break;case"NE":this.aimDir=cc.v2(1,1),this.node.x+=this.speed*t,this.node.y+=this.speed*t;break;case"NW":this.aimDir=cc.v2(-1,1),this.node.x-=this.speed*t,this.node.y+=this.speed*t;break;case"SW":this.aimDir=cc.v2(-1,-1),this.node.x-=this.speed*t,this.node.y-=this.speed*t;break;case"SE":this.aimDir=cc.v2(1,-1),this.node.x+=this.speed*t,this.node.y-=this.speed*t}},e.prototype.playerWalkAnimation=function(){if(!this.attacking)switch(this.moveDir){case"N":null!=this.animateState&&this.animateState.name==this.characterName+"WalkN"||(this.animateState=this.anim.play(this.characterName+"WalkN"));break;case"S":null!=this.animateState&&this.animateState.name==this.characterName+"WalkS"||(this.animateState=this.anim.play(this.characterName+"WalkS"));break;case"E":null!=this.animateState&&this.animateState.name==this.characterName+"WalkE"||(this.animateState=this.anim.play(this.characterName+"WalkE"));break;case"W":null!=this.animateState&&this.animateState.name==this.characterName+"WalkW"||(this.animateState=this.anim.play(this.characterName+"WalkW"));break;case"NE":null!=this.animateState&&this.animateState.name==this.characterName+"WalkNE"||(this.animateState=this.anim.play(this.characterName+"WalkNE"));break;case"NW":null!=this.animateState&&this.animateState.name==this.characterName+"WalkNW"||(this.animateState=this.anim.play(this.characterName+"WalkNW"));break;case"SW":null!=this.animateState&&this.animateState.name==this.characterName+"WalkSW"||(this.animateState=this.anim.play(this.characterName+"WalkSW"));break;case"SE":null!=this.animateState&&this.animateState.name==this.characterName+"WalkSE"||(this.animateState=this.anim.play(this.characterName+"WalkSE"));break;default:this.animateState=null,this.anim.stop()}},e.prototype.playerAttackAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Attack"+this.targetDirection),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.playerDieAnimation=function(){this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Dying"+this.targetDirection)},e.prototype.playerHurtAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Hurt"+this.targetDirection),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.playerAttack=function(){this.traceTarget();var t=cc.director.getTotalTime()/1e3;t>=this.nextAttackTime&&(this.nextAttackTime=t+this.attackCooldown,cc.audioEngine.playEffect(this.attackSound,!1),0==this.characterTag||1==this.characterTag?this.createBullet():this.meleeAttack(),this.playerAttackAnimation())},e.prototype.playerPower=function(){var t=this;if(!this.powerCooldown){if(this.powerCooldown=!0,this.powerprogress.getComponent(cc.ProgressBar).progress=0,this.colorOfpower.color=new cc.Color(25,95,25),0==this.characterTag)this.schedule(function(){t.traceTarget(),t.createBullet(),t.playerAttackAnimation()},.2,4);else if(1==this.characterTag){this.traceTarget();var e=null;this.powerBulletpool.size()>0&&(e=this.powerBulletpool.get(this.powerBulletpool)),null!=e&&e.getComponent("powerBullet").init(this.node,this.targetDirection,this.targetAngle),this.playerAttackAnimation()}else 2==this.characterTag?(this.attackCooldown=.25,this.node.color=new cc.Color(248,86,86),this.scheduleOnce(function(){t.attackCooldown=.5,t.node.color=new cc.Color(255,255,255)},2.5)):3==this.characterTag&&(this.node.color=new cc.Color(134,250,255),this.scheduleOnce(function(){t.node.color=new cc.Color(255,255,255)},2.5));this.scheduleOnce(function(){t.setPowerCooldown(0),t.colorOfpower.color=new cc.Color(0,255,80)},this.powerCooltime)}},e.prototype.setPowerCooldown=function(t){t||(this.powerCooldown=!1)},e.prototype.createBullet=function(){var t=null;if(this.bulletPool.size()>0&&(t=this.bulletPool.get(this.bulletPool)),null!=t){var e=parseInt(this.node.parent.name.slice(-1));t.getComponent("fightBullet").init(this.node,this.targetDirection,this.targetAngle,this.playerData.atk,e)}},e.prototype.meleeAttack=function(){var t=this.node.convertToWorldSpaceAR(cc.v3(0,0,0)),e=this.targetNode.convertToWorldSpaceAR(cc.v3(0,0,0));cc.v2(e.x-t.x,e.y-t.y).mag()<this.attackRange&&this.targetNode.getComponent("fightPlayer").lifeDamage(this.playerData.atk)},e.prototype.traceTarget=function(){var t,e,i=this.node.convertToWorldSpaceAR(cc.v3(0,0,0)),o=this.targetNode.convertToWorldSpaceAR(cc.v3(0,0,0));cc.v2(o.x-i.x,o.y-i.y).mag()>this.attackRange?this.targetPosition=cc.v2(i.x+this.aimDir.x*this.attackRange,i.y+this.aimDir.y*this.attackRange):this.targetPosition=cc.v2(o.x,o.y),this.targetAngle=(t=this.targetPosition.x-i.x,e=this.targetPosition.y-i.y,180*Math.atan2(e,t)/Math.PI),this.targetAngle<157.5&&this.targetAngle>=112.5?this.targetDirection="NW":this.targetAngle<112.5&&this.targetAngle>=67.5?this.targetDirection="N":this.targetAngle<67.5&&this.targetAngle>=22.5?this.targetDirection="NE":this.targetAngle<22.5&&this.targetAngle>=-22.5?this.targetDirection="E":this.targetAngle<-22.5&&this.targetAngle>=-67.5?this.targetDirection="SE":this.targetAngle<-67.5&&this.targetAngle>=-112.5?this.targetDirection="S":this.targetAngle<-112.5&&this.targetAngle>=-157.5?this.targetDirection="SW":this.targetDirection="W"},e.prototype.lifeDamage=function(t){if(this.playerData.hp>0&&(this.playerHurtAnimation(),this.playerData.hp-=t*(1-this.playerData.def/(this.playerData.def+10))),this.playerData.hp<=0){this.playerDieAnimation();var e;e="1"==this.node.parent.name.slice(-1)?"2":"1",cc.find("gameManager").getComponent("fightManager").gameOver("winner"+e)}},e.prototype.update=function(t){this.playerMove(t),this.playerWalkAnimation(),this.lifeprogress.getComponent(cc.ProgressBar).progress=this.playerData.hp/this.lifeMax,this.powerCooldown&&(this.powerprogress.getComponent(cc.ProgressBar).progress+=t/this.powerCooltime)},e.prototype.dataUpdata=function(t){if(t.weapon){var e=JSON.parse(cc.sys.localStorage.getItem(t.weapon));t.atk+=e.atk}if(t.boots){var i=JSON.parse(cc.sys.localStorage.getItem(t.boots));t.def+=i.def,t.hp+=i.hp,t.spd+=i.spd}if(t.armor){var o=JSON.parse(cc.sys.localStorage.getItem(t.armor));t.def+=o.def,t.hp+=o.hp,t.spd+=o.spd}return t},n([c(cc.Prefab)],e.prototype,"bulletPrefab",void 0),n([c(cc.Prefab)],e.prototype,"powerBulletprefab",void 0),n([c(cc.AudioClip)],e.prototype,"attackSound",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],gamerManager:[function(t,e,i){"use strict";cc._RF.push(e,"9e7e14agd9NuLW2mQVAqQh0","gamerManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./player"),s=cc._decorator,c=s.ccclass,p=s.property,h={},l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meleeEnemy=null,e.archerEnemy=null,e.wizard=null,e.archer=null,e.warrior=null,e.knight=null,e.slinger=null,e.bgm=null,e.enemy=null,e.player1=null,e.player2=null,e.mapLeft=null,e.mapRight=null,e.pause=!1,e.physicManager=null,e.meleeEnemyCount=1,e.archerEnemyCount=0,e.wizardCount=0,e.player1_restEnemy=0,e.player2_restEnemy=0,e.player1Job="archer",e.player2Job="archer",e.timer1=null,e.timer2=null,e.timer=0,e.isTiming=!1,e.coin1=null,e.coin2=null,e.coin1label=null,e.coin2label=null,e.passControl=0,e.camera1=null,e.camera2=null,e}return a(e,t),e.prototype.onLoad=function(){this.resetKeyboard(),this.physicManager=cc.director.getPhysicsManager(),this.physicManager.enabled=!0,this.initPlayer();var t=cc.sys.localStorage.getItem("level");this.mapLeft=cc.find("Canvas/map"+t+"_1").getComponent(cc.TiledMap),this.mapRight=cc.find("Canvas/map"+t+"_2").getComponent(cc.TiledMap),this.enemy=cc.find("Canvas/enemy"),this.timer=120,this.timer1=cc.find("Canvas/camera1/bar1/Timer").getComponent(cc.Label),this.timer2=cc.find("Canvas/camera2/bar2/Timer").getComponent(cc.Label),this.coin1label=cc.find("Canvas/camera1/bar1/coin").getComponent(cc.Label),this.coin2label=cc.find("Canvas/camera2/bar2/coin").getComponent(cc.Label),this.coin1=JSON.parse(cc.sys.localStorage.getItem("p1")).money,this.coin2=JSON.parse(cc.sys.localStorage.getItem("p2")).money,this.coin1label.string=this.coin1.toString(),this.coin2label.string=this.coin2.toString(),this.camera1=cc.find("Canvas/camera1"),this.camera2=cc.find("Canvas/camera2")},e.prototype.start=function(){var t=this;this.playBGM(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.initWall(this.mapLeft),this.initWall(this.mapRight);for(var e=1;e<3;e++)this.initEnemies(e,this.meleeEnemyCount,this.wizardCount,this.archerEnemyCount);this.timeCounting=function(){var e=t.timer-1;e<0&&(t.player1_restEnemy>t.player2_restEnemy?t.gameOver("winner2"):t.gameOver("winner1")),t.updateTime(e)},0==this.isTiming&&(this.isTiming=!0,this.schedule(this.timeCounting,1))},e.prototype.resetKeyboard=function(){h[cc.macro.KEY.space]=0,h[cc.macro.KEY.m]=0,h[cc.macro.KEY.s]=0,h[cc.macro.KEY.d]=0,h[cc.macro.KEY.w]=0,h[cc.macro.KEY.a]=0,h[cc.macro.KEY.forwardslash]=0,h[cc.macro.KEY.period]=0,h[cc.macro.KEY.up]=0,h[cc.macro.KEY.down]=0,h[cc.macro.KEY.right]=0,h[cc.macro.KEY.left]=0},e.prototype.playBGM=function(){cc.audioEngine.playMusic(this.bgm,!0)},e.prototype.endBGM=function(){cc.audioEngine.stopMusic()},e.prototype.initPlayer=function(){var t,e;switch(JSON.parse(cc.sys.localStorage.getItem("p1")).job){case"archer":t=cc.instantiate(this.archer);break;case"warrior":t=cc.instantiate(this.warrior);break;case"slinger":t=cc.instantiate(this.slinger);break;case"knight":t=cc.instantiate(this.knight)}switch(t.parent=cc.find("Canvas/player1"),t.setPosition(cc.v2(335,-55)),JSON.parse(cc.sys.localStorage.getItem("p2")).job){case"archer":e=cc.instantiate(this.archer);break;case"warrior":e=cc.instantiate(this.warrior);break;case"slinger":e=cc.instantiate(this.slinger);break;case"knight":e=cc.instantiate(this.knight)}e.parent=cc.find("Canvas/player2"),e.setPosition(cc.v2(335,-55)),this.player1=t.getComponent(r.default),this.player2=e.getComponent(r.default)},e.prototype.updateTime=function(t){this.timer=t,1!=this.passControl&&(this.timer1.string=this.timer.toString()),2!=this.passControl&&(this.timer2.string=this.timer.toString())},e.prototype.addcoin=function(t,e){1==t?(this.coin1+=e,this.coin1label.string=this.coin1.toString()):(this.coin2+=e,this.coin2label.string=this.coin2.toString())},e.prototype.initWall=function(t){for(var e=t.getTileSize(),i=t.getLayer("wall"),o=i.getLayerSize(),a=0;a<o.width;a++)for(var n=0;n<o.height;n++){var r=i.getTiledTileAt(a,n,!0);if(0!=r.gid){r.node.group="wall",r.node.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static;var s=r.node.addComponent(cc.PhysicsBoxCollider);s.offset=cc.v2(e.width/2,e.height/2),s.size=e,s.apply()}}},e.prototype.initEnemies=function(t,e,i,o){for(var a=0;a<e;a++)1==t?(this.player1_restEnemy++,console.log("now p1_enemy: ",this.player1_restEnemy)):2==t&&(this.player2_restEnemy++,console.log("now p2_enemy: ",this.player2_restEnemy)),this.initMelee(t);for(a=0;a<i;a++)1==t?(this.player1_restEnemy++,console.log("now p1_enemy: ",this.player1_restEnemy)):2==t&&(this.player2_restEnemy++,console.log("now p2_enemy: ",this.player2_restEnemy)),this.initWizard(t);for(a=0;a<o;a++)1==t?(this.player1_restEnemy++,console.log("now p1_enemy: ",this.player1_restEnemy)):2==t&&(this.player2_restEnemy++,console.log("now p2_enemy: ",this.player2_restEnemy)),this.initArcher(t)},e.prototype.initMelee=function(t){var e,i=cc.instantiate(this.meleeEnemy);i.parent=cc.find("Canvas/enemy"+t),e=cc.v2(1920*(t-1)-1820+Math.floor(1750*Math.random()),-875+Math.floor(1740*Math.random())),i.setPosition(e)},e.prototype.initWizard=function(t){var e,i=cc.instantiate(this.wizard);i.parent=cc.find("Canvas/enemy"+t),e=cc.v2(1920*(t-1)-1650+Math.floor(1570*Math.random()),-850+Math.floor(1700*Math.random())),i.setPosition(e)},e.prototype.initArcher=function(t){var e,i=cc.instantiate(this.archerEnemy);i.parent=cc.find("Canvas/enemy"+t),e=cc.v2(1920*(t-1)-1820+Math.floor(1750*Math.random()),-875+Math.floor(1740*Math.random())),i.setPosition(e)},e.prototype.onKeyDown=function(t){h[t.keyCode]=1},e.prototype.onKeyUp=function(t){h[t.keyCode]=0},e.prototype.keyboardUpdate=function(){this.pause||(this.player1.playerMoveDir("IDLE"),this.player2.playerMoveDir("IDLE"),h[cc.macro.KEY.space]&&this.player1.playerAttack(),h[cc.macro.KEY.m]&&this.player1.playerPower(),h[cc.macro.KEY.s]&&h[cc.macro.KEY.d]?this.player1.playerMoveDir("SE"):h[cc.macro.KEY.d]&&h[cc.macro.KEY.w]?this.player1.playerMoveDir("NE"):h[cc.macro.KEY.w]&&h[cc.macro.KEY.a]?this.player1.playerMoveDir("NW"):h[cc.macro.KEY.a]&&h[cc.macro.KEY.s]?this.player1.playerMoveDir("SW"):h[cc.macro.KEY.a]?this.player1.playerMoveDir("W"):h[cc.macro.KEY.s]?this.player1.playerMoveDir("S"):h[cc.macro.KEY.d]?this.player1.playerMoveDir("E"):h[cc.macro.KEY.w]&&this.player1.playerMoveDir("N"),h[cc.macro.KEY.forwardslash]&&this.player2.playerAttack(),h[cc.macro.KEY.period]&&this.player2.playerPower(),h[cc.macro.KEY.down]&&h[cc.macro.KEY.right]?this.player2.playerMoveDir("SE"):h[cc.macro.KEY.right]&&h[cc.macro.KEY.up]?this.player2.playerMoveDir("NE"):h[cc.macro.KEY.up]&&h[cc.macro.KEY.left]?this.player2.playerMoveDir("NW"):h[cc.macro.KEY.left]&&h[cc.macro.KEY.down]?this.player2.playerMoveDir("SW"):h[cc.macro.KEY.up]?this.player2.playerMoveDir("N"):h[cc.macro.KEY.down]?this.player2.playerMoveDir("S"):h[cc.macro.KEY.right]?this.player2.playerMoveDir("E"):h[cc.macro.KEY.left]&&this.player2.playerMoveDir("W"))},e.prototype.gameOver=function(t){if(this.pause=!0,cc.sys.localStorage.setItem("winstate",t),"tie"==t){this.endBGM();var e=JSON.parse(cc.sys.localStorage.getItem("p1"));e.money+=this.coin1,cc.log("p1 update",e),cc.sys.localStorage.setItem("p1",JSON.stringify(e)),(e=JSON.parse(cc.sys.localStorage.getItem("p2"))).money+=this.coin2,cc.log("p2 update",e),cc.sys.localStorage.setItem("p2",JSON.stringify(e)),this.camera1.active=!1,this.camera2.active=!1,cc.find("Canvas/loadingCamera").active=!0,cc.find("Canvas/loading_bg").active=!0,this.scheduleOnce(function(){cc.director.loadScene("shop")},.3)}else"winner1"==t?(this.endBGM(),cc.find("Canvas/camera1/Clean").active=!1,cc.find("Canvas/camera2/Clean").active=!1,cc.find("Canvas/camera1/Win").active=!0,cc.find("Canvas/camera2/Lose").active=!0,this.scheduleOnce(function(){cc.director.loadScene("endgame")},3)):"winner2"==t&&(this.endBGM(),cc.find("Canvas/camera1/Clean").active=!1,cc.find("Canvas/camera2/Clean").active=!1,cc.find("Canvas/camera1/Lose").active=!0,cc.find("Canvas/camera2/Win").active=!0,this.scheduleOnce(function(){cc.director.loadScene("endgame")},3))},e.prototype.update=function(){this.keyboardUpdate()},e.prototype.enemyReduce=function(t){if(t>0?(this.player2_restEnemy-=1,0==this.player2_restEnemy&&(0==this.player1_restEnemy?this.gameOver("tie"):(cc.find("Canvas/camera2/Clean").active=!0,0==this.passControl&&(this.passControl=2)))):(this.player1_restEnemy-=1,0==this.player1_restEnemy&&(0==this.player2_restEnemy?this.gameOver("tie"):(cc.find("Canvas/camera1/Clean").active=!0,0==this.passControl&&(this.passControl=1)))),3==this.passControl){var e=JSON.parse(cc.sys.localStorage.getItem("p1"));e.money+=this.coin1,cc.log("p1 update",e),cc.sys.localStorage.setItem("p1",JSON.stringify(e)),(e=JSON.parse(cc.sys.localStorage.getItem("p2"))).money+=this.coin2,cc.log("p2 update",e),cc.sys.localStorage.setItem("p2",JSON.stringify(e)),this.camera1.active=!1,this.camera2.active=!1,cc.find("Canvas/loadingCamera").active=!0,cc.find("Canvas/loading_bg").active=!0,this.endBGM(),cc.director.loadScene("shop")}},n([p(cc.Prefab)],e.prototype,"meleeEnemy",void 0),n([p(cc.Prefab)],e.prototype,"archerEnemy",void 0),n([p(cc.Prefab)],e.prototype,"wizard",void 0),n([p(cc.Prefab)],e.prototype,"archer",void 0),n([p(cc.Prefab)],e.prototype,"warrior",void 0),n([p(cc.Prefab)],e.prototype,"knight",void 0),n([p(cc.Prefab)],e.prototype,"slinger",void 0),n([p(cc.AudioClip)],e.prototype,"bgm",void 0),n([c],e)}(cc.Component);i.default=l,cc._RF.pop()},{"./player":"player"}],leaderboard:[function(t,e,i){"use strict";cc._RF.push(e,"0c4cdzt5LJBn4U/hnuuScqY","leaderboard");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e}return a(e,t),e.prototype.onLoad=function(){this.label=cc.find("Canvas/board/view/content/item").getComponent(cc.Label),this.label.string="name        rate       games\ntimothy      90            20\nDanny\nDaniel"},e.prototype.start=function(){},e.prototype.backToStart=function(){cc.director.loadScene("start")},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],meleeEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"21e92XrQR1KC5am5+uTnqKr","meleeEnemy");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./player"),s=cc._decorator,c=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.knifeSound=null,e.killedSound=null,e.gameManager=null,e.target=null,e.detectRange=300,e.attackCooldown=2,e.nextAttackTime=0,e.moveSpeed=40,e.attackDir=cc.v2(0,0),e.tracingPlayer=!1,e.setPathCooldown=.5,e.traceCooldown=.1,e.traceSpeed=160,e.tracePath=[],e.moveDir=cc.Vec2.ZERO,e.moveDuration=2,e.waitDuration=2,e.nextWaitTime=0,e.nextMoveTime=0,e.nextTraceTime=0,e.waitRandomFactor=.1,e.enemyLife=150,e.enemyMaxLife=150,e.enemyLifeProgress=null,e.anim=null,e.animateState=null,e.attacking=null,e.lastPosition=cc.v2(0,0),e.damage=7,e}return a(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){this.gameManager=cc.find("gameManager");var t=this.node.parent.name.slice(-1);try{var e=JSON.parse(cc.sys.localStorage.getItem("p"+t)).job;e&&(this.target=cc.find("Canvas/player"+t).getChildByName(e))}catch(s){}this.enemyLifeProgress=this.node.getChildByName("lifeBar"),this.anim=this.getComponent(cc.Animation)},e.prototype.wandering=function(t){var e,i=cc.director.getTotalTime()/1e3;i>=this.nextMoveTime&&(this.nextWaitTime=i+this.moveDuration,this.nextMoveTime=this.nextWaitTime+this.waitDuration*(1+this.waitRandomFactor*(2*Math.random()-1)),this.moveDir=(e=Math.random()*Math.PI*2,new cc.Vec2(Math.cos(e),Math.sin(e)))),i<this.nextWaitTime&&(this.node.x+=this.moveDir.x*this.moveSpeed*t,this.node.y+=this.moveDir.y*this.moveSpeed*t)},e.prototype.setPath=function(){var t=cc.v2(0,0);this.tracingPlayer&&(t=this.target.convertToWorldSpaceAR(cc.v2(0,0))),this.tracePath=this.node.getComponent("pathFinding").pathFindingAlgo(t);for(var e=this.tracePath.length,i=[],o=0;o<Math.min(e,10);o++)i.push(cc.moveBy(.05,16*this.tracePath[o][0],-16*this.tracePath[o][1]));if(i.length>1){var a=cc.sequence(i);this.node.runAction(a)}},e.prototype.detectRangePlayer=function(){return this.node.convertToWorldSpaceAR(cc.v2(0,0)).sub(this.target.convertToWorldSpaceAR(cc.v2(0,0))).mag()<this.detectRange&&(this.moveSpeed=200,this.tracingPlayer=!0),0},e.prototype.enemyWalkAnimation=function(){this.attacking||(this.moveDir.x>0?null!=this.animateState&&"walkRight"==this.animateState.name||(this.animateState=this.anim.play("walkRight")):this.moveDir.x<0?null!=this.animateState&&"walkLeft"==this.animateState.name||(this.animateState=this.anim.play("walkLeft")):this.moveDir.y>0?null!=this.animateState&&"walkUp"==this.animateState.name||(this.animateState=this.anim.play("walkUp")):this.moveDir.y<0?null!=this.animateState&&"walkDown"==this.animateState.name||(this.animateState=this.anim.play("walkDown")):(this.animateState=null,this.anim.stop()))},e.prototype.enemyAttackAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,this.attackDir.x>0?this.animateState=this.anim.play("attackRight"):this.attackDir.x<0?this.animateState=this.anim.play("attackLeft"):this.attackDir.y>0?this.animateState=this.anim.play("attackUp"):this.attackDir.y<0&&(this.animateState=this.anim.play("attackDown")),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.enemyHurt=function(t){this.enemyLife-=t,this.enemyLifeProgress.getComponent(cc.ProgressBar).progress=this.enemyLife/this.enemyMaxLife,this.enemyLife<=0&&(this.node.active=!1,"enemy1"==this.node.parent.name?this.gameManager.getComponent("gamerManager").addcoin(1,10):"enemy2"==this.node.parent.name&&this.gameManager.getComponent("gamerManager").addcoin(2,10),this.gameManager.getComponent("gamerManager").enemyReduce(this.node.x),cc.audioEngine.playEffect(this.killedSound,!1),this.node.destroy())},e.prototype.update=function(t){var e=cc.director.getTotalTime()/1e3;if(this.tracingPlayer){e>=this.nextTraceTime&&(this.nextTraceTime=e+this.setPathCooldown,this.setPath(),this.nextMoveTime=e);var i=this.node.position.x-this.lastPosition.x,o=this.node.position.y-this.lastPosition.y;this.moveDir.x=i>0?1:i<0?-1:0,this.moveDir.y=o>0?1:o<0?-1:0,this.lastPosition=cc.v2(this.node.position.x,this.node.position.y)}else this.wandering(t),this.detectRangePlayer();this.enemyWalkAnimation()},e.prototype.onBeginContact=function(t,e,i){if(1==i.tag){var o=cc.director.getTotalTime()/1e3;o>=this.nextAttackTime&&(this.attackDir=t.getWorldManifold().normal,cc.audioEngine.playEffect(this.knifeSound,!1),this.nextAttackTime=o+this.attackCooldown,this.enemyAttackAnimation(),i.node.getComponent(r.default).lifeDamage(this.damage))}},e.prototype.onPreSolve=function(t,e,i){if(!this.attacking&&1==i.tag){var o=cc.director.getTotalTime()/1e3;o>=this.nextAttackTime&&(this.attackDir=t.getWorldManifold().normal,cc.audioEngine.playEffect(this.knifeSound,!1),this.nextAttackTime=o+this.attackCooldown,this.enemyAttackAnimation(),i.node.getComponent(r.default).lifeDamage(this.damage))}},n([p({type:cc.AudioClip})],e.prototype,"knifeSound",void 0),n([p({type:cc.AudioClip})],e.prototype,"killedSound",void 0),n([c],e)}(cc.Component);i.default=h,cc._RF.pop()},{"./player":"player"}],next:[function(t,e,i){"use strict";cc._RF.push(e,"c343cMAF9dJGo26ByM2dd9o","next");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.confirmPrefabs=null,e.shopManager=null,e}return a(e,t),e.prototype.onLoad=function(){this.shopManager=cc.find("Canvas/shopManager");var t=new cc.Component.EventHandler;t.target=this.node,t.component="next",t.handler="BTN_Click",this.node.getComponent(cc.Button).interactable=!1,cc.find("Canvas/next").getComponent(cc.Button).clickEvents.push(t)},e.prototype.start=function(){var t=this;this.node.on(cc.Node.EventType.MOUSE_MOVE,function(){t.shopManager.getComponent("shopManager").check_buttonshow()||(t.node.getComponent(cc.Button).interactable=!0)},this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){t.node.getComponent(cc.Button).interactable=!1},this)},e.prototype.BTN_Click=function(){this.shopManager.getComponent("shopManager").check_buttonshow()||(cc.instantiate(this.confirmPrefabs).getComponent("confirm").init(this.node,"",3,""),this.shopManager.getComponent("shopManager").readyNext())},n([c(cc.Prefab)],e.prototype,"confirmPrefabs",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],ok:[function(t,e,i){"use strict";cc._RF.push(e,"0c526FpfYJDnqhkABJV9Kne","ok");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shopManager=null,e}return a(e,t),e.prototype.onLoad=function(){this.shopManager=cc.find("Canvas/shopManager");var t=new cc.Component.EventHandler;t.target=this.node,t.component="ok",t.handler="reply",cc.find("Canvas/confirm/ok").getComponent(cc.Button).clickEvents.push(t)},e.prototype.reply=function(){this.node.parent.getComponent("confirm").equipClean(),this.shopManager.getComponent("shopManager").OK(),this.node.parent.destroy()},n([c(cc.Node)],e.prototype,"shopManager",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],pathFinding:[function(t,e){"use strict";function i(t){this.content=[],this.scoreFunction=t}cc._RF.push(e,"cbc27MGB4RGd4k254NNoawP","pathFinding"),cc.Class({extends:cc.Component,mapNode:null,initialNodeArray:null,tiledSize:0,layer:null,layerSize:null,nodeArray:null,nextCalculateTime:0,path:null,wall:null,pathLen:0,onLoad:function(){var t=this.node.parent.name.slice(-1),e=cc.sys.localStorage.getItem("level");this.mapNode=cc.find("Canvas/map"+e+"_"+t),this.path=new Array(cc.v2),this.tiledMap=this.mapNode.getComponent(cc.TiledMap),this.tiledSize=this.tiledMap.getTileSize(),this.layer=this.tiledMap.getLayer("wall"),this.layerSize=this.layer.getLayerSize(),this.initialNodeArray=new Array(this.layerSize.width);for(var i=0;i<this.layerSize.width;i++)this.initialNodeArray[i]=new Array(this.layerSize.height);this.initMap()},start:function(){this.nextCalculateTime=cc.director.getTotalTime()/1e3},initMap:function(){for(var t=[],e=0;e<this.layerSize.width;e++)for(var i=0;i<this.layerSize.height;i++){0!=this.layer.getTiledTileAt(e,i,!0).gid&&t.push({x:e,y:i});var o={x:e,y:i,f:Number.MAX_SAFE_INTEGER,g:Number.MAX_SAFE_INTEGER,h:Number.MAX_SAFE_INTEGER,cost:1,visited:!1,closed:!1,parent:null,wall:!1};this.initialNodeArray[e][i]=o}for(var a=0;a<t.length;a++)this.createWallAround(t[a].x,t[a].y)},createWallAround:function(t,e){this.initialNodeArray[t][e].wall=!0,t>0&&(this.initialNodeArray[t-1][e].wall=!0),t<this.layerSize.width-1&&(this.initialNodeArray[t+1][e].wall=!0),e>0&&(this.initialNodeArray[t][e-1].wall=!0),e<this.layerSize.height-1&&(this.initialNodeArray[t][e+1].wall=!0),t>0&&e>0&&(this.initialNodeArray[t-1][e-1].wall=!0),t<this.layerSize.width-1&&e>0&&(this.initialNodeArray[t+1][e-1].wall=!0),t>0&&e<this.layerSize.height-1&&(this.initialNodeArray[t-1][e+1].wall=!0),t<this.layerSize.width-1&&e<this.layerSize.height-1&&(this.initialNodeArray[t+1][e+1].wall=!0)},reloadMap:function(){this.nodeArray=new Array(this.layerSize.width);for(var t=0;t<this.layerSize.width;t++){this.nodeArray[t]=new Array(this.layerSize.height),this.nodeArray[t]=Object.assign({},this.initialNodeArray[t]);for(var e=0;e<this.layerSize.height;e++)this.nodeArray[t][e]=Object.assign({},this.initialNodeArray[t][e])}},buildHeap:function(){return new i(function(t){return t.f})},nodeNeighbors:function(t){var e=[],i=t.x,o=t.y;return i>0&&(this.nodeArray[i-1][o].cost=1,e.push(this.nodeArray[i-1][o])),i<this.layerSize.width-1&&(this.nodeArray[i+1][o].cost=1,e.push(this.nodeArray[i+1][o])),o>0&&(this.nodeArray[i][o-1].cost=1,e.push(this.nodeArray[i][o-1])),o<this.layerSize.height-1&&(this.nodeArray[i][o+1].cost=1,e.push(this.nodeArray[i][o+1])),i>0&&o>0&&(this.nodeArray[i-1][o-1].cost=1,e.push(this.nodeArray[i-1][o-1])),i<this.layerSize.width-1&&o>0&&(this.nodeArray[i+1][o-1].cost=1,e.push(this.nodeArray[i+1][o-1])),i>0&&o<this.layerSize.height-1&&(this.nodeArray[i-1][o+1].cost=1,e.push(this.nodeArray[i-1][o+1])),i<this.layerSize.width-1&&o<this.layerSize.height-1&&(this.nodeArray[i+1][o+1].cost=1,e.push(this.nodeArray[i+1][o+1])),e},heuristic:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-t.y)},pathFindingAlgo:function(t){this.reloadMap();var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),i=this.mapNode.convertToNodeSpaceAR(e);t=this.mapNode.convertToNodeSpaceAR(t);var o=Math.round(i.x/this.tiledSize.width),a=this.layerSize.height-Math.round(i.y/this.tiledSize.height),n=Math.round(t.x/this.tiledSize.width),r=this.layerSize.height-Math.round(t.y/this.tiledSize.height),s=this.nodeArray[o][a],c=this.nodeArray[n][r],p=this.buildHeap();for(p.push(s);p.size()>0;){var h=p.pop();if(h===c){for(var l=h,d=[];l.parent;)d.push([l.x-l.parent.x,l.y-l.parent.y]),l=l.parent;return d.reverse()}h.closed=!0;for(var u=[0,0,1,-1,1,1,-1,-1],y=[1,-1,0,0,1,-1,-1,1],f=0;f<8;f++){var g=h.x+u[f],m=h.y+y[f];if(!(g<0||m<0||g>=this.layerSize.width||m>=this.layerSize.height)){var v=this.nodeArray[g][m];if(!v.closed&&!v.wall||v==c){var b=h.cost;f>=4&&(b+=.3);var S=v.visited;(!S||b<v.g)&&(v.visited=!0,v.parent=h,v.h=this.heuristic(v,c),v.g=b,v.f=v.g+v.h,S?p.rescoreElement(v):p.push(v))}}}}return[]},update:function(){}}),i.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},remove:function(t){for(var e=this.content.length,i=0;i<e;i++)if(this.content[i]==t){var o=this.content.pop();if(i==e-1)break;this.content[i]=o,this.bubbleUp(i),this.sinkDown(i);break}},size:function(){return this.content.length},bubbleUp:function(t){for(var e=this.content[t],i=this.scoreFunction(e);t>0;){var o=Math.floor((t+1)/2)-1,a=this.content[o];if(i>=this.scoreFunction(a))break;this.content[o]=e,this.content[t]=a,t=o}},sinkDown:function(t){for(var e=this.content.length,i=this.content[t],o=this.scoreFunction(i);;){var a=2*(t+1),n=a-1,r=null;if(n<e){var s=this.content[n],c=this.scoreFunction(s);c<o&&(r=n)}if(a<e){var p=this.content[a];this.scoreFunction(p)<(null==r?o:c)&&(r=a)}if(null==r)break;this.content[t]=this.content[r],this.content[r]=i,t=r}}},cc._RF.pop()},{}],playerEquip:[function(t,e,i){"use strict";cc._RF.push(e,"9059ep7JYRI35k9JgMr4v2r","playerEquip");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shopManager=null,e.confirmPrefabs=null,e.dataBoxPrefabs=null,e.dataShow=!1,e.tag=0,e.type="",e.equipName="",e}return a(e,t),e.prototype.onLoad=function(){this.shopManager=cc.find("Canvas/shopManager");var t=new cc.Component.EventHandler;t.target=this.node,t.component="playerEquip",t.handler="BTN_Click",this.node.getComponent(cc.Button).interactable=!1},e.prototype.start=function(){var t,e=this;this.node.on(cc.Node.EventType.MOUSE_MOVE,function(){if(!e.dataShow){e.shopManager.getComponent("shopManager").check_buttonshow()||(e.node.getComponent(cc.Button).interactable=!0),e.dataShow=!0;var i=JSON.parse(cc.sys.localStorage.getItem(e.node.name));(t=cc.instantiate(e.dataBoxPrefabs)).getComponent("dataBox").init(e.node,e.tag,"player",i.atk,i.def,i.hp,i.spd)}},this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){e.node.getComponent(cc.Button).interactable=!1,e.dataShow&&(e.dataShow=!1,t.destroy())},this)},e.prototype.BTN_Click=function(){this.shopManager.getComponent("shopManager").check_buttonshow()||(this.shopManager.getComponent("shopManager").equipSell(this.tag,this.type,this.equipName),cc.instantiate(this.confirmPrefabs).getComponent("confirm").init(this.node,this.equipName,this.tag,"sell"))},e.prototype.init=function(t,e,i,o,a,n){this.node.parent=t.parent,this.tag=e,this.type=i,this.equipName=o,this.node.position=cc.v3(a,n)},n([c(cc.Node)],e.prototype,"shopManager",void 0),n([c(cc.Prefab)],e.prototype,"confirmPrefabs",void 0),n([c(cc.Prefab)],e.prototype,"dataBoxPrefabs",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],playerShopping:[function(t,e,i){"use strict";cc._RF.push(e,"b62771M5lBBv7SUJbJMOQ6n","playerShopping");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anim=null,e.tag=0,e}return a(e,t),e.prototype.init=function(t,e,i){this.node.parent=t.parent,this.tag=i,this.anim=this.getComponent(cc.Animation),"archer"==e?this.anim.play("archerStanding"):"knight"==e?this.anim.play("knightStanding"):"slinger"==e?this.anim.play("slingerStanding"):"warrior"==e&&this.anim.play("warriorStanding"),1==this.tag?this.node.position=cc.v3(-450,-280):this.node.position=cc.v3(450,-280)},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],player:[function(t,e,i){"use strict";cc._RF.push(e,"734cf13gy1LP7FvtfHFr+av","player");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=t("./gamerManager"),s=cc._decorator,c=s.ccclass,p=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletPrefab=null,e.powerBulletprefab=null,e.attackSound=null,e.moveDir="S",e.aimDir=cc.v2(0,0),e.speed=250,e.anim=null,e.animateState=null,e.maxBullet=5,e.bulletPool=null,e.powerBulletpool=null,e.nextAttackTime=0,e.nextReloadTime=0,e.attackCooldown=.5,e.powerCooltime=5,e.reloadCooldown=5,e.attackRange=300,e.attacking=!1,e.rangeTarget={},e.powerCooldown=!1,e.enemys=null,e.enemyCount=0,e.targetPosition=cc.v2(0,0),e.targetDirection="S",e.targetAngle=0,e.life=10,e.lifeMax=10,e.lifeprogress=null,e.powerprogress=null,e.colorOfpower=null,e.characterName="archer",e.characterTag=0,e}return a(e,t),e.prototype.onLoad=function(){this.bulletPool=new cc.NodePool("bullet"),this.powerBulletpool=new cc.NodePool("powerBullet"),this.anim=this.getComponent(cc.Animation),this.lifeprogress=this.node.getChildByName("lifeBar"),this.powerprogress=this.node.getChildByName("powerBar"),this.colorOfpower=this.powerprogress.getChildByName("bar");var t=this.node.parent.name.slice(-1);this.enemys=cc.find("Canvas/enemy"+t),this.enemyCount=this.enemys.childrenCount,this.playerData=JSON.parse(cc.sys.localStorage.getItem("p"+t)),this.speed=75*this.playerData.spd,this.playerData=this.dataUpdata(this.playerData),this.lifeMax=this.playerData.hp;try{var e=JSON.parse(cc.sys.localStorage.getItem("p"+t)).job;if(e)switch(this.characterName=e,e){case"archer":this.characterTag=0;break;case"slinger":this.characterTag=1;break;case"warrior":this.characterTag=2;break;case"knight":this.characterTag=3}}catch(s){}},e.prototype.start=function(){for(var t=0;t<this.maxBullet;t++){var e=cc.instantiate(this.bulletPrefab);this.bulletPool.put(e)}var i=cc.instantiate(this.powerBulletprefab);this.powerBulletpool.put(i),null==this.lifeprogress?cc.log("fail"):this.lifeprogress.getComponent(cc.ProgressBar).progress=1,this.powerprogress.getComponent(cc.ProgressBar).progress=1,this.colorOfpower.color=new cc.Color(0,255,80)},e.prototype.playerMoveDir=function(t){this.moveDir=t},e.prototype.playerMove=function(t){switch(this.moveDir){case"N":this.aimDir=cc.v2(0,1),this.node.y+=this.speed*t;break;case"S":this.aimDir=cc.v2(0,-1),this.node.y-=this.speed*t;break;case"E":this.aimDir=cc.v2(1,0),this.node.x+=this.speed*t;break;case"W":this.aimDir=cc.v2(-1,0),this.node.x-=this.speed*t;break;case"NE":this.aimDir=cc.v2(1,1),this.node.x+=this.speed*t,this.node.y+=this.speed*t;break;case"NW":this.aimDir=cc.v2(-1,1),this.node.x-=this.speed*t,this.node.y+=this.speed*t;break;case"SW":this.aimDir=cc.v2(-1,-1),this.node.x-=this.speed*t,this.node.y-=this.speed*t;break;case"SE":this.aimDir=cc.v2(1,-1),this.node.x+=this.speed*t,this.node.y-=this.speed*t}},e.prototype.playerWalkAnimation=function(){if(!this.attacking)switch(this.moveDir){case"N":null!=this.animateState&&this.animateState.name==this.characterName+"WalkN"||(this.animateState=this.anim.play(this.characterName+"WalkN"));break;case"S":null!=this.animateState&&this.animateState.name==this.characterName+"WalkS"||(this.animateState=this.anim.play(this.characterName+"WalkS"));break;case"E":null!=this.animateState&&this.animateState.name==this.characterName+"WalkE"||(this.animateState=this.anim.play(this.characterName+"WalkE"));break;case"W":null!=this.animateState&&this.animateState.name==this.characterName+"WalkW"||(this.animateState=this.anim.play(this.characterName+"WalkW"));break;case"NE":null!=this.animateState&&this.animateState.name==this.characterName+"WalkNE"||(this.animateState=this.anim.play(this.characterName+"WalkNE"));break;case"NW":null!=this.animateState&&this.animateState.name==this.characterName+"WalkNW"||(this.animateState=this.anim.play(this.characterName+"WalkNW"));break;case"SW":null!=this.animateState&&this.animateState.name==this.characterName+"WalkSW"||(this.animateState=this.anim.play(this.characterName+"WalkSW"));break;case"SE":null!=this.animateState&&this.animateState.name==this.characterName+"WalkSE"||(this.animateState=this.anim.play(this.characterName+"WalkSE"));break;default:this.animateState=null,this.anim.stop()}},e.prototype.playerAttackAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Attack"+this.targetDirection),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.playerDieAnimation=function(){this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Dying"+this.targetDirection)},e.prototype.playerHurtAnimation=function(){var t=this;this.anim.stop(),this.attacking=!0,this.animateState=this.anim.play(this.characterName+"Hurt"+this.targetDirection),this.anim.on("finished",function(){t.attacking=!1})},e.prototype.playerAttack=function(){this.traceEnemy();var t=cc.director.getTotalTime()/1e3;t>=this.nextAttackTime&&(this.nextAttackTime=t+this.attackCooldown,cc.audioEngine.playEffect(this.attackSound,!1),0==this.characterTag||1==this.characterTag?this.createBullet():this.meleeAttack(),this.playerAttackAnimation())},e.prototype.playerPower=function(){var t=this;if(!this.powerCooldown){if(this.powerCooldown=!0,this.powerprogress.getComponent(cc.ProgressBar).progress=0,this.colorOfpower.color=new cc.Color(25,95,25),0==this.characterTag)this.schedule(function(){t.traceEnemy(),t.createBullet(),t.playerAttackAnimation()},.1,4);else if(1==this.characterTag){this.traceEnemy();var e=null;this.powerBulletpool.size()>0&&(e=this.powerBulletpool.get(this.powerBulletpool)),null!=e&&e.getComponent("powerBullet").init(this.node,this.targetDirection,this.targetAngle),this.playerAttackAnimation()}else 2==this.characterTag?(this.attackCooldown=.25,this.node.color=new cc.Color(248,86,86),this.scheduleOnce(function(){t.attackCooldown=.5,t.node.color=new cc.Color(255,255,255)},2.5)):3==this.characterTag&&(this.node.color=new cc.Color(134,250,255),this.playerData.def=2*this.playerData.def+20,this.scheduleOnce(function(){t.playerData.def=(t.playerData.def-20)/2,t.node.color=new cc.Color(255,255,255)},2.5));this.scheduleOnce(function(){t.setPowerCooldown(0),t.colorOfpower.color=new cc.Color(0,255,10)},this.powerCooltime)}},e.prototype.setPowerCooldown=function(t){t||(this.powerCooldown=!1)},e.prototype.createBullet=function(){var t=null;this.bulletPool.size()>0&&(t=this.bulletPool.get(this.bulletPool)),null!=t&&t.getComponent("bullet").init(this.node,this.targetDirection,this.targetAngle,this.playerData.atk)},e.prototype.meleeAttack=function(){if(this.rangeTarget)for(var t in this.rangeTarget){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),i=this.rangeTarget[t],o=l(i.x-e.x,i.y-e.y);if(o<this.targetAngle+22.5&&o>(this.targetAngle-22.5)%360){var a=this.enemys.children[t];a.getComponent(a.name).enemyHurt(this.playerData.atk)}}this.rangeTarget={}},e.prototype.traceEnemy=function(){var t=9007199254740992,e=cc.v2(0,0),i=this.node.convertToWorldSpaceAR(cc.v3(0,0,0));this.enemyCount=this.enemys.childrenCount;for(var o=0;o<this.enemyCount;o++){var a=this.enemys.children[o].convertToWorldSpaceAR(cc.v3(0,0,0)),n=i.sub(a).mag();n<t&&(t=n,e=cc.v2(a.x,a.y)),n<=this.attackRange&&(this.rangeTarget[o]=cc.v2(a.x,a.y))}cc.v2(e.x-i.x,e.y-i.y).mag()>this.attackRange?this.targetPosition=cc.v2(i.x+this.aimDir.x*this.attackRange,i.y+this.aimDir.y*this.attackRange):this.targetPosition=e,this.targetAngle=l(this.targetPosition.x-i.x,this.targetPosition.y-i.y),this.targetAngle<157.5&&this.targetAngle>=112.5?this.targetDirection="NW":this.targetAngle<112.5&&this.targetAngle>=67.5?this.targetDirection="N":this.targetAngle<67.5&&this.targetAngle>=22.5?this.targetDirection="NE":this.targetAngle<22.5&&this.targetAngle>=-22.5?this.targetDirection="E":this.targetAngle<-22.5&&this.targetAngle>=-67.5?this.targetDirection="SE":this.targetAngle<-67.5&&this.targetAngle>=-112.5?this.targetDirection="S":this.targetAngle<-112.5&&this.targetAngle>=-157.5?this.targetDirection="SW":this.targetDirection="W"},e.prototype.lifeDamage=function(t){if(this.playerData.hp>0&&(this.playerHurtAnimation(),console.log("before hurt",this.playerData.hp),this.playerData.hp-=t*(1-this.playerData.def/(this.playerData.def+10))),this.playerData.hp<=0){this.playerDieAnimation();var e;e="1"==this.node.parent.name.slice(-1)?"2":"1",cc.find("gameManager").getComponent(r.default).gameOver("winner"+e)}},e.prototype.update=function(t){this.playerMove(t),this.playerWalkAnimation(),this.lifeprogress.getComponent(cc.ProgressBar).progress=this.playerData.hp/this.lifeMax,this.powerCooldown&&(this.powerprogress.getComponent(cc.ProgressBar).progress+=t/this.powerCooltime)},e.prototype.dataUpdata=function(t){if(t.weapon){var e=JSON.parse(cc.sys.localStorage.getItem(t.weapon));t.atk+=e.atk}if(t.boots){var i=JSON.parse(cc.sys.localStorage.getItem(t.boots));t.def+=i.def,t.hp+=i.hp,t.spd+=i.spd}if(t.armor){var o=JSON.parse(cc.sys.localStorage.getItem(t.armor));t.def+=o.def,t.hp+=o.hp,t.spd+=o.spd}return t},n([p(cc.Prefab)],e.prototype,"bulletPrefab",void 0),n([p(cc.Prefab)],e.prototype,"powerBulletprefab",void 0),n([p(cc.AudioClip)],e.prototype,"attackSound",void 0),n([c],e)}(cc.Component);function l(t,e){return 180*Math.atan2(e,t)/Math.PI}i.default=h,cc._RF.pop()},{"./gamerManager":"gamerManager"}],powerBullet:[function(t,e,i){"use strict";cc._RF.push(e,"aaa45A7DYxPV4NKbKaQmmIl","powerBullet");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bulletManager=null,e.bulletSpeed=10,e.initPosOffset=32,e.damage=1,e.speedX=0,e.speedY=0,e.isTriggered=!1,e}return a(e,t),e.prototype.init=function(t,e,i){var o=this;this.setInitPos(t,e),this.speedX=Math.cos(i*Math.PI/180),this.speedY=Math.sin(i*Math.PI/180),this.scheduleOnce(function(){o.bulletManager.put(o.node),console.log("after put, powerpool size: ",o.bulletManager.size())},1.5)},e.prototype.reuse=function(t){this.bulletManager=t,this.isTriggered=!1},e.prototype.setInitPos=function(t,e){switch(this.node.parent=t.parent,e){case"N":this.node.setPosition(cc.v2(0,this.initPosOffset));break;case"S":this.node.setPosition(cc.v2(0,-1*this.initPosOffset));break;case"E":this.node.setPosition(cc.v2(this.initPosOffset,0));break;case"W":this.node.setPosition(cc.v2(-1*this.initPosOffset,0));break;case"NE":this.node.setPosition(cc.v2(this.initPosOffset,this.initPosOffset));break;case"NW":this.node.setPosition(cc.v2(-1*this.initPosOffset,this.initPosOffset));break;case"SW":this.node.setPosition(cc.v2(-1*this.initPosOffset,-1*this.initPosOffset));break;case"SE":this.node.setPosition(cc.v2(this.initPosOffset,-1*this.initPosOffset))}this.node.position=this.node.position.addSelf(t.position)},e.prototype.update=function(){this.node.x+=this.bulletSpeed*this.speedX,this.node.y+=this.bulletSpeed*this.speedY},e.prototype.onBeginContact=function(t,e,i){var o=this;1!=i.tag?2==i.tag?i.getComponent(i.node.name).enemyHurt(this.damage):(this.node.stopAllActions(),this.unscheduleAllCallbacks(),this.scheduleOnce(function(){o.bulletManager.put(o.node)},.03)):t.disabled=!0},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],shopEquip:[function(t,e,i){"use strict";cc._RF.push(e,"4f4f5IITzVNla4/JwBtfXk8","shopEquip");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.shopManager=null,e.confirmPrefabs=null,e.dataBoxPrefabs=null,e.type="",e.equipName="",e.dataShow=!1,e.tag=0,e}return a(e,t),e.prototype.onLoad=function(){this.shopManager=cc.find("Canvas/shopManager");var t=new cc.Component.EventHandler;t.target=this.node,t.component="shopEquip",t.handler="BTN_Click",this.node.getComponent(cc.Button).interactable=!1},e.prototype.start=function(){var t=this;this.tag=this.node.parent.parent.getComponent("shop").getTag();var e,i=JSON.parse(cc.sys.localStorage.getItem(this.equipName)).price;this.node.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string=i,this.node.on(cc.Node.EventType.MOUSE_MOVE,function(){if(!t.dataShow){t.shopManager.getComponent("shopManager").check_buttonshow()||(t.node.getComponent(cc.Button).interactable=!0),t.dataShow=!0;var i=JSON.parse(cc.sys.localStorage.getItem(t.node.name));(e=cc.instantiate(t.dataBoxPrefabs)).getComponent("dataBox").init(t.node,t.tag,"shop",i.atk,i.def,i.hp,i.spd)}},this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,function(){t.node.getComponent(cc.Button).interactable=!1,t.dataShow&&(t.dataShow=!1,e.destroy())},this)},e.prototype.BTN_Click=function(){this.shopManager.getComponent("shopManager").check_buttonshow()||(this.shopManager.getComponent("shopManager").equipBuy(this.tag,this.type,this.equipName),cc.instantiate(this.confirmPrefabs).getComponent("confirm").init(this.node.parent.parent,this.equipName,this.tag,"buy"))},n([c(cc.Node)],e.prototype,"shopManager",void 0),n([c(cc.Prefab)],e.prototype,"confirmPrefabs",void 0),n([c(cc.Prefab)],e.prototype,"dataBoxPrefabs",void 0),n([c()],e.prototype,"type",void 0),n([c()],e.prototype,"equipName",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],shopManager:[function(t,e,i){"use strict";cc._RF.push(e,"8da2f8lSL1NFpSg+i3Q1rkJ","shopManager");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.archerShop=null,e.knightShop=null,e.slingerShop=null,e.warriorShop=null,e.playerShopping=null,e.bgm=null,e.ButtonShow=!1,e.BothReady=!1,e.Buy=!1,e.Sell=!1,e.type="",e.equipName="",e.price=0,e.atk=0,e.def=0,e.hp=0,e.tag=0,e}return a(e,t),e.prototype.onLoad=function(){var t=this;cc.loader.loadRes("equipPrefabs/equipBg",function(e,i){t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,-350,-270),t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,330,-270),t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,-560,-245),t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,545,-245),t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,-520,-370),t.equipBg=cc.instantiate(i),t.equipBg.getComponent("equipBg").init(t.node,480,-370)}),this.p1=JSON.parse(cc.sys.localStorage.getItem("p1")),console.log("shop p1: ",this.p1),this.p1_Label=cc.find("Canvas/p1_Label").getComponent(cc.Label),this.labelUpdate(1),"archer"==this.p1.job?cc.instantiate(this.archerShop).getComponent("shop").init(this.node,1):"knight"==this.p1.job?cc.instantiate(this.knightShop).getComponent("shop").init(this.node,1):"slinger"==this.p1.job?cc.instantiate(this.slingerShop).getComponent("shop").init(this.node,1):"warrior"==this.p1.job&&cc.instantiate(this.warriorShop).getComponent("shop").init(this.node,1),this.p1_Icon=cc.instantiate(this.playerShopping),this.p1_Icon.getComponent("playerShopping").init(this.node,this.p1.job,1),this.weaponGenerate(1,this.p1.weapon),this.armorGenerate(1,this.p1.armor),this.bootsGenerate(1,this.p1.boots),this.p2=JSON.parse(cc.sys.localStorage.getItem("p2")),console.log("shop p1: ",this.p1),this.p2_Label=cc.find("Canvas/p2_Label").getComponent(cc.Label),this.labelUpdate(2),"archer"==this.p2.job?cc.instantiate(this.archerShop).getComponent("shop").init(this.node,2):"knight"==this.p2.job?cc.instantiate(this.knightShop).getComponent("shop").init(this.node,2):"slinger"==this.p2.job?cc.instantiate(this.slingerShop).getComponent("shop").init(this.node,2):"warrior"==this.p2.job&&cc.instantiate(this.warriorShop).getComponent("shop").init(this.node,2),this.p2_Icon=cc.instantiate(this.playerShopping),this.p2_Icon.getComponent("playerShopping").init(this.node,this.p2.job,2),this.weaponGenerate(2,this.p2.weapon),this.armorGenerate(2,this.p2.armor),this.bootsGenerate(2,this.p2.boots)},e.prototype.start=function(){this.playBGM()},e.prototype.playBGM=function(){cc.audioEngine.playMusic(this.bgm,!0)},e.prototype.endBGM=function(){cc.audioEngine.stopMusic()},e.prototype.equipBuy=function(t,e,i){this.Buy=!0,this.ButtonShow=!0,this.tag=t,this.type=e,this.equipName=i},e.prototype.equipSell=function(t,e,i){this.Sell=!0,this.ButtonShow=!0,this.tag=t,this.type=e,this.equipName=i},e.prototype.readyNext=function(){this.BothReady=!0,this.ButtonShow=!0},e.prototype.equipClean=function(){this.Buy=!1,this.Sell=!1,this.BothReady=!1,this.ButtonShow=!1},e.prototype.OK=function(){if(this.Buy){this.Buy=!1;var t=JSON.parse(cc.sys.localStorage.getItem(this.equipName)).price;if(1==this.tag)this.p1.money>=t&&(this.p1.money-=t,cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1)),"weapon"==this.type?(""!=this.p1.weapon&&this.weaponSell(this.tag,this.p1.weapon),this.weaponGenerate(this.tag,this.equipName)):"armor"==this.type?(""!=this.p1.armor&&this.armorSell(this.tag,this.p1.armor),this.armorGenerate(this.tag,this.equipName)):"boots"==this.type&&(""!=this.p1.boots&&this.bootsSell(this.tag,this.p1.boots),this.bootsGenerate(this.tag,this.equipName)),this.labelUpdate(this.tag));else{if(2!=this.tag)return;this.p2.money>=t&&(this.p2.money-=t,cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),"weapon"==this.type?(""!=this.p2.weapon&&this.weaponSell(this.tag,this.p2.weapon),this.weaponGenerate(this.tag,this.equipName)):"armor"==this.type?(""!=this.p2.armor&&this.armorSell(this.tag,this.p2.armor),this.armorGenerate(this.tag,this.equipName)):"boots"==this.type&&(""!=this.p2.boots&&this.bootsSell(this.tag,this.p2.boots),this.bootsGenerate(this.tag,this.equipName)),this.labelUpdate(this.tag))}}else this.Sell?(this.Sell=!1,"weapon"==this.type?this.weaponSell(this.tag,this.equipName):"armor"==this.type?this.armorSell(this.tag,this.equipName):"boots"==this.type&&this.bootsSell(this.tag,this.equipName),this.labelUpdate(this.tag)):this.BothReady&&(this.BothReady=!1,cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1)),cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),this.nextLevel());this.ButtonShow=!1},e.prototype.check_buttonshow=function(){return this.ButtonShow},e.prototype.labelUpdate=function(t){if(1==t){if((a=JSON.parse(cc.sys.localStorage.getItem("p1"))).weapon){var e=JSON.parse(cc.sys.localStorage.getItem(a.weapon));a.atk+=e.atk}if(a.boots){var i=JSON.parse(cc.sys.localStorage.getItem(a.boots));a.def+=i.def,a.hp+=i.hp,a.spd+=i.spd}if(a.armor){var o=JSON.parse(cc.sys.localStorage.getItem(a.armor));a.def+=o.def,a.hp+=o.hp,a.spd+=o.spd}this.p1_Label.string="ATK: "+a.atk+"\nDEF: "+a.def+"\nHP: "+a.hp+"\nSPD: "+a.spd+"\nMoney: "+a.money}else if(2==t){var a;(a=JSON.parse(cc.sys.localStorage.getItem("p2"))).weapon&&(e=JSON.parse(cc.sys.localStorage.getItem(a.weapon)),a.atk+=e.atk),a.boots&&(i=JSON.parse(cc.sys.localStorage.getItem(a.boots)),a.def+=i.def,a.hp+=i.hp,a.spd+=i.spd),a.armor&&(o=JSON.parse(cc.sys.localStorage.getItem(a.armor)),a.def+=o.def,a.hp+=o.hp,a.spd+=o.spd),this.p2_Label.string="ATK: "+a.atk+"\nDEF: "+a.def+"\nHP: "+a.hp+"\nSPD: "+a.spd+"\nMoney: "+a.money}},e.prototype.weaponGenerate=function(t,e){if(1==t){this.p1.weapon=e,cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1));var i=this;cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p1_Weapon=cc.instantiate(o),i.p1_Weapon.getComponent("playerEquip").init(i.node,1,"weapon",e,-350,-270)}),this.labelUpdate(t)}else 2==t&&(this.p2.weapon=e,cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),i=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p2_Weapon=cc.instantiate(o),i.p2_Weapon.getComponent("playerEquip").init(i.node,2,"weapon",e,330,-270)}),this.labelUpdate(t))},e.prototype.weaponSell=function(t,e){1==t?(this.p1.weapon="",this.p1.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1)),this.p1_Weapon.destroy(),this.labelUpdate(t)):2==t&&(this.p2.weapon="",this.p2.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),this.p2_Weapon.destroy(),this.labelUpdate(t))},e.prototype.armorGenerate=function(t,e){if(1==t){this.p1.armor=e,cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1));var i=this;cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p1_Armor=cc.instantiate(o),i.p1_Armor.getComponent("playerEquip").init(i.node,1,"armor",e,-560,-245)}),this.labelUpdate(t)}else 2==t&&(this.p2.armor=e,cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),i=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p2_Armor=cc.instantiate(o),i.p2_Armor.getComponent("playerEquip").init(i.node,2,"armor",e,545,-245)}),this.labelUpdate(t))},e.prototype.armorSell=function(t,e){1==t?(this.p1.armor="",this.p1.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1)),this.p1_Armor.destroy(),this.labelUpdate(t)):2==t&&(this.p2.armor="",this.p2.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),this.p2_Armor.destroy(),this.labelUpdate(t))},e.prototype.bootsGenerate=function(t,e){if(1==t){this.p1.boots=e,cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1));var i=this;cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p1_Boots=cc.instantiate(o),i.p1_Boots.getComponent("playerEquip").init(i.node,1,"boots",e,-520,-370)}),this.labelUpdate(t)}else 2==t&&(this.p2.boots=e,cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),i=this,cc.loader.loadRes("equipPrefabs/"+e,function(t,o){i.p2_Boots=cc.instantiate(o),i.p2_Boots.getComponent("playerEquip").init(i.node,2,"boots",e,480,-370)}),this.labelUpdate(t))},e.prototype.bootsSell=function(t,e){1==t?(this.p1.boots="",this.p1.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p1",JSON.stringify(this.p1)),this.p1_Boots.destroy(),this.labelUpdate(t)):2==t&&(this.p2.boots="",this.p2.money+=Math.floor(.7*JSON.parse(cc.sys.localStorage.getItem(e)).price),cc.sys.localStorage.setItem("p2",JSON.stringify(this.p2)),this.p2_Boots.destroy(),this.labelUpdate(t))},e.prototype.nextLevel=function(){this.endBGM();var t=parseInt(cc.sys.localStorage.getItem("level"))+1;5==t?(cc.find("loading_bg").active=!0,this.scheduleOnce(function(){cc.director.loadScene("pk")},.2)):(cc.find("loading_bg").active=!0,cc.sys.localStorage.setItem("level",t.toString()),this.scheduleOnce(function(){cc.director.loadScene("level"+t.toString())},.2))},n([c(cc.Prefab)],e.prototype,"archerShop",void 0),n([c(cc.Prefab)],e.prototype,"knightShop",void 0),n([c(cc.Prefab)],e.prototype,"slingerShop",void 0),n([c(cc.Prefab)],e.prototype,"warriorShop",void 0),n([c(cc.Prefab)],e.prototype,"playerShopping",void 0),n([c(cc.AudioClip)],e.prototype,"bgm",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],shop:[function(t,e,i){"use strict";cc._RF.push(e,"1324bdGCSpJPphtKnCaEvyb","shop");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tag=0,e}return a(e,t),e.prototype.init=function(t,e){this.node.parent=t.parent,this.tag=e,1==this.tag?this.node.position=cc.v3(-400,200):(this.node.position=cc.v3(360,200),this.node.getChildByName("equipTable").x+=600)},e.prototype.getTag=function(){return this.tag},n([s],e)}(cc.Component));i.default=c,cc._RF.pop()},{}],signinpage:[function(t,e,i){"use strict";cc._RF.push(e,"ce2a9v0MRlBLZN18IUOpTiA","signinpage");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgm=null,e.logInWindow=null,e.signUpWindow=null,e.logBtn=null,e.signBtn=null,e.signEmailBox=null,e.logEmailBox=null,e.signPassBox=null,e.logPassBox=null,e}return a(e,t),e.prototype.onLoad=function(){this.logInWindow=cc.find("Canvas/login_window"),this.signUpWindow=cc.find("Canvas/signup_window"),this.logBtn=cc.find("Canvas/loginBtn"),this.signBtn=cc.find("Canvas/signupBtn"),this.signEmailBox=cc.find("Canvas/signup_window/email/email_EditBox"),this.signPassBox=cc.find("Canvas/signup_window/pass/pass_EditBox"),this.logEmailBox=cc.find("Canvas/login_window/email/email_EditBox"),this.logPassBox=cc.find("Canvas/login_window/pass/pass_EditBox")},e.prototype.start=function(){this.logInWindow.active=!1,this.signUpWindow.active=!1,this.playBGM()},e.prototype.playBGM=function(){cc.audioEngine.playMusic(this.bgm,!0)},e.prototype.testBtnEvent=function(){cc.director.loadScene("start")},e.prototype.logInBtn=function(){this.logBtn.active=!1,this.signBtn.active=!1,this.logInWindow.active=!0},e.prototype.signUpBtn=function(){this.logBtn.active=!1,this.signBtn.active=!1,this.signUpWindow.active=!0},e.prototype.closeSignUp=function(){this.logBtn.active=!0,this.signBtn.active=!0,this.signUpWindow.active=!1},e.prototype.closeLogIn=function(){this.logBtn.active=!0,this.signBtn.active=!0,this.logInWindow.active=!1},e.prototype.submitLogIn=function(){var t=this.logEmailBox.getComponent(cc.EditBox).textLabel.string,e=this.logPassBox.getComponent(cc.EditBox).textLabel.string;cc.log(t+"\n"+e),firebase.auth().signInWithEmailAndPassword(t,e).then(function(){alert("login success"),cc.director.loadScene("start")}).catch(function(){return console.log("eEEError")})},e.prototype.submitSingUp=function(){var t={name:"Danny",wincount:0,totalcount:0},e={name:"Daniel",wincount:0,totalcount:0},i={name:"Mandy",wincount:0,totalcount:0},o={name:"Timothy",wincount:0,totalcount:0},a=this.signEmailBox.getComponent(cc.EditBox).textLabel.string,n=this.signPassBox.getComponent(cc.EditBox).textLabel.string;console.log(a+"\n"+n),firebase.auth().createUserWithEmailAndPassword(a,n).then(function(n){alert("sign up success");var r=firebase.database().ref("account_data/"+n.user.uid),s={user1:t,user2:e,user3:i,user4:o};r.set({uid:n.user.uid,email:a,userdata:s})}).catch(function(t){console.log(t.message)})},n([c(cc.AudioClip)],e.prototype,"bgm",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],start:[function(t,e,i){"use strict";cc._RF.push(e,"fdc24Vri6NAyalptXB0bs2O","start");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.select=null,e.shade1=null,e.shade2=null,e.archerPrefab=null,e.warrierPrefab=null,e.slingerPrefab=null,e.knightPrefab=null,e.chara1=null,e.chara2=null,e.p1=null,e.p2=null,e.p1name=null,e.p2name=null,e.p1id=0,e.p2id=0,e.p1charaname=null,e.p2charaname=null,e.user1name=null,e.user2name=null,e.user3name=null,e.user4name=null,e.twoplayBtn=null,e.boardBtn=null,e}return a(e,t),e.prototype.start=function(){this.select.active=!1},e.prototype.onLoad=function(){this.p1=cc.instantiate(this.archerPrefab),this.p1.parent=this.chara1,this.p1.position=cc.v3(0,0),this.p2=cc.instantiate(this.archerPrefab),this.p2.parent=this.chara2,this.p2.position=cc.v3(0,0),this.p1charaname="archer",this.p2charaname="archer",this.equipInit();this.user1name="Danny",this.user2name="Daniel",this.user3name="Mandy",this.user4name="Timothy",cc.sys.localStorage.setItem("account_data",JSON.stringify({uid:"usercre.user.uid",email:"email",userdata:{user1:{name:"Danny",wincount:0,totalcount:0},user2:{name:"Daniel",wincount:0,totalcount:0},user3:{name:"Mandy",wincount:0,totalcount:0},user4:{name:"Timothy",wincount:0,totalcount:0}}})),this.p1name=cc.find("Canvas/select_character/P1/name").getComponent(cc.Label),this.p2name=cc.find("Canvas/select_character/P2/name").getComponent(cc.Label),this.p1name.string="",this.p2name.string="",this.twoplayBtn=cc.find("Canvas/2v2Btn"),this.boardBtn=cc.find("Canvas/leaderboard")},e.prototype.changetoselect2V2=function(){this.twoplayBtn.active=!1,this.boardBtn.active=!1,this.select.active=!0},e.prototype.toLeaderboard=function(){cc.director.loadScene("leaderboard")},e.prototype.playerswitch1=function(){this.shade1.active=!0,this.shade2.active=!1},e.prototype.playerswitch2=function(){this.shade1.active=!1,this.shade2.active=!0},e.prototype.gamestart=function(){if(console.log("start..."),0==this.p1id||0==this.p2id||this.p1id==this.p2id)alert("please select the player name");else{var t={p1name:this.p1name.string,p2name:this.p2name.string,p1id:this.p1id,p2id:this.p2id},e=this.dataInit(this.p1charaname),i=this.dataInit(this.p2charaname);cc.sys.localStorage.setItem("playerdata",JSON.stringify(t)),cc.sys.localStorage.setItem("p1",JSON.stringify(e)),cc.sys.localStorage.setItem("p2",JSON.stringify(i)),cc.sys.localStorage.setItem("level","1"),cc.find("Canvas/loading_bg").active=!0,cc.audioEngine.stopMusic(),console.log("start to load"),cc.director.loadScene("level1")}},e.prototype.btnArcherPressed=function(){1==this.shade1.active?(this.p1.destroy(),this.p1=cc.instantiate(this.archerPrefab),this.p1.parent=this.chara1,this.p1.position=cc.v3(0,0),this.p1charaname="archer"):(this.p2.destroy(),this.p2=cc.instantiate(this.archerPrefab),this.p2.parent=this.chara2,this.p2.position=cc.v3(0,0),this.p2charaname="archer")},e.prototype.btnKnightPressed=function(){1==this.shade1.active?(this.p1.destroy(),this.p1=cc.instantiate(this.knightPrefab),this.p1.parent=this.chara1,this.p1.position=cc.v3(0,0),this.p1charaname="knight"):(this.p2.destroy(),this.p2=cc.instantiate(this.knightPrefab),this.p2.parent=this.chara2,this.p2.position=cc.v3(0,0),this.p2charaname="knight")},e.prototype.btnSlingertPressed=function(){1==this.shade1.active?(this.p1.destroy(),this.p1=cc.instantiate(this.slingerPrefab),this.p1.parent=this.chara1,this.p1.position=cc.v3(0,0),this.p1charaname="slinger"):(this.p2.destroy(),this.p2=cc.instantiate(this.slingerPrefab),this.p2.parent=this.chara2,this.p2.position=cc.v3(0,0),this.p2charaname="slinger")},e.prototype.btnWarriorPressed=function(){1==this.shade1.active?(this.p1.destroy(),this.p1=cc.instantiate(this.warrierPrefab),this.p1.parent=this.chara1,this.p1.position=cc.v3(0,0),this.p1charaname="warrior"):(this.p2.destroy(),this.p2=cc.instantiate(this.warrierPrefab),this.p2.parent=this.chara2,this.p2.position=cc.v3(0,0),this.p2charaname="warrior")},e.prototype.userBtn=function(t,e){this.shade1.active?1==e[0]?(this.p1id=1,this.p1name.string=this.user1name):2==e[0]?(this.p1id=2,this.p1name.string=this.user2name):3==e[0]?(this.p1id=3,this.p1name.string=this.user3name):4==e[0]&&(this.p1id=4,this.p1name.string=this.user4name):1==e[0]?(this.p2id=1,this.p2name.string=this.user1name):2==e[0]?(this.p2id=2,this.p2name.string=this.user2name):3==e[0]?(this.p2id=3,this.p2name.string=this.user3name):4==e[0]&&(this.p2id=4,this.p2name.string=this.user4name)},e.prototype.dataInit=function(t){var e={job:t,atk:0,def:0,hp:0,spd:0,money:0,armor:"",boots:"boots1",weapon:""};return"archer"==t?(e.atk=8,e.def=2,e.hp=30,e.spd=3.5,e.weapon="crossBow1",e.armor="archerArmor1"):"slinger"==t?(e.atk=15,e.def=4,e.hp=30,e.spd=2.5,e.weapon="sling1",e.armor="slingerArmor1"):"knight"==t?(e.atk=7,e.def=10,e.hp=50,e.spd=2.5,e.weapon="sword1",e.armor="knightArmor1"):"warrior"==t&&(e.atk=12,e.def=2,e.hp=30,e.spd=3,e.weapon="sword1",e.armor="warriorArmor1"),e},e.prototype.equipInit=function(){cc.sys.localStorage.setItem("archerArmor1",JSON.stringify({atk:0,def:3,hp:10,spd:0,price:10})),cc.sys.localStorage.setItem("archerArmor3",JSON.stringify({atk:0,def:5,hp:18,spd:0,price:20})),cc.sys.localStorage.setItem("archerArmor4",JSON.stringify({atk:0,def:7,hp:22,spd:.5,price:30})),cc.sys.localStorage.setItem("archerArmor5",JSON.stringify({atk:0,def:10,hp:25,spd:.5,price:40})),cc.sys.localStorage.setItem("knightArmor1",JSON.stringify({atk:0,def:5,hp:15,spd:0,price:10})),cc.sys.localStorage.setItem("knightArmor2",JSON.stringify({atk:0,def:8,hp:25,spd:0,price:20})),cc.sys.localStorage.setItem("knightArmor3",JSON.stringify({atk:0,def:12,hp:30,spd:0,price:30})),cc.sys.localStorage.setItem("knightArmor4",JSON.stringify({atk:0,def:16,hp:40,spd:.5,price:40})),cc.sys.localStorage.setItem("slingerArmor1",JSON.stringify({atk:0,def:3,hp:10,spd:0,price:10})),cc.sys.localStorage.setItem("slingerArmor2",JSON.stringify({atk:0,def:4,hp:22,spd:0,price:20})),cc.sys.localStorage.setItem("slingerArmor3",JSON.stringify({atk:0,def:5,hp:28,spd:.5,price:30})),cc.sys.localStorage.setItem("slingerArmor4",JSON.stringify({atk:0,def:8,hp:35,spd:.5,price:40})),cc.sys.localStorage.setItem("warriorArmor1",JSON.stringify({atk:0,def:3,hp:10,spd:0,price:10})),cc.sys.localStorage.setItem("warriorArmor2",JSON.stringify({atk:0,def:5,hp:15,spd:0,price:20})),cc.sys.localStorage.setItem("warriorArmor3",JSON.stringify({atk:0,def:10,hp:25,spd:.5,price:30})),cc.sys.localStorage.setItem("warriorArmor4",JSON.stringify({atk:0,def:16,hp:35,spd:1,price:40})),cc.sys.localStorage.setItem("boots1",JSON.stringify({atk:0,def:1,hp:0,spd:.5,price:10})),cc.sys.localStorage.setItem("boots2",JSON.stringify({atk:0,def:3,hp:10,spd:.5,price:20})),cc.sys.localStorage.setItem("boots3",JSON.stringify({atk:0,def:5,hp:15,spd:1,price:30})),cc.sys.localStorage.setItem("boots4",JSON.stringify({atk:0,def:4,hp:15,spd:1,price:40})),cc.sys.localStorage.setItem("boots5",JSON.stringify({atk:0,def:5,hp:10,spd:.5,price:25})),cc.sys.localStorage.setItem("boots6",JSON.stringify({atk:0,def:10,hp:15,spd:1,price:40})),cc.sys.localStorage.setItem("boots7",JSON.stringify({atk:0,def:2,hp:12,spd:.5,price:20})),cc.sys.localStorage.setItem("boots8",JSON.stringify({atk:0,def:7,hp:20,spd:1,price:35})),cc.sys.localStorage.setItem("crossBow1",JSON.stringify({atk:4,def:0,hp:0,spd:0,price:10})),cc.sys.localStorage.setItem("crossBow2",JSON.stringify({atk:7,def:0,hp:0,spd:0,price:20})),cc.sys.localStorage.setItem("crossBow3",JSON.stringify({atk:10,def:0,hp:0,spd:0,price:30})),cc.sys.localStorage.setItem("crossBow5",JSON.stringify({atk:12,def:0,hp:0,spd:0,price:40})),cc.sys.localStorage.setItem("sword1",JSON.stringify({atk:6,def:0,hp:0,spd:0,price:10})),cc.sys.localStorage.setItem("sword2",JSON.stringify({atk:12,def:0,hp:0,spd:0,price:20})),cc.sys.localStorage.setItem("sword3",JSON.stringify({atk:18,def:0,hp:0,spd:0,price:30})),cc.sys.localStorage.setItem("sword4",JSON.stringify({atk:24,def:0,hp:0,spd:0,price:40})),cc.sys.localStorage.setItem("sword5",JSON.stringify({atk:10,def:0,hp:0,spd:0,price:20})),cc.sys.localStorage.setItem("sword6",JSON.stringify({atk:15,def:0,hp:0,spd:0,price:30})),cc.sys.localStorage.setItem("sword7",JSON.stringify({atk:19,def:0,hp:0,spd:0,price:40})),cc.sys.localStorage.setItem("sling1",JSON.stringify({atk:7,def:0,hp:0,spd:0,price:10})),cc.sys.localStorage.setItem("sling2",JSON.stringify({atk:14,def:0,hp:0,spd:0,price:20})),cc.sys.localStorage.setItem("sling3",JSON.stringify({atk:21,def:0,hp:0,spd:0,price:30})),cc.sys.localStorage.setItem("sling4",JSON.stringify({atk:28,def:0,hp:0,spd:0,price:40})),cc.sys.localStorage.setItem("equipInit",JSON.stringify(!0)),console.log("equip init!")},e.prototype.closeCharSel=function(){this.twoplayBtn.active=!0,this.boardBtn.active=!0,this.select.active=!1},n([c(cc.Node)],e.prototype,"select",void 0),n([c(cc.Node)],e.prototype,"shade1",void 0),n([c(cc.Node)],e.prototype,"shade2",void 0),n([c(cc.Prefab)],e.prototype,"archerPrefab",void 0),n([c(cc.Prefab)],e.prototype,"warrierPrefab",void 0),n([c(cc.Prefab)],e.prototype,"slingerPrefab",void 0),n([c(cc.Prefab)],e.prototype,"knightPrefab",void 0),n([c(cc.Node)],e.prototype,"chara1",void 0),n([c(cc.Node)],e.prototype,"chara2",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}],wizard:[function(t,e,i){"use strict";cc._RF.push(e,"52521w6jFZNFaTdVDTHmbfa","wizard");var o,a=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=this&&this.__decorate||function(t,e,i,o){var a,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(n<3?a(r):n>3?a(e,i,r):a(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targetRegion=null,e.fire=null,e.gameManager=null,e.killedSound=null,e.bombSound=null,e.player=null,e.map=null,e.moveSpeed=40,e.tracingPlayer=!1,e.moveDir=cc.Vec2.ZERO,e.moveDuration=2,e.waitDuration=2,e.nextWaitTime=0,e.nextMoveTime=0,e.waitRandomFactor=.1,e.wizardLife=300,e.wizardMaxLife=300,e.wizardLifeProgress=null,e.target=null,e.targetRange=5,e.damage=15,e}return a(e,t),e.prototype.onLoad=function(){this.gameManager=cc.find("gameManager");var t=this.node.parent.name.slice(-1);try{var e=JSON.parse(cc.sys.localStorage.getItem("p"+t)).job;e&&(this.player=cc.find("Canvas/player"+t).getChildByName(e))}catch(r){}var i=cc.sys.localStorage.getItem("level");this.map=cc.find("Canvas/map"+i+"_"+t),this.wizardLifeProgress=this.node.getChildByName("lifeBar")},e.prototype.start=function(){var t=this;this.targetGenerate=function(){t.generateTargetRegion()},this.schedule(this.targetGenerate,10)},e.prototype.generateTargetRegion=function(){var t,e=this;this.target=cc.instantiate(this.targetRegion),this.target.scale=this.targetRange,this.target.parent=this.map;var i=1700-190*(this.targetRange-1),o=1700-190*(this.targetRange-1);t=cc.v2(100+95*(this.targetRange-1)+Math.floor(Math.random()*i),100+95*(this.targetRange-1)+Math.floor(Math.random()*o)),this.target.setPosition(t),this.scheduleOnce(function(){e.isInCycle(e.target)&&(e.player.getComponent("player").lifeDamage(e.damage),e.explosion(t)),e.target.destroy()},4)},e.prototype.explosion=function(t){var e=cc.instantiate(this.fire);e.scale=this.targetRange,e.parent=this.map,cc.audioEngine.playEffect(this.bombSound,!1),e.setPosition(t),this.scheduleOnce(function(){e.destroy()},1.1)},e.prototype.isInCycle=function(t){if(t){var e=75*this.targetRange,i=t.convertToWorldSpaceAR(cc.v2(0,0)),o=this.player.convertToWorldSpaceAR(cc.v2(0,0)),a=o.x-i.x,n=o.y-i.y;return a*a+n*n<=e*e}},e.prototype.enemyHurt=function(t){this.wizardLife-=t,this.wizardLifeProgress.getComponent(cc.ProgressBar).progress=this.wizardLife/this.wizardMaxLife,this.wizardLife<=0&&(this.node.active=!1,cc.audioEngine.playEffect(this.killedSound,!1),"enemy1"==this.node.parent.name?this.gameManager.getComponent("gamerManager").addcoin(1,25):"enemy2"==this.node.parent.name&&this.gameManager.getComponent("gamerManager").addcoin(2,25),this.gameManager.getComponent("gamerManager").enemyReduce(this.node.x),null!=this.target&&this.target.destroy(),this.node.destroy())},e.prototype.wandering=function(t){var e,i=cc.director.getTotalTime()/1e3;i>=this.nextMoveTime&&(this.nextWaitTime=i+this.moveDuration,this.nextMoveTime=this.nextWaitTime+this.waitDuration*(1+this.waitRandomFactor*(2*Math.random()-1)),this.moveDir=(e=Math.random()*Math.PI*2,new cc.Vec2(Math.cos(e),Math.sin(e)))),i<this.nextWaitTime&&(this.node.x+=this.moveDir.x*this.moveSpeed*t,this.node.y+=this.moveDir.y*this.moveSpeed*t)},e.prototype.update=function(t){this.wizardLife<=0&&this.unschedule(this.targetGenerate),this.wandering(t)},n([c(cc.Prefab)],e.prototype,"targetRegion",void 0),n([c(cc.Prefab)],e.prototype,"fire",void 0),n([c(cc.Node)],e.prototype,"gameManager",void 0),n([c({type:cc.AudioClip})],e.prototype,"killedSound",void 0),n([c({type:cc.AudioClip})],e.prototype,"bombSound",void 0),n([s],e)}(cc.Component);i.default=p,cc._RF.pop()},{}]},{},["archerEnemy","bullet","camera1","camera2","endgame","enemyBullet","fightBullet","fightManager","fightPlayer","gamerManager","leaderboard","meleeEnemy","pathFinding","player","powerBullet","cancel","confirm","dataBox","equipBg","next","ok","playerEquip","playerShopping","shop","shopEquip","shopManager","signinpage","start","wizard"]);