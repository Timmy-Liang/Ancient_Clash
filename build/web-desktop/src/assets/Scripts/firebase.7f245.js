!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),p(t)},d.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},d.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),p(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},_.call(b.prototype),_.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=b,t.Response=E,t.fetch=function(t,e){return new Promise(function(n,i){var o=new b(t,e),a=new XMLHttpRequest;a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;n(new E(i,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t,e,n,r=y(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,n=m(e=new FileReader),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(t,e){var n,r,i=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(r=(n=e.method||this.method||"GET").toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function w(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var r=setTimeout;function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(n){return void u(e.promise,n)}s(e.promise,r)}else(1===t._state?s:u)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void c(t);if("function"==typeof n)return void l((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,c(t)}catch(e){u(t,e)}var r,i}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function h(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new h(t,e,n)),n},o.prototype.finally=n,o.all=function(t){return new o(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(t,e)},n)}r[t]=a,0==--i&&e(r)}catch(a){n(a)}}for(var a=0;a<r.length;a++)o(a,r[a])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=n):f.Promise=o;var p=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("","return this")();"number"==typeof __g&&(__g=e)}),d=e(function(t){var e=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)}),y=(d.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),m=function(t){if(!y(t))throw TypeError(t+" is not an object!");return t},v=function(t){try{return!!t()}catch(t){return!0}},g=!v(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),_=p.document,b=y(_)&&y(_.createElement),w=function(t){return b?_.createElement(t):{}},E=!g&&!v(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),T=function(t,e){if(!y(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!y(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},S=Object.defineProperty,C={f:g?Object.defineProperty:function(t,e,n){if(m(t),e=T(e,!0),m(n),E)try{return S(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},I=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},N=g?function(t,e,n){return C.f(t,e,I(1,n))}:function(t,e,n){return t[e]=n,t},A={}.hasOwnProperty,k=function(t,e){return A.call(t,e)},D=0,R=Math.random(),P=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++D+R).toString(36))},O=e(function(t){var e="__core-js_shared__",n=p[e]||(p[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:d.version,mode:"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})}),x=O("native-function-to-string",Function.toString),L=e(function(t){var e=P("src"),n="toString",r=(""+x).split(n);d.inspectSource=function(t){return x.call(t)},(t.exports=function(t,n,i,o){var a="function"==typeof i;a&&(k(i,"name")||N(i,"name",n)),t[n]!==i&&(a&&(k(i,e)||N(i,e,t[n]?""+t[n]:r.join(String(n)))),t===p?t[n]=i:o?t[n]?t[n]=i:N(t,n,i):(delete t[n],N(t,n,i)))})(Function.prototype,n,function(){return"function"==typeof this&&this[e]||x.call(this)})}),M=function(t,e,n){if(function(){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},F="prototype",U=function(t,e,n){var r,i,o,a,s=t&U.F,u=t&U.G,c=t&U.S,h=t&U.P,l=t&U.B,f=u?p:c?p[e]||(p[e]={}):(p[e]||{})[F],y=u?d:d[e]||(d[e]={}),m=y[F]||(y[F]={});for(r in u&&(n=e),n)o=((i=!s&&f&&void 0!==f[r])?f:n)[r],a=l&&i?M(o,p):h&&"function"==typeof o?M(Function.call,o):o,f&&L(f,r,o,t&U.U),y[r]!=o&&N(y,r,a),h&&m[r]!=o&&(m[r]=o)};p.core=d,U.F=1,U.G=2,U.S=4,U.P=8,U.B=16,U.W=32,U.U=64,U.R=128;var q=U,V={}.toString,j=function(t){return V.call(t).slice(8,-1)},B=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==j(t)?t.split(""):Object(t)},W=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},Q=function(t){return Object(W(t))},K=Math.ceil,H=Math.floor,G=function(t){return isNaN(t=+t)?0:(0<t?H:K)(t)},z=Math.min,Y=function(t){return 0<t?z(G(t),9007199254740991):0},X=Array.isArray||function(t){return"Array"==j(t)},J=e(function(t){var e=O("wks"),n=p.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:P)("Symbol."+t))}).store=e}),$=J("species"),Z=function(t,e){return X(n=t)&&("function"!=typeof(r=n.constructor)||r!==Array&&!X(r.prototype)||(r=void 0),y(r)&&null===(r=r[$])&&(r=void 0)),new(void 0===r?Array:r)(e);var n,r},tt=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,u=e||Z;return function(e,c,h){for(var l,f,p=Q(e),d=B(p),y=M(c,h,3),m=Y(d.length),v=0,g=n?u(e,m):r?u(e,0):void 0;v<m;v++)if((s||v in d)&&(f=y(l=d[v],v,p),t))if(n)g[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:g.push(l)}else if(o)return!1;return a?-1:i||o?o:g}},et=J("unscopables"),nt=Array.prototype;null==nt[et]&&N(nt,et,{});var rt=function(t){nt[et][t]=!0},it=tt(5),ot="find",at=!0;ot in[]&&Array(1)[ot](function(){at=!1}),q(q.P+q.F*at,"Array",{find:function(t){return it(this,t,1<arguments.length?arguments[1]:void 0)}}),rt(ot),d.Array.find;var st=tt(6),ut="findIndex",ct=!0;ut in[]&&Array(1)[ut](function(){ct=!1}),q(q.P+q.F*ct,"Array",{findIndex:function(t){return st(this,t,1<arguments.length?arguments[1]:void 0)}}),rt(ut),d.Array.findIndex;var ht=function(t){return B(W(t))},lt=Math.max,ft=Math.min,pt=O("keys"),dt=function(t){return pt[t]||(pt[t]=P(t))},yt=function(t,e,n){for(var r,i,o=ht(t),a=Y(o.length),s=(i=a,(r=G(r=n))<0?lt(r+i,0):ft(r,i));s<a;s++)if(s in o&&o[s]===e)return s||0;return-1},mt=dt("IE_PROTO"),vt=function(t,e){var n,r=ht(t),i=0,o=[];for(n in r)n!=mt&&k(r,n)&&o.push(n);for(;e.length>i;)k(r,n=e[i++])&&(~yt(o,n)||o.push(n));return o},gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),_t=Object.keys||function(t){return vt(t,gt)},bt={f:Object.getOwnPropertySymbols},wt={f:{}.propertyIsEnumerable},Et=Object.assign,Tt=!Et||v(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Et({},t)[n]||Object.keys(Et({},e)).join("")!=r})?function(t){for(var e=Q(t),n=arguments.length,r=1,i=bt.f,o=wt.f;r<n;)for(var a,s=B(arguments[r++]),u=i?_t(s).concat(i(s)):_t(s),c=u.length,h=0;h<c;)o.call(s,a=u[h++])&&(e[a]=s[a]);return e}:Et;q(q.S+q.F,"Object",{assign:Tt}),d.Object.assign;var St=J("match"),Ct=function(t,e,n){if(y(r=e)&&(void 0!==(i=r[St])?i:"RegExp"==j(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,i;return String(W(t))},It=J("match"),Nt="startsWith",At=""[Nt];q(q.P+q.F*function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[It]=!1,!"/./"[e](n)}catch(t){}}return!0}(Nt),"String",{startsWith:function(t){var e=Ct(this,t,Nt),n=Y(Math.min(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return At?At.call(e,r,n):e.slice(n,n+r.length)===r}}),d.String.startsWith,q(q.P,"String",{repeat:function(t){var e=String(W(this)),n="",r=G(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),d.String.repeat;var kt=e(function(t){var e=P("meta"),n=C.f,r=0,i=Object.isExtensible||function(){return!0},o=!v(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!y(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!k(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!k(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!k(t,e)&&a(t),t}}}),Dt=(kt.KEY,kt.NEED,kt.fastKey,kt.getWeak,kt.onFreeze,C.f),Rt=J("toStringTag"),Pt=function(t,e,n){t&&!k(t=n?t:t.prototype,Rt)&&Dt(t,Rt,{configurable:!0,value:e})},Ot={f:J},xt=C.f,Lt=function(t){var e=d.Symbol||(d.Symbol=p.Symbol||{});"_"==t.charAt(0)||t in e||xt(e,t,{value:Ot.f(t)})},Mt=g?Object.defineProperties:function(t,e){m(t);for(var n,r=_t(e),i=r.length,o=0;o<i;)C.f(t,n=r[o++],e[n]);return t},Ft=p.document,Ut=Ft&&Ft.documentElement,qt=dt("IE_PROTO"),Vt=function(){},jt="prototype",Bt=function(){var t,e=w("iframe"),n=gt.length;for(e.style.display="none",Ut.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Bt=t.F;n--;)delete Bt[jt][gt[n]];return Bt()},Wt=Object.create||function(t,e){var n;return null!==t?(Vt[jt]=m(t),n=new Vt,Vt[jt]=null,n[qt]=t):n=Bt(),void 0===e?n:Mt(n,e)},Qt=gt.concat("length","prototype"),Kt={f:Object.getOwnPropertyNames||function(t){return vt(t,Qt)}},Ht=Kt.f,Gt={}.toString,zt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Yt={f:function(t){return zt&&"[object Window]"==Gt.call(t)?function(t){try{return Ht(t)}catch(t){return zt.slice()}}(t):Ht(ht(t))}},Xt=Object.getOwnPropertyDescriptor,Jt={f:g?Xt:function(t,e){if(t=ht(t),e=T(e,!0),E)try{return Xt(t,e)}catch(t){}if(k(t,e))return I(!wt.f.call(t,e),t[e])}},$t=kt.KEY,Zt=Jt.f,te=C.f,ee=Yt.f,ne=p.Symbol,re=p.JSON,ie=re&&re.stringify,oe="prototype",ae=J("_hidden"),se=J("toPrimitive"),ue={}.propertyIsEnumerable,ce=O("symbol-registry"),he=O("symbols"),le=O("op-symbols"),fe=Object[oe],pe="function"==typeof ne,de=p.QObject,ye=!de||!de[oe]||!de[oe].findChild,me=g&&v(function(){return 7!=Wt(te({},"a",{get:function(){return te(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Zt(fe,e);r&&delete fe[e],te(t,e,n),r&&t!==fe&&te(fe,e,r)}:te,ve=function(t){var e=he[t]=Wt(ne[oe]);return e._k=t,e},ge=pe&&"symbol"==typeof ne.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof ne},_e=function(t,e,n){return t===fe&&_e(le,e,n),m(t),e=T(e,!0),m(n),k(he,e)?(n.enumerable?(k(t,ae)&&t[ae][e]&&(t[ae][e]=!1),n=Wt(n,{enumerable:I(0,!1)})):(k(t,ae)||te(t,ae,I(1,{})),t[ae][e]=!0),me(t,e,n)):te(t,e,n)},be=function(t,e){m(t);for(var n,r=function(t){var e=_t(t),n=bt.f;if(n)for(var r,i=n(t),o=wt.f,a=0;i.length>a;)o.call(t,r=i[a++])&&e.push(r);return e}(e=ht(e)),i=0,o=r.length;i<o;)_e(t,n=r[i++],e[n]);return t},we=function(t){var e=ue.call(this,t=T(t,!0));return!(this===fe&&k(he,t)&&!k(le,t))&&(!(e||!k(this,t)||!k(he,t)||k(this,ae)&&this[ae][t])||e)},Ee=function(t,e){if(t=ht(t),e=T(e,!0),t!==fe||!k(he,e)||k(le,e)){var n=Zt(t,e);return!n||!k(he,e)||k(t,ae)&&t[ae][e]||(n.enumerable=!0),n}},Te=function(t){for(var e,n=ee(ht(t)),r=[],i=0;n.length>i;)k(he,e=n[i++])||e==ae||e==$t||r.push(e);return r},Se=function(t){for(var e,n=t===fe,r=ee(n?le:ht(t)),i=[],o=0;r.length>o;)!k(he,e=r[o++])||n&&!k(fe,e)||i.push(he[e]);return i};pe||(L((ne=function(){if(this instanceof ne)throw TypeError("Symbol is not a constructor!");var t=P(0<arguments.length?arguments[0]:void 0),e=function(n){this===fe&&e.call(le,n),k(this,ae)&&k(this[ae],t)&&(this[ae][t]=!1),me(this,t,I(1,n))};return g&&ye&&me(fe,t,{configurable:!0,set:e}),ve(t)})[oe],"toString",function(){return this._k}),Jt.f=Ee,C.f=_e,Kt.f=Yt.f=Te,wt.f=we,bt.f=Se,g&&L(fe,"propertyIsEnumerable",we,!0),Ot.f=function(t){return ve(J(t))}),q(q.G+q.W+q.F*!pe,{Symbol:ne});for(var Ce="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ie=0;Ce.length>Ie;)J(Ce[Ie++]);for(var Ne=_t(J.store),Ae=0;Ne.length>Ae;)Lt(Ne[Ae++]);q(q.S+q.F*!pe,"Symbol",{for:function(t){return k(ce,t+="")?ce[t]:ce[t]=ne(t)},keyFor:function(t){if(!ge(t))throw TypeError(t+" is not a symbol!");for(var e in ce)if(ce[e]===t)return e},useSetter:function(){ye=!0},useSimple:function(){ye=!1}}),q(q.S+q.F*!pe,"Object",{create:function(t,e){return void 0===e?Wt(t):be(Wt(t),e)},defineProperty:_e,defineProperties:be,getOwnPropertyDescriptor:Ee,getOwnPropertyNames:Te,getOwnPropertySymbols:Se}),re&&q(q.S+q.F*(!pe||v(function(){var t=ne();return"[null]"!=ie([t])||"{}"!=ie({a:t})||"{}"!=ie(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(y(e)||void 0!==t)&&!ge(t))return X(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!ge(e))return e}),r[1]=e,ie.apply(re,r)}}),ne[oe][se]||N(ne[oe],se,ne[oe].valueOf),Pt(ne,"Symbol"),Pt(Math,"Math",!0),Pt(p.JSON,"JSON",!0);var ke=J("toStringTag"),De="Arguments"==j(function(){return arguments}()),Re={};Re[J("toStringTag")]="z",Re+""!="[object z]"&&L(Object.prototype,"toString",function(){return"[object "+(void 0===this?"Undefined":null===this?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Object(this),ke))?e:De?j(t):"Object"==(n=j(t))&&"function"==typeof t.callee?"Arguments":n)+"]";var t,e,n},!0),Lt("asyncIterator"),Lt("observable"),d.Symbol;var Pe={},Oe={};N(Oe,J("iterator"),function(){return this});var xe=dt("IE_PROTO"),Le=Object.prototype,Me=Object.getPrototypeOf||function(t){return t=Q(t),k(t,xe)?t[xe]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Le:null},Fe=J("iterator"),Ue=!([].keys&&"next"in[].keys()),qe="values",Ve=function(){return this},je=function(t,e,n,r,i,o,a){var s,u,c;u=e,c=r,(s=n).prototype=Wt(Oe,{next:I(1,c)}),Pt(s,u+" Iterator");var h,l,f,p=function(t){if(!Ue&&t in v)return v[t];switch(t){case"keys":case qe:return function(){return new n(this,t)}}return function(){return new n(this,t)}},d=e+" Iterator",y=i==qe,m=!1,v=t.prototype,g=v[Fe]||v["@@iterator"]||i&&v[i],_=g||p(i),b=i?y?p("entries"):_:void 0,w="Array"==e&&v.entries||g;if(w&&(f=Me(w.call(new t)))!==Object.prototype&&f.next&&(Pt(f,d,!0),"function"!=typeof f[Fe]&&N(f,Fe,Ve)),y&&g&&g.name!==qe&&(m=!0,_=function(){return g.call(this)}),(Ue||m||!v[Fe])&&N(v,Fe,_),Pe[e]=_,Pe[d]=Ve,i)if(h={values:y?_:p(qe),keys:o?_:p("keys"),entries:b},a)for(l in h)l in v||L(v,l,h[l]);else q(q.P+q.F*(Ue||m),e,h);return h},Be=function(t,e){var n,r,i=String(W(t)),o=G(e),a=i.length;return o<0||a<=o?"":(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?i.charAt(o):i.slice(o,o+2)};je(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Be(e,n),this._i+=t.length,{value:t,done:!1})});var We=function(t,e){return{value:e,done:!!t}},Qe=je(Array,"Array",function(t,e){this._t=ht(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,We(1)):We(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");Pe.Arguments=Pe.Array,rt("keys"),rt("values"),rt("entries");for(var Ke=J("iterator"),He=J("toStringTag"),Ge=Pe.Array,ze={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ye=_t(ze),Xe=0;Xe<Ye.length;Xe++){var Je,$e=Ye[Xe],Ze=ze[$e],tn=p[$e],en=tn&&tn.prototype;if(en&&(en[Ke]||N(en,Ke,Ge),en[He]||N(en,He,$e),Pe[$e]=Ge,Ze))for(Je in Qe)en[Je]||L(en,Je,Qe[Je],!0)}Ot.f("iterator");var nn=function(t,e){return(nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function rn(t,e){function n(){this.constructor=t}nn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var on=function(){return(on=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function an(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function sn(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function un(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}var cn=function(t,e){if(!t)throw hn(e)},hn=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},ln=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,i>>6&63|128),63&i|128)}return e},fn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ln(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!=s){var h=a<<4&240|s>>2;if(r.push(h),64!=u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},pn=function(t){try{return fn.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function dn(t){return yn(void 0,t)}function yn(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=yn(t[n],e[n]));return t}function mn(t,e,n){t[e]=n}var vn=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),gn=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")},_n=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},bn=function(){return!1},wn="FirebaseError",En=Error.captureStackTrace,Tn=function(t,e){if(this.code=t,this.message=e,En)En(this,Sn.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=wn,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};((Tn.prototype=Object.create(Error.prototype)).constructor=Tn).prototype.name=wn;var Sn=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new Tn(i,n);for(var a in e)e.hasOwnProperty(a)&&"_"!==a.slice(-1)&&(o[a]=e[a]);return o},t}();function Cn(t){return JSON.parse(t)}function In(t){return JSON.stringify(t)}var Nn=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Cn(pn(o[0])||""),n=Cn(pn(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},An=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},kn=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},Dn=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},Rn=function(t){return e={},Dn(t,function(t,n){e[t]=n}),e;var e},Pn=function(t){for(var e in t)return!1;return!0},On=function(t){var e=0;for(var n in t)e++;return e},xn=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},Ln=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},Mn=function(t){for(var e in t)return e},Fn=function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}return rn(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},e}(function(){this.blockSize=-1});function Un(t,e){var n=new qn(t,e);return n.subscribe.bind(n)}var qn=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t){if("object"!=typeof t||null===t)return!1;for(var e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=Vn),void 0===r.error&&(r.error=Vn),void 0===r.complete&&(r.complete=Vn);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function Vn(){}var jn=function(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Bn(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function Wn(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Bn(t,e,r)+"must be a valid function.")}function Qn(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Bn(t,e,r)+"must be a valid context object.")}var Kn=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e},Hn=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Gn="[DEFAULT]",zn=[],Yn=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=dn(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){zn.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){zn=zn.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var e=[];return Object.keys(t.services_).forEach(function(n){Object.keys(t.services_[n]).forEach(function(r){e.push(t.services_[n][r])})}),Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=Gn),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==Gn?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;yn(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(zn.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),zn=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&Xn("app-deleted",{name:this.name_})},t}();function Xn(t,e){throw Jn.create(t,e)}Yn.prototype.name&&Yn.prototype.options||Yn.prototype.delete||console.log("dc");var Jn=new Sn("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),$n=!1;try{$n="[object process]"===Object.prototype.toString.call(global.process)}catch(va){}$n&&console.warn('\nWarning: This is a browser-targeted Firebase bundle but it appears it is being\nrun in a Node environment.  If running in a Node environment, make sure you\nare using the bundle specified by the "main" field in package.json.\n\nIf you are using Webpack, you can specify "main" as the first item in\n"resolve.mainFields":\nhttps://webpack.js.org/configuration/resolve/#resolvemainfields\n\nIf using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\nto false and "main" to true:\nhttps://github.com/rollup/rollup-plugin-node-resolve\n');var Zn,tr,er=function t(){var e={},n={},r={},i={__esModule:!0,initializeApp:function(t,n){void 0===n&&(n={}),("object"!=typeof n||null===n)&&(n={name:n});var r=n;void 0===r.name&&(r.name=Gn);var o=r.name;"string"==typeof o&&o||Xn("bad-app-name",{name:o+""}),Hn(e,o)&&Xn("duplicate-app",{name:o});var a=new Yn(t,r,i);return s(e[o]=a,"create"),a},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.9.2",INTERNAL:{registerService:function(t,e,s,u,c){n[t]&&Xn("duplicate-service",{name:t}),n[t]=e,u&&(r[t]=u,a().forEach(function(t){u("create",t)}));var h=function(e){return void 0===e&&(e=o()),"function"!=typeof e[t]&&Xn("invalid-app-argument",{name:t}),e[t]()};return void 0!==s&&yn(h,s),i[t]=h,Yn.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,c?e:[])},h},createFirebaseNamespace:t,extendNamespace:function(t){yn(i,t)},createSubscribe:Un,ErrorFactory:Sn,removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u,Promise:Promise,deepExtend:yn}};function o(t){return Hn(e,t=t||Gn)||Xn("no-app",{name:t}),e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){Object.keys(n).forEach(function(n){var i=u(t,n);null!==i&&r[i]&&r[i](e,t)})}function u(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return mn(i,"default",i),Object.defineProperty(i,"apps",{get:a}),mn(o,"App",Yn),i}();(function(){var t,e=e||{},n=this;function r(t){return"string"==typeof t}function i(t){return"boolean"==typeof t}var o=/^[\w+/_-]+[=]{0,2}$/,a=null;function s(){}function u(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function c(t){return null===t}function h(t){return"array"==u(t)}function l(t){var e=u(t);return"array"==e||"object"==e&&"number"==typeof t.length}function f(t){return"function"==u(t)}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var d="closure_uid_"+(1e9*Math.random()>>>0),y=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function v(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function g(t,e,n){return(g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:v).apply(null,arguments)}function _(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var b=Date.now||function(){return+new Date};function w(t,e){function n(){}n.prototype=e.prototype,t.pb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function E(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function T(t){if(Error.captureStackTrace)Error.captureStackTrace(this,T);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function S(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");T.call(this,n+t[r])}function C(t,e){throw new S("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function I(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function N(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function A(){this.b=this.a=null}w(T,Error),T.prototype.name="CustomError",w(S,T),S.prototype.name="AssertionError",I.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var k=new I(function(){return new D},function(t){t.reset()});function D(){this.next=this.b=this.a=null}A.prototype.add=function(t,e){var n=k.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},D.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},D.prototype.reset=function(){this.next=this.b=this.a=null};var R=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(r(t))return r(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},P=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,o=r(t)?t.split(""):t,a=0;a<i;a++)a in o&&e.call(n,o[a],a,t)},O=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),o=r(t)?t.split(""):t,a=0;a<n;a++)a in o&&(i[a]=e.call(void 0,o[a],a,t));return i},x=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t))return!0;return!1};function L(t,e){return 0<=R(t,e)}function M(t,e){var n;return(n=0<=(e=R(t,e)))&&Array.prototype.splice.call(t,e,1),n}function F(t,e){!function(t,e){var n=t.length,i=r(t)?t.split(""):t;for(--n;0<=n;--n)n in i&&e.call(void 0,i[n],n,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length})}function U(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var V,j=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},B=/&/g,W=/</g,Q=/>/g,K=/"/g,H=/'/g,G=/\x00/g,z=/[\x00&<>"']/;function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var J=n.navigator;if(J){var $=J.userAgent;if($){V=$;break t}}V=""}function Z(t){return Y(V,t)}function tt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function et(t){for(var e in t)return!1;return!0}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt,it,ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ot.length;o++)n=ot[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function st(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function ut(t){return z.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(B,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(W,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(Q,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(K,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(H,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(G,"&#0;"))),t}function ct(t){n.setTimeout(function(){throw t},0)}function ht(t,e){it||function(){if(n.Promise&&n.Promise.resolve){var t=n.Promise.resolve(void 0);it=function(){t.then(pt)}}else it=function(){var t=pt;!f(n.setImmediate)||n.Window&&n.Window.prototype&&!Z("Edge")&&n.Window.prototype.setImmediate==n.setImmediate?(rt||(rt=function(){var t=n.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Z("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=g(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Z("Trident")||Z("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){n.setTimeout(t,0)};var e=new t,r={},i=r;return e.port1.onmessage=function(){if(void 0!==r.next){var t=(r=r.next).xb;r.xb=null,t()}},function(t){i.next={xb:t},i=i.next,e.port2.postMessage(0)}}()),rt(t)):n.setImmediate(t)}}(),lt||(it(),lt=!0),ft.add(t,e)}var lt=!1,ft=new A;function pt(){for(var t;n=e=void 0,n=null,(e=ft).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){ct(t)}N(k,t)}var e,n;lt=!1}function dt(t,e){if(this.a=yt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=s)try{var n=this;t.call(e,function(t){Nt(n,mt,t)},function(t){if(!(t instanceof xt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Nt(n,vt,t)})}catch(t){Nt(this,vt,t)}}var yt=0,mt=2,vt=3;function gt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}gt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var _t=new I(function(){return new gt},function(t){t.reset()});function bt(t,e,n){var r=_t.get();return r.g=t,r.b=e,r.f=n,r}function wt(t){if(t instanceof dt)return t;var e=new dt(s);return Nt(e,mt,t),e}function Et(t){return new dt(function(e,n){n(t)})}function Tt(t,e,n){At(t,e,n,null)||ht(_(e,t))}function St(t){return new dt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Eb:!0,value:o}:{Eb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Tt(t[o],_(i,o,!0),_(i,o,!1));else e(r)})}function Ct(t,e){t.b||t.a!=mt&&t.a!=vt||kt(t),t.f?t.f.next=e:t.b=e,t.f=e}function It(t,e,n,r){var i=bt(null,null,null);return i.a=new dt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof xt?o(e):t(i)}catch(e){o(e)}}:o}),Ct(i.a.c=t,i),i.a}function Nt(t,e,n){var r,i;t.a==yt&&(t===n&&(e=vt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,At(n,t.Pc,t.Qc,t)||(t.i=n,t.a=e,t.c=null,kt(t),e!=vt||n instanceof xt||(i=n,(r=t).g=!0,ht(function(){r.g&&Ot.call(null,i)}))))}function At(t,e,n,r){if(t instanceof dt)return Ct(t,bt(e||s,n||null,r)),!0;if(E(t))return t.then(e,n,r),!0;if(p(t))try{var i=t.then;if(f(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function kt(t){t.h||(t.h=!0,ht(t.Yb,t))}function Dt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function Rt(t,e,n,r){if(n==vt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Pt(e,n,r);else try{e.c?e.g.call(e.f):Pt(e,n,r)}catch(t){Ot.call(null,t)}N(_t,e)}function Pt(t,e,n){e==mt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}dt.prototype.then=function(t,e,n){return It(this,f(t)?t:null,f(e)?e:null,n)},dt.prototype.$goog_Thenable=!0,(t=dt.prototype).ia=function(t,e){return(t=bt(t,t,e)).c=!0,Ct(this,t),this},t.s=function(t,e){return It(this,null,t,e)},t.cancel=function(t){this.a==yt&&ht(function(){!function t(e,n){if(e.a==yt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==yt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):Dt(r),Rt(r,o,vt,n)))}e.c=null}else Nt(e,vt,n)}(this,new xt(t))},this)},t.Pc=function(t){this.a=yt,Nt(this,mt,t)},t.Qc=function(t){this.a=yt,Nt(this,vt,t)},t.Yb=function(){for(var t;t=Dt(this);)Rt(this,t,this.a,this.i);this.h=!1};var Ot=ct;function xt(t){T.call(this,t)}function Lt(){this.qa=this.qa,this.ja=this.ja}w(xt,T);var Mt=0;function Ft(t){t.qa||(t.qa=!0,t.va(),0==Mt)||t[d]||(t[d]=++y)}function Ut(t){return Ut[" "](t),t}Lt.prototype.qa=!(xt.prototype.name="cancel"),Lt.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},Ut[" "]=s;var qt,Vt,jt=Z("Opera"),Bt=Z("Trident")||Z("MSIE"),Wt=Z("Edge"),Qt=Wt||Bt,Kt=Z("Gecko")&&!(Y(V.toLowerCase(),"webkit")&&!Z("Edge"))&&!(Z("Trident")||Z("MSIE"))&&!Z("Edge"),Ht=Y(V.toLowerCase(),"webkit")&&!Z("Edge");function Gt(){var t=n.document;return t?t.documentMode:void 0}t:{var zt="",Yt=(Vt=V,Kt?/rv:([^\);]+)(\)|;)/.exec(Vt):Wt?/Edge\/([\d\.]+)/.exec(Vt):Bt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Vt):Ht?/WebKit\/(\S+)/.exec(Vt):jt?/(?:Version)[ \/]?(\S+)/.exec(Vt):void 0);if(Yt&&(zt=Yt?Yt[1]:""),Bt){var Xt=Gt();if(null!=Xt&&Xt>parseFloat(zt)){qt=String(Xt);break t}}qt=zt}var Jt,$t={};function Zt(t){return e=t,n=function(){for(var e=0,n=j(String(qt)).split("."),r=j(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=X(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==a[2].length,0==s[2].length)||X(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e},r=$t,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n();var e,n,r}var te=n.document;Jt=te&&Bt?Gt()||("CSS1Compat"==te.compatMode?parseInt(qt,10):5):void 0;var ee=Object.freeze||function(t){return t},ne=!Bt||9<=Number(Jt),re=Bt&&!Zt("9"),ie=function(){if(!n.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{n.addEventListener("test",s,e),n.removeEventListener("test",s,e)}catch(t){}return t}();function oe(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function ae(t,e){if(oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Kt){t:{try{Ut(e.nodeName);var o=!0;break t}catch(t){}o=!1}o||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=r(t.pointerType)?t.pointerType:se[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}oe.prototype.preventDefault=function(){this.Kb=!1},w(ae,oe);var se=ee({2:"touch",3:"pen",4:"mouse"});ae.prototype.preventDefault=function(){ae.pb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,re)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},ae.prototype.f=function(){return this.a};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ma=i,this.key=++ce,this.oa=this.Ia=!1}function le(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Ma=null}function fe(t){this.src=t,this.a={},this.b=0}function pe(t,e){var n=e.type;n in t.a&&M(t.a[n],e)&&(le(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function de(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Ma==r)return i}return-1}fe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=de(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new he(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var ye="closure_lm_"+(1e6*Math.random()|0),me={};function ve(t,e,n,r,i){if(r&&r.once)_e(t,e,n,r,i);else if(h(e))for(var o=0;o<e.length;o++)ve(t,e[o],n,r,i);else n=Ae(n),t&&t[ue]?De(t,e,n,p(r)?!!r.capture:!!r,i):ge(t,e,n,!1,r,i)}function ge(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a,s,u=p(i)?!!i.capture:!!i,c=Ie(t);if(c||(t[ye]=c=new fe(t)),!(n=c.add(e,n,r,u,o)).proxy)if(a=Ce,r=s=ne?function(t){return a.call(s.src,s.listener,t)}:function(t){if(!(t=a.call(s.src,s.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)ie||(i=u),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ee(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function _e(t,e,n,r,i){if(h(e))for(var o=0;o<e.length;o++)_e(t,e[o],n,r,i);else n=Ae(n),t&&t[ue]?Re(t,e,n,p(r)?!!r.capture:!!r,i):ge(t,e,n,!0,r,i)}function be(t,e,n,r,i){if(h(e))for(var o=0;o<e.length;o++)be(t,e[o],n,r,i);else r=p(r)?!!r.capture:!!r,n=Ae(n),t&&t[ue]?(t=t.o,(e=String(e).toString())in t.a&&-1<(n=de(o=t.a[e],n,r,i))&&(le(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Ie(t))&&(e=t.a[e.toString()],t=-1,e&&(t=de(e,n,r,i)),(n=-1<t?e[t]:null)&&we(n))}function we(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[ue])pe(e.o,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ee(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ie(e))?(pe(n,t),0==n.b&&(n.src=null,e[ye]=null)):le(t)}}}function Ee(t){return t in me?me[t]:me[t]="on"+t}function Te(t,e,n,r){var i=!0;if((t=Ie(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Se(o,r),i=i&&!1!==o)}return i}function Se(t,e){var n=t.listener,r=t.Ma||t.src;return t.Ia&&we(t),n.call(r,e)}function Ce(t,e){if(t.oa)return!0;if(ne)return Se(t,new ae(e,this));if(!e)t:{e=["window","event"];for(var r=n,i=0;i<e.length;i++)if(null==(r=r[e[i]])){e=null;break t}e=r}if(e=new ae(i=e,this),r=!0,!(i.keyCode<0||null!=i.returnValue)){t:{var o=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){o=!0}(o||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],o=e.b;o;o=o.parentNode)i.push(o);for(t=t.type,o=i.length-1;0<=o;o--){e.b=i[o];var a=Te(i[o],t,!0,e);r=r&&a}for(o=0;o<i.length;o++)e.b=i[o],a=Te(i[o],t,!1,e),r=r&&a}return r}function Ie(t){return(t=t[ye])instanceof fe?t:null}var Ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return f(t)?t:(t[Ne]||(t[Ne]=function(e){return t.handleEvent(e)}),t[Ne])}function ke(){Lt.call(this),this.o=new fe(this),(this.Rb=this).Wa=null}function De(t,e,n,r,i){t.o.add(String(e),n,!1,r,i)}function Re(t,e,n,r,i){t.o.add(String(e),n,!0,r,i)}function Pe(t,e,n,r){if(!(e=t.o.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Ma||a.src;a.Ia&&pe(t.o,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function Oe(t,e,r){if(f(t))r&&(t=g(t,r));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=g(t.handleEvent,t)}return 2147483647<Number(e)?-1:n.setTimeout(t,e||0)}function xe(t){var e=null;return new dt(function(n,r){-1==(e=Oe(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw n.clearTimeout(e),t})}function Le(t){if(t.S&&"function"==typeof t.S)return t.S();if(r(t))return t.split("");if(l(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function Me(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(l(t)||r(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ue(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}w(ke,Lt),ke.prototype[ue]=!0,ke.prototype.addEventListener=function(t,e,n,r){ve(this,t,e,n,r)},ke.prototype.removeEventListener=function(t,e,n,r){be(this,t,e,n,r)},ke.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Rb;var i=t.type||t;if(r(t))t=new oe(t,n);else if(t instanceof oe)t.target=t.target||n;else{var o=t;at(t=new oe(i,n),o)}if(o=!0,e)for(var a=e.length-1;0<=a;a--){var s=t.b=e[a];o=Pe(s,i,!0,t)&&o}if(o=Pe(s=t.b=n,i,!0,t)&&o,o=Pe(s,i,!1,t)&&o,e)for(a=0;a<e.length;a++)o=Pe(s=t.b=e[a],i,!1,t)&&o;return o},ke.prototype.va=function(){if(ke.pb.va.call(this),this.o){var t,e=this.o;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)le(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=Fe.prototype).S=function(){Ue(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return Ue(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return qe(this.b,t)?this.b[t]:e},t.set=function(t,e){qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function je(t,e){if(this.b=this.o=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof je){this.f=void 0!==e?e:t.f,Be(this,t.c),this.o=t.o,this.b=t.b,We(this,t.i),this.g=t.g,e=t.a;var n=new rn;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Qe(this,n),this.h=t.h}else t&&(n=String(t).match(Ve))?(this.f=!!e,Be(this,n[1]||"",!0),this.o=Ye(n[2]||""),this.b=Ye(n[3]||"",!0),We(this,n[4]),this.g=Ye(n[5]||"",!0),Qe(this,n[6]||"",!0),this.h=Ye(n[7]||"")):(this.f=!!e,this.a=new rn(null,this.f))}function Be(t,e,n){t.c=n?Ye(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function We(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Qe(t,e,n){var r,i;e instanceof rn?(t.a=e,r=t.a,(i=t.f)&&!r.f&&(on(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(sn(this,e),cn(this,n,t))},r)),r.f=i):(n||(e=Xe(e,en)),t.a=new rn(e,t.f))}function Ke(t,e,n){t.a.set(e,n)}function He(t,e){return t.a.get(e)}function Ge(t){return t instanceof je?new je(t):new je(t,void 0)}function ze(t,e){var n=new je(null,void 0);return Be(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Ye(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xe(t,e,n){return r(t)?(t=encodeURI(t).replace(e,Je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Je(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}je.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Xe(e,$e,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Xe(e,$e,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Xe(n,"/"==n.charAt(0)?tn:Ze,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Xe(n,nn)),t.join("")};var $e=/[#\/\?@]/g,Ze=/[#\?:]/g,tn=/[#\?]/g,en=/[#\?@]/g,nn=/#/g;function rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function on(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function an(t){var e=Me(t);if(void 0===e)throw Error("Keys are undefined");var n=new rn(null,void 0);t=Le(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];h(o)?cn(n,i,o):n.add(i,o)}return n}function sn(t,e){on(t),e=hn(t,e),qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ue(t)))}function un(t,e){return on(t),e=hn(t,e),qe(t.a.b,e)}function cn(t,e,n){sn(t,e),0<n.length&&(t.c=null,t.a.set(hn(t,e),q(n)),t.b+=n.length)}function hn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=rn.prototype).add=function(t,e){on(this),this.c=null,t=hn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){on(this),this.a.forEach(function(n,r){P(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){on(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){on(this);var e=[];if(r(t))un(this,t)&&(e=U(e,this.a.get(hn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},t.set=function(t,e){return on(this),this.c=null,un(this,t=hn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var ln=!Bt||9<=Number(Jt);function fn(t,e){this.a=t===yn&&e||"",this.b=dn}function pn(t){return t instanceof fn&&t.constructor===fn&&t.b===dn?t.a:(C("expected object of type Const, got '"+t+"'"),"type_error:Const")}fn.prototype.na=!0,fn.prototype.ma=function(){return this.a},fn.prototype.toString=function(){return"Const{"+this.a+"}"};var dn={},yn={};function mn(){this.a="",this.b=wn}function vn(t){return t instanceof mn&&t.constructor===mn&&t.b===wn?t.a:(C("expected object of type TrustedResourceUrl, got '"+t+"' of type "+u(t)),"type_error:TrustedResourceUrl")}function gn(t,e){var n,r,i=pn(t);if(!bn.test(i))throw Error("Invalid TrustedResourceUrl format: "+i);return n=t=i.replace(_n,function(t,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw Error('Found marker, "'+n+'", in format string, "'+i+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[n])instanceof fn?pn(t):encodeURIComponent(String(t))}),(r=new mn).a=n,r}mn.prototype.na=!0,mn.prototype.ma=function(){return this.a},mn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var _n=/%{(\w+)}/g,bn=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,wn={};function En(){this.a="",this.b=In}function Tn(t){return t instanceof En&&t.constructor===En&&t.b===In?t.a:(C("expected object of type SafeUrl, got '"+t+"' of type "+u(t)),"type_error:SafeUrl")}En.prototype.na=!0,En.prototype.ma=function(){return this.a},En.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Sn=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Cn(t){return t instanceof En?t:(t="object"==typeof t&&t.na?t.ma():String(t),Sn.test(t)||(t="about:invalid#zClosurez"),Nn(t))}var In={};function Nn(t){var e=new En;return e.a=t,e}function An(){this.a="",this.b=kn}Nn("about:blank"),An.prototype.na=!0,An.prototype.ma=function(){return this.a},An.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kn={};function Dn(t){var e=new An;return e.a=t,e}function Rn(t){var e=document;return r(t)?e.getElementById(t):t}function Pn(t,e){tt(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:On.hasOwnProperty(n)?t.setAttribute(On[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}Dn("<!DOCTYPE html>"),Dn(""),Dn("<br>");var On={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function xn(t,e,n){var i=arguments,o=document,a=String(i[0]),s=i[1];if(!ln&&s&&(s.name||s.type)){if(a=["<",a],s.name&&a.push(' name="',ut(s.name),'"'),s.type){a.push(' type="',ut(s.type),'"');var u={};at(u,s),delete u.type,s=u}a.push(">"),a=a.join("")}return a=o.createElement(a),s&&(r(s)?a.className=s:h(s)?a.className=s.join(" "):Pn(a,s)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild(r(n)?t.createTextNode(n):n)}for(var o=2;o<n.length;o++){var a=n[o];!l(a)||p(a)&&0<a.nodeType?i(a):P(Ln(a)?q(a):a,i)}}(o,a,i),a}function Ln(t){if(t&&"number"==typeof t.length){if(p(t))return"function"==typeof t.item||"string"==typeof t.item;if(f(t))return"function"==typeof t.item}return!1}function Mn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(h(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),Vn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Vn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Fn,t,e),e.join("")}function Fn(){}var Un={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},qn=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Vn(t,e){e.push('"',t.replace(qn,function(t){var e=Un[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Un[t]=e),e}),'"')}function jn(){var t=sr();return Bt&&!!Jt&&11==Jt||/Edge\/\d+/.test(t)}function Bn(){return n.window&&n.window.location.href||self&&self.location&&self.location.href||""}function Wn(t,e){e=e||n.window;var r="about:blank";t&&(r=Tn(Cn(t))),e.location.href=r}function Qn(t){return!!((t=(t||sr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Kn(t){t=t||n.window;try{t.close()}catch(t){}}function Hn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=sr().toLowerCase(),r&&(e.target=r,Y(n,"crios/")&&(e.target="_blank")),ir(sr())==nr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof En?n:Cn(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var a,s=i.join(",");if((Z("iPhone")&&!Z("iPod")&&!Z("iPad")||Z("iPad")||Z("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(s=r.document.createElement("A"),e instanceof En||e instanceof En||(e="object"==typeof e&&e.na?e.ma():String(e),Sn.test(e)||(e="about:invalid#zClosurez"),e=Nn(e)),s.href=Tn(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=Tn(e),s&&(Qt&&Y(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=Dn('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+ut(t)+'">'),s.document.write((a=t)instanceof An&&a.constructor===An&&a.b===kn?a.a:(C("expected object of type SafeHtml, got '"+a+"' of type "+u(a)),"type_error:SafeHtml")),s.document.close())):(s=r.open(Tn(e),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(t){}return s}var Gn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zn=/^[^@]+@[^@]+$/;function Yn(){var t=null;return new dt(function(e){"complete"==n.document.readyState?e():(t=function(){e()},_e(window,"load",t))}).s(function(e){throw be(window,"load",t),e})}function Xn(t){return t=t||sr(),!("file:"!==fr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function Jn(){var t=n.window;try{return!(!t||t==t.top)}catch(t){return!1}}function $n(){return"object"!=typeof n.window&&"function"==typeof n.importScripts}function Zn(){return er.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":er.INTERNAL.hasOwnProperty("node")?"Node":$n()?"Worker":"Browser"}function tr(){var t=Zn();return"ReactNative"===t||"Node"===t}var nr="Firefox",rr="Chrome";function ir(t){var e=t.toLowerCase();return Y(e,"opera/")||Y(e,"opr/")||Y(e,"opios/")?"Opera":Y(e,"iemobile")?"IEMobile":Y(e,"msie")||Y(e,"trident/")?"IE":Y(e,"edge/")?"Edge":Y(e,"firefox/")?nr:Y(e,"silk/")?"Silk":Y(e,"blackberry")?"Blackberry":Y(e,"webos")?"Webos":!Y(e,"safari/")||Y(e,"chrome/")||Y(e,"crios/")||Y(e,"android")?!Y(e,"chrome/")&&!Y(e,"crios/")||Y(e,"edge/")?Y(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":rr:"Safari"}var or={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function ar(t,e){e=e||[];var n,r=[],i={};for(n in or)i[or[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=Zn())?r=ir(i=sr()):"Worker"===r&&(r=ir(i=sr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function sr(){return n.navigator&&n.navigator.userAgent||""}function ur(t,e){t=t.split("."),e=e||n;for(var r=0;r<t.length&&"object"==typeof e&&null!=e;r++)e=e[t[r]];return r!=t.length&&(e=void 0),e}function cr(){try{var t=n.localStorage,e=vr();if(t)return t.setItem(e,"1"),t.removeItem(e),!jn()||!!n.indexedDB}catch(t){return $n()&&!!n.indexedDB}return!1}function hr(){return(lr()||"chrome-extension:"===fr()||Xn())&&!tr()&&cr()&&!$n()}function lr(){return"http:"===fr()||"https:"===fr()}function fr(){return n.location&&n.location.protocol||null}function pr(t){return!Qn(t=t||sr())&&ir(t)!=nr}function dr(t){return void 0===t?null:Mn(t)}function yr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function mr(t){if(null!==t)return JSON.parse(t)}function vr(t){return t||Math.floor(1e9*Math.random()).toString()}function gr(t){return"Safari"!=ir(t=t||sr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function _r(){var t=n.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var r=0;r<t.CP.length;r++)t.CP[r]=null}function br(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=sr(),e=Zn(),this.b=Qn(t)||"ReactNative"===e}function wr(){var t=n.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Er(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Tr(){return!(!ur("fireauth.oauthhelper",n)&&!ur("fireauth.iframe",n))}br.prototype.get=function(){var t=n.navigator;return!t||"boolean"!=typeof t.onLine||!lr()&&"chrome-extension:"!==fr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Sr,Cr={};function Ir(t){Cr[t]||(Cr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Nr={};Object.defineProperty(Nr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Nr,"abcd",{configurable:!0,enumerable:!0,value:2}),Sr=2==Nr.abcd}catch(t){Sr=!1}function Ar(t,e,n){Sr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function kr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Ar(t,n,e[n])}function Dr(t){var e={};return kr(e,t),e}function Rr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Ar(e,n,Rr(t[n]));return e}function Pr(t){var e={},n=t[xr],r=t[Lr];if(!(t=t[Mr])||t!=Or&&!n)throw Error("Invalid provider user info!");e[Ur]=r||null,e[Fr]=n||null,Ar(this,Vr,t),Ar(this,qr,Rr(e))}var Or="EMAIL_SIGNIN",xr="email",Lr="newEmail",Mr="requestType",Fr="email",Ur="fromEmail",qr="data",Vr="operation";function jr(t,e){this.code=Wr+t,this.message=e||Qr[t]||""}function Br(t){var e=t&&t.code;return e?new jr(e.substring(Wr.length),t.message):null}w(jr,Error),jr.prototype.C=function(){return{code:this.code,message:this.message}},jr.prototype.toJSON=function(){return this.C()};var Wr="auth/",Qr={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Kr(t){var e=t[Xr];if(void 0===e)throw new jr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new jr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Hr];if(n&&"object"==typeof n){e=n[Zr];var r=n[Jr];if(n=n[$r],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new jr("argument-error",Jr+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new jr("argument-error",$r+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new jr("argument-error",Zr+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new jr("missing-android-pkg-name")}}else if(void 0!==n)throw new jr("argument-error",Hr+" property must be a non null object when specified.");if(this.f=null,(e=t[Yr])&&"object"==typeof e){if("string"==typeof(e=e[ti])&&e.length)this.f=e;else if(void 0!==e)throw new jr("argument-error",ti+" property must be a non empty string when specified.")}else if(void 0!==e)throw new jr("argument-error",Yr+" property must be a non null object when specified.");if(void 0!==(e=t[zr])&&"boolean"!=typeof e)throw new jr("argument-error",zr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Gr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new jr("argument-error",Gr+" property must be a non empty string when specified.");this.i=t||null}var Hr="android",Gr="dynamicLinkDomain",zr="handleCodeInApp",Yr="iOS",Xr="url",Jr="installApp",$r="minimumVersion",Zr="packageName",ti="bundleId";function ei(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ni=null,ri=null;function ii(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=ri[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ni){ni={},ri={};for(var t=0;t<65;t++)ni[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(ri[ni[t]]=t)&&(ri["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function oi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function ai(t){return(t=si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new oi(t):null}function si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(ii(t))}catch(t){}return null}oi.prototype.f=function(){return this.b};var ui,ci={bd:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function hi(t){for(var e in ci)if(ci[e].id===t)return{firebaseEndpoint:(t=ci[e]).bb,secureTokenEndpoint:t.jb};return null}ui=hi("__EID__")?"__EID__":void 0;var li="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),fi=["client_id","response_type","scope","redirect_uri","state"],pi={Xc:{Na:"locale",Ba:500,Aa:600,Oa:"facebook.com",ib:fi},Zc:{Na:null,Ba:500,Aa:620,Oa:"github.com",ib:fi},$c:{Na:"hl",Ba:515,Aa:680,Oa:"google.com",ib:fi},fd:{Na:"lang",Ba:485,Aa:705,Oa:"twitter.com",ib:li}};function di(t){for(var e in pi)if(pi[e].Oa==t)return pi[e];return null}function yi(t){var e={};e["facebook.com"]=bi,e["google.com"]=Ei,e["github.com"]=wi,e["twitter.com"]=Ti;var n=t&&t[vi];try{if(n)return e[n]?new e[n](t):new _i(t);if(void 0!==t[mi])return new gi(t)}catch(t){}return null}var mi="idToken",vi="providerId";function gi(t){var e=t[vi];if(!e&&t[mi]){var n=ai(t[mi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Ar(this,"providerId",e),Ar(this,"isNewUser",n)}function _i(t){gi.call(this,t),Ar(this,"profile",Rr((t=mr(t.rawUserInfo||"{}"))||{}))}function bi(t){if(_i.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function wi(t){if(_i.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Ar(this,"username",this.profile&&this.profile.login||null)}function Ei(t){if(_i.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ti(t){if(_i.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Ar(this,"username",t.screenName||null)}function Si(t){this.a=Ge(t)}function Ci(t){var e=Ge(t),n=He(e,"link"),r=He(Ge(n),"link");return He(Ge(e=He(e,"deep_link_id")),"link")||e||r||n||t}function Ii(t,e){return t.then(function(t){if(t[la]){var n=ai(t[la]);if(!n||e!=n.c)throw new jr("user-mismatch");return t}throw new jr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Wr+"user-not-found"?new jr("user-mismatch"):t})}function Ni(t,e){if(!e)throw new jr("internal-error","failed to construct a credential");this.a=e,Ar(this,"providerId",t),Ar(this,"signInMethod",t)}function Ai(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function ki(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Ar(this,"idToken",e.idToken),e.accessToken&&Ar(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Ar(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new jr("internal-error","failed to construct a credential");Ar(this,"accessToken",e.oauthToken),Ar(this,"secret",e.oauthTokenSecret)}Ar(this,"providerId",t),Ar(this,"signInMethod",n)}function Di(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:an(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Ri(t,e){this.Fc=e||[],kr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(di(t)||{}).Na||null,this.ab=null}function Pi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new jr("argument-error",'SAML provider IDs must be prefixed with "saml."');Ri.call(this,t,[])}function Oi(t){Ri.call(this,t,fi),this.a=[]}function xi(){Oi.call(this,"facebook.com")}function Li(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return p(t)&&(e=t.accessToken),(new xi).credential(null,e)}function Mi(){Oi.call(this,"github.com")}function Fi(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return p(t)&&(e=t.accessToken),(new Mi).credential(null,e)}function Ui(){Oi.call(this,"google.com"),this.ua("profile")}function qi(t,e){var n=t;return p(t)&&(n=t.idToken,e=t.accessToken),(new Ui).credential(n,e)}function Vi(){Ri.call(this,"twitter.com",li)}function ji(t,e){var n=t;if(p(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new jr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new ki("twitter.com",n,"twitter.com")}function Bi(t,e,n){this.a=t,this.c=e,Ar(this,"providerId","password"),Ar(this,"signInMethod",n===Wi.EMAIL_LINK_SIGN_IN_METHOD?Wi.EMAIL_LINK_SIGN_IN_METHOD:Wi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Wi(){kr(this,{providerId:"password",isOAuthProvider:!1})}function Qi(t,e){if(!(e=Ki(e)))throw new jr("argument-error","Invalid email link!");return new Bi(t,e,Wi.EMAIL_LINK_SIGN_IN_METHOD)}function Ki(t){var e=He((t=new Si(t=Ci(t))).a,"oobCode")||null;return"signIn"===(He(t.a,"mode")||null)&&e?e:null}function Hi(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new jr("internal-error");this.a=t,Ar(this,"providerId","phone"),Ar(this,"signInMethod","phone")}function Gi(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function zi(t){try{this.a=t||er.auth()}catch(t){throw new jr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}kr(this,{providerId:"phone",isOAuthProvider:!1})}function Yi(t,e){if(!t)throw new jr("missing-verification-id");if(!e)throw new jr("missing-verification-code");return new Hi({Ua:t,Ta:e})}function Xi(t){if(t.temporaryProof&&t.phoneNumber)return new Hi({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return qi(o,n);case"facebook.com":return Li(n);case"github.com":return Fi(n);case"twitter.com":return ji(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ni(e,a):new ki(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Oi(e).credential(o,n,i):null}}catch(t){return null}}function Ji(t){if(!t.isOAuthProvider)throw new jr("invalid-oauth-provider")}function $i(t,e,n,r,i,o){if(this.b=t,this.c=e||null,this.f=n||null,this.g=r||null,this.h=o||null,this.a=i||null,!this.f&&!this.a)throw new jr("invalid-auth-event");if(this.f&&this.a)throw new jr("invalid-auth-event");if(this.f&&!this.g)throw new jr("invalid-auth-event")}function Zi(t){return(t=t||{}).type?new $i(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Br(t.error),t.postBody):null}function to(){this.b=null,this.a=[]}w(_i,gi),w(bi,_i),w(wi,_i),w(Ei,_i),w(Ti,_i),Ni.prototype.la=function(t){return ka(t,Ai(this))},Ni.prototype.b=function(t,e){var n=Ai(this);return n.idToken=e,Da(t,n)},Ni.prototype.f=function(t,e){return Ii(Ra(t,Ai(this)),e)},Ni.prototype.C=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},ki.prototype.la=function(t){return ka(t,Di(this))},ki.prototype.b=function(t,e){var n=Di(this);return n.idToken=e,Da(t,n)},ki.prototype.f=function(t,e){return Ii(Ra(t,Di(this)),e)},ki.prototype.C=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Ri.prototype.Da=function(t){return this.zb=nt(t),this},w(Pi,Ri),w(Oi,Ri),Oi.prototype.ua=function(t){return L(this.a,t)||this.a.push(t),this},Oi.prototype.Fb=function(){return q(this.a)},Oi.prototype.credential=function(t,e,n){if(!t&&!e)throw new jr("argument-error","credential failed: must provide the ID token and/or the access token.");return new ki(this.providerId,{idToken:t||null,accessToken:e||null,nonce:n||null},this.providerId)},w(xi,Oi),Ar(xi,"PROVIDER_ID","facebook.com"),Ar(xi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),w(Mi,Oi),Ar(Mi,"PROVIDER_ID","github.com"),Ar(Mi,"GITHUB_SIGN_IN_METHOD","github.com"),w(Ui,Oi),Ar(Ui,"PROVIDER_ID","google.com"),Ar(Ui,"GOOGLE_SIGN_IN_METHOD","google.com"),w(Vi,Ri),Ar(Vi,"PROVIDER_ID","twitter.com"),Ar(Vi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Bi.prototype.la=function(t){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?as(t,qa,{email:this.a,oobCode:this.c}):as(t,ns,{email:this.a,password:this.c})},Bi.prototype.b=function(t,e){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?as(t,Va,{idToken:e,email:this.a,oobCode:this.c}):as(t,Xa,{idToken:e,email:this.a,password:this.c})},Bi.prototype.f=function(t,e){return Ii(this.la(t),e)},Bi.prototype.C=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},kr(Wi,{PROVIDER_ID:"password"}),kr(Wi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),kr(Wi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Hi.prototype.la=function(t){return t.Va(Gi(this))},Hi.prototype.b=function(t,e){var n=Gi(this);return n.idToken=e,as(t,is,n)},Hi.prototype.f=function(t,e){var n=Gi(this);return n.operation="REAUTH",Ii(t=as(t,os,n),e)},Hi.prototype.C=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},zi.prototype.Va=function(t,e){var n=this.a.b;return wt(e.verify()).then(function(i){if(!r(i))throw new jr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return(o=n,a={phoneNumber:t,recaptchaToken:i},as(o,za,a)).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new jr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}var o,a})},kr(zi,{PROVIDER_ID:"phone"}),kr(zi,{PHONE_SIGN_IN_METHOD:"phone"}),$i.prototype.C=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,postBody:this.h,error:this.a&&this.a.C()}};var eo,no=null;function ro(t){var e="unauthorized-domain",n=void 0,r=Ge(t);t=r.b,"chrome-extension"==(r=r.c)?n=st("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=st("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",jr.call(this,e,n)}function io(t,e,n){jr.call(this,t,n),(t=e||{}).Ab&&Ar(this,"email",t.Ab),t.$&&Ar(this,"phoneNumber",t.$),t.credential&&Ar(this,"credential",t.credential)}function oo(t){if(t.code){var e=t.code||"";0==e.indexOf(Wr)&&(e=e.substring(Wr.length));var n={credential:Xi(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new jr(e,t.message||void 0);return new io(e,n,t.message)}return null}function ao(){}function so(t){return t.c||(t.c=t.b())}function uo(){}function co(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function ho(){}function lo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=g(this.fc,this),this.a.onerror=g(this.Gb,this),this.a.onprogress=g(this.gc,this),this.a.ontimeout=g(this.kc,this)}function fo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function po(t,e,n){this.reset(t,e,n,void 0,void 0)}function yo(t){this.f=t,this.b=this.c=this.a=null}function mo(t,e){this.name=t,this.value=e}to.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=ur("universalLinks.subscribe",n))&&t(null,this.b))},to.prototype.unsubscribe=function(t){F(this.a,function(e){return e==t})},w(ro,jr),w(io,jr),io.prototype.C=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.C();return e&&at(t,e),t},io.prototype.toJSON=function(){return this.C()},ao.prototype.c=null,w(uo,ao),uo.prototype.a=function(){var t=co(this);return t?new ActiveXObject(t):new XMLHttpRequest},uo.prototype.b=function(){var t={};return co(this)&&(t[0]=!0,t[1]=!0),t},eo=new uo,w(ho,ao),ho.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new lo;throw Error("Unsupported browser")},ho.prototype.b=function(){return{}},(t=lo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,fo(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",fo(this,4)},t.kc=function(){this.Gb()},t.gc=function(){this.status=200,fo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},po.prototype.a=null,po.prototype.reset=function(){delete this.a},mo.prototype.toString=function(){return this.name};var vo=new mo("SEVERE",1e3),go=new mo("WARNING",900),_o=new mo("CONFIG",700),bo=new mo("FINE",500);yo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(C("Root logger has no level set."),null)}(this).value)for(f(e)&&(e=e()),t=new po(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var wo,Eo={},To=null;function So(t){var e;if(To||(To=new yo(""),(Eo[""]=To).c=_o),!(e=Eo[t])){e=new yo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=So(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Eo[t]=e}return e}function Co(t,e){t&&t.log(bo,e,void 0)}function Io(t){this.f=t}function No(t){ke.call(this),this.u=t,this.readyState=Ao,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=So("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}w(Io,ao),Io.prototype.a=function(){return new No(this.f)},Io.prototype.b=(wo={},function(){return wo}),w(No,ke);var Ao=0;function ko(t){t.c.read().then(t.ec.bind(t)).catch(t.La.bind(t))}function Do(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Ro(t)}function Ro(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Po(t){ke.call(this),this.headers=new Fe,this.D=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.m=Oo,this.v=this.O=!1}(t=No.prototype).open=function(t,e){if(this.readyState!=Ao)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Ro(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.La.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Do(this,!1)),this.readyState=Ao},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Ro(this)),this.a&&(this.readyState=3,Ro(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.La.bind(this)):void 0!==n.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,ko(this)):t.text().then(this.ic.bind(this),this.La.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Do(this,!0):Ro(this),3==this.readyState&&ko(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Do(this,!0))},t.hc=function(t){this.a&&(this.response=t,Do(this,!0))},t.La=function(t){var e=this.h;e&&e.log(go,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Do(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(go,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(go,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},w(Po,ke);var Oo="";Po.prototype.b=So("goog.net.XhrIo");var xo=/^https?$/i,Lo=["POST","PUT"];function Mo(t,e,i,o,a){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);i=i?i.toUpperCase():"GET",t.l=e,t.h="",t.N=i,t.G=!1,t.c=!0,t.a=t.D?t.D.a():eo.a(),t.w=t.D?so(t.D):so(eo),t.a.onreadystatechange=g(t.Jb,t);try{Co(t.b,Ko(t,"Opening Xhr")),t.I=!0,t.a.open(i,String(e),!0),t.I=!1}catch(e){return Co(t.b,Ko(t,"Error opening Xhr: "+e.message)),void Uo(t,e)}e=o||"";var s,u=new Fe(t.headers);a&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(l(t)||r(t))P(t,e,void 0);else for(var n=Me(t),i=Le(t),o=i.length,a=0;a<o;a++)e.call(void 0,i[a],n&&n[a],t)}(a,function(t,e){u.set(e,t)}),a=function(t){t:{for(var e=Fo,n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return e<0?null:r(t)?t.charAt(e):t[e]}(u.U()),o=n.FormData&&e instanceof n.FormData,!L(Lo,i)||a||o||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),u.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{Bo(t),0<t.g&&(t.v=(s=t.a,Bt&&Zt(9)&&"number"==typeof s.timeout&&void 0!==s.ontimeout),Co(t.b,Ko(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=g(t.Ga,t)):t.u=Oe(t.Ga,t.g,t)),Co(t.b,Ko(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Co(t.b,Ko(t,"Send error: "+e.message)),Uo(t,e)}}function Fo(t){return"content-type"==t.toLowerCase()}function Uo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,qo(t),jo(t)}function qo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Vo(t){if(t.c&&void 0!==e)if(t.w[1]&&4==Wo(t)&&2==Qo(t))Co(t.b,Ko(t,"Local request error detected and ignored"));else if(t.i&&4==Wo(t))Oe(t.Jb,0,t);else if(t.dispatchEvent("readystatechange"),4==Wo(t)){Co(t.b,Ko(t,"Request complete")),t.c=!1;try{var r,i=Qo(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if(!(r=o)){var a;if(a=0===i){var s=String(t.l).match(Ve)[1]||null;if(!s&&n.self&&n.self.location){var u=n.self.location.protocol;s=u.substr(0,u.length-1)}a=!xo.test(s?s.toLowerCase():"")}r=a}if(r)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Wo(t)?t.a.statusText:""}catch(r){Co(t.b,"Can not get status: "+r.message),c=""}t.h=c+" ["+Qo(t)+"]",qo(t)}}finally{jo(t)}}}function jo(t,e){if(t.a){Bo(t);var n=t.a,r=t.w[0]?s:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(vo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Bo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(n.clearTimeout(t.u),t.u=null)}function Wo(t){return t.a?t.a.readyState:0}function Qo(t){try{return 2<Wo(t)?t.a.status:-1}catch(t){return-1}}function Ko(t,e){return e+" ["+t.N+" "+t.l+" "+Qo(t)+"]"}function Ho(t){var e=ra;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.o=0}function Go(t,e,n){t.a=!0,t.c=n,t.f=!e,Jo(t)}function zo(t){if(t.a){if(!t.l)throw new $o(t);t.l=!1}}function Yo(t,e,n,r){t.g.push([e,n,r]),t.a&&Jo(t)}function Xo(t){return x(t.g,function(t){return f(t[1])})}function Jo(t){if(t.h&&t.a&&Xo(t)){var e=t.h,r=ea[e];r&&(n.clearTimeout(r.a),delete ea[e]),t.h=0}t.b&&(t.b.o--,delete t.b),e=t.c;for(var i=r=!1;t.g.length&&!t.i;){var o=t.g.shift(),a=o[0],s=o[1];if(o=o[2],a=t.f?s:a)try{var u=a.call(o||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(E(e)||"function"==typeof n.Promise&&e instanceof n.Promise)&&(i=!0,t.i=!0)}catch(i){e=i,t.f=!0,Xo(t)||(r=!0)}}t.c=e,i&&(u=g(t.m,t,!0),i=g(t.m,t,!1),e instanceof Ho?(Yo(e,u,i),e.w=!0):e.then(u,i)),r&&(e=new ta(e),ea[e.a]=e,t.h=e.a)}function $o(){T.call(this)}function Zo(){T.call(this)}function ta(t){this.a=n.setTimeout(g(this.c,this),0),this.b=t}(t=Po.prototype).Ga=function(){void 0!==e&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Co(this.b,Ko(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Co(this.b,Ko(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jo(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),jo(this,!0)),Po.pb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?Vo(this):this.yc())},t.yc=function(){Vo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Oo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(vo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Co(this.b,"Can not get response: "+t.message),null}},Ho.prototype.cancel=function(t){if(this.a)this.c instanceof Ho&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.o--,e.o<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new Zo(this),zo(this),Go(this,!1,t))}},Ho.prototype.m=function(t,e){this.i=!1,Go(this,t,e)},Ho.prototype.then=function(t,e,n){var r,i,o=new dt(function(t,e){r=t,i=e});return Yo(this,r,function(t){t instanceof Zo?o.cancel():i(t)}),o.then(t,e,n)},Ho.prototype.$goog_Thenable=!0,w($o,T),$o.prototype.message="Deferred has already fired",$o.prototype.name="AlreadyCalledError",w(Zo,T),Zo.prototype.message="Deferred was canceled",Zo.prototype.name="CanceledError",ta.prototype.c=function(){throw delete ea[this.a],this.b};var ea={};function na(t){var e,r,i,s,u,c=document,h=vn(t),l=document.createElement("SCRIPT"),f={Lb:l,Ga:void 0},p=new Ho(f);return e=window.setTimeout(function(){ia(l,!0);var t=new sa(aa,"Timeout reached for loading script "+h);zo(p),Go(p,!1,t)},5e3),f.Ga=e,l.onload=l.onreadystatechange=function(){l.readyState&&"loaded"!=l.readyState&&"complete"!=l.readyState||(ia(l,!1,e),zo(p),Go(p,!0,null))},l.onerror=function(){ia(l,!0,e);var t=new sa(oa,"Error while loading script "+h);zo(p),Go(p,!1,t)},at(f={},{type:"text/javascript",charset:"UTF-8"}),Pn(l,f),i=t,(r=l).src=vn(i),null===a&&(a=(i=(i=n.document).querySelector&&i.querySelector("script[nonce]"))&&(i=i.nonce||i.getAttribute("nonce"))&&o.test(i)?i:""),(i=a)&&r.setAttribute("nonce",i),(s=c,(u=(s||document).getElementsByTagName("HEAD"))&&0!=u.length?u[0]:s.documentElement).appendChild(l),p}function ra(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&ia(t,!0,this.Ga)}}function ia(t,e,r){null!=r&&n.clearTimeout(r),t.onload=s,t.onerror=s,t.onreadystatechange=s,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var oa=0,aa=1;function sa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),T.call(this,n),this.code=t}function ua(t){this.f=t}function ca(t,e,r){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.o=t.secureTokenTimeout||fa,this.f=nt(t.secureTokenHeaders||pa),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||da,this.a=nt(t.firebaseHeaders||ya),r&&(this.a["X-Client-Version"]=r,this.f["X-Client-Version"]=r),r="Node"==Zn(),!(r=n.XMLHttpRequest||r&&er.INTERNAL.node&&er.INTERNAL.node.XMLHttpRequest)&&!$n())throw new jr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,$n()?this.c=new Io(self):tr()?this.c=new ua(r):this.c=new ho}w(sa,T),w(ua,ao),ua.prototype.a=function(){return new this.f},ua.prototype.b=function(){return{}};var ha,la="idToken",fa=new br(3e4,6e4),pa={"Content-Type":"application/x-www-form-urlencoded"},da=new br(3e4,6e4),ya={"Content-Type":"application/json"};function ma(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function va(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function ga(t,e,r,i,o,a,s){var u;(t=!((u=ir(u=sr())!=rr?null:(u=u.match(/\sChrome\/(\d+)/i))&&2==u.length?parseInt(u[1],10):null)&&u<30||Bt&&Jt&&!(9<Jt))||$n()?g(t.m,t):(ha||(ha=new dt(function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(n[ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},Yo(na(gn(_a,{onload:ba})),null,function(){e(Error("CORS_UNSUPPORTED"))},void 0))}(t,e)})),g(t.l,t)))(e,r,i,o,a,s)}ca.prototype.m=function(t,e,r,i,o,a){if($n()&&(void 0===n.fetch||void 0===n.Headers||void 0===n.Request))throw new jr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var s=new Po(this.c);if(a){s.g=Math.max(0,a);var u=setTimeout(function(){s.dispatchEvent("timeout")},a)}De(s,"complete",function(){u&&clearTimeout(u);var n=null;try{n=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Co(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){n=null}e&&e(n)}),Re(s,"ready",function(){u&&clearTimeout(u),Ft(this)}),Re(s,"timeout",function(){u&&clearTimeout(u),Ft(this),e&&e(null)}),Mo(s,t,r,i,o)};var _a=new fn(yn,"https://apis.google.com/js/client.js?onload=%{onload}"),ba="__fcb"+Math.floor(1e6*Math.random()).toString();function wa(t){if(!r(t=t.email)||!zn.test(t))throw new jr("invalid-email")}function Ea(t){"email"in t&&wa(t)}function Ta(t){if(!t[la])throw new jr("internal-error")}function Sa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new jr("internal-error")}else{if(!t.sessionInfo)throw new jr("missing-verification-id");if(!t.code)throw new jr("missing-verification-code")}}ca.prototype.l=function(t,e,n,r,i){var o=this;ha.then(function(){window.gapi.client.setApiKey(o.b);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},ca.prototype.Ra=function(){return as(this,Ja,{})},ca.prototype.qb=function(t,e){return as(this,Ya,{idToken:t,email:e})},ca.prototype.rb=function(t,e){return as(this,Xa,{idToken:t,password:e})};var Ca={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ia(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new jr("internal-error")}function Na(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&un(t=new rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Aa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=oo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=oo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=oo(t)):t.errorMessage&&(e=ss(t.errorMessage)),e)throw e;if(!t[la])throw new jr("internal-error")}function ka(t,e){return e.returnIdpCredential=!0,as(t,$a,e)}function Da(t,e){return e.returnIdpCredential=!0,as(t,ts,e)}function Ra(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,as(t,Za,e)}function Pa(t){if(!t.oobCode)throw new jr("invalid-action-code")}(t=ca.prototype).sb=function(t,e){var n={idToken:t},r=[];return tt(Ca,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),as(this,Ya,n)},t.lb=function(t,e){return at(t={requestType:"PASSWORD_RESET",email:t},e),as(this,Qa,t)},t.mb=function(t,e){return at(t={requestType:"EMAIL_SIGNIN",email:t},e),as(this,Ba,t)},t.kb=function(t,e){return at(t={requestType:"VERIFY_EMAIL",idToken:t},e),as(this,Wa,t)},t.Va=function(t){return as(this,rs,t)},t.$a=function(t,e){return as(this,Ga,{oobCode:t,newPassword:e})},t.Ja=function(t){return as(this,xa,{oobCode:t})},t.Xa=function(t){return as(this,Oa,{oobCode:t})};var Oa={endpoint:"setAccountInfo",B:Pa,da:"email"},xa={endpoint:"resetPassword",B:Pa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new jr("internal-error")}},La={endpoint:"signupNewUser",B:function(t){if(wa(t),!t.password)throw new jr("weak-password")},J:Ta,R:!0},Ma={endpoint:"createAuthUri"},Fa={endpoint:"deleteAccount",T:["idToken"]},Ua={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],B:function(t){if(!h(t.deleteProvider))throw new jr("internal-error")}},qa={endpoint:"emailLinkSignin",T:["email","oobCode"],B:wa,J:Ta,R:!0},Va={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],B:wa,J:Ta,R:!0},ja={endpoint:"getAccountInfo"},Ba={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new jr("internal-error");wa(t)},da:"email"},Wa={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new jr("internal-error")},da:"email"},Qa={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new jr("internal-error");wa(t)},da:"email"},Ka={vb:!0,endpoint:"getProjectConfig",Ib:"GET"},Ha={vb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new jr("internal-error")}},Ga={endpoint:"resetPassword",B:Pa,da:"email"},za={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},Ya={endpoint:"setAccountInfo",T:["idToken"],B:Ea,R:!0},Xa={endpoint:"setAccountInfo",T:["idToken"],B:function(t){if(Ea(t),!t.password)throw new jr("weak-password")},J:Ta,R:!0},Ja={endpoint:"signupNewUser",J:Ta,R:!0},$a={endpoint:"verifyAssertion",B:Ia,Pa:Na,J:Aa,R:!0},Za={endpoint:"verifyAssertion",B:Ia,Pa:Na,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new jr("user-not-found");if(t.errorMessage)throw ss(t.errorMessage);if(!t[la])throw new jr("internal-error")},R:!0},ts={endpoint:"verifyAssertion",B:function(t){if(Ia(t),!t.idToken)throw new jr("internal-error")},Pa:Na,J:Aa,R:!0},es={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new jr("invalid-custom-token")},J:Ta,R:!0},ns={endpoint:"verifyPassword",B:function(t){if(wa(t),!t.password)throw new jr("wrong-password")},J:Ta,R:!0},rs={endpoint:"verifyPhoneNumber",B:Sa,J:Ta},is={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new jr("internal-error");Sa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",oo(t);Ta(t)}},os={Xb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:Sa,J:Ta};function as(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Et(new jr("internal-error"));var r,i=e.Ib||"POST";return wt(n).then(e.B).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var a=Ge(t.g+e);Ke(a,"key",t.b),o&&Ke(a,"cb",b().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&Ke(a,u,r[u]);return new dt(function(e,o){ga(t,a.toString(),function(t){t?t.error?o(us(t,i||{})):e(t):o(new jr("network-request-failed"))},n,s?void 0:Mn(yr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Xb,e.vb||!1)}).then(function(t){return r=t,e.Pa?e.Pa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new jr("internal-error");return r[e.da]})}function ss(t){return us({error:{errors:[{message:t}],code:400,message:t}})}function us(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new jr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",at(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new jr(r[i],e);return!e&&t&&(e=dr(t)),new jr("internal-error",e)}function cs(t){var e;this.b=t,this.a=null,this.gb=(e=this,(ps||(ps=new dt(function(t,e){function r(){_r(),ur("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){_r(),e(Error("Network Error"))},timeout:ls.get()})}if(ur("gapi.iframes.Iframe"))t();else if(ur("gapi.load"))r();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();n[i]=function(){ur("gapi.load")?r():e(Error("Network Error"))},wt(na(i=gn(hs,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw ps=null,t}))).then(function(){return new dt(function(t,n){ur("gapi.iframes.getContext")().open({where:document.body,url:e.b,messageHandlersFilter:ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),t()}e.a=r,e.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},fs.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})}))}var hs=new fn(yn,"https://apis.google.com/js/api.js?onload=%{onload}"),ls=new br(3e4,6e4),fs=new br(5e3,15e3),ps=null;function ds(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=ze(this.i,"/__/auth/iframe"),Ke(this.a,"apiKey",this.g),Ke(this.a,"appName",this.h),this.b=null,this.c=[]}function ys(t,e,n,r,i){this.m=t,this.l=e,this.c=n,this.o=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ms(t){try{return er.app(t).auth().ya()}catch(t){return[]}}function vs(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.u=this.v=null,this.g=[],this.o=this.a=null}function gs(t){var e,n=Bn();return(e=t,as(e,Ka,{}).then(function(t){return t.authorizedDomains||[]})).then(function(t){t:{var e=Ge(n),r=e.c;e=e.b;for(var i=0;i<t.length;i++){var o=t[i],a=e,s=r;if(a=0==o.indexOf("chrome-extension://")?Ge(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(Gn.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new ro(Bn())})}function _s(t){return t.o||(t.o=Yn().then(function(){if(!t.u){var e=t.c,n=t.h,r=ms(t.b),i=new ds(t.l,t.f,t.b);i.f=e,i.b=n,i.c=q(r||[]),t.u=i.toString()}t.i=new cs(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");var e,n;e=t.i,n=function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Zi(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",wt(n)}return n.status="ERROR",wt(n)},e.gb.then(function(){e.a.register("authEvent",n,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t)})),t.o}function bs(t){return t.m||(t.v=t.c?ar(t.c,ms(t.b)):null,t.m=new ca(t.f,hi(t.h),t.v)),t.m}function ws(t,e,n,r,i,o,a,s,u,c){return(t=new ys(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=nt(u||null),t.f=c,t.toString()}function Es(t){if(this.a=t||er.INTERNAL.reactNative&&er.INTERNAL.reactNative.AsyncStorage,!this.a)throw new jr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ts(t){this.b=t,this.a={},this.c=g(this.f,this)}ds.prototype.toString=function(){return this.f?Ke(this.a,"v",this.f):sn(this.a.a,"v"),this.b?Ke(this.a,"eid",this.b):sn(this.a.a,"eid"),this.c.length?Ke(this.a,"fw",this.c.join(",")):sn(this.a.a,"fw"),this.a.toString()},ys.prototype.toString=function(){var t=ze(this.m,"/__/auth/handler");if(Ke(t,"apiKey",this.l),Ke(t,"appName",this.c),Ke(t,"authType",this.o),this.a.isOAuthProvider){var e=this.a;try{var n=er.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.ab=n,Ke(t,"providerId",this.a.providerId),n=yr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=nt(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),et(n)||Ke(t,"customParameters",dr(n))}if("function"==typeof this.a.Fb&&(e=this.a.Fb()).length&&Ke(t,"scopes",e.join(",")),this.i?Ke(t,"redirectUrl",this.i):sn(t.a,"redirectUrl"),this.g?Ke(t,"eventId",this.g):sn(t.a,"eventId"),this.h?Ke(t,"v",this.h):sn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!He(t,a)&&Ke(t,a,this.b[a]);return this.f?Ke(t,"eid",this.f):sn(t.a,"eid"),(a=ms(this.c)).length&&Ke(t,"fw",a.join(",")),t.toString()},(t=vs.prototype).Ea=function(t,e,n){var r=new jr("popup-closed-by-user"),i=new jr("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){var n,r;(n=o,r={type:"webStorageSupport"},_s(n).then(function(){return t=n.i,e=r,t.gb.then(function(){return new dt(function(n){t.a.send(e.type,e,n,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})});var t,e}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})).then(function(n){n||(t&&Kn(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return e=t,new dt(function(t){return function n(){xe(2e3).then(function(){if(e&&!e.closed)return n();t()})}()});var e}).then(function(){if(!a)return xe(n).then(function(){e(r)})})},t.Mb=function(){var t=sr();return!pr(t)&&!gr(t)},t.Hb=function(){return!1},t.Db=function(t,e,n,r,i,o,a){if(!t)return Et(new jr("popup-blocked"));if(a&&!pr())return this.ga().s(function(e){Kn(t),i(e)}),r(),wt();this.a||(this.a=gs(bs(this)));var s=this;return this.a.then(function(){var e=s.ga().s(function(e){throw Kn(t),i(e),e});return r(),e}).then(function(){Ji(n),a||Wn(ws(s.l,s.f,s.b,e,n,null,o,s.c,void 0,s.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=gs(bs(this)));var r=this;return this.a.then(function(){Ji(e),Wn(ws(r.l,r.f,r.b,t,e,Bn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return _s(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new jr("network-request-failed")})},t.Qb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ka=function(t){F(this.g,function(e){return e==t})},(t=Es.prototype).get=function(t){return wt(this.a.getItem(t)).then(function(t){return t&&mr(t)})},t.set=function(t,e){return wt(this.a.setItem(t,dr(e)))},t.P=function(t){return wt(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Ss,Cs=[];function Is(t){this.a=t}function Ns(t){this.c=t,this.b=!1,this.a=[]}function As(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Et(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new dt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return ks(t,c),e}).s(function(e){throw ks(t,c),e})}function ks(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),F(t.a,function(t){return t==e})}}function Ds(){if(!Os())throw new jr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=n.indexedDB,this.type="indexedDB",this.g=this.o=this.f=this.i=null,this.u=!1,this.h=null;var t,e=this;$n()&&self?(this.o=function(){var t=$n()?self:null;if(P(Cs,function(n){n.b==t&&(e=n)}),!e){var e=new Ts(t);Cs.push(e)}return e}(),this.o.subscribe("keyChanged",function(t,n){return Us(e).then(function(t){return 0<t.length&&P(e.a,function(e){e(t)}),{keyProcessed:L(t,n.key)}})}),this.o.subscribe("ping",function(){return wt(["keyChanged"])})):(t=n.navigator,t&&t.serviceWorker?wt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):wt(null)).then(function(t){(e.h=t)&&(e.g=new Ns(new Is(t)),As(e.g,"ping",null,!0).then(function(t){t[0].fulfilled&&L(t[0].value,"keyChanged")&&(e.u=!0)}).s(function(){}))})}function Rs(t){return new dt(function(e,n){var r=t.l.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){var i;(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):(i=t,new dt(function(t,e){var n=i.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})).then(function(){return Rs(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Ps(t){return t.m||(t.m=Rs(t)),t.m}function Os(){try{return!!n.indexedDB}catch(t){return!1}}function xs(t){return t.objectStore("firebaseLocalStorage")}function Ls(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ms(t){return new dt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Fs(t,e){return t.g&&t.h&&((r=n.navigator)&&r.serviceWorker&&r.serviceWorker.controller||null)===t.h?As(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):wt();var r}function Us(t){return Ps(t).then(function(t){var e=xs(Ls(t,!1));return e.getAll?Ms(e.getAll()):new dt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function qs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Vs(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=wt().then(function(){if(Os()){var t=vr(),r="__sak"+t;return Ss||(Ss=new Ds),(n=Ss).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){P(e.a,function(e){e(t)})}),t})}function js(){this.a={},this.type="inMemory"}function Bs(){if(!function(){var t="Node"==Zn();if(!(t=Ws()||t&&er.INTERNAL.node&&er.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new jr("internal-error","The LocalStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Ws()||er.INTERNAL.node.localStorage,this.type="localStorage"}function Ws(){try{var t=n.localStorage,e=vr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Qs(){this.type="nullStorage"}function Ks(){if(!function(){var t="Node"==Zn();if(!(t=Hs()||t&&er.INTERNAL.node&&er.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new jr("internal-error","The SessionStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Hs()||er.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Hs(){try{var t=n.sessionStorage,e=vr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Gs(){var t={};t.Browser=Xs,t.Node=Js,t.ReactNative=$s,t.Worker=Zs,this.a=t[Zn()]}Ts.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];P(r,function(e){i.push(wt().then(function(){return e(t.origin,t.data.data)}))}),St(i).then(function(r){var i=[];P(r,function(t){i.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),P(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Ts.prototype.subscribe=function(t,e){et(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},Ts.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(F(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],et(this.a)&&this.b.removeEventListener("message",this.c)},Is.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ns.prototype.close=function(){for(;0<this.a.length;)ks(this,this.a[0]);this.b=!0},(t=Ds.prototype).set=function(t,e){var n,r=!1,i=this;return Ps(this).then(function(e){return Ms((e=xs(Ls(n=e,!0))).get(t))}).then(function(o){var a=xs(Ls(n,!0));return o?(o.value=e,Ms(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Ms(a.add(o)))}).then(function(){return i.c[t]=e,Fs(i,t)}).ia(function(){r&&i.b--})},t.get=function(t){return Ps(this).then(function(e){return Ms(xs(Ls(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return Ps(this).then(function(r){return e=!0,n.b++,Ms(xs(Ls(r,!0)).delete(t))}).then(function(){return delete n.c[t],Fs(n,t)}).ia(function(){e&&n.b--})},t.Y=function(t){var e;0==this.a.length&&(qs(e=this),function t(){e.f=setTimeout(function(){e.i=Us(e).then(function(t){0<t.length&&P(e.a,function(e){e(t)})}).then(function(){t()}).s(function(e){"STOP_EVENT"!=e.message&&t()})},800)}()),this.a.push(t)},t.ca=function(t){F(this.a,function(e){return e==t}),0==this.a.length&&qs(this)},(t=Vs.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){F(this.a,function(e){return e==t})},(t=js.prototype).get=function(t){return wt(this.a[t])},t.set=function(t,e){return this.a[t]=e,wt()},t.P=function(t){return delete this.a[t],wt()},t.Y=function(){},t.ca=function(){},(t=Bs.prototype).get=function(t){var e=this;return wt().then(function(){return mr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return wt().then(function(){var r=dr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return wt().then(function(){e.a.removeItem(t)})},t.Y=function(t){n.window&&ve(n.window,"storage",t)},t.ca=function(t){n.window&&be(n.window,"storage",t)},(t=Qs.prototype).get=function(){return wt(null)},t.set=function(){return wt()},t.P=function(){return wt()},t.Y=function(){},t.ca=function(){},(t=Ks.prototype).get=function(t){var e=this;return wt().then(function(){return mr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return wt().then(function(){var r=dr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return wt().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var zs,Ys,Xs={A:Bs,Sa:Ks},Js={A:Bs,Sa:Ks},$s={A:Es,Sa:Qs},Zs={A:Bs,Sa:Qs},tu={ad:"local",NONE:"none",cd:"session"};function eu(){var t=!(gr(sr())||!Jn()),e=pr(),r=cr();this.m=t,this.h=e,this.o=r,this.a={},zs||(zs=new Gs),t=zs;try{this.g=!jn()&&Tr()||!n.indexedDB?new t.a.A:new Vs($n()?new js:new t.a.A)}catch(t){this.g=new js,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new js}this.l=new js,this.f=g(this.Pb,this),this.b={}}function nu(){return Ys||(Ys=new eu),Ys}function ru(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function iu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ou(t,e,n){return n=iu(e,n),"local"==e.A&&(t.b[n]=null),ru(t,e.A).P(n)}function au(t){t.c&&(clearInterval(t.c),t.c=null)}function su(t){this.a=t,this.b=nu()}(t=eu.prototype).get=function(t,e){return ru(this,t.A).get(iu(t,e))},t.set=function(t,e,n){var r=iu(t,n),i=this,o=ru(this,t.A);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.A&&(i.b[r]=e)})},t.addListener=function(t,e,r){var i;t=iu(t,e),this.o&&(this.b[t]=n.localStorage.getItem(t)),et(this.a)&&(ru(this,"local").Y(this.f),this.h||(jn()||!Tr())&&n.indexedDB||!this.o||(au(i=this),i.c=setInterval(function(){for(var t in i.a){var e=n.localStorage.getItem(t),r=i.b[t];e!=r&&(i.b[t]=e,e=new ae({type:"storage",key:t,target:window,oldValue:r,newValue:e,a:!0}),i.Pb(e))}},1e3))),this.a[t]||(this.a[t]=[]),this.a[t].push(r)},t.removeListener=function(t,e,n){t=iu(t,e),this.a[t]&&(F(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),et(this.a)&&(ru(this,"local").ca(this.f),au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var r in this.a){var i=this.b[r];void 0===i&&(i=null);var o=n.localStorage.getItem(r);o!==i&&(this.b[r]=o,this.Ya(r))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?ru(this,"local").ca(this.f):au(this),this.m)if(r=n.localStorage.getItem(e),(i=t.a.newValue)!==r)null!==i?n.localStorage.setItem(e,i):n.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var a=this;r=function(){void 0===t.a.a&&a.b[e]===n.localStorage.getItem(e)||(a.b[e]=n.localStorage.getItem(e),a.Ya(e))},Bt&&Jt&&10==Jt&&n.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(r,10):r()}}else P(t,g(this.Ya,this))},t.Ya=function(t){this.a[t]&&P(this.a[t],function(t){t()})};var uu,cu={name:"authEvent",A:"local"};function hu(){this.a=nu()}function lu(t,e){this.b=fu,this.f=n.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.o=n.Int32Array?new Int32Array(64):Array(64),void 0!==uu||(uu=n.Int32Array?new Int32Array(_u):_u),this.reset()}w(lu,function(){this.b=-1});for(var fu=64,pu=fu-1,du=[],yu=0;yu<pu;yu++)du[yu]=0;var mu=U(128,du);function vu(t){for(var e=t.f,n=t.o,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|uu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function gu(t,e,n){void 0===n&&(n=e.length);var i=0,o=t.c;if(r(e))for(;i<n;)t.f[o++]=e.charCodeAt(i++),o==t.b&&(vu(t),o=0);else{if(!l(e))throw Error("message must be string or array");for(;i<n;){var a=e[i++];if(!("number"==typeof a&&0<=a&&a<=255&&a==(0|a)))throw Error("message must be a byte array");t.f[o++]=a,o==t.b&&(vu(t),o=0)}}t.c=o,t.g+=n}lu.prototype.reset=function(){this.g=this.c=0,this.a=n.Int32Array?new Int32Array(this.h):q(this.h)};var _u=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function bu(){lu.call(this,8,wu)}w(bu,lu);var wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Eu(t,e,n,r,i){this.l=t,this.i=e,this.o=n,this.m=r||null,this.u=i||null,this.h=e+":"+n,this.v=new hu,this.g=new su(this.h),this.f=null,this.b=[],this.a=this.c=null}function Tu(t){return new jr("invalid-cordova-configuration",t)}function Su(t){var e=new bu;gu(e,t),t=[];var n=8*e.g;e.c<56?gu(e,mu,56-e.c):gu(e,mu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(vu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return O(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}function Cu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Iu(t){return t.f||(t.f=t.ga().then(function(){return new dt(function(e){t.wa(function n(r){return e(r),t.Ka(n),!1}),function(t){function e(e){i=!0,o&&o.cancel(),Nu(t).then(function(n){var i=r;if(n&&e&&e.url){var o=null;-1!=(i=Ci(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=mr(He(o=Ge(i),"firebaseError")||null))?Br(o):null)?new $i(n.b,n.c,null,null,o):new $i(n.b,n.c,i,n.g)),i=o||r}Cu(t,i)})}var r=new $i("unknown",null,null,null,new jr("no-auth-event")),i=!1,o=xe(500).then(function(){return Nu(t).then(function(){i||Cu(t,r)})}),a=n.handleOpenURL;n.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(ur("BuildInfo.packageName",n).toLowerCase()+"://")&&e({url:t}),"function"==typeof a)try{a(t)}catch(t){console.error(t)}},no||(no=new to),no.subscribe(e)}(t)})})),t.f}function Nu(t){var e,n=null;return(e=t.g,e.b.get(cu,e.a).then(function(t){return Zi(t)})).then(function(e){return n=e,ou((e=t.g).b,cu,e.a)}).then(function(){return n})}function Au(t){this.a=t,this.b=nu()}(t=Eu.prototype).ga=function(){return this.za?this.za:this.za=(Xn(void 0)?Yn().then(function(){return new dt(function(t,e){var r=n.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);r.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Et(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof ur("universalLinks.subscribe",n))throw Tu("cordova-universal-links-plugin-fix is not installed");if(void 0===ur("BuildInfo.packageName",n))throw Tu("cordova-plugin-buildinfo is not installed");if("function"!=typeof ur("cordova.plugins.browsertab.openUrl",n))throw Tu("cordova-plugin-browsertab is not installed");if("function"!=typeof ur("cordova.InAppBrowser.open",n))throw Tu("cordova-plugin-inappbrowser is not installed")},function(){throw new jr("cordova-not-ready")})},t.Ea=function(t,e){return e(new jr("operation-not-supported-in-this-environment")),wt()},t.Db=function(){return Et(new jr("operation-not-supported-in-this-environment"))},t.Qb=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,r){if(this.c)return Et(new jr("redirect-operation-pending"));var i=this,o=n.document,a=null,s=null,u=null,c=null;return this.c=wt().then(function(){return Ji(e),Iu(i)}).then(function(){return function(t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new $i(e,i,null,o,new jr("no-auth-event")),s=ur("BuildInfo.packageName",n);if("string"!=typeof s)throw new jr("invalid-cordova-configuration");var u=ur("BuildInfo.displayName",n),c={};if(sr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!sr().toLowerCase().match(/android/))return Et(new jr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Su(o),c.sessionId=o;var h=ws(t.l,t.i,t.o,e,r,null,i,t.m,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(cu,a.C(),e)}).then(function(){var e=ur("cordova.plugins.browsertab.isAvailable",n);if("function"!=typeof e)throw new jr("invalid-cordova-configuration");var r=null;e(function(e){if(e){if("function"!=typeof(r=ur("cordova.plugins.browsertab.openUrl",n)))throw new jr("invalid-cordova-configuration");r(h)}else{if("function"!=typeof(r=ur("cordova.InAppBrowser.open",n)))throw new jr("invalid-cordova-configuration");e=!(!(e=sr()).match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),t.a=r(h,e?"_blank":"_system","location=yes")}})})}(i,t,e,r)}).then(function(){return new dt(function(t,e){s=function(){var e=ur("cordova.plugins.browsertab.close",n);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.wa(s),u=function(){a||(a=xe(2e3).then(function(){e(new jr("redirect-cancelled-by-user"))}))},c=function(){wr()&&u()},o.addEventListener("resume",u,!1),sr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Nu(i).then(function(){throw t})})}).ia(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.Ka(s),i.c=null})},t.wa=function(t){this.b.push(t),Iu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new $i("unknown",null,null,null,new jr("no-auth-event")),t(e))})},t.Ka=function(t){F(this.b,function(e){return e==t})};var ku={name:"pendingRedirect",A:"session"};function Du(t){return ou(t.b,ku,t.a)}function Ru(t,e,n){this.u=t,this.o=e,this.l=n,this.h=[],this.f=!1,this.i=g(this.cb,this),this.b=new ju,this.m=new Ku,this.g=new Au(this.o+":"+this.l),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.m,this.c.linkViaPopup=this.m,this.c.reauthViaPopup=this.m,this.a=Pu(this.u,this.o,this.l,ui)}function Pu(t,e,n,r){var i=er.SDK_VERSION||null;return Xn()?new Eu(t,e,n,i,r):new vs(t,e,n,i,r)}function Ou(t){t.f||(t.f=!0,t.a.wa(t.i));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function xu(t){t.a.Mb()&&Ou(t).s(function(e){var n=new $i("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Uu(e)&&t.cb(n)}),t.a.Hb()||Bu(t.b)}(t=Ru.prototype).reset=function(){this.f=!1,this.a.Ka(this.i),this.a=Pu(this.u,this.o,this.l)},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(L(this.h,t)||this.h.push(t),!this.f){var e=this;(n=this.g,n.b.get(ku,n.a).then(function(t){return"pending"==t})).then(function(t){t?Du(e.g).then(function(){Ou(e).s(function(t){var n=new $i("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Uu(t)&&e.cb(n)})}):xu(e)}).s(function(){xu(e)})}var n},t.unsubscribe=function(t){F(this.h,function(e){return e==t})},t.cb=function(t){if(!t)throw new jr("invalid-auth-event");for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.wb(t.b,t.c)){(e=this.c[t.b])&&e.h(t,r),e=!0;break}}return Bu(this.b),e};var Lu=new br(2e3,1e4),Mu=new br(3e4,6e4);function Fu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.i))},function(){t.reset()},i,o)}function Uu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}Ru.prototype.fa=function(){return this.b.fa()},Ru.prototype.Ca=function(t,e,n){var r,i,o=this;return(i=this.g,i.b.set(ku,"pending",i.a)).then(function(){return o.a.Ca(t,e,n).s(function(t){if(Uu(t))throw new jr("operation-not-supported-in-this-environment");return r=t,Du(o.g).then(function(){throw r})}).then(function(){return o.a.Qb()?new dt(function(){}):Du(o.g).then(function(){return o.fa()}).then(function(){}).s(function(){})})})},Ru.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},Lu.get())};var qu={};function Vu(t,e,n){var r=e+":"+n;return qu[r]||(qu[r]=new Ru(t,e,n)),qu[r]}function ju(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Bu(t){t.g||(t.g=!0,Qu(t,!1,null,null))}function Wu(t,e){if(t.b=function(){return wt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Qu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Et(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):Wu(t,n):Wu(t,{user:null}),t.f=[],t.c=[]}function Ku(){}function Hu(){this.tb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.tb},set:function(t){this.tb=t},enumerable:!1})}function Gu(t,e){this.a=e,Ar(this,"verificationId",t)}function zu(t,e,n,r){return new zi(t).Va(e,n).then(function(t){return new Gu(t,r)})}function Yu(t){var e=si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new jr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");kr(this,{token:t,expirationTime:Er(1e3*e.exp),authTime:Er(1e3*e.auth_time),issuedAtTime:Er(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Xu(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Ju(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function $u(t){this.f=t,this.b=this.a=null,this.c=0}function Zu(t,e){var n=e[la],r=e.refreshToken;e=tc(e.expiresIn),t.b=n,t.c=e,t.a=r}function tc(t){return b()+1e3*parseInt(t,10)}function ec(t,e){return(n=t.f,r=e,new dt(function(t,e){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?ga(n,n.i+"?key="+encodeURIComponent(n.b),function(n){n?n.error?e(us(n)):n.access_token&&n.refresh_token?t(n):e(new jr("internal-error")):e(new jr("network-request-failed"))},"POST",an(r).toString(),n.f,n.o.get()):e(new jr("internal-error"))})).then(function(e){return t.b=e.access_token,t.c=tc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e});var n,r}function nc(t,e){this.a=t||null,this.b=e||null,kr(this,{lastSignInTime:Er(e||null),creationTime:Er(t||null)})}function rc(t,e,n,r,i,o){kr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function ic(t,e){for(var n in oe.call(this,t),e)this[n]=e[n]}function oc(t,e,n){var r;this.G=[],this.l=t.apiKey,this.m=t.appName,this.u=t.authDomain||null,t=er.SDK_VERSION?ar(er.SDK_VERSION):null,this.b=new ca(this.l,hi(ui),t),this.h=new $u(this.b),fc(this,e[la]),Zu(this.h,e),Ar(this,"refreshToken",this.h.a),yc(this,n||{}),ke.call(this),this.I=!1,this.u&&hr()&&(this.a=Vu(this.u,this.l,this.m)),this.N=[],this.i=null,this.w=(r=this,new Xu(function(){return r.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=r.h.c-b()-3e5;return 0<t?t:0})),this.V=g(this.Ha,this);var i=this;this.ka=null,this.ta=function(t){i.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){sc(i,t.c)},this.W=null}function ac(t,e){t.X&&be(t.X,"languageCodeChanged",t.ta),(t.X=e)&&ve(e,"languageCodeChanged",t.ta)}function sc(t,e){t.O=e,va(t.b,er.SDK_VERSION?ar(er.SDK_VERSION,t.O):null)}function uc(t,e){t.W&&be(t.W,"frameworkChanged",t.sa),(t.W=e)&&ve(e,"frameworkChanged",t.sa)}function cc(e){try{return er.app(e.m).auth()}catch(t){throw new jr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function hc(t){t.D||t.w.b||(t.w.start(),be(t,"tokenChanged",t.V),ve(t,"tokenChanged",t.V))}function lc(t){be(t,"tokenChanged",t.V),t.w.stop()}function fc(t,e){t.ra=e,Ar(t,"_lat",e)}function pc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return St(e).then(function(){return t})}function dc(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function yc(t,e){kr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new nc(e.createdAt,e.lastLoginAt),providerData:[]})}function mc(){}function vc(t){return wt().then(function(){if(t.D)throw new jr("app-deleted")})}function gc(t){return O(t.providerData,function(t){return t.providerId})}function _c(t,e){e&&(bc(t,e.providerId),t.providerData.push(e))}function bc(t,e){F(t.providerData,function(t){return t.providerId==e})}function wc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Ar(t,e,n)}function Ec(t,e){var n,r,i;t!=e&&(kr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?Ar(t,"metadata",new nc((i=e.metadata).a,i.b)):Ar(t,"metadata",new nc),P(e.providerData,function(e){_c(t,e)}),n=t.h,r=e.h,n.b=r.b,n.a=r.a,n.c=r.c,Ar(t,"refreshToken",t.h.a))}function Tc(t){return t.F().then(function(e){var n,r,i=t.isAnonymous;return(n=t,r=e,as(n.b,ja,{idToken:r}).then(g(n.zc,n))).then(function(){return i||wc(t,"isAnonymous",!1),e})})}function Sc(t,e){e[la]&&t.ra!=e[la]&&(Zu(t.h,e),t.dispatchEvent(new ic("tokenChanged")),fc(t,e[la]),wc(t,"refreshToken",t.h.a))}function Cc(t,e){return Tc(t).then(function(){if(L(gc(t),e))return pc(t).then(function(){throw new jr("provider-already-linked")})})}function Ic(t,e,n){return Dr({user:t,credential:Xi(e),additionalUserInfo:e=yi(e),operationType:n})}function Nc(t,e){return Sc(t,e),t.reload().then(function(){return t})}function Ac(t,e,n,r,i){if(!hr())return Et(new jr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Et(t.i);var o=di(n.providerId),a=vr(t.uid+":::"),s=null;(!pr()||Jn())&&t.u&&n.isOAuthProvider&&(s=ws(t.u,t.l,t.m,e,n,null,a,er.SDK_VERSION||null));var u=Hn(s,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(Dc(t),!i)return t.F().then(function(){})}).then(function(){return Fu(t.a,u,e,n,a,!!s)}).then(function(){return new dt(function(n,r){t.ha(e,null,new jr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.c=t.a.Ea(t,e,u,a)})}).then(function(t){return u&&Kn(u),t?Dr(t):null}).s(function(t){throw u&&Kn(u),t}),Rc(t,r,i)}function kc(t,e,n,r,i){if(!hr())return Et(new jr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Et(t.i);var o=null,a=vr(t.uid+":::");return r=r().then(function(){if(Dc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=a,pc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(xc,t.C(),e.a)),e}).then(function(){return t.a.Ca(e,n,a)}).s(function(e){if(o=e,t.ba)return Lc(t.ba);throw o}).then(function(){if(o)throw o}),Rc(t,r,i)}function Dc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new jr("internal-error");throw new jr("auth-domain-config-required")}}function Rc(t,e,n){var r,i,o,a=(i=e,o=n,(r=t).i&&!o?(i.cancel(),Et(r.i)):i.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(r.i||r.dispatchEvent(new ic("userInvalidated")),r.i=t),t}));return t.G.push(a),a.ia(function(){M(t.G,a)}),a}function Pc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[la]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-b())/1e3;var r=new oc(e,n,t);return t.providerData&&P(t.providerData,function(t){t&&_c(r,Dr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Oc(t){this.a=t,this.b=nu()}ju.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},ju.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.b,r=t.c,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Qu(this,!0,null,t.a),wt()):e.xa(n,r)?function(t,e,n){n=n.xa(e.b,e.c);var r=e.f,i=e.g,o=e.h,a=!!e.b.match(/Redirect$/);n(r,i,o).then(function(e){Qu(t,a,e,null)}).s(function(e){Qu(t,a,null,e)})}(this,t,e):Et(new jr("invalid-auth-event")):(Qu(this,!1,null,null),wt())}else Et(new jr("invalid-auth-event"))},ju.prototype.Za=function(){this.g&&!this.i&&Qu(this,!1,null,null)},ju.prototype.fa=function(){var t=this;return new dt(function(e,n){var r,i;t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),r=t,i=new jr("timeout"),r.a&&r.a.cancel(),r.a=xe(Mu.get()).then(function(){r.b||(r.g=!0,Qu(r,!0,null,i))}))})},Ku.prototype.h=function(t,e){if(t){var n=t.b,r=t.c;t.a?(e.ha(t.b,null,t.a,t.c),wt()):e.xa(n,r)?(o=e,a=(i=t).c,s=i.b,o.xa(s,a)(i.f,i.g,i.h).then(function(t){o.ha(s,t,null,a)}).s(function(t){o.ha(s,null,t,a)})):Et(new jr("invalid-auth-event"))}else Et(new jr("invalid-auth-event"));var i,o,a,s},Gu.prototype.confirm=function(t){return t=Yi(this.verificationId,t),this.a(t)},Xu.prototype.start=function(){this.a=this.c,function t(e,r){e.stop(),e.b=xe(Ju(e,r)).then(function(){return t=n.document,e=null,wr()||!t?wt():new dt(function(n){e=function(){wr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Xu.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},$u.prototype.C=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},$u.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Et(new jr("user-token-expired")):t||!this.b||b()>this.c-3e4?this.a?ec(this,{grant_type:"refresh_token",refresh_token:this.a}):wt(null):wt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},nc.prototype.C=function(){return{lastLoginAt:this.b,createdAt:this.a}},w(ic,oe),w(oc,ke),oc.prototype.pa=function(t){this.ka=t,ma(this.b,t)},oc.prototype.ea=function(){return this.ka},oc.prototype.ya=function(){return q(this.O)},oc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Ar(oc.prototype,"providerId","firebase"),(t=oc.prototype).reload=function(){var t=this;return Rc(this,vc(this).then(function(){return Tc(t).then(function(){return pc(t)}).then(mc)}))},t.dc=function(t){return this.F(t).then(function(t){return new Yu(t)})},t.F=function(t){var e=this;return Rc(this,vc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new jr("internal-error");return t.accessToken!=e.ra&&(fc(e,t.accessToken),e.dispatchEvent(new ic("tokenChanged"))),wc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new jr("internal-error");yc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=(r=(r=t).providerUserInfo)&&r.length?O(r,function(t){return new rc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[],n=0;n<e.length;n++)_c(this,e[n]);var r;wc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.hb=function(t){var e=this,n=null;return Rc(this,t.f(this.b,this.uid).then(function(t){return Sc(e,t),n=Ic(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.Ac=function(t){return Ir("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.hb(t).then(function(){})},t.fb=function(t){var e=this,n=null;return Rc(this,Cc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.b,n)}).then(function(t){return n=Ic(e,t,"link"),Nc(e,t)}).then(function(){return n}))},t.rc=function(t){return Ir("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.fb(t).then(function(t){return t.user})},t.sc=function(t,e){var n=this;return Rc(this,Cc(this,"phone").then(function(){return zu(cc(n),t,e,g(n.fb,n))}))},t.Bc=function(t,e){var n=this;return Rc(this,wt().then(function(){return zu(cc(n),t,e,g(n.hb,n))}),!0)},t.qb=function(t){var e=this;return Rc(this,this.F().then(function(n){return e.b.qb(n,t)}).then(function(t){return Sc(e,t),e.reload()}))},t.Tc=function(t){var e=this;return Rc(this,this.F().then(function(n){return t.b(e.b,n)}).then(function(t){return Sc(e,t),e.reload()}))},t.rb=function(t){var e=this;return Rc(this,this.F().then(function(n){return e.b.rb(n,t)}).then(function(t){return Sc(e,t),e.reload()}))},t.sb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return vc(this);var e=this;return Rc(this,this.F().then(function(n){return e.b.sb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Sc(e,t),wc(e,"displayName",t.displayName||null),wc(e,"photoURL",t.photoUrl||null),P(e.providerData,function(t){"password"===t.providerId&&(Ar(t,"displayName",e.displayName),Ar(t,"photoURL",e.photoURL))}),pc(e)}).then(mc))},t.Rc=function(t){var e=this;return Rc(this,Tc(this).then(function(n){return L(gc(e),t)?(r=e.b,i=n,o=[t],as(r,Ua,{idToken:i,deleteProvider:o})).then(function(t){var n={};return P(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),P(gc(e),function(t){n[t]||bc(e,t)}),n[zi.PROVIDER_ID]||Ar(e,"phoneNumber",null),pc(e)}):pc(e).then(function(){throw new jr("no-such-provider")});var r,i,o}))},t.delete=function(){var t=this;return Rc(this,this.F().then(function(e){return as(t.b,Fa,{idToken:e})}).then(function(){t.dispatchEvent(new ic("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");ac(t,null),uc(t,null),t.G=[],t.D=!0,lc(t),Ar(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},t.wb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?g(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?g(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?g(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?g(this.Cb,this):null},t.tc=function(t){var e=this;return Ac(this,"linkViaPopup",t,function(){return Cc(e,t.providerId).then(function(){return pc(e)})},!1)},t.Cc=function(t){return Ac(this,"reauthViaPopup",t,function(){return wt()},!0)},t.uc=function(t){var e=this;return kc(this,"linkViaRedirect",t,function(){return Cc(e,t.providerId)},!1)},t.Dc=function(t){return kc(this,"reauthViaRedirect",t,function(){return wt()},!0)},t.Bb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Rc(this,this.F().then(function(i){return Da(r.b,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=Ic(r,t,"link"),Nc(r,t)}).then(function(){return i}))},t.Cb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Rc(this,wt().then(function(){return Ii(Ra(r.b,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Ic(r,t,"reauthenticate"),Sc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(t){var e=this,n=null;return Rc(this,this.F().then(function(e){return n=e,void 0===t||et(t)?{}:ei(new Kr(t))}).then(function(t){return e.b.kb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.C()},t.C=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.u,stsTokenManager:this.h.C(),redirectEventId:this.aa||null};return this.metadata&&at(t,this.metadata.C()),P(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var xc={name:"redirectUser",A:"session"};function Lc(t){return ou(t.b,xc,t.a)}function Mc(t){var e,r,i,o,a,s,u,c,h;this.a=t,this.b=nu(),this.c=null,this.f=(e=this,r=qc("local"),i=qc("session"),o=qc("none"),(a=e.b,s=r,u=e.a,c=iu(s,u),h=ru(a,s.A),a.get(s,u).then(function(t){var e=null;try{e=mr(n.localStorage.getItem(c))}catch(t){}if(e&&!t)return n.localStorage.removeItem(c),a.set(s,e,u);e&&t&&"localStorage"!=h.type&&n.localStorage.removeItem(c)})).then(function(){return e.b.get(i,e.a)}).then(function(t){return t?i:e.b.get(o,e.a).then(function(t){return t?o:e.b.get(r,e.a).then(function(t){return t?r:e.b.get(Uc,e.a).then(function(t){return t?qc(t):r})})})}).then(function(t){return e.c=t,Fc(e,t.A)}).s(function(){e.c||(e.c=r)})),this.b.addListener(qc("local"),this.a,g(this.g,this))}function Fc(t,e){var n,r,i=[];for(n in tu)tu[n]!==e&&i.push(ou(t.b,qc(tu[n]),t.a));return i.push(ou(t.b,Uc,t.a)),r=i,new dt(function(t,e){var n=r.length,i=[];if(n)for(var o=function(e,r){n--,i[e]=r,0==n&&t(i)},a=function(t){e(t)},s=0;s<r.length;s++)Tt(r[s],_(o,s),a);else t(i)})}Mc.prototype.g=function(){var t=this,e=qc("local");Wc(this,function(){return wt().then(function(){return t.c&&"local"!=t.c.A?t.b.get(e,t.a):null}).then(function(n){if(n)return Fc(t,"local").then(function(){t.c=e})})})};var Uc={name:"persistence",A:"session"};function qc(t){return{name:"authUser",A:t}}function Vc(t,e){return Wc(t,function(){return t.b.set(t.c,e.C(),t.a)})}function jc(t){return Wc(t,function(){return ou(t.b,t.c,t.a)})}function Bc(t,e){return Wc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Pc(t||{})})})}function Wc(t,e){return t.f=t.f.then(e,e),t.f}function Qc(t){if(this.l=!1,Ar(this,"settings",new Hu),Ar(this,"app",t),!Jc(this).options||!Jc(this).options.apiKey)throw new jr("invalid-api-key");var e,n,r,i,o,a,s,u,c,h,l;t=er.SDK_VERSION?ar(er.SDK_VERSION):null,this.b=new ca(Jc(this).options&&Jc(this).options.apiKey,hi(ui),t),this.N=[],this.m=[],this.I=[],this.Tb=er.INTERNAL.createSubscribe(g(this.oc,this)),this.O=void 0,this.Ub=er.INTERNAL.createSubscribe(g(this.pc,this)),Yc(this,null),this.h=new Mc(Jc(this).options.apiKey+":"+Jc(this).name),this.w=new Oc(Jc(this).options.apiKey+":"+Jc(this).name),this.V=eh(this,(n=Jc(e=this).options.authDomain,r=(i=e,o=(a=i.w,s=Jc(i).options.authDomain,a.b.get(xc,a.a).then(function(t){return t&&s&&(t.authDomain=s),Pc(t||{})})).then(function(t){return(i.D=t)&&(t.ba=i.w),Lc(i.w)}),eh(i,o)).then(function(){return Bc(e.h,n)}).then(function(t){return t?(t.ba=e.w,e.D&&(e.D.aa||null)==(t.aa||null)?t:t.reload().then(function(){return Vc(e.h,t).then(function(){return t})}).s(function(n){return"auth/network-request-failed"==n.code?t:jc(e.h)})):null}).then(function(t){Yc(e,t||null)}),eh(e,r))),this.i=eh(this,(u=this).V.then(function(){return u.fa()}).s(function(){}).then(function(){if(!u.l)return u.ka()}).s(function(){}).then(function(){if(!u.l){u.X=!0;var t=u.h;t.b.addListener(qc("local"),t.a,u.ka)}})),this.X=!1,this.ka=g(this.Oc,this),this.Ha=g(this.Z,this),this.ra=g(this.bc,this),this.sa=g(this.mc,this),this.ta=g(this.nc,this),h=Jc(c=this).options.authDomain,l=Jc(c).options.apiKey,h&&hr()&&(c.Sb=c.V.then(function(){if(!c.l){if(c.a=Vu(h,l,Jc(c).name),c.a.subscribe(c),$c(c)&&dc($c(c)),c.D){dc(c.D);var t=c.D;t.pa(c.ea()),ac(t,c),sc(t=c.D,c.G),uc(t,c),c.D=null}return c.a}})),this.INTERNAL={},this.INTERNAL.delete=g(this.delete,this),this.INTERNAL.logFramework=g(this.vc,this),this.u=0,ke.call(this),Object.defineProperty(this,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),this.W=null,this.G=[]}function Kc(t){oe.call(this,"languageCodeChanged"),this.g=t}function Hc(t){oe.call(this,"frameworkChanged"),this.c=t}function Gc(t){return t.Sb||Et(new jr("auth-domain-config-required"))}function zc(t,e){var n={};return n.apiKey=Jc(t).options.apiKey,n.authDomain=Jc(t).options.authDomain,n.appName=Jc(t).name,t.V.then(function(){return r=n,i=e,o=t.w,a=t.ya(),s=new oc(r,i),o&&(s.ba=o),a&&sc(s,a),s.reload().then(function(){return s});var r,i,o,a,s}).then(function(e){return $c(t)&&e.uid==$c(t).uid?Ec($c(t),e):(Yc(t,e),dc(e)),t.Z(e)}).then(function(){th(t)})}function Yc(t,e){var n,r;$c(t)&&(n=$c(t),r=t.Ha,F(n.N,function(t){return t==r}),be($c(t),"tokenChanged",t.ra),be($c(t),"userDeleted",t.sa),be($c(t),"userInvalidated",t.ta),lc($c(t))),e&&(e.N.push(t.Ha),ve(e,"tokenChanged",t.ra),ve(e,"userDeleted",t.sa),ve(e,"userInvalidated",t.ta),0<t.u&&hc(e)),Ar(t,"currentUser",e),e&&(e.pa(t.ea()),ac(e,t),sc(e,t.G),uc(e,t))}function Xc(t,e){var n=null,r=null;return eh(t,e.then(function(e){return n=Xi(e),r=yi(e),zc(t,e)}).then(function(){return Dr({user:$c(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Jc(t){return t.app}function $c(t){return t.currentUser}function Zc(t){return $c(t)&&$c(t)._lat||null}function th(t){if(t.X){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Zc(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](Zc(t))}}function eh(t,e){return t.N.push(e),e.ia(function(){M(t.N,e)}),e}function nh(){}function rh(){this.a={},this.b=1e12}Mc.prototype.nb=function(t){var e=null,n=this;return function(t){var e=new jr("invalid-persistence-type"),n=new jr("unsupported-persistence-type");t:{for(r in tu)if(tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(Zn()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!cr()&&"none"!==t)throw n}}(t),Wc(this,function(){return t!=n.c.A?n.b.get(n.c,n.a).then(function(r){return e=r,Fc(n,t)}).then(function(){if(n.c=qc(t),e)return n.b.set(n.c,e,n.a)}):wt()})},w(Qc,ke),w(Kc,oe),w(Hc,oe),(t=Qc.prototype).nb=function(t){return eh(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,ma(this.b,this.W),this.dispatchEvent(new Kc(this.ea())))},t.ea=function(){return this.W},t.Uc=function(){var t=n.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.G.push(t),va(this.b,er.SDK_VERSION?ar(er.SDK_VERSION,this.G):null),this.dispatchEvent(new Hc(this.G))},t.ya=function(){return q(this.G)},t.toJSON=function(){return{apiKey:Jc(this).options.apiKey,authDomain:Jc(this).options.authDomain,appName:Jc(this).name,currentUser:$c(this)&&$c(this).C()}},t.wb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?g(this.ac,this):null},t.ac=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var i=null,o=null,a=ka(r.b,t).then(function(t){return i=Xi(t),o=yi(t),t});return eh(this,t=r.V.then(function(){return a}).then(function(t){return zc(r,t)}).then(function(){return Dr({user:$c(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Mc=function(t){if(!hr())return Et(new jr("operation-not-supported-in-this-environment"));var e=this,n=di(t.providerId),r=vr(),i=null;(!pr()||Jn())&&Jc(this).options.authDomain&&t.isOAuthProvider&&(i=ws(Jc(this).options.authDomain,Jc(this).options.apiKey,Jc(this).name,"signInViaPopup",t,null,r,er.SDK_VERSION||null));var o=Hn(i,n&&n.Ba,n&&n.Aa);return eh(this,n=Gc(this).then(function(e){return Fu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new dt(function(t,n){e.ha("signInViaPopup",null,new jr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=e.a.Ea(e,"signInViaPopup",o,r)})}).then(function(t){return o&&Kn(o),t?Dr(t):null}).s(function(t){throw o&&Kn(o),t}))},t.Nc=function(t){if(!hr())return Et(new jr("operation-not-supported-in-this-environment"));var e=this;return eh(this,Gc(this).then(function(){return Wc(t=e.h,function(){return t.b.set(Uc,t.c.A,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!hr())return Et(new jr("operation-not-supported-in-this-environment"));var t=this;return eh(this,Gc(this).then(function(){return t.a.fa()}).then(function(t){return t?Dr(t):null}))},t.Sc=function(t){if(!t)return Et(new jr("null-user"));var e=this,n={};n.apiKey=Jc(this).options.apiKey,n.authDomain=Jc(this).options.authDomain,n.appName=Jc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.m};var i=t.h,o={};return o[la]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-b())/1e3,e=new oc(e,o),n&&(e.ba=n),r&&sc(e,r),Ec(e,t),e}(t,n,e.w,e.ya());return eh(this,this.i.then(function(){if(Jc(e).options.apiKey!=t.l)return r.reload()}).then(function(){return $c(e)&&t.uid==$c(e).uid?(Ec($c(e),t),e.Z(t)):(Yc(e,r),dc(r),e.Z(r))}).then(function(){th(e)}))},t.ob=function(){var t=this;return eh(this,this.i.then(function(){return $c(t)?(Yc(t,null),jc(t.h).then(function(){th(t)})):wt()}))},t.Oc=function(){var t=this;return Bc(this.h,Jc(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=$c(t)&&e){n=$c(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Ec($c(t),e),$c(t).F();($c(t)||e)&&(Yc(t,e),e&&(dc(e),e.ba=t.w),t.a&&t.a.subscribe(t),th(t))}})},t.Z=function(t){return Vc(this.h,t)},t.bc=function(){th(this),this.Z($c(this))},t.mc=function(){this.ob()},t.nc=function(){this.ob()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next($c(e))})},t.pc=function(t){var e,n,r=this;n=function(){t.next($c(r))},(e=this).I.push(n),eh(e,e.i.then(function(){!e.l&&L(e.I,n)&&e.O!==e.getUid()&&(e.O=e.getUid(),n(Zc(e)))}))},t.xc=function(t,e,n){var r=this;return this.X&&er.Promise.resolve().then(function(){f(t)?t($c(r)):f(t.next)&&t.next($c(r))}),this.Tb(t,e,n)},t.wc=function(t,e,n){var r=this;return this.X&&er.Promise.resolve().then(function(){r.O=r.getUid(),f(t)?t($c(r)):f(t.next)&&t.next($c(r))}),this.Ub(t,e,n)},t.cc=function(t){var e=this;return eh(this,this.i.then(function(){return $c(e)?$c(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Nb=function(t){var e=this;return this.i.then(function(){return Xc(e,as(e.b,es,{token:t}))}).then(function(t){var n=t.user;return wc(n,"isAnonymous",!1),e.Z(n),t})},t.Gc=function(t){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Nb(t)},t.Hc=function(t,e){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Ob(t,e)},t.Ob=function(t,e){var n=this;return this.i.then(function(){return Xc(n,as(n.b,ns,{email:t,password:e}))})},t.yb=function(t,e){var n=this;return this.i.then(function(){return Xc(n,as(n.b,La,{email:t,password:e}))})},t.Wb=function(t,e){return Ir("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.yb(t,e)},t.Jc=function(t){return Ir("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Qa(t).then(function(t){return t.user})},t.Qa=function(t){var e=this;return this.i.then(function(){return Xc(e,t.la(e.b))})},t.Ra=function(){var t=this;return this.i.then(function(){var e=$c(t);return e&&e.isAnonymous?Dr({user:e,credential:null,additionalUserInfo:Dr({providerId:null,isNewUser:!1}),operationType:"signIn"}):Xc(t,t.b.Ra()).then(function(e){var n=e.user;return wc(n,"isAnonymous",!0),t.Z(n),e})})},t.Ic=function(){return Ir("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Ra()},t.getUid=function(){return $c(this)&&$c(this).uid||null},t.Vb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&$c(this)&&hc($c(this))},t.Ec=function(t){var e=this;P(this.m,function(n){n==t&&e.u--}),this.u<0&&(this.u=0),0==this.u&&$c(this)&&lc($c(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),eh(this,this.i.then(function(){e.l||L(e.m,t)&&t(Zc(e))}))},t.removeAuthTokenListener=function(t){F(this.m,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(qc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),er.Promise.resolve()},t.Zb=function(t){return Ir("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),eh(this,as(this.b,Ma,{identifier:t,continueUri:lr()?Bn():"http://localhost"}).then(function(t){return t.allProviders||[]}))},t.$b=function(t){return eh(this,as(this.b,Ma,{identifier:t,continueUri:lr()?Bn():"http://localhost"}).then(function(t){return t.signinMethods||[]}))},t.qc=function(t){return!!Ki(t)},t.mb=function(t,e){var n=this;return eh(this,wt().then(function(){var t=new Kr(e);if(!t.c)throw new jr("argument-error",zr+" must be true when sending sign in link to email");return ei(t)}).then(function(e){return n.b.mb(t,e)}).then(function(){}))},t.Vc=function(t){return this.Ja(t).then(function(t){return t.data.email})},t.$a=function(t,e){return eh(this,this.b.$a(t,e).then(function(){}))},t.Ja=function(t){return eh(this,this.b.Ja(t).then(function(t){return new Pr(t)}))},t.Xa=function(t){return eh(this,this.b.Xa(t).then(function(){}))},t.lb=function(t,e){var n=this;return eh(this,wt().then(function(){return void 0===e||et(e)?{}:ei(new Kr(e))}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},t.Lc=function(t,e){return eh(this,zu(this,t,e,g(this.Qa,this)))},t.Kc=function(t,e){var n=this;return eh(this,wt().then(function(){var r=Qi(t,e||Bn());return n.Qa(r)}))},nh.prototype.render=function(){},nh.prototype.reset=function(){},nh.prototype.getResponse=function(){},nh.prototype.execute=function(){};var ih=null;function oh(t,e){return(e=ah(e))&&t.a[e]||null}function ah(t){return(t=void 0===t?1e12:t)?t.toString():null}function sh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Rn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ve(this.f,"click",this.i)}function uh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function ch(){}rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new sh(t,e),this.b++},rh.prototype.reset=function(t){var e=oh(this,t);t=ah(t),e&&t&&(e.delete(),delete this.a[t])},rh.prototype.getResponse=function(t){return(t=oh(this,t))?t.getResponse():null},rh.prototype.execute=function(t){(t=oh(this,t))&&t.execute()},sh.prototype.getResponse=function(){return uh(this),this.b},sh.prototype.execute=function(){uh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(e){}t.h&&t.execute()},6e4)},500))},sh.prototype.delete=function(){uh(this),this.g=!0,clearTimeout(this.a),this.a=null,be(this.f,"click",this.i)},ch.prototype.g=function(){return ih||(ih=new rh),wt(ih)},ch.prototype.c=function(){};var hh=null;function lh(){this.b=n.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var fh=new fn(yn,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),ph=new br(3e4,6e4);lh.prototype.g=function(t){var e=this;return new dt(function(r,i){var o=setTimeout(function(){i(new jr("network-request-failed"))},ph.get());!n.grecaptcha||t!==e.f&&!e.b?(n[e.a]=function(){if(n.grecaptcha){e.f=t;var a=n.grecaptcha.render;n.grecaptcha.render=function(t,n){return t=a(t,n),e.b++,t},clearTimeout(o),r(n.grecaptcha)}else clearTimeout(o),i(new jr("internal-error"));delete n[e.a]},wt(na(gn(fh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(o),i(new jr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(o),r(n.grecaptcha))})},lh.prototype.c=function(){this.b--};var dh=null;function yh(t,e,r,i,o,a,s){if(Ar(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,s=s?(hh||(hh=new ch),hh):(dh||(dh=new lh),dh),this.m=s,this.a=r||{theme:"light",type:"image"},this.h=[],this.a[gh])throw new jr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[_h],!n.document)throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Rn(e)||!this.i&&Rn(e).hasChildNodes())throw new jr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new ca(t,a||null,o||null),this.v=i||function(){return null};var u=this;this.o=[];var c=this.a[mh];this.a[mh]=function(t){if(bh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=ur(c,n);"function"==typeof e&&e(t)}};var h=this.a[vh];this.a[vh]=function(){if(bh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=ur(h,n);"function"==typeof t&&t()}}}var mh="callback",vh="expired-callback",gh="sitekey",_h="size";function bh(t,e){for(var n=0;n<t.o.length;n++)try{t.o[n](e)}catch(t){}}function wh(t,e){return t.h.push(e),e.ia(function(){M(t.h,e)}),e}function Eh(t){if(t.D)throw new jr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Th(t,e,n){var r=!1;try{this.b=n||er.app()}catch(t){throw new jr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new jr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=er.SDK_VERSION?ar(er.SDK_VERSION,o):null,yh.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,hi(ui),r)}function Sh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new jr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Ch.length)throw new jr("internal-error","Argument validator received an unsupported number of arguments.");n=Ch[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new jr("argument-error",t+" failed: "+r)}(t=yh.prototype).za=function(){var t=this;return this.f?this.f:this.f=wh(this,wt().then(function(){if(lr()&&!$n())return Yn();throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.v())}).then(function(e){return t.g=e,as(t.u,Ha,{})}).then(function(e){t.a[gh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){Eh(this);var t=this;return wh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Rn(e);e=xn("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){Eh(this);var t=this;return wh(this,this.render().then(function(e){return new dt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){var r;e&&(r=i,F(t.o,function(t){return t==r}),n(e))};t.o.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){Eh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Eh(this),this.D=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Rn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},w(Th,yh);var Ch="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Ih(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:r}}function Nh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:i}}function Ah(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:p}}function kh(t,e){return{name:t||"",K:"a function",optional:!!e,M:f}}function Dh(t,e){return{name:t||"",K:"null",optional:!!e,M:c}}function Rh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.la||!n)}}}function Ph(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&r(t.type)&&f(t.verify))}}}function Oh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function xh(t,e){for(var n in e){var r=e[n].name;t[r]=Fh(r,t[n],e[n].j)}}function Lh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:_(function(t){return this[t]},n),set:_(function(t,e,n,r){Sh(t,[n],[r],!0),this[e]=r},r,n,e[n].ub),enumerable:!0})}}function Mh(t,e,n,r){t[e]=Fh(e,n,r)}function Fh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Sh(a,n,t),e.apply(this,t)}if(!n)return e;var i,o,a=(o=(o=t).split("."))[o.length-1];for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}xh(Qc.prototype,{Xa:{name:"applyActionCode",j:[Ih("code")]},Ja:{name:"checkActionCode",j:[Ih("code")]},$a:{name:"confirmPasswordReset",j:[Ih("code"),Ih("newPassword")]},yb:{name:"createUserWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Wb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Zb:{name:"fetchProvidersForEmail",j:[Ih("email")]},$b:{name:"fetchSignInMethodsForEmail",j:[Ih("email")]},fa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[Ih("emailLink")]},wc:{name:"onAuthStateChanged",j:[Oh(Ah(),kh(),"nextOrObserver"),kh("opt_error",!0),kh("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[Oh(Ah(),kh(),"nextOrObserver"),kh("opt_error",!0),kh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[Ih("email"),Oh(Ah("opt_actionCodeSettings",!0),Dh(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[Ih("email"),Ah("actionCodeSettings")]},nb:{name:"setPersistence",j:[Ih("persistence")]},Qa:{name:"signInAndRetrieveDataWithCredential",j:[Rh()]},Ra:{name:"signInAnonymously",j:[]},Ic:{name:"signInAnonymouslyAndRetrieveData",j:[]},Jc:{name:"signInWithCredential",j:[Rh()]},Nb:{name:"signInWithCustomToken",j:[Ih("token")]},Gc:{name:"signInAndRetrieveDataWithCustomToken",j:[Ih("token")]},Ob:{name:"signInWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Kc:{name:"signInWithEmailLink",j:[Ih("email"),Ih("emailLink",!0)]},Hc:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Lc:{name:"signInWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},Mc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Sc:{name:"updateCurrentUser",j:[Oh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof oc)}},Dh(),"user")]},ob:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Ih(null,!0)]},Uc:{name:"useDeviceLanguage",j:[]},Vc:{name:"verifyPasswordResetCode",j:[Ih("code")]}}),Lh(Qc.prototype,{lc:{name:"languageCode",ub:Oh(Ih(),Dh(),"languageCode")}}),(Qc.Persistence=tu).LOCAL="local",Qc.Persistence.SESSION="session",Qc.Persistence.NONE="none",xh(oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Nh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Nh("opt_forceRefresh",!0)]},fb:{name:"linkAndRetrieveDataWithCredential",j:[Rh()]},rc:{name:"linkWithCredential",j:[Rh()]},sc:{name:"linkWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},hb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Rh()]},Ac:{name:"reauthenticateWithCredential",j:[Rh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[Oh(Ah("opt_actionCodeSettings",!0),Dh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Ih(null,!0)]},Rc:{name:"unlink",j:[Ih("provider")]},qb:{name:"updateEmail",j:[Ih("email")]},rb:{name:"updatePassword",j:[Ih("password")]},Tc:{name:"updatePhoneNumber",j:[Rh("phone")]},sb:{name:"updateProfile",j:[Ah("profile")]}}),xh(rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),xh(nh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),xh(dt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Lh(Hu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",ub:Nh("appVerificationDisabledForTesting")}}),xh(Gu.prototype,{confirm:{name:"confirm",j:[Ih("verificationCode")]}}),Mh(Wi,"credential",function(t,e){return new Bi(t,e)},[Ih("email"),Ih("password")]),xh(xi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(xi,"credential",Li,[Oh(Ih(),Ah(),"token")]),Mh(Wi,"credentialWithLink",Qi,[Ih("email"),Ih("emailLink")]),xh(Mi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Mi,"credential",Fi,[Oh(Ih(),Ah(),"token")]),xh(Ui.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Ui,"credential",qi,[Oh(Ih(),Oh(Ah(),Dh()),"idToken"),Oh(Ih(),Dh(),"accessToken",!0)]),xh(Vi.prototype,{Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Vi,"credential",ji,[Oh(Ih(),Ah(),"token"),Ih("secret",!0)]),xh(Oi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},credential:{name:"credential",j:[Oh(Ih(),Dh(),"idToken",!0),Oh(Ih(),Dh(),"accessToken",!0),Oh(Ih(),Dh(),"nonce",!0)]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(zi,"credential",Yi,[Ih("verificationId"),Ih("verificationCode")]),xh(zi.prototype,{Va:{name:"verifyPhoneNumber",j:[Ih("phoneNumber"),Ph()]}}),xh(jr.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(io.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(ro.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(Th.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===er||!er.INTERNAL||!er.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:Qc,Error:jr};Mh(t,"EmailAuthProvider",Wi,[]),Mh(t,"FacebookAuthProvider",xi,[]),Mh(t,"GithubAuthProvider",Mi,[]),Mh(t,"GoogleAuthProvider",Ui,[]),Mh(t,"TwitterAuthProvider",Vi,[]),Mh(t,"OAuthProvider",Oi,[Ih("providerId")]),Mh(t,"SAMLAuthProvider",Pi,[Ih("providerId")]),Mh(t,"PhoneAuthProvider",zi,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof Qc)}}]),Mh(t,"RecaptchaVerifier",Th,[Oh(Ih(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Ah("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof er.app.App)}}]),er.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:g((t=new Qc(t)).getUid,t),getToken:g(t.cc,t),addAuthTokenListener:g(t.Vb,t),removeAuthTokenListener:g(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),er.INTERNAL.extendNamespace({User:oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),(tr=Zn||(Zn={}))[tr.DEBUG=0]="DEBUG",tr[tr.VERBOSE=1]="VERBOSE",tr[tr.INFO=2]="INFO",tr[tr.WARN=3]="WARN",tr[tr.ERROR=4]="ERROR",tr[tr.SILENT=5]="SILENT";var nr,rr,ir,or,ar,sr,ur,cr,hr,lr,fr,pr=Zn.INFO,dr=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Zn.DEBUG:case Zn.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zn.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zn.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Zn.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},yr=function(){function t(t){this.name=t,this._logLevel=pr,this._logHandler=dr}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Zn))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zn.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zn.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zn.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zn.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Zn.ERROR].concat(t))},t}(),mr=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),In(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Cn(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),vr=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return An(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),gr=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new mr(e)}}catch(t){}return new vr},_r=gr("localStorage"),br=gr("sessionStorage"),wr=new yr("@firebase/database"),Er=(nr=1,function(){return nr++}),Tr=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;cn(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(e[n++]=i<65536?i>>12|224:(e[n++]=i>>18|240,i>>12&63|128),i>>6&63|128),63&i|128)}return e}(t),n=new Fn;n.update(e);var r=n.digest();return fn.encodeByteArray(r)},Sr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=Sr.apply(null,t[r]):"object"==typeof t[r]?n+=In(t[r]):n+=t[r],n+=" ";return n},Cr=null,Ir=!0,Nr=function(t,e){cn(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(wr.logLevel=Zn.VERBOSE,Cr=wr.log.bind(wr),e&&br.set("logging_enabled",!0)):"function"==typeof t?Cr=t:(Cr=null,br.remove("logging_enabled"))},Ar=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Ir&&(Ir=!1,null===Cr&&!0===br.get("logging_enabled")&&Nr(!0)),Cr){var n=Sr.apply(null,t);Cr(n)}},kr=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Ar.apply(void 0,[t].concat(e))}},Dr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Sr.apply(void 0,t);wr.error(n)},Rr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Sr.apply(void 0,t);throw wr.error(n),new Error(n)},Pr=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Sr.apply(void 0,t);wr.warn(n)},Or=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},xr="[MIN_NAME]",Lr="[MAX_NAME]",Mr=function(t,e){if(t===e)return 0;if(t===xr||e===Lr)return-1;if(e===xr||t===Lr)return 1;var n=Qr(t),r=Qr(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Fr=function(t,e){return t===e?0:t<e?-1:1},Ur=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+In(e))},qr=function(t){if("object"!=typeof t||null===t)return In(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=In(e[i]),r+=":",r+=qr(t[e[i]]);return r+"}"},Vr=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},jr=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;++n)e(n,t[n]);else Dn(t,function(t,n){return e(n,t)})},Br=function(t){var e,n,r,i,o,a,s;for(cn(!Or(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},Wr=new RegExp("^-?\\d{1,10}$"),Qr=function(t){if(Wr.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},Kr=function(t){try{t()}catch(e){setTimeout(function(){var n=e.stack||"";throw Pr("Exception was thrown by user callback.",n),e},Math.floor(0))}},Hr=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},Gr=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)0<i[r].length&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Mr(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),zr=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Kn(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Kn(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Kn(t),0<this.parts_.length&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Yr="firebaseio.com",Xr="websocket",Jr="long_polling",$r=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=_r.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&_r.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(cn("string"==typeof t,"typeof type must == string"),cn("object"==typeof e,"typeof params must == object"),t===Xr)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Jr)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Dn(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}(),Zr=function(t){var e=ti(t),n=e.subdomain;"firebase"===e.domain&&Rr(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Rr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Pr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new $r(e.host,e.secure,n,r),path:new Gr(e.pathString)}},ti=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):Pr("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},ei=/[\[\].#$\/\u0000-\u001F\u007F]/,ni=/[\[\].#$\u0000-\u001F\u007F]/,ri=10485760,ii=function(t){return"string"==typeof t&&0!==t.length&&!ei.test(t)},oi=function(t){return"string"==typeof t&&0!==t.length&&!ni.test(t)},ai=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!Or(t)||t&&"object"==typeof t&&An(t,".sv")},si=function(t,e,n,r,i){i&&void 0===n||ui(Bn(t,e,i),n,r)},ui=function(t,e,n){var r=n instanceof Gr?new zr(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(Or(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>ri/3&&Kn(e)>ri)throw new Error(t+"contains a string greater than "+ri+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(Dn(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!ii(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),ui(t,n,r),r.pop()}),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},ci=function(t,e,n,r,i){if(!i||void 0!==n){var o=Bn(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Dn(n,function(t,e){var n=new Gr(t);if(ui(o,e,r.child(n)),".priority"===n.getBack()&&!ai(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ii(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Gr.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},hi=function(t,e,n,r){if(!r||void 0!==n){if(Or(n))throw new Error(Bn(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ai(n))throw new Error(Bn(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},li=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Bn(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},fi=function(t,e,n,r){if(!(r&&void 0===n||ii(n)))throw new Error(Bn(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},pi=function(t,e,n,r){if(!(r&&void 0===n||oi(n)))throw new Error(Bn(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},di=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},yi=function(t,e,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ii(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&((r=i)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),!oi(r)))throw new Error(Bn(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},mi=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){jn("OnDisconnect.cancel",0,1,arguments.length),Wn("OnDisconnect.cancel",1,t,!0);var e=new vn;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){jn("OnDisconnect.remove",0,1,arguments.length),di("OnDisconnect.remove",this.path_),Wn("OnDisconnect.remove",1,t,!0);var e=new vn;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){jn("OnDisconnect.set",1,2,arguments.length),di("OnDisconnect.set",this.path_),si("OnDisconnect.set",1,t,this.path_,!1),Wn("OnDisconnect.set",2,e,!0);var n=new vn;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){jn("OnDisconnect.setWithPriority",2,3,arguments.length),di("OnDisconnect.setWithPriority",this.path_),si("OnDisconnect.setWithPriority",1,t,this.path_,!1),hi("OnDisconnect.setWithPriority",2,e,!1),Wn("OnDisconnect.setWithPriority",3,n,!0);var r=new vn;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(jn("OnDisconnect.update",1,2,arguments.length),di("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Pr("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ci("OnDisconnect.update",1,t,this.path_,!1),Wn("OnDisconnect.update",2,e,!0);var i=new vn;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),vi=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return jn("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),gi=(rr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ir=0,or=[],function(t){var e,n=t===ir;ir=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=rr.charAt(t%64),t=Math.floor(t/64);cn(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===or[e];e--)or[e]=0;or[e]++}else for(e=0;e<12;e++)or[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=rr.charAt(or[e]);return cn(20===i.length,"nextPushId: Length should be 20."),i}),_i=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),bi=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new _i(xr,t),r=new _i(xr,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return _i.MIN},t}(),wi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return ar},set:function(t){ar=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return Mr(t.name,e.name)},e.prototype.isDefinedOn=function(){throw hn("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(){return!1},e.prototype.minPost=function(){return _i.MIN},e.prototype.maxPost=function(){return new _i(Lr,ar)},e.prototype.makePost=function(t){return cn("string"==typeof t,"KeyIndex indexValue must always be a string."),new _i(t,ar)},e.prototype.toString=function(){return".key"},e}(bi),Ei=new wi,Ti=function(t){return"number"==typeof t?"number:"+Br(t):"string:"+t},Si=function(t){if(t.isLeafNode()){var e=t.val();cn("string"==typeof e||"number"==typeof e||"object"==typeof e&&An(e,".sv"),"Priority must be a string or number.")}else cn(t===sr||t.isEmpty(),"priority of unexpected type.");cn(t===sr||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ci=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,cn(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Si(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return ur},set:function(t){ur=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(cn(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ti(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?Br(this.value_):this.value_,this.lazyHash_=Tr(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(cn(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),o=t.VALUE_TYPE_ORDER.indexOf(r);return cn(0<=i,"Unknown leaf type: "+n),cn(0<=o,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),Ii=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Mr(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return _i.MIN},e.prototype.maxPost=function(){return new _i(Lr,new Ci("[PRIORITY-POST]",hr))},e.prototype.makePost=function(t,e){var n=cr(t);return new _i(e,new Ci("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(bi)),Ni=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return 0<this.nodeStack_.length},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Ai=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Di.EMPTY_NODE,this.right=null!=o?o:Di.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Di.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Di.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),ki=function(){function t(){}return t.prototype.copy=function(){return this},t.prototype.insert=function(t,e){return new Ai(t,e,null)},t.prototype.remove=function(){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(){return!1},t.prototype.reverseTraversal=function(){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Di=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Ai.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ai.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new Ni(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new Ni(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new Ni(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new Ni(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new ki,t}(),Ri=Math.log(2),Pi=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Ri,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Oi=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new Ai(a,o.node,Ai.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new Ai(a,o.node,Ai.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(o+1,s),h=t[o],l=n?n(h):h;u(new Ai(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,Ai.BLACK):(s(l,Ai.BLACK),s(l,Ai.RED))}return o}(new Pi(t.length));return new Di(r||e,o)},xi={},Li=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return cn(Ii,"ChildrenNode.ts has not been loaded"),lr=lr||new t({".priority":xi},{".priority":Ii})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=kn(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===xi?null:e},t.prototype.hasIndex=function(t){return An(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){cn(e!==Ei,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],o=!1,a=n.getIterator(_i.Wrap),s=a.getNext();s;)o=o||e.isDefinedOn(s.node),i.push(s),s=a.getNext();r=o?Oi(i,e.getCompare()):xi;var u=e.toString(),c=Rn(this.indexSet_);c[u]=e;var h=Rn(this.indexes_);return h[u]=r,new t(h,c)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(xn(this.indexes_,function(t,i){var o=kn(r.indexSet_,i);if(cn(o,"Missing index implementation for "+i),t===xi){if(o.isDefinedOn(e.node)){for(var a=[],s=n.getIterator(_i.Wrap),u=s.getNext();u;)u.name!=e.name&&a.push(u),u=s.getNext();return a.push(e),Oi(a,o.getCompare())}return xi}var c=n.get(e.name),h=t;return c&&(h=h.remove(new _i(e.name,c))),h.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(xn(this.indexes_,function(t){if(t===xi)return t;var r=n.get(e.name);return r?t.remove(new _i(e.name,r)):t}),this.indexSet_)},t}();function Mi(t,e){return Mr(t.name,e.name)}function Fi(t,e){return Mr(t,e)}var Ui=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Si(this.priorityNode_),this.children_.isEmpty()&&cn(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return fr||(fr=new t(new Di(Fi),null,Li.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||fr},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?fr:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(cn(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r,i=new _i(e,n),o=void 0;return r=n.isEmpty()?(o=this.children_.remove(e),this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(e,n),this.indexMap_.addToIndexes(i,this.children_)),new t(o,o.isEmpty()?fr:this.priorityNode_,r)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;cn(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ii,function(a,s){n[a]=s.val(e),r++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!e&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Ti(this.getPriority().val())+":"),this.forEachChild(Ii,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":Tr(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new _i(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new _i(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new _i(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,_i.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,_i.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===qi?-1:0},t.prototype.withIndex=function(e){if(e===Ei||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===Ei||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Ii),r=e.getIterator(Ii),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},t.prototype.resolveIndex_=function(t){return t===Ei?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),qi=new(function(t){function e(){return t.call(this,new Di(Fi),Ui.EMPTY_NODE,Li.Default)||this}return rn(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(){return Ui.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ui));Object.defineProperties(_i,{MIN:{value:new _i(xr,Ui.EMPTY_NODE)},MAX:{value:new _i(Lr,qi)}}),wi.__EMPTY_NODE=Ui.EMPTY_NODE,Ci.__childrenNodeConstructor=Ui,sr=qi,hr=qi;var Vi=!0;function ji(t,e){if(void 0===e&&(e=null),null===t)return Ui.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),cn(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Ci(t,ji(e));if(t instanceof Array||!Vi){var n=Ui.EMPTY_NODE,r=t;return Dn(r,function(t,e){if(An(r,t)&&"."!==t.substring(0,1)){var i=ji(e);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}}),n.updatePriority(ji(e))}var i=[],o=!1,a=t;if(Dn(a,function(t){if("string"!=typeof t||"."!==t.substring(0,1)){var e=ji(a[t]);e.isEmpty()||(o=o||!e.getPriority().isEmpty(),i.push(new _i(t,e)))}}),0==i.length)return Ui.EMPTY_NODE;var s=Oi(i,Mi,function(t){return t.name},Fi);if(o){var u=Oi(i,Ii.getCompare());return new Ui(s,ji(e),new Li({".priority":u},{".priority":Ii}))}return new Ui(s,ji(e),Li.Default)}cr=ji;var Bi,Wi,Qi,Ki=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Mr(t.name,e.name):n},e.prototype.isDefinedOn=function(){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return _i.MIN},e.prototype.maxPost=function(){return _i.MAX},e.prototype.makePost=function(t,e){var n=ji(t);return new _i(e,n)},e.prototype.toString=function(){return".value"},e}(bi)),Hi=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,cn(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return rn(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Mr(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=ji(t),r=Ui.EMPTY_NODE.updateChild(this.indexPath_,n);return new _i(e,r)},e.prototype.maxPost=function(){var t=Ui.EMPTY_NODE.updateChild(this.indexPath_,qi);return new _i(Lr,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(bi),Gi=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return jn("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return jn("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return jn("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return jn("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){jn("DataSnapshot.child",0,1,arguments.length),e=String(e),pi("DataSnapshot.child",1,e,!1);var n=new Gr(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,Ii)},t.prototype.hasChild=function(t){jn("DataSnapshot.hasChild",1,1,arguments.length),pi("DataSnapshot.hasChild",1,t,!1);var e=new Gr(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return jn("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return jn("DataSnapshot.forEach",1,1,arguments.length),Wn("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),Ii))})},t.prototype.hasChildren=function(){return jn("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return jn("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return jn("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),zi=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+In(this.snapshot.exportVal())},t}(),Yi=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Xi=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new zi("value",this,new Gi(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){cn(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Yi(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Ji=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,An(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Yi(this,t,e):null},t.prototype.createEvent=function(t,e){cn(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new zi(t.type,this,new Gi(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){cn(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=On(e.callbacks_);if(n===On(this.callbacks_)){if(1!==n)return function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0}(this.callbacks_,function(t,n){return e.callbacks_[t]===n});var r=Mn(e.callbacks_),i=Mn(this.callbacks_);return!(i!==r||e.callbacks_[r]&&this.callbacks_[i]&&e.callbacks_[r]!==this.callbacks_[i])}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),$i=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return cn(Bi,"Reference.ts has not been loaded"),Bi},set:function(t){Bi=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Ei){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=xr)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Lr)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Ii){if(null!=e&&!ai(e)||null!=n&&!ai(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(cn(t.getIndex()instanceof Hi||t.getIndex()===Ki,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return jn("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){jn("Query.on",2,4,arguments.length),li("Query.on",1,e,!1),Wn("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[e]=n,this.onChildEvent(a,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Xi(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Ji(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){jn("Query.off",0,3,arguments.length),li("Query.off",1,t,!0),Wn("Query.off",2,e,!0),Qn("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Xi(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Ji(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this;jn("Query.once",1,4,arguments.length),li("Query.once",1,e,!1),Wn("Query.once",2,n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,i),s=!0,u=new vn;u.promise.catch(function(){});var c=function(t){s&&(s=!1,o.off(e,c),n&&n.bind(a.context)(t),u.resolve(t))};return this.on(e,c,function(t){o.off(e,c),a.cancel&&a.cancel.bind(a.context)(t),u.reject(t)}),u.promise},t.prototype.limitToFirst=function(e){if(jn("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(jn("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(jn("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');pi("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new Gr(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Hi(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){jn("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(Ei);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){jn("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(Ii);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){jn("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Ki);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),jn("Query.startAt",0,2,arguments.length),si("Query.startAt",1,e,this.path,!0),fi("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(n=e=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),jn("Query.endAt",0,2,arguments.length),si("Query.endAt",1,e,this.path,!0),fi("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(jn("Query.equalTo",1,2,arguments.length),si("Query.equalTo",1,t,this.path,!1),fi("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return jn("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return jn("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=qr(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(jn("Query.isEqual",1,1,arguments.length),!(e instanceof t))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var n=this.repo===e.repo,r=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return n&&r&&i},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Wn(t,3,r.cancel,!0),r.context=n,Qn(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Bn(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),Zi=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return An(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return Pn(this.set)},t.prototype.count=function(){return On(this.set)},t.prototype.each=function(t){Dn(this.set,function(e,n){return t(e,n)})},t.prototype.keys=function(){var t=[];return Dn(this.set,function(e){t.push(e)}),t},t}(),to=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,n);else{null==this.children_&&(this.children_=new Zi);var r=e.getFront();this.children_.contains(r)||this.children_.add(r,new t);var i=this.children_.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,!(this.children_=null);if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(Ii,function(t,e){n.remember(new Gr(t),e)}),this.forget(t)}if(null===this.children_)return!0;var r=t.getFront();return t=t.popFront(),this.children_.contains(r)&&this.children_.get(r).forget(t)&&this.children_.remove(r),!!this.children_.isEmpty()&&!(this.children_=null)},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(n,r){var i=new Gr(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,n){t(e,n)})},t}(),eo=function(t,e){return t&&"object"==typeof t?(cn(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},no=function(t,e){var n,r=t.getPriority().val(),i=eo(r,e);if(t.isLeafNode()){var o=t,a=eo(o.getValue(),e);return a!==o.getValue()||i!==o.getPriority().val()?new Ci(a,ji(i)):t}var s=t;return i!==(n=s).getPriority().val()&&(n=n.updatePriority(new Ci(i))),s.forEachChild(Ii,function(t,r){var i=no(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};(Qi=Wi||(Wi={}))[Qi.OVERWRITE=0]="OVERWRITE",Qi[Qi.MERGE=1]="MERGE",Qi[Qi.ACK_USER_WRITE=2]="ACK_USER_WRITE",Qi[Qi.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var ro,io,oo=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,cn(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ao=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Wi.ACK_USER_WRITE,this.source=oo.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return cn(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Gr(e));return new t(Gr.Empty,n,this.revert)}return cn(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),so=function(){function t(t,e){void 0===e&&(ro||(ro=new Di(Fr)),e=ro),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return Dn(e,function(t,e){n=n.set(new Gr(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Gr.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Gr(n).child(i.path),value:i.value}},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r,i=e.getFront(),o=(this.children.get(i)||t.Empty).setTree(e.popFront(),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(Gr.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Gr.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Gr.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(Gr.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),uo=function(){function t(t,e){this.source=t,this.path=e,this.type=Wi.LISTEN_COMPLETE}return t.prototype.operationForChild=function(){return this.path.isEmpty()?new t(this.source,Gr.Empty):new t(this.source,this.path.popFront())},t}(),co=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Wi.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,Gr.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),ho=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Wi.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new Gr(e));return n.isEmpty()?null:n.value?new co(this.source,Gr.Empty,n.value):new t(this.source,Gr.Empty,n)}return cn(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),lo=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),fo=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new lo(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new lo(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new lo(Ui.EMPTY_NODE,!1,!1),new lo(Ui.EMPTY_NODE,!1,!1)),t}(),po=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),yo=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){cn(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(po.childRemovedChange(e,a)):cn(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(po.childAddedChange(e,n)):o.trackChildChange(po.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Ii,function(t,r){e.hasChild(t)||n.trackChildChange(po.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(Ii,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(po.childChangedChange(e,r,i))}else n.trackChildChange(po.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ui.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),mo=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;cn(e==po.CHILD_ADDED||e==po.CHILD_CHANGED||e==po.CHILD_REMOVED,"Only child changes supported for tracking"),cn(".priority"!==n,"Only non-priority child changes can be tracked.");var r=kn(this.changeMap_,n);if(r){var i=r.type;if(e==po.CHILD_ADDED&&i==po.CHILD_REMOVED)this.changeMap_[n]=po.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==po.CHILD_REMOVED&&i==po.CHILD_ADDED)delete this.changeMap_[n];else if(e==po.CHILD_REMOVED&&i==po.CHILD_CHANGED)this.changeMap_[n]=po.childRemovedChange(n,r.oldSnap);else if(e==po.CHILD_CHANGED&&i==po.CHILD_ADDED)this.changeMap_[n]=po.childAddedChange(n,t.snapshotNode);else{if(e!=po.CHILD_CHANGED||i!=po.CHILD_CHANGED)throw hn("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=po.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e}(this.changeMap_)},t}(),vo=new(function(){function t(){}return t.prototype.getCompleteChild=function(){return null},t.prototype.getChildAfterChild=function(){return null},t}()),go=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new lo(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),_o=function(t,e){this.viewCache=t,this.changes=e},bo=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){cn(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),cn(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,i){var o,a,s=new mo;if(n.type===Wi.OVERWRITE){var u=n;o=u.source.fromUser?this.applyUserOverwrite_(e,u.path,u.snap,r,i,s):(cn(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.getServerCache().isFiltered()&&!u.path.isEmpty(),this.applyServerOverwrite_(e,u.path,u.snap,r,i,a,s))}else if(n.type===Wi.MERGE){var c=n;o=c.source.fromUser?this.applyUserMerge_(e,c.path,c.children,r,i,s):(cn(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.getServerCache().isFiltered(),this.applyServerMerge_(e,c.path,c.children,r,i,a,s))}else if(n.type===Wi.ACK_USER_WRITE){var h=n;o=h.revert?this.revertUserWrite_(e,h.path,r,i,s):this.ackUserWrite_(e,h.path,h.affectedTree,r,i,s)}else{if(n.type!==Wi.LISTEN_COMPLETE)throw hn("Unknown operation type: "+n.type);o=this.listenComplete_(e,n.path,r,s)}var l=s.getChanges();return t.maybeAddValueEvent_(e,o,l),new _o(o,l)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(po.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(cn(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Ui?u:Ui.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){cn(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var v=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=v?o.getNode().getImmediateChild(f).updateChild(y,v):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,vo,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new go(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new go(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ui.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,a){var s=this,u=e;return r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),u},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:so.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new Gr(e),l,r,i,o,a)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new Gr(e),f,r,i,o,a)}}),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=so.Empty;return s.getNode().forEachChild(Ei,function(t,e){u=u.set(new Gr(t),e)}),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=so.Empty;return n.foreach(function(t){var n=e.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,e,c,r,i,a,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,vo,r)},t.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new go(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();cn(h instanceof Ui,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,Ui.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Gr.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},t}(),wo=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===po.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(po.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,po.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,po.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,po.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,po.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,po.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw hn("Should only compare child_ events.");var n=new _i(t.childName,t.snapshotNode),r=new _i(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),Eo=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new yo(n.getIndex()),i=n.getNodeFilter();this.processor_=new bo(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Ui.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ui.EMPTY_NODE,a.getNode(),null),c=new lo(s,o.isFullyInitialized(),r.filtersNodes()),h=new lo(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new fo(h,c),this.eventGenerator_=new wo(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){cn(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(a)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Wi.MERGE&&null!==t.source.queryId&&(cn(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),cn(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),cn(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Ii,function(t,e){n.push(po.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(po.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),To=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return cn(io,"Reference.ts has not been loaded"),io},set:function(t){cn(!io,"__referenceConstructor has already been defined"),io=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return Pn(this.views_)},t.prototype.applyOperation=function(t,e,n){var r=t.source.queryId;if(null!==r){var i=kn(this.views_,r);return cn(null!=i,"SyncTree gave us an op for an invalid query."),i.applyOperation(t,e,n)}var o=[];return Dn(this.views_,function(r,i){o=o.concat(i.applyOperation(t,e,n))}),o},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=kn(this.views_,o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof Ui?n.calcCompleteEventChildren(r):Ui.EMPTY_NODE,!1);var c=new fo(new lo(u,s,!1),new lo(r,i,!1));a=new Eo(t,c),this.views_[o]=a}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i=e.queryIdentifier(),o=[],a=[],s=this.hasCompleteView();if("default"===i){var u=this;Dn(this.views_,function(t,e){a=a.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete u.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var c=kn(this.views_,i);c&&(a=a.concat(c.removeEventRegistration(n,r)),c.isEmpty()&&(delete this.views_[i],c.getQuery().getQueryParams().loadsAllData()||o.push(c.getQuery())))}return s&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:a}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return Dn(this.views_,function(n,r){e=e||r.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return kn(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;return t=this.views_,(e=Ln(t,function(t){return t.getQuery().getQueryParams().loadsAllData()},void 0))&&t[e]||null},t}(),So=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new so(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,a=Gr.relativePath(i,e);return o=o.updateChild(a,n),new t(this.writeTree_.set(i,o))}var s=new so(n);return new t(this.writeTree_.setTree(e,s))},t.prototype.addWrites=function(t,e){var n=this;return Dn(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,so.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Gr.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(Ii,function(e,n){t.push(new _i(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new _i(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new so(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(Gr.Empty,this.writeTree_,e)},t.Empty=new t(new so(null)),t.applySubtreeWrite_=function(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var i=null;return n.children.inorderTraversal(function(n,o){".priority"===n?(cn(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=t.applySubtreeWrite_(e.child(n),o,r)}),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(e.child(".priority"),i)),r},t}(),Co=function(){function t(){this.visibleWrites_=So.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new Io(t,this)},t.prototype.addOverwrite=function(t,e,n,r){cn(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){cn(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});cn(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(n<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var u=r.children;Dn(u,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(Gr.Empty)){var a=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return c=n||Ui.EMPTY_NODE,a.apply(c)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(Gr.Empty)){var c=n||Ui.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=Ui.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(Ii,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Ii,function(t,e){var r=i.childCompoundWrite(new Gr(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){cn(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Gr.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!Ln(t.children,function(n,r){return t.path.child(r).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,Gr.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=So.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Gr.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Gr.relativePath(a,n),r=r.addWrite(Gr.Empty,o.snap.getChild(s)));else{if(!o.children)throw hn("WriteRecord should have .snap or .children");if(n.contains(a))s=Gr.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Gr.relativePath(a,n)).isEmpty())r=r.addWrites(Gr.Empty,o.children);else{var u=kn(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Gr.Empty,c)}}}}}return r},t}(),Io=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),No=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=so.Empty,this.pendingWriteTree_=new Co,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new co(oo.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=so.fromObject(e);return this.applyOperationToSyncPoints_(new ho(oo.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=so.Empty;return null!=n.snap?r=r.set(Gr.Empty,!0):Dn(n.children,function(t,e){r=r.set(new Gr(t),e)}),this.applyOperationToSyncPoints_(new ao(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new co(oo.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=so.fromObject(e);return this.applyOperationToSyncPoints_(new ho(oo.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new uo(oo.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null==i)return[];var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=Gr.relativePath(a,e),c=new co(oo.forServerTaggedQuery(s),u,n);return this.applyTaggedOperation_(a,c)},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=Gr.relativePath(a,e),c=so.fromObject(n),h=new ho(oo.forServerTaggedQuery(s),u,c);return this.applyTaggedOperation_(a,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,a=i.queryId,s=Gr.relativePath(o,e),u=new uo(oo.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Gr.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var a,s=this.syncPointTree_.get(r);s?(o=o||s.hasCompleteView(),i=i||s.getCompleteServerCache(Gr.Empty)):(s=new To,this.syncPointTree_=this.syncPointTree_.set(r,s)),null!=i?a=!0:(a=!1,i=Ui.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Gr.Empty);n&&(i=i.updateImmediateChild(t,n))}));var u=s.viewExistsForQuery(e);if(!u&&!e.getQueryParams().loadsAllData()){var c=t.makeQueryKey_(e);cn(!(c in this.queryToTagMap_),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap_[c]=h,this.tagToQueryMap_["_"+h]=c}var l=this.pendingWriteTree_.childWrites(r),f=s.addEventRegistration(e,n,l,i,a);if(!u&&!o){var p=s.viewForQuery(e);f=f.concat(this.setupListener_(e,p))}return f},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var u=a.removeEventRegistration(e,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;s=u.events;var h=-1!==c.findIndex(function(t){return t.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var y=p[d],m=y.getQuery(),v=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(m),this.tagForQuery_(m),v.hashFn,v.onComplete)}}!l&&0<c.length&&!r&&(h?this.listenProvider_.stopListening(t.queryForListening_(e),null):c.forEach(function(e){var n=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),n)})),this.removeTags_(c)}return s},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=Gr.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Dn(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+o]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,i=this.tagForQuery_(e),o=this.createListenerForView_(n),a=this.listenProvider_.startListening(t.queryForListening_(e),i,o.hashFn,o.onComplete),s=this.syncPointTree_.subtree(r);if(i)cn(!s.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=s.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Dn(n,function(t,e){r=r.concat(e)}),r}),c=0;c<u.length;++c){var h=u[c];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return a},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||Ui.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return cn(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Gr(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return kn(this.queryToTagMap_,n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);cn(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Gr.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Gr.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Gr.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(Gr.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(Gr.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))}),o&&(a=a.concat(o.applyOperation(t,r,n))),a},t.nextQueryTag_=1,t}(),Ao=function(){function t(){this.rootNode_=Ui.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),ko=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Ar("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Pr(t)},t}(),Do=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),An(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return dn(this.counters_)},t}(),Ro=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Do),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),Po=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Rn(t);return this.last_&&Dn(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),Oo=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Po(t);var n=1e4+2e4*Math.random();Hr(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;Dn(e,function(e,i){0<i&&An(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),Hr(this.reportStats_.bind(this),Math.floor(6e5*Math.random()))},t}(),xo=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Lo(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),Lo=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Cr&&Ar("event: "+e.toString()),Kr(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Mo=function(){function t(t){this.allowedEvents_=t,this.listeners_={},cn(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){cn(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),Fo=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return rn(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return cn("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(Mo),Uo=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||gn()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return rn(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return cn("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(Mo),qo=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&Kr(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),Vo=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=kr(t),this.stats_=Ro.getCollection(e),this.urlFn=function(t){return e.connectionURL(Jr,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new qo(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(bn()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new jo(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1],o=t[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),!bn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Yr)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!bn()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=In(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=ln(e),fn.encodeByteArray(n,!0)),i=Vr(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!bn()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=In(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),jo=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Zi,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,bn())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Er(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(t){Ar("frame writing exception"),t.stack&&Ar(t.stack),Ar(t)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ar("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var t=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0))),bn()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);e.nodeRestRequest(r)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},e.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},e.prototype.addTag=function(t,e){var n=this;bn()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){Ar("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},e}(),Bo=null;"undefined"!=typeof MozWebSocket?Bo=MozWebSocket:"undefined"!=typeof WebSocket&&(Bo=WebSocket);var Wo=function(){function t(e,n,r,i){this.connId=e,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=kr(this.connId),this.stats_=Ro.getCollection(n),this.connURL=t.connectionURL_(n,r,i)}return t.connectionURL_=function(t,e,n){var r={v:"5"};return!bn()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Yr)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Xr,r)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_r.set("previous_websocket_failure",!0);try{if(bn()){var r={headers:{"User-Agent":"Firebase/5/"+er.SDK_VERSION+"/"+process.platform+"/Node"}},i=process.env,o=0==this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;o&&(r.proxy={origin:o}),this.mySock=new Bo(this.connURL,[],r)}else this.mySock=new Bo(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&1<n.length&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Bo&&!t.forceDisallow_},t.previouslyFailed=function(){return _r.isInMemoryStorage||!0===_r.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){_r.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Cn(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(cn(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=In(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Vr(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Qo=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[Vo,Wo]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n=Wo&&Wo.isAvailable(),r=n&&!Wo.previouslyFailed();if(e.webSocketOnly&&(n||Pr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Wo];else{var i=this.transports_=[];jr(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},t}(),Ko=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=kr("c:"+this.id+":"),this.transportManager_=new Qo(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Hr(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=Ur("t",t),n=Ur("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=Ur("t",t),n=Ur("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=Ur("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Dr("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Dr("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Pr("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Hr(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Hr(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_r.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Ho=function(){function t(){}return t.prototype.put=function(){},t.prototype.merge=function(){},t.prototype.refreshAuthToken=function(){},t.prototype.onDisconnectPut=function(){},t.prototype.onDisconnectMerge=function(){},t.prototype.onDisconnectCancel=function(){},t.prototype.reportStats=function(){},t}(),Go=function(t){function e(n,r,i,o,a,s){var u=t.call(this)||this;if(u.repoInfo_=n,u.onDataUpdate_=r,u.onConnectStatus_=i,u.onServerInfoUpdate_=o,u.authTokenProvider_=a,u.authOverride_=s,u.id=e.nextPersistentConnectionId_++,u.log_=kr("p:"+u.id+":"),u.interruptReasons_={},u.listens_={},u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=1e3,u.maxReconnectDelay_=3e5,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,s&&!bn())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),Fo.getInstance().on("visible",u.onVisible_,u),-1===n.host.indexOf("fblocal")&&Uo.getInstance().on("online",u.onOnline_,u),u}return rn(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(In(i)),cn(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},cn(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),cn(!this.listens_[o][i],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[o][i]=a,this.connected_&&this.sendListen_(a)},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};t.tag&&(a.q=r.queryObject(),a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,u=a.s;e.warnOnListenWarnings_(s,r),(n.listens_[i]&&n.listens_[i][o])===t&&(n.log_("listen response",a),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,s))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&An(t,"w")){var n=kn(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Pr("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=Nn(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t,e=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(t=Nn(n).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,function(t){var r=t.s,i=t.d||"error";e.authToken_===n&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),cn(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+In(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Dr("Unrecognized action received from server: "+In(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;cn(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){cn(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then(function(e){s?Ar("getToken() completed but was canceled"):(Ar("getToken() completed. Creating connection."),o.authToken_=e&&e.accessToken,u=new Ko(i,o.repoInfo_,t,n,r,function(t){Pr(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},e.prototype.interrupt=function(t){Ar("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){Ar("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Pn(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return qr(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new Gr(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===On(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},e.prototype.onAuthRevoked_=function(t,e){Ar("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t=this;this.tryAuth(),Dn(this.listens_,function(e,n){Dn(n,function(e,n){t.sendListen_(n)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},e.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+er.SDK_VERSION.replace(/\./g,"-")]=1,gn()?t["framework.cordova"]=1:_n()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=Uo.getInstance().currentlyOnline();return Pn(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Ho),zo=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=kr("p:rest:"),i.listens_={},i}return rn(e,t),e.prototype.reportStats=function(){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(cn(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=e.getListenId_(t,r),u={};this.listens_[s]=u;var c=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",c,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),kn(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a,s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+(a=[],Dn(e,function(t,e){Array.isArray(e)?e.forEach(function(e){a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),a.length?"&"+a.join("&"):"");r.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var t=null;if(200<=u.status&&u.status<300){try{t=Cn(u.responseText)}catch(t){Pr("Failed to parse JSON response for "+s+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&Pr("Got unsuccessful REST response for "+s+" Status: "+u.status),n(u.status);n=null}},u.open("GET",s,!0),u.send()})},e}(Ho),Yo="repo_interrupt",Xo=function(){function t(t,e,n){var r=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new to,this.persistentConnection_=null;var i=new ko(n);if(this.stats_=Ro.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new zo(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{In(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Go(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){r.server_.refreshAuthToken(t)}),this.statsReporter_=Ro.getOrCreateReporter(t,function(){return new Oo(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new Ao,this.infoSyncTree_=new No({startListening:function(t,e,n,i){var o=[],a=r.infoData_.getNode(t.path);return a.isEmpty()||(o=r.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new No({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,function(e,n){var o=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new Gr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Gr(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=xn(e,function(t){return ji(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=ji(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=xn(e,function(t){return ji(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=ji(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;jr(t,function(t,n){e.updateInfo_(n,t)})},t.prototype.updateInfo_=function(t,e){var n=new Gr("/.info/"+t),r=ji(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=ji(e,n),s=no(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),function(e,n){var o="ok"===e;o||Pr("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(Dn(e,function(t,e){i=!1;var n=ji(e);a[t]=no(n,o)}),i)Ar("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||Pr("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)}),Dn(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e,n,r,i=this.generateServerValues(),o=(e=this.onDisconnect_,n=i,r=new to,e.forEachTree(new Gr(""),function(t,e){r.remember(t,no(e,n))}),r),a=[];o.forEachTree(Gr.Empty,function(e,n){a=a.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var r=t.abortTransactions_(e);t.rerunTransactions_(r)}),this.onDisconnect_=new to,this.eventQueue_.raiseEventsForChangedPath(Gr.Empty,a)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=ji(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=ji(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(Pn(e))return Ar("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&Dn(e,function(e,n){var i=ji(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Yo)},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Yo)},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new Po(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Dn(e,function(t,e){for(var r=t.length;r<n+2;r++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Ar.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&Kr(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new ua(this))},enumerable:!0,configurable:!0}),t}(),Jo=function(){function t(e){this.indexedFilter_=new yo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new _i(e,n))||(n=Ui.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ui.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ui.EMPTY_NODE);var i=this;return e.forEachChild(Ii,function(t,e){i.matches(new _i(t,e))||(r=r.updateImmediateChild(t,Ui.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),$o=function(){function t(t){this.rangedFilter_=new Jo(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new _i(e,n))||(n=Ui.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ui.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ui.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ui.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Ui.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;cn(s.numChildren()==this.limit_,"");var u=new _i(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(po.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(po.childRemovedChange(e,l));var d=s.updateImmediateChild(e,Ui.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(po.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(po.childRemovedChange(c.name,c.node)),i.trackChildChange(po.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,Ui.EMPTY_NODE)):t},t}(),Zo=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ii}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return cn(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return cn(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:xr},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return cn(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return cn(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Lr},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return cn(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,n.indexStartName_=null!=e?(n.startNameSet_=!0,e):(n.startNameSet_=!1,""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,n.indexEndName_=void 0!==e?(n.endNameSet_=!0,e):(n.endNameSet_=!1,""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==Ii&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ii},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new yo(this.getIndex()):this.hasLimit()?new $o(this):new Jo(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(e=this.index_===Ii?n.PRIORITY_INDEX:this.index_===Ki?n.VALUE_INDEX:this.index_===Ei?n.KEY_INDEX:(cn(this.index_ instanceof Hi,"Unrecognized index type!"),this.index_.toString()),r[n.ORDER_BY]=In(e),this.startSet_&&(r[n.START_AT]=In(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+In(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=In(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+In(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),ta=function(t){function e(e,n){if(!(e instanceof Xo))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,Zo.DEFAULT,!1)||this}return rn(e,t),e.prototype.getKey=function(){return jn("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){var n,r,i,o;return jn("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Gr||(null===this.path.getFront()?(n="Reference.child",o=!(r=1),(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),pi(n,r,i,o)):pi("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){jn("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){jn("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){jn("Reference.set",1,2,arguments.length),di("Reference.set",this.path),si("Reference.set",1,t,this.path,!1),Wn("Reference.set",2,e,!0);var n=new vn;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(jn("Reference.update",1,2,arguments.length),di("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Pr("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ci("Reference.update",1,t,this.path,!1),Wn("Reference.update",2,e,!0);var i=new vn;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(jn("Reference.setWithPriority",2,3,arguments.length),di("Reference.setWithPriority",this.path),si("Reference.setWithPriority",1,t,this.path,!1),hi("Reference.setWithPriority",2,e,!1),Wn("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new vn;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return jn("Reference.remove",0,1,arguments.length),di("Reference.remove",this.path),Wn("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(jn("Reference.transaction",1,3,arguments.length),di("Reference.transaction",this.path),Wn("Reference.transaction",1,t,!1),Wn("Reference.transaction",2,e,!0),function(t,e,n){if(void 0!==n&&"boolean"!=typeof n)throw new Error(Bn("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new vn;return"function"==typeof e&&r.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new vi(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){jn("Reference.setPriority",1,2,arguments.length),di("Reference.setPriority",this.path),hi("Reference.setPriority",1,t,!1),Wn("Reference.setPriority",2,e,!0);var n=new vn;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){jn("Reference.push",0,2,arguments.length),di("Reference.push",this.path),si("Reference.push",1,t,this.path,!0),Wn("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=gi(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},e.prototype.onDisconnect=function(){return di("Reference.onDisconnect",this.path),new mi(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}($i);$i.__referenceConstructor=ta,To.__referenceConstructor=ta;var ea,na,ra=function(){this.children={},this.childCount=0,this.value=null},ia=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new ra),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n,r=e instanceof Gr?e:new Gr(e),i=this;null!==(n=r.getFront());)i=new t(n,i,kn(i.node_.children,n)||new ra),r=r.popFront();return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){cn(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return 0<this.node_.childCount},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;Dn(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new Gr(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=An(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();(na=ea||(ea={}))[na.RUN=0]="RUN",na[na.SENT=1]="SENT",na[na.COMPLETED=2]="COMPLETED",na[na.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",na[na.NEEDS_ABORT=4]="NEEDS_ABORT",Xo.MAX_TRANSACTION_RETRIES_=25,Xo.prototype.transactions_init_=function(){this.transactionQueueTree_=new ia},Xo.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new ta(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:Er(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Gi(a.currentInputSnapshot,new ta(this,a.path),Ii);a.onComplete(null,!1,c)}}else{ui("transaction failed: Data returned ",u,a.path),a.status=ea.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;"object"==typeof u&&null!==u&&An(u,".priority")?(f=kn(u,".priority"),cn(ai(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(this.serverSyncTree_.calcCompleteEventCache(t)||Ui.EMPTY_NODE).getPriority().val(),f=f;var p=this.generateServerValues(),d=ji(u,f),y=no(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},Xo.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ui.EMPTY_NODE},Xo.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);cn(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===ea.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Xo.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),i=this.getLatestState_(t,r),o=i,a=i.hash(),s=0;s<e.length;s++){var u=e[s];cn(u.status===ea.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=ea.SENT,u.retryCount++;var c=Gr.relativePath(t,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),l=t;this.server_.put(l.toString(),h,function(r){n.log_("transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=ea.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new ta(n,e[a].path),c=new Gi(s,u,Ii);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)Kr(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===ea.SENT_NEEDS_ABORT?e[a].status=ea.NEEDS_ABORT:e[a].status=ea.RUN;else for(Pr("transaction at "+l.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=ea.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}},a)},Xo.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Xo.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===ea.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Gr.relativePath(e,s.path),c=!1,h=void 0;if(cn(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===ea.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===ea.RUN)if(s.retryCount>=Xo.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){ui("transaction failed: Data returned ",f,s.path);var p=ji(f);"object"==typeof f&&null!=f&&An(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=no(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=ea.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var v=new ta(this,t[a].path),g=t[a].currentInputSnapshot,_=new Gi(g,v,Ii);r.push(t[a].onComplete.bind(null,null,!1,_))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<r.length;a++)Kr(r[a]);this.sendReadyTransactions_()}},Xo.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Xo.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Xo.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Xo.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==ea.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Xo.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Xo.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)e[o].status===ea.SENT_NEEDS_ABORT||(e[o].status===ea.SENT?(cn(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=ea.SENT_NEEDS_ABORT,e[o].abortReason="set"):(cn(e[o].status===ea.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete&&n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));for(-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),o=0;o<n.length;o++)Kr(n[o])}};var oa,aa="databaseURL",sa=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return oa||(oa=new t),oa},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options[aa];void 0===n&&Rr("Can't determine Firebase Database URL.  Be sure to include "+aa+" option when calling firebase.initializeApp().");var r=Zr(n),i=r.repoInfo;return yi("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Rr("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=kn(this.repos_,t.app.name);e&&kn(e,t.repoInfo_.toURLString())===t||Rr("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=kn(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=kn(n,t.toURLString());return r&&Rr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Xo(t,this.useRestClient_,e),n[t.toURLString()]=r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),ua=function(){function t(t){(this.repo_=t)instanceof Xo||Rr("Don't call new Database() directly - please use firebase.database()."),this.root_=new ta(t,Gr.Empty),this.INTERNAL=new ca(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),jn("database.ref",0,1,arguments.length),t instanceof ta?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),jn(e,1,1,arguments.length);var n=Zr(t);yi(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Rr(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&Rr("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){jn("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){jn("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),ca=function(){function t(t){this.database=t}return t.prototype.delete=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return this.database.checkDeleted_("delete"),sa.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),ha=Object.freeze({forceLongPolling:function(){Wo.forceDisallow(),Vo.forceAllow()},forceWebSockets:function(){Vo.forceDisallow()},isWebSocketsAvailable:function(){return Wo.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),la=Go;Go.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Go.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var fa,pa=Ko,da=$r,ya=Object.freeze({DataConnection:la,RealTimeConnection:pa,hijackHash:function(t){var e=Go.prototype.put;return Go.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Go.prototype.put=e}},ConnectionTarget:da,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){sa.getInstance().forceRestClient(t)}}),ma=ua.ServerValue;fa=er.INTERNAL.registerService("database",function(t,e,n){return sa.getInstance().databaseFromApp(t,n)},{Reference:ta,Query:$i,Database:ua,DataSnapshot:Gi,enableLogging:Nr,INTERNAL:ha,ServerValue:ma,TEST_ACCESS:ya},null,!0),bn()&&(module.exports=fa);var va,ga="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_a=_a||{},ba=ga;function wa(t){return"string"==typeof t}function Ea(t,e){t=t.split("."),e=e||ba;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Ta(){}function Sa(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Ca(t){return"array"==Sa(t)}function Ia(t){var e=Sa(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Na(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Aa="closure_uid_"+(1e9*Math.random()>>>0),ka=0;function Da(t){return t.call.apply(t.bind,arguments)}function Ra(t,e){if(!t)throw Error();if(2<arguments.length){var n=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,n),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function Pa(){return(Pa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Da:Ra).apply(null,arguments)}function Oa(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}}var xa=Date.now||function(){return+new Date};function La(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,(t.prototype.constructor=t).re=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Ma(){this.i=this.i,this.j=this.j}Ma.prototype.i=!1,Ma.prototype.La=function(){!this.i&&(this.i=!0,this.G(),0)&&(this[Aa]||(this[Aa]=++ka))},Ma.prototype.G=function(){if(this.j)for(;this.j.length;)this.j.shift()()};var Fa=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(wa(t))return wa(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Ua=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=wa(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function qa(){return Array.prototype.concat.apply([],arguments)}function Va(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function ja(t){return/^[\s\xa0]*$/.test(t)}var Ba,Wa=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Qa(t,e){return-1!=t.indexOf(e)}function Ka(t,e){return t<e?-1:e<t?1:0}t:{var Ha=ba.navigator;if(Ha){var Ga=Ha.userAgent;if(Ga){Ba=Ga;break t}}Ba=""}function za(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ya(t){var e,n={};for(e in t)n[e]=t[e];return n}var Xa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ja(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<Xa.length;i++)e=Xa[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function $a(t){return $a[" "](t),t}$a[" "]=Ta;var Za,ts,es=Qa(Ba,"Opera"),ns=Qa(Ba,"Trident")||Qa(Ba,"MSIE"),rs=Qa(Ba,"Edge"),is=rs||ns,os=Qa(Ba,"Gecko")&&!(Qa(Ba.toLowerCase(),"webkit")&&!Qa(Ba,"Edge"))&&!(Qa(Ba,"Trident")||Qa(Ba,"MSIE"))&&!Qa(Ba,"Edge"),as=Qa(Ba.toLowerCase(),"webkit")&&!Qa(Ba,"Edge");function ss(){var t=ba.document;return t?t.documentMode:void 0}t:{var us="",cs=(ts=Ba,os?/rv:([^\);]+)(\)|;)/.exec(ts):rs?/Edge\/([\d\.]+)/.exec(ts):ns?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ts):as?/WebKit\/(\S+)/.exec(ts):es?/(?:Version)[ \/]?(\S+)/.exec(ts):void 0);if(cs&&(us=cs?cs[1]:""),ns){var hs=ss();if(null!=hs&&hs>parseFloat(us)){Za=String(hs);break t}}Za=us}var ls,fs={};function ps(t){return e=t,n=function(){for(var e=0,n=Wa(String(Za)).split("."),r=Wa(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Ka(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Ka(0==a[2].length,0==s[2].length)||Ka(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e},r=fs,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n();var e,n,r}var ds=ba.document;ls=ds&&ns?ss()||("CSS1Compat"==ds.compatMode?parseInt(Za,10):5):void 0;var ys=!ns||9<=Number(ls),ms=ns&&!ps("9"),vs=function(){if(!ba.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ba.addEventListener("test",Ta,e),ba.removeEventListener("test",Ta,e)}catch(t){}return t}();function gs(t,e){this.type=t,this.a=this.target=e,this.b=!1,this.hc=!0}function _s(t,e){gs.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.f=null,t&&this.g(t,e)}gs.prototype.c=function(){this.hc=!1},La(_s,gs);var bs={2:"touch",3:"pen",4:"mouse"};_s.prototype.g=function(t,e){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(os){t:{try{$a(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=wa(t.pointerType)?t.pointerType:bs[t.pointerType]||"",(this.f=t).defaultPrevented&&this.c()},_s.prototype.c=function(){_s.S.c.call(this);var t=this.f;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ms)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var ws="closure_listenable_"+(1e6*Math.random()|0),Es=0;function Ts(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ya=i,this.key=++Es,this.ja=this.oa=!1}function Ss(t){this.src=t,this.a={},this.b=0}function Cs(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ja&&o.listener==e&&o.capture==!!n&&o.ya==r)return i}return-1}Ts.prototype.a=function(){this.ja=!0,this.ya=this.src=this.proxy=this.listener=null},(va=Ss.prototype).add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Cs(t,e,r,i);return-1<a?(e=t[a],n||(e.oa=!1)):((e=new Ts(e,this.src,o,!!r,i)).oa=n,t.push(e)),e},va.Sc=function(t,e,n,r){if((t=t.toString())in this.a){var i=this.a[t];-1<(e=Cs(i,e,n,r))&&(i[e].a(),Array.prototype.splice.call(i,e,1),0==i.length&&(delete this.a[t],this.b--))}},va.fc=function(t){var e=t.type;if(e in this.a){var n,r=this.a[e],i=Fa(r,t);(n=0<=i)&&Array.prototype.splice.call(r,i,1),n&&(t.a(),0==this.a[e].length&&(delete this.a[e],this.b--))}},va.Tc=function(){var t;for(t in this.a){for(var e=this.a[t],n=0;n<e.length;n++)e[n].a();delete this.a[t],this.b--}},va.Rc=function(t,e,n,r){var i=-1;return(t=this.a[t.toString()])&&(i=Cs(t,e,n,r)),-1<i?t[i]:null};var Is="closure_lm_"+(1e6*Math.random()|0),Ns={};function As(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Ca(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Ms(r),e&&e[ws]?e.Mb(n,r,Na(i)?!!i.capture:!!i,o):ks(e,n,r,!0,i,o)}(t,e,n,r,i);if(Ca(e)){for(var o=0;o<e.length;o++)As(t,e[o],n,r,i);return null}return n=Ms(n),t&&t[ws]?t.Lb(e,n,Na(r)?!!r.capture:!!r,i):ks(t,e,n,!1,r,i)}function ks(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Na(i)?!!i.capture:!!i;if(a&&!ys)return null;var s,u,c=xs(t);if(c||(t[Is]=c=new Ss(t)),(n=c.add(e,n,r,a,o)).proxy)return n;if(s=Os,r=u=ys?function(t){return s.call(u.src,u.listener,t)}:function(t){if(!(t=s.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)vs||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rs(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ds(t){if("number"!=typeof t&&t&&!t.ja){var e=t.src;if(e&&e[ws])e.nc(t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rs(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=xs(e))?(n.fc(t),0==n.b&&(n.src=null,e[Is]=null)):t.a()}}}function Rs(t){return t in Ns?Ns[t]:Ns[t]="on"+t}function Ps(t,e){var n=t.listener,r=t.ya||t.src;return t.oa&&Ds(t),n.call(r,e)}function Os(t,e){return!!t.ja||Ps(t,ys?new _s(e,this):e=new _s(e||Ea("window.event"),this))}function xs(t){return(t=t[Is])instanceof Ss?t:null}var Ls="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ms(t){return"function"==Sa(t)?t:(t[Ls]||(t[Ls]=function(e){return t.handleEvent(e)}),t[Ls])}function Fs(){Ma.call(this),this.c=new Ss(this),(this.K=this).F=null}La(Fs,Ma),Fs.prototype[ws]=!0,(va=Fs.prototype).addEventListener=function(t,e,n,r){As(this,t,e,n,r)},va.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Ca(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Na(i)?!!i.capture:!!i,r=Ms(r),e&&e[ws]?e.Qc(n,r,i,o):e&&(e=xs(e))&&(n=e.Rc(n,r,i,o))&&Ds(n)}(this,t,e,n,r)},va.dispatchEvent=function(t){var e,n=this.F;if(n)for(e=[];n;n=n.F)e.push(n);n=this.K;var r=t.type||t;if(wa(t))t=new gs(t,n);else if(t instanceof gs)t.target=t.target||n;else{var i=t;Ja(t=new gs(r,n),i)}if(i=!0,e)for(var o=e.length-1;!t.b&&0<=o;o--){var a=t.a=e[o];i=a.ua(r,!0,t)&&i}if(t.b||(i=(a=t.a=n).ua(r,!0,t)&&i,t.b||(i=a.ua(r,!1,t)&&i)),e)for(o=0;!t.b&&o<e.length;o++)i=(a=t.a=e[o]).ua(r,!1,t)&&i;return i},va.G=function(){Fs.S.G.call(this),this.Id(),this.F=null},va.Lb=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},va.Mb=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)},va.Qc=function(t,e,n,r){this.c.Sc(String(t),e,n,r)},va.nc=function(t){this.c.fc(t)},va.Id=function(){this.c&&this.c.Tc()},va.ua=function(t,e,n){if(!(t=this.c.a[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.ja&&o.capture==e){var a=o.listener,s=o.ya||o.src;o.oa&&this.nc(o),r=!1!==a.call(s,n)&&r}}return r&&0!=n.hc};var Us=ba.JSON.stringify;function qs(t,e){this.g=100,this.c=t,this.h=e,this.b=0,this.a=null}function Vs(){this.b=this.a=null}qs.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t},qs.prototype.f=function(t){this.h(t),this.b<this.g&&(this.b++,t.next=this.a,this.a=t)};var js,Bs=new qs(function(){return new Ws},function(t){t.reset()});function Ws(){this.next=this.b=this.a=null}function Qs(t){ba.setTimeout(function(){throw t},0)}Vs.prototype.add=function(t,e){var n=this.c();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Vs.prototype.f=function(){var t=null;return this.a&&(t=this.a,this.a=this.a.next,this.a||(this.b=null),t.next=null),t},Vs.prototype.g=function(t){Bs.f(t)},Vs.prototype.c=function(){return Bs.get()},Ws.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ks=!(Ws.prototype.reset=function(){this.next=this.b=this.a=null}),Hs=new Vs;function Gs(){for(var t;t=Hs.f();){try{t.a.call(t.b)}catch(t){Qs(t)}Hs.g(t)}Ks=!1}function zs(t,e){Fs.call(this),this.b=t||1,this.a=e||ba,this.f=Pa(this.$d,this),this.g=xa()}function Ys(t,e,n){if("function"==Sa(t))n&&(t=Pa(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Pa(t.handleEvent,t)}return 2147483647<Number(e)?-1:ba.setTimeout(t,e||0)}function Xs(t,e,n){Ma.call(this),this.f=null!=n?Pa(t,n):t,this.c=e,this.b=Pa(this.Cd,this),this.a=[]}function Js(t){Ma.call(this),this.b=t,this.a={}}La(zs,Fs),(va=zs.prototype).wa=!1,va.P=null,va.$d=function(){if(this.wa){var t=xa()-this.g;0<t&&t<.8*this.b?this.P=this.a.setTimeout(this.f,this.b-t):(this.P&&(this.a.clearTimeout(this.P),this.P=null),this.Gc(),this.wa&&(this.Na(),this.start()))}},va.Gc=function(){this.dispatchEvent("tick")},va.start=function(){this.wa=!0,this.P||(this.P=this.a.setTimeout(this.f,this.b),this.g=xa())},va.Na=function(){this.wa=!1,this.P&&(this.a.clearTimeout(this.P),this.P=null)},va.G=function(){zs.S.G.call(this),this.Na(),delete this.a},La(Xs,Ma),(va=Xs.prototype).Ca=!1,va.ec=0,va.ba=null,va.Hc=function(){this.a=arguments,this.ba||this.ec?this.Ca=!0:this.yb()},va.Pc=function(){this.ba&&(ba.clearTimeout(this.ba),this.ba=null,this.Ca=!1,this.a=[])},va.G=function(){Xs.S.G.call(this),this.Pc()},va.Cd=function(){this.ba=null,this.Ca&&!this.ec&&(this.Ca=!1,this.yb())},va.yb=function(){this.ba=Ys(this.b,this.c),this.f.apply(null,this.a)},La(Js,Ma);var $s=[];function Zs(){}(va=Js.prototype).Jb=function(t,e,n){this.wd(t,e,n)},va.wd=function(t,e,n){Ca(e)||(e&&($s[0]=e.toString()),e=$s);for(var r=0;r<e.length;r++){var i=As(t,e[r],n||this.handleEvent,!1,this.b||this);if(!i)break;this.a[i.key]=i}},va.Kb=function(){za(this.a,function(t,e){this.a.hasOwnProperty(e)&&Ds(t)},this),this.a={}},va.G=function(){Js.S.G.call(this),this.Kb()},va.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var tu=new Fs;function eu(t){gs.call(this,"serverreachability",t)}function nu(t){tu.dispatchEvent(new eu(tu,t))}function ru(t){gs.call(this,"statevent",t)}function iu(t){tu.dispatchEvent(new ru(tu,t))}function ou(t){gs.call(this,"timingevent",t)}function au(t,e){if("function"!=Sa(t))throw Error("Fn must not be null and must be a function");return ba.setTimeout(function(){t()},e)}La(eu,gs),La(ru,gs),La(ou,gs);var su={NO_ERROR:0,ae:1,he:2,ge:3,de:4,fe:5,ie:6,qc:7,TIMEOUT:8,le:9},uu={ce:"complete",pe:"success",rc:"error",qc:"abort",ne:"ready",oe:"readystatechange",TIMEOUT:"timeout",je:"incrementaldata",me:"progress",ee:"downloadprogress",qe:"uploadprogress"};function cu(){}function hu(){}cu.prototype.a=null,cu.prototype.c=function(){return this.a||(this.a={})};var lu,fu={OPEN:"a",be:"b",rc:"c",ke:"d"};function pu(){gs.call(this,"d")}function du(){gs.call(this,"c")}function yu(){}function mu(t,e,n){this.g=t,this.da=e,this.ca=n||1,this.I=new Js(this),this.L=45e3,t=is?125:void 0,this.T=new zs(t),this.J=null,this.b=!1,this.i=this.C=this.f=this.F=this.u=this.U=this.h=null,this.j=[],this.a=null,this.A=0,this.c=this.v=null,this.o=-1,this.l=!1,this.K=0,this.B=null,this.s=this.Y=this.H=!1}La(pu,gs),La(du,gs),La(yu,cu),yu.prototype.b=function(){return new XMLHttpRequest},lu=new yu;var vu={},gu={};function _u(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Ia(t)||wa(t))Ua(t,e,void 0);else{if(t.O&&"function"==typeof t.O)var n=t.O();else if(t.D&&"function"==typeof t.D)n=void 0;else if(Ia(t)||wa(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.D&&"function"==typeof t.D)return t.D();if(wa(t))return t.split("");if(Ia(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function bu(t){this.b={},this.a=[],this.c=0;var e=arguments.length;if(1<e){if(e%2)throw Error("Uneven number of arguments");for(var n=0;n<e;n+=2)this.set(arguments[n],arguments[n+1])}else t&&this.fd(t)}function wu(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(va=mu.prototype).ha=function(t){this.J=t},va.setTimeout=function(t){this.L=t},va.Xc=function(t){this.K=t},va.Qd=function(t){this.j=t},va.cb=function(t,e){this.F=1,this.f=t.N().za(),this.i=e,this.H=!0,this.ic(null)},va.bb=function(t,e,n){this.F=1,this.f=t.N().za(),this.i=null,this.H=e,this.ic(n)},va.ic=function(t){this.u=xa(),this.fa(),this.C=this.f.N(),this.C.Aa("t",this.ca),this.A=0,this.a=this.g.sa(this.g.Da()?t:null),0<this.K&&(this.B=new Xs(Pa(this.oc,this,this.a),this.K)),this.I.Jb(this.a,"readystatechange",this.Hd),t=this.J?Ya(this.J):{},this.i?(this.v||(this.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",this.a.xa(this.C,this.v,this.i,t)):(this.v="GET",this.a.xa(this.C,this.v,null,t)),nu(1)},va.Hd=function(t){t=t.target;var e=this.B;e&&3==t.W()?e.Hc():this.oc(t)},va.oc=function(t){try{t==this.a&&this.Ed()}catch(t){}},va.Ed=function(){var t=this.a.W(),e=this.a.Db(),n=this.a.aa();if(!(t<3||3==t&&!is&&!this.a.va()))if(this.l||4!=t||7==e||nu(8==e||n<=0?3:2),this.pa(),this.o=n=this.a.aa(),e=this.a.va(),this.b=200==n){if(this.Td()){if(!(n=this.Kc()))return this.b=!1,this.c=3,iu(12),this.Z(),void this.ta();this.s=!0,this.Wa(n)}this.H?(this.vb(t,e),is&&this.b&&3==t&&this.Yd()):this.Wa(e),4==t&&this.Z(),this.b&&!this.l&&(4==t?this.g.Va(this):(this.b=!1,this.fa()))}else 400==n&&0<e.indexOf("Unknown SID")?(this.c=3,iu(12)):(this.c=0,iu(13)),this.Z(),this.ta()},va.Td=function(){return this.Y&&!this.s},va.Kc=function(){if(this.a){var t=this.a.ga("X-HTTP-Initial-Response");if(t&&!ja(t))return t}return null},va.Md=function(){this.Y=!0},va.vb=function(t,e){for(var n=!0;!this.l&&this.A<e.length;){var r=this.Lc(e);if(r==gu){4==t&&(this.c=4,iu(14),n=!1);break}if(r==vu){this.c=4,iu(15),n=!1;break}this.Wa(r)}4==t&&0==e.length&&(this.c=1,iu(16),n=!1),this.b=this.b&&n,n||(this.Z(),this.ta())},va.Gd=function(){if(this.a){var t=this.a.W(),e=this.a.va();this.A<e.length&&(this.pa(),this.vb(t,e),this.b&&4!=t&&this.fa())}},va.Yd=function(){this.I.Jb(this.T,"tick",this.Gd),this.T.start()},va.Lc=function(t){var e=this.A,n=t.indexOf("\n",e);return-1==n?gu:(e=Number(t.substring(e,n)),isNaN(e)?vu:(n+=1)+e>t.length?gu:(t=t.substr(n,e),this.A=n+e,t))},va.Ld=function(t){this.F=2,this.f=t.N().za(),t=!1,ba.navigator&&ba.navigator.sendBeacon&&(t=ba.navigator.sendBeacon(this.f.toString(),"")),!t&&ba.Image&&((new Image).src=this.f,t=!0),t||(this.a=this.g.sa(null),this.a.xa(this.f)),this.u=xa(),this.fa()},va.cancel=function(){this.l=!0,this.Z()},va.Kd=function(t){t&&this.setTimeout(t),this.h&&(this.pa(),this.fa())},va.fa=function(){this.U=xa()+this.L,this.mc(this.L)},va.mc=function(t){if(null!=this.h)throw Error("WatchDog timer not null");this.h=au(Pa(this.Dd,this),t)},va.pa=function(){this.h&&(ba.clearTimeout(this.h),this.h=null)},va.Dd=function(){this.h=null;var t=xa();0<=t-this.U?this.md():this.mc(this.U-t)},va.md=function(){2!=this.F&&(nu(3),iu(17)),this.Z(),this.c=2,this.ta()},va.ta=function(){this.g.Tb()||this.l||this.g.Va(this)},va.Z=function(){this.pa();var t=this.B;t&&"function"==typeof t.La&&t.La(),this.B=null,this.T.Na(),this.I.Kb(),this.a&&(t=this.a,this.a=null,t.abort(),t.La())},va.Wa=function(t){try{this.g.bc(this,t),nu(4)}catch(t){}},(va=bu.prototype).D=function(){this.Ka();for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},va.O=function(){return this.Ka(),this.a.concat()},va.Ra=function(t){return wu(this.b,t)},va.hd=function(){return 0==this.c},va.gd=function(){this.b={},this.c=this.a.length=0},va.Qb=function(t){wu(this.b,t)&&(delete this.b[t],this.c--,this.a.length>2*this.c&&this.Ka())},va.Ka=function(){if(this.c!=this.a.length){for(var t=0,e=0;t<this.a.length;){var n=this.a[t];wu(this.b,n)&&(this.a[e++]=n),t++}this.a.length=e}if(this.c!=this.a.length){var r={};for(e=t=0;t<this.a.length;)wu(r,n=this.a[t])||(r[this.a[e++]=n]=1),t++;this.a.length=e}},va.get=function(t,e){return wu(this.b,t)?this.b[t]:e},va.set=function(t,e){wu(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},va.fd=function(t){if(t instanceof bu)for(var e=t.O(),n=0;n<e.length;n++)this.set(e[n],t.get(e[n]));else for(e in t)this.set(e,t[e])},va.forEach=function(t,e){for(var n=this.O(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}},va.Pb=function(){return new bu(this)};var Eu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Tu(t,e){var n;this.c=this.i=this.b="",this.h=null,this.j=this.g="",this.f=this.l=!1,t instanceof Tu?(this.f=void 0!==e?e:t.f,this.ma(t.b),this.$a(t.i),this.ka(t.c),this.la(t.h),this.Ba(t.g),this.Za(t.a.Gb()),this.Ya(t.j)):t&&(n=String(t).match(Eu))?(this.f=!!e,this.ma(n[1]||"",!0),this.$a(n[2]||"",!0),this.ka(n[3]||"",!0),this.la(n[4]),this.Ba(n[5]||"",!0),this.Za(n[6]||"",!0),this.Ya(n[7]||"",!0)):(this.f=!!e,this.a=new Pu(null,this.f))}function Su(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Cu(t,e,n){return wa(t)?(t=encodeURI(t).replace(e,Iu),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Iu(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}(va=Tu.prototype).toString=function(){var t=[],e=this.b;e&&t.push(Cu(e,Nu,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Cu(e,Nu,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.Sa()&&"/"!=n.charAt(0)&&t.push("/"),t.push(Cu(n,"/"==n.charAt(0)?ku:Au,!0))),(n=this.Ic())&&t.push("?",n),(n=this.j)&&t.push("#",Cu(n,Ru)),t.join("")},va.resolve=function(t){var e=this.N(),n=t.qd();n?e.ma(t.b):n=t.rd(),n?e.$a(t.i):n=t.Sa(),n?e.ka(t.c):n=t.od();var r=t.g;if(n)e.la(t.h);else if(n=t.Sb()){if("/"!=r.charAt(0))if(this.Sa()&&!this.Sb())r="/"+r;else{var i=e.g.lastIndexOf("/");-1!=i&&(r=e.g.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Qa(i,"./")||Qa(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.Ba(r):n=t.pd(),n?e.Za(t.a.Gb()):n=t.nd(),n&&e.Ya(t.j),e},va.N=function(){return new Tu(this)},va.ma=function(t,e){this.M(),(this.b=e?Su(t,!0):t)&&(this.b=this.b.replace(/:$/,""))},va.qd=function(){return!!this.b},va.$a=function(t,e){this.M(),this.i=e?Su(t):t},va.rd=function(){return!!this.i},va.ka=function(t,e){this.M(),this.c=e?Su(t,!0):t},va.Sa=function(){return!!this.c},va.la=function(t){if(this.M(),t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);this.h=t}else this.h=null},va.od=function(){return null!=this.h},va.Ba=function(t,e){this.M(),this.g=e?Su(t,!0):t},va.Sb=function(){return!!this.g},va.pd=function(){return""!==this.a.toString()},va.Za=function(t,e){this.M(),t instanceof Pu?(this.a=t,this.a.Oc(this.f)):(e||(t=Cu(t,Du)),this.a=new Pu(t,this.f))},va.Ic=function(){return this.a.toString()},va.m=function(t,e){this.M(),this.a.set(t,e)},va.Aa=function(t,e){this.M(),Ca(e)||(e=[String(e)]),this.a.lc(t,e)},va.Ya=function(t,e){this.M(),this.j=e?Su(t):t},va.nd=function(){return!!this.j},va.za=function(){return this.M(),this.m("zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^xa()).toString(36)),this},va.M=function(){if(this.l)throw Error("Tried to modify a read-only Uri")};var Nu=/[#\/\?@]/g,Au=/[#\?:]/g,ku=/[#\?]/g,Du=/[#\?@]/g,Ru=/#/g;function Pu(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Ou(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function xu(){this.a=this.b=null}function Lu(){this.a=new bu}function Mu(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Aa]||(t[Aa]=++ka)):e.charAt(0)+t}function Fu(t,e){this.a=t,this.b=e}function Uu(t){this.g=t||qu,t=ba.PerformanceNavigationTiming?0<(t=ba.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(ba.Ja&&ba.Ja.Vb&&ba.Ja.Vb()&&ba.Ja.Vb().te),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Lu),this.b=null,this.c=[]}(va=Pu.prototype).V=function(){if(!this.a&&(this.a=new bu,this.b=0,this.c)){var t=this;!function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(this.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})}},va.add=function(t,e){this.V(),this.ia(),t=this.$(t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},va.Ib=function(t){this.V(),t=this.$(t),this.a.Ra(t)&&(this.ia(),this.b-=this.a.get(t).length,this.a.Qb(t))},va.Hb=function(t){return this.V(),t=this.$(t),this.a.Ra(t)},va.forEach=function(t,e){this.V(),this.a.forEach(function(n,r){Ua(n,function(n){t.call(e,n,r,this)},this)},this)},va.O=function(){this.V();for(var t=this.a.D(),e=this.a.O(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},va.D=function(t){this.V();var e=[];if(wa(t))this.Hb(t)&&(e=qa(e,this.a.get(this.$(t))));else{t=this.a.D();for(var n=0;n<t.length;n++)e=qa(e,t[n])}return e},va.set=function(t,e){return this.V(),this.ia(),t=this.$(t),this.Hb(t)&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},va.get=function(t,e){return t&&0<(t=this.D(t)).length?String(t[0]):e},va.lc=function(t,e){this.Ib(t),0<e.length&&(this.ia(),this.a.set(this.$(t),Va(e)),this.b+=e.length)},va.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.O(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.D(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},va.ia=function(){this.c=null},va.Gb=function(){var t=new Pu;return t.c=this.c,this.a&&(t.a=this.a.Pb(),t.b=this.b),t},va.$=function(t){return t=String(t),this.f&&(t=t.toLowerCase()),t},va.Oc=function(t){t&&!this.f&&(this.V(),this.ia(),this.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(this.Ib(e),this.lc(n,t))},this)),this.f=t},La(function(){},function(){}),(va=Ou.prototype).R=null,va.Wc=function(t){this.h=t},va.Vc=function(t){this.i=t,t=this.a.Cb(this.i),iu(3);var e=this.a.H.b;null!=e?(this.f=this.a.Oa(e[0]),this.R=1,this.rb()):(t.Aa("MODE","init"),!this.a.o&&this.a.j&&t.Aa("X-HTTP-Session-Id",this.a.j),this.b=new mu(this,void 0,void 0),this.b.ha(this.h),this.b.bb(t,!1,null),this.R=0)},va.rb=function(){var t=this.a.H.a;if(null!=t)iu(4),t?(iu(10),this.a.na(this,!1)):(iu(11),this.a.na(this,!0));else{this.b=new mu(this,void 0,void 0),this.b.ha(this.h),t=this.a.Bb(this.f,this.i),iu(4),t.Aa("TYPE","xmlhttp");var e=this.a.j,n=this.a.Fa;e&&n&&t.m(e,n),this.b.bb(t,!1,this.f)}},va.sa=function(t){return this.a.sa(t)},va.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},va.Tb=function(){return!1},va.bc=function(t,e){if(this.c=t.o,0==this.R)if(this.Uc(t),e){try{var n=this.a.U.a(e)}catch(t){return void this.a.ab(this)}this.f=this.a.Oa(n[0])}else this.a.ab(this);else 1==this.R&&(this.g?iu(6):"11111"==e?(iu(5),this.g=!0,this.Ac()&&(this.c=200,this.b.cancel(),iu(11),this.a.na(this,!0))):(iu(7),this.g=!1))},va.Va=function(){this.c=this.b.o,this.b.b?0==this.R?(this.R=1,this.rb()):1==this.R&&(this.g?(iu(11),this.a.na(this,!0)):(iu(10),this.a.na(this,!1))):(0==this.R?iu(8):1==this.R&&iu(9),this.a.ab(this))},va.Uc=function(t){if(!this.a.o&&(t=t.a)){var e=t.ga("X-Client-Wire-Protocol");this.l=e||null,this.a.j&&(t=t.ga("X-HTTP-Session-Id"))&&this.a.kc(t)}},va.Da=function(){return this.a.Da()},va.Pa=function(){return this.a.Pa()},va.Ac=function(){return!ns||10<=Number(ls)},(va=Lu.prototype).add=function(t){this.a.set(Mu(t),t)},va.ed=function(t){this.a.Qb(Mu(t))},va.jd=function(){this.a.gd()},va.Rb=function(){return this.a.hd()},va.Ob=function(t){return this.a.Ra(Mu(t))},va.D=function(){return this.a.D()};var qu=10;function Vu(){this.b=this.a=void 0}function ju(){this.f=new Vu}function Bu(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}(va=Uu.prototype).kb=function(t){!this.a&&(Qa(t,"spdy")||Qa(t,"quic")||Qa(t,"h2"))&&(this.f=this.g,this.a=new Lu,this.b&&(this.Ha(this.b),this.b=null))},va.Ub=function(){return!!this.b||!!this.a&&this.a.a.c>=this.f},va.Mc=function(){return this.b?1:this.a?this.a.a.c:0},va.Ta=function(t){return this.b?this.b==t:!!this.a&&this.a.Ob(t)},va.Ha=function(t){this.a?this.a.add(t):this.b=t},va.gc=function(t){this.b&&this.b==t?this.b=null:this.a&&this.a.Ob(t)&&this.a.ed(t)},va.cancel=function(){this.c=this.Xb(),this.b?(this.b.cancel(),this.b=null):this.a&&!this.a.Rb()&&(Ua(this.a.D(),function(t){t.cancel()}),this.a.jd())},va.Xb=function(){if(null!=this.b)return this.c.concat(this.b.j);if(null==this.a||this.a.Rb())return Va(this.c);var t=this.c;return Ua(this.a.D(),function(e){t=t.concat(e.j)}),t},va.wc=function(t){this.c=this.c.concat(t)},va.Bc=function(){this.c.length=0},Vu.prototype.stringify=function(t){return ba.JSON.stringify(t,this.a)},Vu.prototype.parse=function(t){return ba.JSON.parse(t,this.b)},ju.prototype.b=function(t,e,n){var r=n||"";try{_u(t,function(t,n){var i=t;Na(t)&&(i=Us(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}},ju.prototype.c=function(t,e,n){for(var r=-1;;){var i=["count="+e];-1==r?0<e?(r=t[0].a,i.push("ofs="+r)):r=0:i.push("ofs="+r);for(var o=!0,a=0;a<e;a++){var s=t[a].a,u=t[a].b;if((s-=r)<0)r=Math.max(0,t[a].a-100),o=!1;else try{this.b(u,i,"req"+s+"_")}catch(t){n&&n(u)}}if(o)return i.join("&")}},ju.prototype.a=function(t){return this.f.parse(t)};var Wu=ba.JSON.parse;function Qu(t){Fs.call(this),this.headers=new bu,this.l=t||null,this.b=!1,this.v=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.o=this.A=!1,this.u=0,this.s=null,this.J=Ku,this.H=this.L=this.I=!1}La(Qu,Fs);var Ku="",Hu=/^https?$/i,Gu=["POST","PUT"];function zu(t){return"content-type"==t.toLowerCase()}function Yu(t,e){return{type:e,lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total}}function Xu(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;var i;if(i="",za(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,wa(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var o=""}else o=t.substring(r+1,n);n=(t=[t.substr(0,r),o,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return t.m(e,n),t}function Ju(t){this.gb=22,this.g=[],this.H=new xu,this.da=this.fb=this.C=this.Ea=this.a=this.Fa=this.j=this.ca=this.f=this.J=this.h=null,this.sc=!0,this.zc=this.L=0,this.uc=!!Ea("internalChannelParams.failFast",t),this.Ga=this.v=this.s=this.l=this.i=this.b=null,this.eb=!0,this.B=this.jb=this.K=-1,this.Y=this.u=this.A=0,this.tc=Ea("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Fc=Ea("internalChannelParams.retryDelaySeedMs",t)||1e4,this.pc=Ea("internalChannelParams.forwardChannelMaxRetries",t)||2,this.ib=Ea("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.xc=t&&t.ue||void 0,this.F=void 0,this.vc=0,this.T=t&&t.supportsCrossDomainXhr||!1,this.I="",this.c=new Uu(t&&t.concurrentRequestLimit),this.U=new ju,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.hb=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.se&&(this.eb=!1)}function $u(){}function Zu(){if(ns&&!(10<=Number(ls)))throw Error("Environmental error: no available transport.")}function tc(t,e){Fs.call(this),this.a=new Ju(e),this.g=t,this.o=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.cd(t),t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.tb&&(t?t["X-WebChannel-Client-Profile"]=e.tb:t={"X-WebChannel-Client-Profile":e.tb}),this.a.Pd(t),(t=e&&e.httpHeadersOverwriteParam)&&!ja(t)&&this.a.Nd(t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ja(e)&&(this.a.Od(e),null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new rc(this)}function ec(t){pu.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.f=t)?(t=this.f,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function nc(){du.call(this),this.status=1}function rc(t){this.a=t}(va=Qu.prototype).Sd=function(t){this.I=t},va.xa=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.Ec(),this.v=this.l?this.l.c():lu.c(),this.a.onreadystatechange=Pa(this.ac,this),this.L&&"onprogress"in this.a&&(this.a.onprogress=Pa(function(t){this.Zb(t,!0)},this),this.a.upload&&(this.a.upload.onprogress=Pa(this.Zb,this)));try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(t){return void this.Ab(t)}t=n||"";var i,o=this.headers.Pb();r&&_u(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=zu,n=t.length,r=wa(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:wa(t)?t.charAt(e):t[e]}(o.O()),n=ba.FormData&&t instanceof ba.FormData,!(0<=Fa(Gu,e))||r||n||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.J&&(this.a.responseType=this.J),"withCredentials"in this.a&&this.a.withCredentials!==this.I&&(this.a.withCredentials=this.I);try{this.sb(),0<this.u&&((this.H=(i=this.a,ns&&ps(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.u,this.a.ontimeout=Pa(this.Nb,this)):this.s=Ys(this.Nb,this.u,this)),this.o=!0,this.a.send(t),this.o=!1}catch(t){this.Ab(t)}},va.Ec=function(){return this.l?this.l.b():lu.b()},va.Nb=function(){void 0!==_a&&this.a&&(this.f="Timed out after "+this.u+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},va.Ab=function(t){this.b=!1,this.a&&(this.g=!0,this.a.abort(),this.g=!1),this.f=t,this.h=5,this.xb(),this.qa()},va.xb=function(){this.A||(this.A=!0,this.dispatchEvent("complete"),this.dispatchEvent("error"))},va.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),this.qa())},va.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),this.qa(!0)),Qu.S.G.call(this)},va.ac=function(){this.i||(this.B||this.o||this.g?this.$b():this.Bd())},va.Bd=function(){this.$b()},va.$b=function(){if(this.b&&void 0!==_a&&(!this.v[1]||4!=this.W()||2!=this.aa()))if(this.o&&4==this.W())Ys(this.ac,0,this);else if(this.dispatchEvent("readystatechange"),this.td()){this.b=!1;try{this.vd()?(this.dispatchEvent("complete"),this.dispatchEvent("success")):(this.h=6,this.f=this.Fb()+" ["+this.aa()+"]",this.xb())}finally{this.qa()}}},va.Zb=function(t,e){this.dispatchEvent(Yu(t,"progress")),this.dispatchEvent(Yu(t,e?"downloadprogress":"uploadprogress"))},va.qa=function(t){if(this.a){this.sb();var e=this.a,n=this.v[0]?Ta:null;this.v=this.a=null,t||this.dispatchEvent("ready");try{e.onreadystatechange=n}catch(t){}}},va.sb=function(){this.a&&this.H&&(this.a.ontimeout=null),this.s&&(ba.clearTimeout(this.s),this.s=null)},va.td=function(){return 4==this.W()},va.vd=function(){var t=this.aa();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}return e||0===t&&!this.ud()},va.ud=function(){var t=String(this.C).match(Eu)[1]||null;return!t&&ba.self&&ba.self.location&&(t=(t=ba.self.location.protocol).substr(0,t.length-1)),Hu.test(t?t.toLowerCase():"")},va.W=function(){return this.a?this.a.readyState:0},va.aa=function(){try{return 2<this.W()?this.a.status:-1}catch(t){return-1}},va.Fb=function(){try{return 2<this.W()?this.a.statusText:""}catch(t){return""}},va.va=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},va.Nc=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Wu(e)}},va.ga=function(t){return this.a?this.a.getResponseHeader(t):null},va.Db=function(){return this.h},va.dd=function(){return wa(this.f)?this.f:String(this.f)},(va=Ju.prototype).qb=8,va.w=1,va.bd=function(t,e,n){iu(0),this.Ea=e,this.ca=n||{},this.o&&(this.H.b=[],this.H.a=!1),this.Dc(t)},va.Qa=function(){if(this.lb(),3==this.w){var t=this.L++,e=this.C.N();e.m("SID",this.I),e.m("RID",t),e.m("TYPE","terminate"),this.ea(e),new mu(this,t,void 0).Ld(e)}this.Yb()},va.Dc=function(t){this.v=new Ou(this),null===this.f&&this.v.Wc(this.h);var e=t;this.f&&this.h&&(e=Xu(t,this.f,this.h)),this.v.Vc(e)},va.Cc=function(){this.C=this.Cb(this.Ea),this.Ma()},va.lb=function(){this.v&&(this.v.abort(),this.v=null),this.a&&(this.a.cancel(),this.a=null),this.l&&(ba.clearTimeout(this.l),this.l=null),this.ra(),this.c.cancel(),this.i&&(ba.clearTimeout(this.i),this.i=null)},va.cd=function(t){this.h=t},va.Pd=function(t){this.J=t},va.Nd=function(t){this.f=t},va.Od=function(t){this.j=t},va.kc=function(t){this.Fa=t},va.Rd=function(){this.T=!0},va.jc=function(t){this.b=t},va.sd=function(){return!this.Ga},va.Xa=function(t){this.g.push(new Fu(this.zc++,t)),3==this.w&&this.Ma()},va.Jc=function(){return this.uc?0:this.pc},va.Tb=function(){return 0==this.w},va.Ma=function(){this.c.Ub()||this.i||(this.i=au(Pa(this.dc,this),0),this.A=0)},va.xd=function(t){return!(this.c.Mc()>=this.c.f-(this.i?1:0)||(this.i?(this.g=t.j.concat(this.g),0):1==this.w||2==this.w||this.A>=this.Jc()||(this.i=au(Pa(this.dc,this,t),this.Eb(this.A)),this.A++,0)))},va.dc=function(t){this.i=null,this.Xd(t)},va.Xd=function(t){1==this.w?t||(this.Fd(),this.w=2):3==this.w&&(t?this.Wb(t):0==this.g.length||this.c.Ub()||this.Wb())},va.Fd=function(){this.L=Math.floor(1e5*Math.random());var t=this.L++,e=new mu(this,t,void 0),n=this.h;this.J&&(n?Ja(n=Ya(n),this.J):n=this.J),null===this.f&&e.ha(n);var r=this.wb(e),i=this.C.N();i.m("RID",t),0<this.gb&&i.m("CVER",this.gb),this.o&&this.j&&i.m("X-HTTP-Session-Id",this.j),this.ea(i),this.f&&n&&Xu(i,this.f,n),this.c.Ha(e),this.hb?(i.m("$req",r),i.m("SID","null"),e.Md(),e.cb(i,null)):e.cb(i,r)},va.Wb=function(t){var e;e=t?t.da:this.L++;var n=this.C.N();n.m("SID",this.I),n.m("RID",e),n.m("AID",this.K),this.ea(n),this.f&&this.h&&Xu(n,this.f,this.h),e=new mu(this,e,this.A+1),null===this.f&&e.ha(this.h),t&&this.Jd(t),t=this.wb(e),e.setTimeout(Math.round(.5*this.ib)+Math.round(.5*this.ib*Math.random())),this.c.Ha(e),e.cb(n,t)},va.ea=function(t){this.b&&_u({},function(e,n){t.m(n,e)})},va.wb=function(t){var e=Math.min(this.g.length,1e3),n=this.b?Pa(this.b.yc,this.b,this):null;return n=this.U.c(this.g,e,n),t.Qd(this.g.splice(0,e)),n},va.Jd=function(t){this.g=t.j.concat(this.g)},va.zb=function(){if(!this.a&&!this.l){this.Y=1;var t=this.cc;js||(e=ba.Promise.resolve(void 0),js=function(){e.then(Gs)}),Ks||(js(),Ks=!0),Hs.add(t,this),this.u=0}var e},va.Ua=function(){return!(this.a||this.l||3<=this.u||(this.Y++,this.l=au(Pa(this.cc,this),this.Eb(this.u)),this.u++,0))},va.cc=function(){this.l=null,this.Vd()},va.Vd=function(){this.a=new mu(this,"rpc",this.Y),null===this.f&&this.a.ha(this.h),this.a.Xc(this.vc);var t=this.fb.N();t.m("RID","rpc"),t.m("SID",this.I),t.m("CI",this.Ga?"0":"1"),t.m("AID",this.K),this.ea(t),t.m("TYPE","xmlhttp"),this.f&&this.h&&Xu(t,this.f,this.h),this.F&&this.a.setTimeout(this.F),this.a.bb(t,!0,this.da)},va.na=function(t,e){var n=t.l;n&&this.c.kb(n),this.Ga=this.eb&&e,this.B=t.c,this.Cc()},va.ab=function(t){this.B=t.c,this.X(2)},va.bc=function(t,e){if(0!=this.w&&(this.a==t||this.c.Ta(t)))if(this.B=t.o,!t.s&&this.c.Ta(t)&&3==this.w){try{var n=this.U.a(e)}catch(t){n=null}Ca(n)&&3==n.length?this.ld(n,t):this.X(11)}else(t.s||this.a==t)&&this.ra(),ja(e)||(n=this.U.a(e),this.Ad(n,t))},va.ld=function(t,e){0==t[0]?this.kd(e):(this.jb=t[1],0<this.jb-this.K&&this.Ud(t[2])&&!this.s&&(this.s=au(Pa(this.yd,this),6e3)))},va.kd=function(t){if(!this.l){if(this.a){if(!(this.a.u+3e3<t.u))return;this.ra(),this.a.cancel(),this.a=null}this.Ua(),iu(18)}},va.Ud=function(t){return t<37500&&!this.sd()&&0==this.u},va.Oa=function(t){return this.sc?this.b?this.b.$c(t):t:null},va.yd=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,this.Ua(),iu(19))},va.ra=function(){null!=this.s&&(ba.clearTimeout(this.s),this.s=null)},va.Va=function(t){var e=null;if(this.a==t){this.ra(),this.a=null;var n=2}else{if(!this.c.Ta(t))return;e=t.j,this.c.gc(t),n=1}if(this.B=t.o,0!=this.w)if(t.b)1==n?(n=xa()-t.u,tu.dispatchEvent(new ou(tu,t.i?t.i.length:0,n,this.A)),this.Ma()):this.zb();else{var r=t.c;if(3==r||0==r&&0<this.B||!(1==n&&this.xd(t)||2==n&&this.Ua()))switch(e&&0<e.length&&this.c.wc(e),r){case 1:this.X(5);break;case 4:this.X(10);break;case 3:this.X(6);break;default:this.X(2)}}},va.Eb=function(t){var e=this.tc+Math.floor(Math.random()*this.Fc);return this.Pa()||(e*=2),e*t},va.ad=function(t){if(this.o&&(t=t.a)){var e=t.ga("X-Client-Wire-Protocol");e&&this.c.kb(e),this.j&&(t=t.ga("X-HTTP-Session-Id"))&&(this.kc(t),this.C.m(this.j,t))}},va.Ad=function(t,e){for(var n=this.b&&this.b.Ia?[]:null,r=0;r<t.length;r++){var i=t[r];if(this.K=i[0],i=i[1],2==this.w)if("c"==i[0]){this.I=i[1],this.da=this.Oa(i[2]);var o=i[3];null!=o&&(this.qb=o),null!=(i=i[5])&&"number"==typeof i&&0<i&&(this.F=1.5*i),this.ad(e),this.w=3,this.b&&this.b.pb(),this.Wd(e)}else"stop"!=i[0]&&"close"!=i[0]||this.X(7);else 3==this.w&&("stop"==i[0]||"close"==i[0]?(n&&0!=n.length&&(this.b.Ia(this,n),n.length=0),"stop"==i[0]?this.X(7):this.Qa()):"noop"!=i[0]&&(n?n.push(i):this.b&&this.b.ob(i)),this.u=0)}n&&0!=n.length&&this.b.Ia(this,n)},va.Wd=function(t){this.fb=this.Bb(this.da,this.Ea),t.s?(this.c.gc(t),t.Kd(this.F),this.a=t):this.zb()},va.X=function(t){if(2==t){var e=null;this.b&&(e=null);var n=Pa(this.Zd,this);e||(e=new Tu("//www.google.com/images/cleardot.gif"),ba.location&&"http"==ba.location.protocol||e.ma("https"),e.za()),r=e.toString(),i=n,o=new Zs,(a=new Image).onload=Oa(Bu,o,a,"TestLoadImage: loaded",!0,i),a.onerror=Oa(Bu,o,a,"TestLoadImage: error",!1,i),a.onabort=Oa(Bu,o,a,"TestLoadImage: abort",!1,i),a.ontimeout=Oa(Bu,o,a,"TestLoadImage: timeout",!1,i),ba.setTimeout(function(){a.ontimeout&&a.ontimeout()},1e4),a.src=r}else iu(2);var r,i,o,a;this.zd(t)},va.Zd=function(t){iu(t?2:1)},va.zd=function(t){this.w=0,this.b&&this.b.nb(t),this.Yb(),this.lb()},va.Yb=function(){this.w=0,this.B=-1,this.b&&(0==this.c.Xb().length&&0==this.g.length||(this.c.Bc(),Va(this.g),this.g.length=0),this.b.mb())},va.Cb=function(t){return this.ub(null,t)},va.Bb=function(t,e){return this.ub(this.Da()?t:null,e)},va.ub=function(t,e){var n,r,i,o,a,s,u=(n=e)instanceof Tu?n.N():new Tu(n,void 0);if(""!=u.c)t&&u.ka(t+"."+u.c),u.la(u.h);else{var c,h=ba.location;c=t?t+"."+h.hostname:h.hostname,r=h.protocol,i=c,o=+h.port,a=e,s=new Tu(null,void 0),r&&s.ma(r),i&&s.ka(i),o&&s.la(o),a&&s.Ba(a),u=s}return this.ca&&za(this.ca,function(t,e){u.m(e,t)}),t=this.j,e=this.Fa,t&&e&&u.m(t,e),u.m("VER",this.qb),this.ea(u),u},va.sa=function(t){if(t&&!this.T)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Qu(this.xc)).Sd(this.T),t},va.Pa=function(){return!!this.b&&!0},va.Da=function(){return this.T},(va=$u.prototype).Ia=null,va.pb=function(){},va.ob=function(){},va.nb=function(){},va.mb=function(){},va.yc=function(){},va.$c=function(t){return t},Zu.prototype.a=function(t,e){return new tc(t,e)},La(tc,Fs),(va=tc.prototype).addEventListener=function(t,e,n,r){tc.S.addEventListener.call(this,t,e,n,r)},va.removeEventListener=function(t,e,n,r){tc.S.removeEventListener.call(this,t,e,n,r)},va.Yc=function(){this.a.jc(this.f),this.l&&this.a.Rd(),this.a.bd(this.o,this.g,this.b||void 0)},va.close=function(){this.a.Qa()},va.Zc=function(t){if(wa(t)){var e={};e.__data__=t,this.a.Xa(e)}else this.h?((e={}).__data__=Us(t),this.a.Xa(e)):this.a.Xa(t)},va.G=function(){this.a.jc(null),delete this.f,this.a.Qa(),delete this.a,tc.S.G.call(this)},La(ec,pu),La(nc,du),La(rc,$u),rc.prototype.pb=function(){this.a.dispatchEvent("a")},rc.prototype.ob=function(t){this.a.dispatchEvent(new ec(t))},rc.prototype.nb=function(t){this.a.dispatchEvent(new nc(t))},rc.prototype.mb=function(){this.a.dispatchEvent("b")};var ic=Oa(function(t){function e(){}e.prototype=t.prototype;var n=new e;return t.apply(n,Array.prototype.slice.call(arguments,1)),n},Zu);Zu.prototype.createWebChannel=Zu.prototype.a,tc.prototype.send=tc.prototype.Zc,tc.prototype.open=tc.prototype.Yc,tc.prototype.close=tc.prototype.close,su.NO_ERROR=0,su.TIMEOUT=8,su.HTTP_ERROR=6,uu.COMPLETE="complete",(hu.EventType=fu).OPEN="a",fu.CLOSE="b",fu.ERROR="c",fu.MESSAGE="d",Fs.prototype.listen=Fs.prototype.Lb,Qu.prototype.listenOnce=Qu.prototype.Mb,Qu.prototype.getLastError=Qu.prototype.dd,Qu.prototype.getLastErrorCode=Qu.prototype.Db,Qu.prototype.getStatus=Qu.prototype.aa,Qu.prototype.getStatusText=Qu.prototype.Fb,Qu.prototype.getResponseJson=Qu.prototype.Nc,Qu.prototype.getResponseText=Qu.prototype.va,Qu.prototype.send=Qu.prototype.xa;var oc,ac,sc={createWebChannelTransport:ic,ErrorCode:su,EventType:uu,WebChannel:hu,XhrIo:Qu},uc=sc.createWebChannelTransport,cc=sc.ErrorCode,hc=sc.EventType,lc=sc.WebChannel,fc=sc.XhrIo,pc=er.SDK_VERSION,dc=new yr("@firebase/firestore");function yc(){return dc.logLevel===Zn.DEBUG?oc.DEBUG:dc.logLevel===Zn.SILENT?oc.SILENT:oc.ERROR}function mc(t){switch(t){case oc.DEBUG:dc.logLevel=Zn.DEBUG;break;case oc.ERROR:dc.logLevel=Zn.ERROR;break;case oc.SILENT:dc.logLevel=Zn.SILENT;break;default:dc.error("Firestore ("+pc+"): Invalid value passed to `setLogLevel`")}}function vc(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(dc.logLevel<=Zn.DEBUG){var i=n.map(_c);dc.debug.apply(dc,["Firestore ("+pc+") ["+t+"]: "+e].concat(i))}}function gc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(dc.logLevel<=Zn.ERROR){var r=e.map(_c);dc.error.apply(dc,["Firestore ("+pc+"): "+t].concat(r))}}function _c(t){if("string"==typeof t)return t;var e=Ec.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function bc(t){var e="FIRESTORE ("+pc+") INTERNAL ASSERTION FAILED: "+t;throw gc(e),new Error(e)}function wc(t,e){t||bc(e)}(ac=oc||(oc={}))[ac.DEBUG=0]="DEBUG",ac[ac.ERROR=1]="ERROR",ac[ac.SILENT=2]="SILENT";var Ec=function(){function t(){}return t.setPlatform=function(e){t.platform&&bc("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||bc("Platform not set"),t.platform},t}();function Tc(){return Ec.getPlatform().emptyByteString}var Sc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Cc=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return rn(e,t),e}(Error);function Ic(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Cc(Sc.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Nc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ac(t,e){return void 0!==t?t:e}function kc(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Dc(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Rc(t){for(var e in wc(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pc(t,e){if(0!==e.length)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Yc(e.length,"argument")+".")}function Oc(t,e,n){if(e.length!==n)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires "+Yc(n,"argument")+", but was called with "+Yc(e.length,"argument")+".")}function xc(t,e,n){if(e.length<n)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Yc(n,"argument")+", but was called with "+Yc(e.length,"argument")+".")}function Lc(t,e,n,r){if(e.length<n||e.length>r)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Yc(e.length,"argument")+".")}function Mc(t,e,n,r){Bc(t,e,zc(n)+" argument",r)}function Fc(t,e,n,r){void 0!==r&&Mc(t,e,n,r)}function Uc(t,e,n,r){Bc(t,e,n+" option",r)}function qc(t,e,n,r){void 0!==r&&Uc(t,e,n,r)}function Vc(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Qc(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Qc(r[o]))}(t,e,n,r,i)}function jc(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Qc(u))}var c=Qc(r);throw new Cc(Sc.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Bc(t,e,n,r){if(!("object"===e?Wc(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Qc(r);throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Wc(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Qc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":bc("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Kc(t,e,n){if(void 0===n)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+zc(e)+" argument, but it was undefined.")}function Hc(t,e,n){Dc(e,function(e){if(n.indexOf(e)<0)throw new Cc(Sc.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Gc(t,e,n,r){var i=Qc(r);return new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() requires its "+zc(n)+" argument to be a "+e+", but it was: "+i)}function zc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Yc(t,e){return t+" "+e+(1===t?"":"s")}var Xc=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return wc(20===e.length,"Invalid auto ID: "+e),e},t}();function Jc(t,e){return t<e?-1:e<t?1:0}function $c(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Zc(t){return t+"\0"}function th(){if("undefined"==typeof Uint8Array)throw new Cc(Sc.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function eh(){if(!Ec.getPlatform().base64Available)throw new Cc(Sc.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var nh,rh,ih,oh,ah=function(){function t(t){eh(),this._binaryString=t}return t.fromBase64String=function(e){Oc("Blob.fromBase64String",arguments,1),Mc("Blob.fromBase64String","string",1,e),eh();try{return new t(Ec.getPlatform().atob(e))}catch(e){throw new Cc(Sc.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+e)}},t.fromUint8Array=function(e){if(Oc("Blob.fromUint8Array",arguments,1),th(),!(e instanceof Uint8Array))throw Gc("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return Oc("Blob.toBase64",arguments,0),eh(),Ec.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){Oc("Blob.toUint8Array",arguments,0),th();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Jc(this._binaryString,t._binaryString)},t}(),sh=Ic(ah,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),uh=function(){function t(t,e){if(Oc("GeoPoint",arguments,2),Mc("GeoPoint","number",1,t),Mc("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Cc(Sc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Cc(Sc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Jc(this._lat,t._lat)||Jc(this._long,t._long)},t}(),ch=function(){function t(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Cc(Sc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Cc(Sc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Cc(Sc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Cc(Sc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Jc(this.nanoseconds,t.nanoseconds):Jc(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),hh=function(t,e,n,r){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r},lh="(default)",fh=function(){function t(t,e){this.projectId=t,this.database=e||lh}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===lh},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Jc(this.projectId,t.projectId)||Jc(this.database,t.database)},t}(),ph="__name__",dh=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&bc("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&bc("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):bc("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,wc(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return wc(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return wc(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return wc(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),yh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(0<=t.indexOf("//"))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return 0<t.length}))},e.EMPTY_PATH=new e([]),e}(dh),mh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,vh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return rn(e,t),e.isValidIdentifier=function(t){return mh.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===ph},e.keyField=function(){return new e([ph])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new Cc(Sc.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Cc(Sc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?a=!a:"."!==s||a?r+=s:o(),i++}if(o(),a)throw new Cc(Sc.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(dh),gh=function(){function t(e){this.path=e,wc(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===yh.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return yh.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new yh(e.slice()))},t.fromPathString=function(e){return new t(yh.fromString(e))},t.EMPTY=new t(new yh([])),t}(),_h=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return gh.comparator(t.key,e.key)},t}(),bh=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n)||this;return a.data=r,a.proto=o,a.hasLocalMutations=!!i.hasLocalMutations,a.hasCommittedMutations=!!i.hasCommittedMutations,a}return rn(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):bc("Trying to compare documents on fields that don't exist")},e}(_h),wh=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return rn(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(_h),Eh=function(t){function e(e,n){return t.call(this,e,n)||this}return rn(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(_h),Th=function(){function t(t,e){this.comparator=t,this.root=e||Ch.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ch.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ch.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Sh(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Sh(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Sh(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Sh(this.root,t,this.comparator,!0)},t}(),Sh=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){wc(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return 0<this.nodeStack.length},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ch=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw bc("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw bc("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw bc("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),Ih=function(){function t(){this.size=0}return t.prototype.copy=function(){return this},t.prototype.insert=function(t,e){return new Ch(t,e)},t.prototype.remove=function(){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(){return!1},t.prototype.reverseTraversal=function(){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();Ch.EMPTY=new Ih,(rh=nh||(nh={}))[rh.NullValue=0]="NullValue",rh[rh.BooleanValue=1]="BooleanValue",rh[rh.NumberValue=2]="NumberValue",rh[rh.TimestampValue=3]="TimestampValue",rh[rh.StringValue=4]="StringValue",rh[rh.BlobValue=5]="BlobValue",rh[rh.RefValue=6]="RefValue",rh[rh.GeoPointValue=7]="GeoPointValue",rh[rh.ArrayValue=8]="ArrayValue",rh[rh.ObjectValue=9]="ObjectValue",(oh=ih||(ih={}))[oh.Default=0]="Default",oh[oh.Estimate=1]="Estimate",oh[oh.Previous=2]="Previous";var Nh=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(ih.Estimate,n);case"previous":return new t(ih.Previous,n);case"none":case void 0:return new t(ih.Default,n);default:return bc("fromSnapshotOptions() called with invalid options.")}},t}(),Ah=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return wc(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Jc(this.typeOrder,t.typeOrder)},t}(),kh=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=nh.NullValue,e.internalValue=null,e}return rn(e,t),e.prototype.value=function(){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(Ah),Dh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.BooleanValue,n}return rn(e,t),e.prototype.value=function(){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Jc(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Ah),Rh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.NumberValue,n}return rn(e,t),e.prototype.value=function(){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue)<(r=t.internalValue)?-1:r<n?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1:this.defaultCompareTo(t);var n,r},e}(Ah);function Ph(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Oh=function(t){function e(e){return t.call(this,e)||this}return rn(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ph(this.internalValue,t.internalValue)},e}(Rh),xh=function(t){function e(e){var n=t.call(this,e)||this;return n.internalValue=e,n}return rn(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ph(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Rh),Lh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.StringValue,n}return rn(e,t),e.prototype.value=function(){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Jc(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Ah),Mh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.TimestampValue,n}return rn(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Fh?-1:this.defaultCompareTo(t)},e}(Ah),Fh=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=nh.TimestampValue,r}return rn(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===ih.Estimate?new Mh(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===ih.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Mh?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Ah),Uh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.BlobValue,n}return rn(e,t),e.prototype.value=function(){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Ah),qh=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=nh.RefValue,r}return rn(e,t),e.prototype.value=function(){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:gh.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(Ah),Vh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.GeoPointValue,n}return rn(e,t),e.prototype.value=function(){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Ah),jh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.ObjectValue,n}return rn(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=Jc(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return Jc(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(wc(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(wc(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return void 0!==this.field(t)},e.prototype.field=function(t){wc(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e&&n.internalValue.get(t)||void 0}),n},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new Th(Jc)),e}(Ah),Bh=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=nh.ArrayValue,n}return rn(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Jc(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(Ah),Wh=Number,Qh=Wh.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Kh=Wh.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Hh=Wh.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Gh(t){return null==t}function zh(t){return Hh(t)&&t<=Kh&&Qh<=t}var Yh,Xh,Jh=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[al]:this.memoizedOrderBy=[new ol(t),al];else{wc(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:rl.ASCENDING;this.memoizedOrderBy.push(a===rl.ASCENDING?al:sl)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){wc(null==this.getInequalityFilterField()||!(e instanceof tl)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),wc(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){wc(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Gh(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),Gh(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return wc(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!Gh(this.limit)},t.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof tl&&n.isInequality())return n.field}return null},t.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof tl&&t.op===Zh.ARRAY_CONTAINS})},t.prototype.isDocumentQuery=function(){return gh.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):gh.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){wc(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),$h=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(kh.INSTANCE)){if(e!==Zh.EQUAL)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new el(t)}if(n.isEqual(xh.NAN)){if(e!==Zh.EQUAL)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new nl(t)}return new tl(t,e,n)},t}(),Zh=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;default:return bc("Unknown relation: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t}(),tl=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return rn(e,t),e.prototype.matches=function(t){if(this.field.isKeyField()){wc(this.value instanceof qh,"Comparing on key, but filter value not a RefValue"),wc(this.op!==Zh.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=this.value,n=gh.comparator(t.key,e.key);return this.matchesComparison(n)}var r=t.field(this.field);return void 0!==r&&this.matchesValue(r)},e.prototype.matchesValue=function(t){var e=this;return this.op===Zh.ARRAY_CONTAINS?t instanceof Bh&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case Zh.LESS_THAN:return t<0;case Zh.LESS_THAN_OR_EQUAL:return t<=0;case Zh.EQUAL:return 0===t;case Zh.GREATER_THAN:return 0<t;case Zh.GREATER_THAN_OR_EQUAL:return 0<=t;default:return bc("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==Zh.EQUAL&&this.op!==Zh.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}($h),el=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return rn(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}($h),nl=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return rn(e,t),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}($h),rl=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),il=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},t.prototype.sortsBeforeDocument=function(t,e){wc(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())wc(o instanceof qh,"Bound has a non-key value where the key path is being used."),n=gh.comparator(o.key,e.key);else{var a=e.field(i.field);wc(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===rl.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];return n.isEqual(r)}return!0},t}(),ol=function(){function t(t,e){this.field=t,void 0===e&&(e=rl.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?bh.compareByKey(t,e):bh.compareByField(this.field,t,e);switch(this.dir){case rl.ASCENDING:return n;case rl.DESCENDING:return-1*n;default:return bc("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),al=new ol(vh.keyField(),rl.ASCENDING),sl=new ol(vh.keyField(),rl.DESCENDING),ul=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new ch(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new ch(0,0)),t}();(Xh=Yh||(Yh={}))[Xh.Listen=0]="Listen",Xh[Xh.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",Xh[Xh.LimboResolution=2]="LimboResolution";var cl,hl,ll=function(){function t(t,e,n,r,i,o){void 0===i&&(i=ul.MIN),void 0===o&&(o=Tc()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),fl=function(){function t(t){this.comparator=t,this.data=new Th(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new pl(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new pl(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),pl=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),dl=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new fl(vh.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.applyTo=function(t){var e=jh.EMPTY;return this.fields.forEach(function(n){if(n.isEmpty())return t;var r=t.field(n);void 0!==r&&(e=e.set(n,r))}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),yl=function(){function t(t,e){this.field=t,this.transform=e}return Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return this.transform.isIdempotent},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),ml=function(t,e){this.version=t,this.transformResults=e};(hl=cl||(cl={}))[hl.Set=0]="Set",hl[hl.Patch=1]="Patch",hl[hl.Transform=2]="Transform",hl[hl.Delete=3]="Delete";var vl=function(){function t(t,e){this.updateTime=t,this.exists=e,wc(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof bh&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof bh:(wc(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),gl=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&wc(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof bh?t.version:ul.MIN},t}(),_l=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=cl.Set,i}return rn(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),wc(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new bh(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var e=gl.getPostMutationVersion(t);return new bh(this.key,e,this.value,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(gl),bl=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=cl.Patch,o}return rn(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),wc(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Eh(this.key,e.version);var n=this.patchDocument(t);return new bh(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var e=gl.getPostMutationVersion(t),n=this.patchDocument(t);return new bh(this.key,e,n,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof bh?t.data:jh.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=void 0!==r?t.set(n,r):t.delete(n)}}),t},e}(gl),wl=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=cl.Transform,r.precondition=vl.exists(!0),r}return rn(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),wc(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Eh(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new bh(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new bh(this.key,r.version,o,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){for(var t=0,e=this.fieldTransforms;t<e.length;t++)if(!e[t].isIdempotent)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){var t=new fl(vh.comparator);return this.fieldTransforms.forEach(function(e){return t=t.add(e.field)}),new dl(t)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&$c(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){wc(t instanceof bh,"Unknown MaybeDocument type "+t);var e=t;return wc(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];wc(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof bh&&(a=t.field(i.field)||null),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],a=o.transform,s=null;e instanceof bh&&(s=e.field(o.field)||null),n.push(a.applyToLocalView(s,t))}return n},e.prototype.transformObject=function(t,e){wc(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(gl),El=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=cl.Delete,r}return rn(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),wc(null==e.transformResults,"Transform results received by DeleteMutation."),new wh(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&wc(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new wh(this.key,ul.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e}(gl),Tl=function(){function t(){this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return new Fh(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),Sl=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t){return this.apply(t)},t.prototype.apply=function(t){for(var e=Nl(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Bh(e)},t.prototype.isEqual=function(e){return e instanceof t&&$c(e.elements,this.elements)},t}(),Cl=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t){return this.apply(t)},t.prototype.apply=function(t){for(var e=Nl(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Bh(e)},t.prototype.isEqual=function(e){return e instanceof t&&$c(e.elements,this.elements)},t}(),Il=function(){function t(t){this.operand=t,this.isIdempotent=!1}return t.prototype.applyToLocalView=function(t){if(t instanceof Oh&&this.operand instanceof Oh){var e=t.internalValue+this.operand.internalValue;return new Oh(e)}return t instanceof Rh?(e=t.internalValue+this.operand.internalValue,new xh(e)):this.operand},t.prototype.applyToRemoteDocument=function(t,e){return wc(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function Nl(t){return t instanceof Bh?t.internalValue.slice():[]}var Al,kl,Dl=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function Rl(t){switch(t){case Sc.OK:return bc("Treated status OK as error");case Sc.CANCELLED:case Sc.UNKNOWN:case Sc.DEADLINE_EXCEEDED:case Sc.RESOURCE_EXHAUSTED:case Sc.INTERNAL:case Sc.UNAVAILABLE:case Sc.UNAUTHENTICATED:return!1;case Sc.INVALID_ARGUMENT:case Sc.NOT_FOUND:case Sc.ALREADY_EXISTS:case Sc.PERMISSION_DENIED:case Sc.FAILED_PRECONDITION:case Sc.ABORTED:case Sc.OUT_OF_RANGE:case Sc.UNIMPLEMENTED:case Sc.DATA_LOSS:return!0;default:return bc("Unknown status code: "+t)}}function Pl(t){if(void 0===t)return gc("GRPC error has no .code"),Sc.UNKNOWN;switch(t){case Al.OK:return Sc.OK;case Al.CANCELLED:return Sc.CANCELLED;case Al.UNKNOWN:return Sc.UNKNOWN;case Al.DEADLINE_EXCEEDED:return Sc.DEADLINE_EXCEEDED;case Al.RESOURCE_EXHAUSTED:return Sc.RESOURCE_EXHAUSTED;case Al.INTERNAL:return Sc.INTERNAL;case Al.UNAVAILABLE:return Sc.UNAVAILABLE;case Al.UNAUTHENTICATED:return Sc.UNAUTHENTICATED;case Al.INVALID_ARGUMENT:return Sc.INVALID_ARGUMENT;case Al.NOT_FOUND:return Sc.NOT_FOUND;case Al.ALREADY_EXISTS:return Sc.ALREADY_EXISTS;case Al.PERMISSION_DENIED:return Sc.PERMISSION_DENIED;case Al.FAILED_PRECONDITION:return Sc.FAILED_PRECONDITION;case Al.ABORTED:return Sc.ABORTED;case Al.OUT_OF_RANGE:return Sc.OUT_OF_RANGE;case Al.UNIMPLEMENTED:return Sc.UNIMPLEMENTED;case Al.DATA_LOSS:return Sc.DATA_LOSS;default:return bc("Unknown status code: "+t)}}(kl=Al||(Al={}))[kl.OK=0]="OK",kl[kl.CANCELLED=1]="CANCELLED",kl[kl.UNKNOWN=2]="UNKNOWN",kl[kl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kl[kl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kl[kl.NOT_FOUND=5]="NOT_FOUND",kl[kl.ALREADY_EXISTS=6]="ALREADY_EXISTS",kl[kl.PERMISSION_DENIED=7]="PERMISSION_DENIED",kl[kl.UNAUTHENTICATED=16]="UNAUTHENTICATED",kl[kl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kl[kl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kl[kl.ABORTED=10]="ABORTED",kl[kl.OUT_OF_RANGE=11]="OUT_OF_RANGE",kl[kl.UNIMPLEMENTED=12]="UNIMPLEMENTED",kl[kl.INTERNAL=13]="INTERNAL",kl[kl.UNAVAILABLE=14]="UNAVAILABLE",kl[kl.DATA_LOSS=15]="DATA_LOSS";var Ol=new Th(gh.comparator);function xl(){return Ol}function Ll(){return xl()}var Ml=new Th(gh.comparator);function Fl(){return Ml}var Ul=new Th(gh.comparator);function ql(){return Ul}var Vl=new fl(gh.comparator);function jl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Vl,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Bl=new fl(Jc);function Wl(){return Bl}var Ql,Kl,Hl,Gl,zl=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||gh.comparator(e.key,n.key)}:function(t,e){return gh.comparator(t.key,e.key)},this.keyedMap=Fl(),this.sortedSet=new Th(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();(Kl=Ql||(Ql={}))[Kl.Added=0]="Added",Kl[Kl.Removed=1]="Removed",Kl[Kl.Modified=2]="Modified",Kl[Kl.Metadata=3]="Metadata",(Gl=Hl||(Hl={}))[Gl.Local=0]="Local",Gl[Gl.Synced=1]="Synced";var Yl,Xl,Jl=function(){function t(){this.changeMap=new Th(gh.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Ql.Added&&n.type===Ql.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Ql.Metadata&&n.type!==Ql.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Ql.Modified&&n.type===Ql.Modified?this.changeMap=this.changeMap.insert(e,{type:Ql.Modified,doc:t.doc}):t.type===Ql.Modified&&n.type===Ql.Added?this.changeMap=this.changeMap.insert(e,{type:Ql.Added,doc:t.doc}):t.type===Ql.Removed&&n.type===Ql.Added?this.changeMap=this.changeMap.remove(e):t.type===Ql.Removed&&n.type===Ql.Modified?this.changeMap=this.changeMap.insert(e,{type:Ql.Removed,doc:n.doc}):t.type===Ql.Added&&n.type===Ql.Removed?this.changeMap=this.changeMap.insert(e,{type:Ql.Modified,doc:t.doc}):bc("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),$l=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:Ql.Added,doc:t})}),new t(e,n,zl.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Zl=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=tf.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(ul.MIN,i,Wl(),xl(),jl())},t}(),tf=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Tc(),n,jl(),jl(),jl())},t}(),ef=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},nf=function(t,e){this.targetId=t,this.existenceFilter=e};(Xl=Yl||(Yl={}))[Xl.NoChange=0]="NoChange",Xl[Xl.Added=1]="Added",Xl[Xl.Removed=2]="Removed",Xl[Xl.Current=3]="Current",Xl[Xl.Reset=4]="Reset";var rf=function(t,e,n,r){void 0===n&&(n=Tc()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},of=function(){function t(){this.pendingResponses=0,this.documentChanges=uf(),this._resumeToken=Tc(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=jl(),e=jl(),n=jl();return this.documentChanges.forEach(function(r,i){switch(i){case Ql.Added:t=t.add(r);break;case Ql.Modified:e=e.add(r);break;case Ql.Removed:n=n.add(r);break;default:bc("Encountered invalid change type: "+i)}}),new tf(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=uf()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),af=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=xl(),this.pendingDocumentTargetMapping=sf(),this.pendingTargetResets=new fl(Jc)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof bh?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof wh&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case Yl.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case Yl.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case Yl.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),wc(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case Yl.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case Yl.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:bc("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):kc(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new gh(i.path);this.removeDocumentFromTarget(e,o,new wh(o,ul.forDeletedDoc()))}else wc(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};kc(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new gh(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new wh(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=jl();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===Yh.LimboResolution||(i=!1)}),i&&(r=r.add(t))});var i=new Zl(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=xl(),this.pendingDocumentTargetMapping=sf(),this.pendingTargetResets=new fl(Jc),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Ql.Modified:Ql.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Ql.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new of),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new fl(Jc),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;wc(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new of,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function sf(){return new Th(gh.comparator)}function uf(){return new Th(gh.comparator)}var cf,hf,lf=((cf={})[rl.ASCENDING.name]="ASCENDING",cf[rl.DESCENDING.name]="DESCENDING",cf),ff=((hf={})[Zh.LESS_THAN.name]="LESS_THAN",hf[Zh.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",hf[Zh.GREATER_THAN.name]="GREATER_THAN",hf[Zh.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",hf[Zh.EQUAL.name]="EQUAL",hf[Zh.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",hf),pf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function df(t,e){wc(!Gh(t),e+" is missing")}function yf(t){return"number"==typeof t?t:"string"==typeof t?Number(t):bc("can't parse "+t)}var mf=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Sc.UNKNOWN:Pl(t.code);return new Cc(e,t.message||"")},t.prototype.toInt32Value=function(t){return Gh(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Gh(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);wc(!!t,"Cannot deserialize null or undefined timestamp.");var e=yf(t.seconds||"0"),n=t.nanos||0;return new ch(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=pf.exec(t);if(wc(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new ch(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(wc(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),ah.fromBase64String(t)):(wc(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),ah.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return wc(!!t,"Trying to deserialize version that isn't set"),ul.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=yh.fromString(t);return wc(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return wc(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),wc(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new gh(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?yh.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new yh(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new yh(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return wc(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof kh)return{nullValue:"NULL_VALUE"};if(t instanceof Dh)return{booleanValue:t.value()};if(t instanceof Oh)return{integerValue:""+t.value()};if(t instanceof xh){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Lh?{stringValue:t.value()}:t instanceof jh?{mapValue:this.toMapValue(t)}:t instanceof Bh?{arrayValue:this.toArrayValue(t)}:t instanceof Mh?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Vh?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Uh?{bytesValue:this.toBytes(t.value())}:t instanceof qh?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:bc("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(vf(t,n,"nullValue"))return kh.INSTANCE;if(vf(t,n,"booleanValue"))return Dh.of(t.booleanValue);if(vf(t,n,"integerValue"))return new Oh(yf(t.integerValue));if(vf(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return xh.NAN;if("Infinity"===t.doubleValue)return xh.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return xh.NEGATIVE_INFINITY}return new xh(t.doubleValue)}if(vf(t,n,"stringValue"))return new Lh(t.stringValue);if(vf(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(vf(t,n,"arrayValue")){df(t.arrayValue,"arrayValue");var r=t.arrayValue.values||[];return new Bh(r.map(function(t){return e.fromValue(t)}))}if(vf(t,n,"timestampValue"))return df(t.timestampValue,"timestampValue"),new Mh(this.fromTimestamp(t.timestampValue));if(vf(t,n,"geoPointValue")){df(t.geoPointValue,"geoPointValue");var i=t.geoPointValue.latitude||0,o=t.geoPointValue.longitude||0;return new Vh(new uh(i,o))}if(vf(t,n,"bytesValue")){df(t.bytesValue,"bytesValue");var a=this.fromBlob(t.bytesValue);return new Uh(a)}if(vf(t,n,"referenceValue")){df(t.referenceValue,"referenceValue");var s=this.fromResourceName(t.referenceValue),u=new fh(s.get(1),s.get(3)),c=new gh(this.extractLocalPathFromResourceName(s));return new qh(u,c)}return bc("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return wc(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new bh(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=jh.EMPTY;return Dc(n,function(t,n){r=r.set(new vh([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){wc(!!t.found,"Tried to deserialize a found document from a missing document."),df(t.found.name,"doc.found.name"),df(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new bh(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){wc(!!t.missing,"Tried to deserialize a missing document from a found document."),wc(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new wh(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return vf(t,e,"found")?this.fromFound(t):vf(t,e,"missing")?this.fromMissing(t):bc("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case Yl.Added:return"ADD";case Yl.Current:return"CURRENT";case Yl.NoChange:return"NO_CHANGE";case Yl.Removed:return"REMOVE";case Yl.Reset:return"RESET";default:return bc("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof nf)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof ef){if(t.newDoc instanceof bh){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof wh)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof rf){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Al.OK;switch(t){case Sc.OK:return Al.OK;case Sc.CANCELLED:return Al.CANCELLED;case Sc.UNKNOWN:return Al.UNKNOWN;case Sc.DEADLINE_EXCEEDED:return Al.DEADLINE_EXCEEDED;case Sc.RESOURCE_EXHAUSTED:return Al.RESOURCE_EXHAUSTED;case Sc.INTERNAL:return Al.INTERNAL;case Sc.UNAVAILABLE:return Al.UNAVAILABLE;case Sc.UNAUTHENTICATED:return Al.UNAUTHENTICATED;case Sc.INVALID_ARGUMENT:return Al.INVALID_ARGUMENT;case Sc.NOT_FOUND:return Al.NOT_FOUND;case Sc.ALREADY_EXISTS:return Al.ALREADY_EXISTS;case Sc.PERMISSION_DENIED:return Al.PERMISSION_DENIED;case Sc.FAILED_PRECONDITION:return Al.FAILED_PRECONDITION;case Sc.ABORTED:return Al.ABORTED;case Sc.OUT_OF_RANGE:return Al.OUT_OF_RANGE;case Sc.UNIMPLEMENTED:return Al.UNIMPLEMENTED;case Sc.DATA_LOSS:return Al.DATA_LOSS;default:return bc("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return bc("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(vf(t,n,"targetChange")){df(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new rf(r,i,o,s||null)}else if(vf(t,n,"documentChange")){df(t.documentChange,"documentChange"),df(t.documentChange.document,"documentChange.name"),df(t.documentChange.document.name,"documentChange.document.name"),df(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),f=new bh(c,h,l,{},u.document),p=u.targetIds||[],d=u.removedTargetIds||[];e=new ef(p,d,f.key,f)}else if(vf(t,n,"documentDelete")){df(t.documentDelete,"documentDelete"),df(t.documentDelete.document,"documentDelete.document");var y=t.documentDelete;c=this.fromName(y.document),h=y.readTime?this.fromVersion(y.readTime):ul.forDeletedDoc(),f=new wh(c,h),d=y.removedTargetIds||[],e=new ef([],d,f.key,f)}else if(vf(t,n,"documentRemove")){df(t.documentRemove,"documentRemove"),df(t.documentRemove.document,"documentRemove");var m=t.documentRemove;c=this.fromName(m.document),d=m.removedTargetIds||[],e=new ef([],d,c,null)}else{if(!vf(t,n,"filter"))return bc("Unknown change type "+JSON.stringify(t));df(t.filter,"filter"),df(t.filter.targetId,"filter.targetId");var v=t.filter,g=v.count||0,_=new Dl(g),b=v.targetId;e=new nf(b,_)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Yl.NoChange:"ADD"===t?Yl.Added:"REMOVE"===t?Yl.Removed:"CURRENT"===t?Yl.Current:"RESET"===t?Yl.Reset:bc("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!vf(t,t.response_type,"targetChange"))return ul.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?ul.MIN:e.readTime?this.fromVersion(e.readTime):ul.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof _l)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof El)e={delete:this.toName(t.key)};else if(t instanceof bl)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof wl))return bc("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):vl.NONE;if(t.update){df(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new bl(r,i,o,n)}return new _l(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new El(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return wc(!0===n.exists,'Transforms only support precondition "exists == true"'),new wl(r,a)}return bc("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return wc(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:bc("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?vl.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?vl.exists(t.exists):vl.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new ml(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(wc(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Tl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Sl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Cl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Il)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw bc("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(vf(t,n,"setToServerValue"))wc("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=Tl.instance;else if(vf(t,n,"appendMissingElements")){var i=t.appendMissingElements.values||[];r=new Sl(i.map(function(t){return e.fromValue(t)}))}else if(vf(t,n,"removeAllFromArray"))i=t.removeAllFromArray.values||[],r=new Cl(i.map(function(t){return e.fromValue(t)}));else if(vf(t,n,"increment")){var o=this.fromValue(t.increment);wc(o instanceof Rh,"NUMERIC_ADD transform requires a NumberValue"),r=new Il(o)}else bc("Unknown transform proto: "+JSON.stringify(t));var a=vh.fromServerFormat(t.fieldPath);return new yl(a,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;wc(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Jh.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(wc(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(wc(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){wc(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Jh(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case Yh.Listen:return null;case Yh.ExistenceFilterMismatch:return"existence-filter-mismatch";case Yh.LimboResolution:return"limbo-document";default:return bc("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof tl?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):bc("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new il(r,n)},t.prototype.toDirection=function(t){return lf[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return rl.ASCENDING;case"DESCENDING":return rl.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return ff[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Zh.EQUAL;case"GREATER_THAN":return Zh.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Zh.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Zh.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Zh.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Zh.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return bc("Unspecified relation");default:return bc("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return vh.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new ol(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof tl?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:bc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new tl(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof nl?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof el?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:bc("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new nl(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new el(n);case"OPERATOR_UNSPECIFIED":return bc("Unspecified filter");default:return bc("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return vh.fromServerFormat(t)});return dl.fromArray(e)},t}();function vf(t,e,n){return e===n||!e&&n in t}var gf=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){wc(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){wc(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){wc(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){wc(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){wc(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){wc(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),_f="Connection",bf={BatchGetDocuments:"batchGet",Commit:"commit"},wf="gl-js/ fire/"+pc,Ef=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=wf},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new fc;s.listenOnce(hc.COMPLETE,function(){try{switch(s.getLastErrorCode()){case cc.NO_ERROR:var e=s.getResponseJson();vc(_f,"XHR received:",JSON.stringify(e)),o(e);break;case cc.TIMEOUT:vc(_f,'RPC "'+t+'" timed out'),a(new Cc(Sc.DEADLINE_EXCEEDED,"Request time out"));break;case cc.HTTP_ERROR:var n=s.getStatus();vc(_f,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),0<n?a(new Cc(function(t){switch(t){case 200:return Sc.OK;case 400:return Sc.INVALID_ARGUMENT;case 401:return Sc.UNAUTHENTICATED;case 403:return Sc.PERMISSION_DENIED;case 404:return Sc.NOT_FOUND;case 409:return Sc.ABORTED;case 416:return Sc.OUT_OF_RANGE;case 429:return Sc.RESOURCE_EXHAUSTED;case 499:return Sc.CANCELLED;case 500:return Sc.UNKNOWN;case 501:return Sc.UNIMPLEMENTED;case 503:return Sc.UNAVAILABLE;case 504:return Sc.DEADLINE_EXCEEDED;default:return 200<=t&&t<300?Sc.OK:400<=t&&t<500?Sc.FAILED_PRECONDITION:500<=t&&t<600?Sc.INTERNAL:Sc.UNKNOWN}}(n),"Server responded with status "+s.getStatusText())):(vc(_f,'RPC "'+t+'" failed'),a(new Cc(Sc.UNAVAILABLE,"Connection failed.")));break;default:bc('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{vc(_f,'RPC "'+t+'" completed.')}});var u=JSON.stringify(e);vc(_f,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=uc(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5}};this.modifyHeadersForRequest(i.initMessageHeaders,e),_n()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");vc(_f,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),s=!1,u=!1,c=new gf({sendFn:function(t){u?vc(_f,"Not sending because WebChannel is closed:",t):(s||(vc(_f,"Opening WebChannel transport."),a.open(),s=!0),vc(_f,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),h=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(lc.EventType.OPEN,function(){u||vc(_f,"WebChannel transport opened.")}),h(lc.EventType.CLOSE,function(){u||(u=!0,vc(_f,"WebChannel transport closed"),c.callOnClose())}),h(lc.EventType.ERROR,function(t){u||(u=!0,vc(_f,"WebChannel transport errored:",t),c.callOnClose(new Cc(Sc.UNAVAILABLE,"The operation could not be completed")))}),h(lc.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];wc(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){vc(_f,"WebChannel received error:",n);var r=n.status,i=function(){var t=Al[r];if(void 0!==t)return Pl(t)}(),o=n.message;void 0===i&&(i=Sc.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new Cc(i,o)),a.close()}else vc(_f,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=bf[t];wc(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),Tf=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Ef(t))},t.prototype.newSerializer=function(t){return new mf(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();Ec.setPlatform(new Tf);var Sf,Cf,If=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Nf=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})};(Cf=Sf||(Sf={})).All="all",Cf.ListenStreamIdle="listen_stream_idle",Cf.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Cf.WriteStreamIdle="write_stream_idle",Cf.WriteStreamConnectionBackoff="write_stream_connection_backoff",Cf.OnlineStateTimeout="online_state_timeout",Cf.ClientMetadataRefresh="client_metadata_refresh",Cf.LruGarbageCollection="lru_garbage_collection";var Af=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Nf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Cc(Sc.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),kf=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw gc("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),wc(0<=e,"Attempted to schedule an operation with a negative delay of "+e),wc(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Af.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&bc("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){wc(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){wc(t===Sf.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Sf.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);wc(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Df="\x01",Rf="\x01",Pf="\x10",Of="\x11";function xf(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Mf(e)),e=Lf(t.get(n),e);return Mf(e)}function Lf(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Df+Pf;break;case Df:n+=Df+Of;break;default:n+=o}}return n}function Mf(t){return t+Df+Rf}function Ff(t){var e=t.length;if(wc(2<=e,"Invalid path "+t),2===e)return wc(t.charAt(0)===Df&&t.charAt(1)===Rf,"Non-empty path "+t+" had length 2"),yh.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Df,o);switch((a<0||n<a)&&bc('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Rf:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Pf:i+=t.substring(o,a),i+="\0";break;case Of:i+=t.substring(o,a+1);break;default:bc('Invalid encoded resource path: "'+t+'"')}o=a+2}return new yh(r)}var Uf,qf,Vf=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,wc(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&wc(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;wc(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&wc(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},jl())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&$c(this.mutations,t.mutations)&&$c(this.baseMutations,t.baseMutations)},t}(),jf=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){wc(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=ql(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),Bf=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&bc("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Wf=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return wc(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gf(t).iterate({index:Cp.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=Hf(n),Yf(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=Hf(e),Yf(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=zf(t),a=Gf(t);return a.add({}).next(function(s){wc("number"==typeof s,"Auto-generated key is not a number");var u=new Vf(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=Ip.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,Ip.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return Bf.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Gf(t).get(e).next(function(t){return t?(wc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Bf.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this;return this.getMutationQueueMetadata(t).next(function(){var r=e+1,i=IDBKeyRange.lowerBound([n.userId,r]),o=null;return Gf(t).iterate({index:Cp.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(wc(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gf(t).loadAll(Cp.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Ip.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return zf(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=Ff(u);if(s===n.userId&&e.path.isEqual(h))return Gf(t).get(c).next(function(t){if(!t)throw bc("Dangling document-mutation reference found: "+r+" which points to "+c);wc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new fl(Jc),i=[];return e.forEach(function(e){var o=Ip.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=zf(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=Ff(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),Bf.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;wc(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),wc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Ip.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new fl(Jc);return zf(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=Ff(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Gf(t).get(e).next(function(t){if(null===t)throw bc("Dangling document-mutation reference found, which points to "+e);wc(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Bf.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Kf(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),Bf.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Bf.resolve();var r=IDBKeyRange.lowerBound(Ip.prefixForUser(e.userId)),i=[];return zf(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=Ff(t[1]);i.push(o)}else r.done()}).next(function(){wc(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return Qf(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Yf(t).get(this.userId).next(function(t){return t||new Sp(e.userId,-1,"")})},t}();function Qf(t,e,n){var r=Ip.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return zf(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function Kf(t,e,n){var r=t.store(Cp.store),i=t.store(Ip.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){wc(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Ip.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Bf.waitFor(o).next(function(){return c})}function Hf(t){return t instanceof Uint8Array?(wc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Gf(t){return $p.getStore(t,Cp.store)}function zf(t){return $p.getStore(t,Ip.store)}function Yf(t){return $p.getStore(t,Sp.store)}(qf=Uf||(Uf={}))[qf.QueryCache=0]="QueryCache",qf[qf.SyncEngine=1]="SyncEngine";var Xf=function(){function t(t,e){wc((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},t.prototype.after=function(t){return this.seek(t+2),this.next()},t.prototype.seek=function(t){wc((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(Uf.QueryCache,2)},t.forSyncEngine=function(){return new t(Uf.SyncEngine)},t}(),Jf="SimpleDb",$f=function(){function t(t){this.db=t}return t.openOrCreate=function(e,n,r){return wc(t.isAvailable(),"IndexedDB not supported in current environment."),vc(Jf,"Opening database:",e),new Bf(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new Cc(Sc.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new Cc(Sc.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){vc(Jf,'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new tp(a.transaction);r.createOrUpgrade(n,i,t.oldVersion,bp).next(function(){vc(Jf,"Database upgrade to version "+bp+" complete")})}}).toPromise()},t.delete=function(t){return vc(Jf,"Removing database:",t),np(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=window.navigator.userAgent;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/"))},t.getStore=function(t,e){return t.store(e)},t.prototype.runTransaction=function(t,e,n){var r=tp.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Bf.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),Zf=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return np(this.dbCursor.delete())},t}(),tp=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Nf,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(vc(Jf,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return wc(!!e,"Object store not part of transaction: "+t),new ep(e)},t}(),ep=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){return np(void 0!==e?(vc(Jf,"PUT",this.store.name,t,e),this.store.put(e,t)):(vc(Jf,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},t.prototype.add=function(t){return vc(Jf,"ADD",this.store.name,t,t),np(this.store.add(t))},t.prototype.get=function(t){var e=this;return np(this.store.get(t)).next(function(n){return void 0===n&&(n=null),vc(Jf,"GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return vc(Jf,"DELETE",this.store.name,t),np(this.store.delete(t))},t.prototype.count=function(){return vc(Jf,"COUNT",this.store.name),np(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){vc(Jf,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new Bf(function(n,r){e.onerror=function(t){r(t.target.error)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new Bf(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Zf(i),a=e(i.primaryKey,i.value,o);if(a instanceof Bf){var s=a.catch(function(t){return o.done(),Bf.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return Bf.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(wc(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function np(t){return new Bf(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){n(t.target.error)}})}var rp=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Xf.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return ul.fromTimestamp(new ch(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return ap(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return ip(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return wc(0<e.targetCount,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return ip(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return Bf.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return ip(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return op(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,$p.getStore(n,Op.store)).put(Op.key,e);var n},t.prototype.saveQueryData=function(t,e){return ip(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return ip(t).iterate({range:i,index:Rp.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=sp(t);return e.forEach(function(e){var a=xf(e.path);i.push(o.put(new Pp(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),Bf.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=sp(t);return Bf.forEach(e,function(e){var o=xf(e.path);return Bf.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=sp(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=sp(t),i=jl();return r.iterate({range:n,keysOnly:!0},function(t){var e=Ff(t[1]),n=new gh(e);i=i.add(n)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=xf(e.path),r=IDBKeyRange.bound([n],[Zc(n)],!1,!0),i=0;return sp(t).iterate({index:Pp.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return ip(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function ip(t){return $p.getStore(t,Rp.store)}function op(t){return $f.getStore(t,Op.store).get(Op.key).next(function(t){return wc(null!==t,"Missing metadata row."),t})}function ap(t){return op(t).next(function(t){return t.highestListenSequenceNumber})}function sp(t){return $p.getStore(t,Pp.store)}var up=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Dc(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return Rc(this.inner)},t}(),cp=function(){function t(){this.changes=xl(),this.documentSizes=new up(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?Bf.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return wc(null!==this.changes,"Changes have already been applied."),this.changes},t}(),hp="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",lp=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=$f.getStore(t,Mp.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=dp(t),o=jl(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(mp(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(yp(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return Bf.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=dp(t),r=mp(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return vp(t)}):Bf.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return dp(t).get(mp(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return dp(t).get(mp(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:vp(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Ll();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ll(),i=new Th(gh.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,vp(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Bf.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return dp(t).iterate({range:r},function(t,e,r){for(var a=gh.fromSegments(t);o&&gh.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;wc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Fl(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return dp(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof bh&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;wc(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=jl(),r=xl(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=yp(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return Bf.reject(new Cc(Sc.DATA_LOSS,hp))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new wh(n,ul.forDeletedDoc());r=r.insert(n,e)}))}),Bf.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return yp(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new pp(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return fp(t).get(Dp.key).next(function(t){return wc(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return fp(t).put(Dp.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function fp(t){return $p.getStore(t,Dp.store)}var pp=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return rn(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),a=e.documentSizes.get(t);wc(void 0!==a,"Attempting to change document "+t.toString()+" without having read it first");var s=vp(o);r+=s-a,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(cp);function dp(t){return $p.getStore(t,kp.store)}function yp(t){return $p.getStore(t,Mp.store)}function mp(t){return t.path.toArray()}function vp(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw bc("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var gp=function(){function t(){this.collectionParentIndex=new _p}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Bf.resolve()},t.prototype.getCollectionParents=function(t,e){return Bf.resolve(this.collectionParentIndex.getEntries(e))},t}(),_p=function(){function t(){this.index={}}return t.prototype.add=function(t){wc(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new fl(yh.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new fl(yh.comparator)).toArray()},t}(),bp=8,wp=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i,o=this;wc(n<r&&0<=n&&r<=bp,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&1<=r&&(t.createObjectStore(Tp.store),(i=t).createObjectStore(Sp.store,{keyPath:Sp.keyPath}),i.createObjectStore(Cp.store,{keyPath:Cp.keyPath,autoIncrement:!0}).createIndex(Cp.userMutationsIndex,Cp.userMutationsKeyPath,{unique:!0}),i.createObjectStore(Ip.store),Lp(t),t.createObjectStore(kp.store));var a,s=Bf.resolve();return n<3&&3<=r&&(0!==n&&((a=t).deleteObjectStore(Pp.store),a.deleteObjectStore(Rp.store),a.deleteObjectStore(Op.store),Lp(t)),s=s.next(function(){return t=e.store(Op.store),n=new Op(0,0,ul.MIN.toTimestamp(),0),t.put(Op.key,n);var t,n})),n<4&&4<=r&&(0!==n&&(s=s.next(function(){return n=t,(r=e).store(Cp.store).loadAll().next(function(t){n.deleteObjectStore(Cp.store),n.createObjectStore(Cp.store,{keyPath:Cp.keyPath,autoIncrement:!0}).createIndex(Cp.userMutationsIndex,Cp.userMutationsKeyPath,{unique:!0});var e=r.store(Cp.store),i=t.map(function(t){return e.put(t)});return Bf.waitFor(i)});var n,r})),s=s.next(function(){t.createObjectStore(Fp.store,{keyPath:Fp.keyPath}),t.createObjectStore(Mp.store,{keyPath:"id",autoIncrement:!0})})),n<5&&5<=r&&(s=s.next(function(){return o.removeAcknowledgedMutations(e)})),n<6&&6<=r&&(s=s.next(function(){return t.createObjectStore(Dp.store),o.addDocumentGlobal(e)})),n<7&&7<=r&&(s=s.next(function(){return o.ensureSequenceNumbers(e)})),n<8&&8<=r&&(s=s.next(function(){return o.createCollectionParentIndex(t,e)})),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(kp.store).iterate(function(t,n){e+=vp(n)}).next(function(){var n=new Dp(e);return t.store(Dp.store).put(Dp.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Sp.store),r=t.store(Cp.store);return n.loadAll().next(function(n){return Bf.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(Cp.userMutationsIndex,i).next(function(r){return Bf.forEach(r,function(r){wc(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Kf(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Pp.store),n=t.store(kp.store);return ap(t).next(function(t){var r=[];return n.iterate(function(n){var i=new yh(n),o=[0,xf(i)];r.push(e.get(o).next(function(n){return n?Bf.resolve():(r=i,e.put(new Pp(0,xf(r),t)));var r}))}).next(function(){return Bf.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(xp.store,{keyPath:xp.keyPath});var n=e.store(xp.store),r=new _p,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:xf(i)})}};return e.store(kp.store).iterate({keysOnly:!0},function(t){var e=new yh(t);return i(e.popLast())}).next(function(){return e.store(Ip.store).iterate({keysOnly:!0},function(t){t[0];var e=t[1],n=(t[2],Ff(e));return i(n.popLast())})})},t}(),Ep=function(t,e){this.seconds=t,this.nanoseconds=e},Tp=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}(),Sp=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),Cp=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}(),Ip=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,xf(e)]},t.key=function(t,e,n){return[t,xf(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}(),Np=function(t,e){this.path=t,this.readTime=e},Ap=function(t,e){this.path=t,this.version=e},kp=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),Dp=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}(),Rp=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Pp=function(){function t(t,e,n){this.targetId=t,this.path=e,wc(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Op=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),xp=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function Lp(t){t.createObjectStore(Pp.store,{keyPath:Pp.keyPath}).createIndex(Pp.documentTargetsIndex,Pp.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Rp.store,{keyPath:Rp.keyPath}).createIndex(Rp.queryTargetsIndexName,Rp.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Op.store)}var Mp=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}(),Fp=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}(),Up=[Sp.store,Cp.store,Ip.store,kp.store,Rp.store,Tp.store,Op.store,Pp.store].concat([Fp.store,Mp.store]).concat([Dp.store]).concat([xp.store]),qp=function(){function t(){this.collectionParentsCache=new _p}return t.prototype.addToCollectionParentIndex=function(t,e){if(wc(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){wc(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Vp(t).put({collectionId:n,parent:xf(r)})}return Bf.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Zc(e),""],!1,!0);return Vp(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Ff(o.parent))}return n})},t}();function Vp(t){return $p.getStore(t,xp.store)}var jp=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=gh.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new wh(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=gh.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new Eh(e,n)):bc("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof bh){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new kp(null,null,e,n)}if(t instanceof wh){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return n=t.hasCommittedMutations,new kp(null,new Np(r,i),null,n)}return t instanceof Eh?(r=t.key.path.toArray(),i=this.toDbTimestamp(t.version),new kp(new Ap(r,i),null,null,!0)):bc("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Ep(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new ch(t.seconds,t.nanoseconds);return ul.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Cp(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=ch.fromMillis(t.localWriteTimeMs);return new Vf(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(xf(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=jl(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new gh(Ff(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new ll(e,t.targetId,Yh.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){wc(Yh.Listen===t.purpose,"Only queries with purpose "+Yh.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(wc("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Rp(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Bp(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Jc(n,i);return 0===a?Jc(r,o):a}var Wp=function(){function t(t){this.maxElements=t,this.buffer=new fl(Bp),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Bp(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Qp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kp=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Hp=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){wc(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Kp.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;wc(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;vc("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Sf.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Zp)})},t}(),Gp=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Bf.resolve(If.INVALID);var r=new Wp(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Kp.COLLECTION_DISABLED?(vc("LruGarbageCollector","Garbage collection skipped; disabled"),Bf.resolve(Qp)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(vc("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Qp):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c,h=this;return o=Date.now(),this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return r=e>h.params.maximumSequenceNumbersToCollect?(vc("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),h.params.maximumSequenceNumbersToCollect):e,a=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),yc()<=oc.DEBUG&&vc("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-o)+"ms\n\tDetermined least recently used "+r+" in "+(s-a)+"ms\n\tRemoved "+i+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-o)+"ms"),Bf.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),zp="IndexedDbPersistence",Yp="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Xp="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",Jp=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return rn(e,t),e}(function(){}),$p=function(){function e(t,n,r,i,o,a,s){if(this.persistenceKey=t,this.clientId=n,this.queue=i,this.multiClientParams=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(){return Promise.resolve()},!e.isAvailable())throw new Cc(Sc.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new nd(this,a),this.dbName=t+e.MAIN_DATABASE,this.serializer=new jp(o),this.document=r.document,this.allowTabSynchronization=void 0!==s,this.queryCache=new rp(this.referenceDelegate,this.serializer),this.indexManager=new qp,this.remoteDocumentCache=new lp(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new Cc(Sc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return e.getStore=function(t,e){if(t instanceof Jp)return $f.getStore(t.simpleDbTransaction,e);throw bc("IndexedDbPersistence must use instances of IndexedDbTransaction")},e.createIndexedDbPersistence=function(t,n,r,i,o,a){return an(this,void 0,void 0,function(){var s;return sn(this,function(u){switch(u.label){case 0:return[4,(s=new e(t,n,r,i,o,a)).start()];case 1:return u.sent(),[2,s]}})})},e.createMultiClientIndexedDbPersistence=function(t,n,r,i,o,a,s){return an(this,void 0,void 0,function(){var u;return sn(this,function(c){switch(c.label){case 0:return[4,(u=new e(t,n,r,i,o,a,s)).start()];case 1:return c.sent(),[2,u]}})})},e.prototype.start=function(){var t=this;return wc(!this.started,"IndexedDbPersistence double-started!"),wc(null!==this.window,"Expected 'window' to be defined"),$f.openOrCreate(this.dbName,bp,new wp(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[Op.store],function(e){return ap(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new If(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},e.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",Up,function(e){return t.remoteDocumentCache.start(e)})},e.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return an(e,void 0,void 0,function(){return sn(this,function(){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},e.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return an(e,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},e.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",Up,function(e){return ed(e).put(new Fp(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},e.prototype.verifyPrimaryLease=function(t){var e=this;return td(t).get(Tp.key).next(function(t){return Bf.resolve(e.isLocalClient(t))})},e.prototype.removeClientMetadata=function(t){return ed(t).delete(this.clientId)},e.prototype.maybeGarbageCollectMultiClientState=function(){return an(this,void 0,void 0,function(){var t,n,r=this;return sn(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=e.getStore(i,Fp.store);return o.loadAll().next(function(e){t=r.filterActiveClients(e,18e5),n=e.filter(function(e){return-1===t.indexOf(e)})}).next(function(){return Bf.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if(0<(t=t.filter(function(t){return t.clientId!==r.clientId})).length){var e=t.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,e);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},e.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Sf.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},e.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.canActAsPrimary=function(t){var e=this;return td(t).get(Tp.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new Cc(Sc.FAILED_PRECONDITION,Xp);return!1}}return!(!e.networkEnabled||!e.inForeground)||ed(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&vc(zp,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},e.prototype.shutdown=function(t){return an(this,void 0,void 0,function(){var e=this;return sn(this,function(n){switch(n.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[Tp.store,Fp.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return n.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),t?[4,$f.delete(this.dbName)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},e.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[Fp.store],function(e){return ed(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),e.prototype.getMutationQueue=function(t){return wc(this.started,"Cannot initialize MutationQueue before persistence is started."),Wf.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},e.prototype.getQueryCache=function(){return wc(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},e.prototype.getRemoteDocumentCache=function(){return wc(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},e.prototype.getIndexManager=function(){return wc(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},e.prototype.runTransaction=function(t,e,n){var r=this;return vc(zp,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",Up,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw gc("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new Cc(Sc.FAILED_PRECONDITION,Yp);return n(new Jp(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Jp(i,r.listenSequence.next()))})})},e.prototype.verifyAllowTabSynchronization=function(t){var e=this;return td(t).get(Tp.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Cc(Sc.FAILED_PRECONDITION,Xp)})},e.prototype.acquireOrExtendPrimaryLease=function(t){var e=new Tp(this.clientId,this.allowTabSynchronization,Date.now());return td(t).put(Tp.key,e)},e.isAvailable=function(){return $f.isAvailable()},e.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},e.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=td(t);return n.get(Tp.key).next(function(t){return e.isLocalClient(t)?(vc(zp,"Releasing primary lease."),n.delete(Tp.key)):Bf.resolve()})},e.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(gc("Detected an update time that is in the future: "+t+" > "+n),1))},e.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},e.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(wc(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},e.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},e.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(wc("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},e.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return vc(zp,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return gc(zp,"Failed to get zombied client id.",t),!1}},e.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){gc("Failed to set zombie client id.",t)}},e.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},e.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e.MAIN_DATABASE="main",e}();function Zp(t){return an(this,void 0,void 0,function(){return sn(this,function(){if((e=t).code!==Sc.FAILED_PRECONDITION||e.message!==Yp)throw t;var e;return vc(zp,"Unexpectedly lost primary lease"),[2]})})}function td(t){return t.store(Tp.store)}function ed(t){return t.store(Fp.store)}var nd=function(){function t(t,e){this.db=t,this.garbageCollector=new Gp(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return rd(t,e)},t.prototype.removeReference=function(t,e){return rd(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return rd(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Bf.resolve(!0):(r=e,i=!1,Yf(n=t).iterateSerial(function(t){return Qf(n,t,r).next(function(t){return t&&(i=!0),Bf.resolve(!t)})}).next(function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,a).next(function(t){i+=t})});o.push(u)}}).next(function(){return Bf.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return Bf.waitFor([sp(t).delete((n=e,[0,xf(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return rd(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=sp(t),i=If.INVALID;return r.iterate({index:Pp.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==If.INVALID&&e(new gh(Ff(n)),i),i=s,n=a):i=If.INVALID}).next(function(){i!==If.INVALID&&e(new gh(Ff(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function rd(t,e){return sp(t).put((n=e,r=t.currentSequenceNumber,new Pp(0,xf(n.path),r)));var n,r}var id,od,ad=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Ll();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=xl();return i.forEach(function(t,e){e||(e=new wh(t,ul.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new gh(e)).next(function(t){var e=Fl();return t instanceof bh&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;wc(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Fl();return this.indexManager.getCollectionParents(t,r).next(function(o){return Bf.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(i){return n=i,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key;if(e.path.isImmediateParentOf(c.path)){var h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof bh?n.insert(c,l):n.remove(c)}}}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t}(),sd=function(){function t(){this.refsByKey=new fl(ud.compareByKey),this.refsByTarget=new fl(ud.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new ud(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new ud(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=gh.EMPTY,r=new ud(n,t),i=new ud(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=gh.EMPTY,n=new ud(e,t),r=new ud(e,t+1),i=jl();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new ud(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),ud=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return gh.comparator(t.key,e.key)||Jc(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Jc(t.targetOrBatchId,e.targetOrBatchId)||gh.comparator(t.key,e.key)},t}(),cd=function(){function t(t,e){this.persistence=t,this.localViewReferences=new sd,this.queryDataByTarget={},wc(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new ad(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new ad(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=jl(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],o.push(c.batchId);for(var y=0,m=c.mutations;y<m.length;y++)f=m[y],a=a.add(f.key)}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=ch.now(),r=t.reduce(function(t,e){return t.add(e.key)},jl());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=r.get(u.key);if(!u.isIdempotent){var h=u.fieldMask;if(h){var l=c instanceof bh?h.applyTo(c.data):jh.EMPTY;o.push(new bl(u.key,l,h,vl.exists(!0)))}}}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):Bf.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return wc(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],a=jl();kc(e.targetChanges,function(r,s){var u=n.queryDataByTarget[r];if(u){s.addedDocuments.forEach(function(t){a=a.add(t)}),s.modifiedDocuments.forEach(function(t){a=a.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,s.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,s.addedDocuments,r)}));var c=s.resumeToken;if(0<c.length){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,s)&&o.push(n.queryCache.updateQueryData(i,u))}}});var s=xl(),u=jl();e.documentUpdates.forEach(function(t){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(ul.MIN)||a.has(c.key)&&!h.hasPendingWrites||0<=c.version.compareTo(h.version)?(r.addEntry(c),s=s.insert(u,c)):vc("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(ul.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return wc(0<=c.compareTo(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return Bf.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,s)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size)},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Bf.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),Bf.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,Bf.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new ll(t,i,Yh.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return wc(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){wc(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?Bf.resolve():Bf.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Bf.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);wc(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):wc(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),hd=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Tc(),this.batchesByDocumentKey=new fl(ud.compareByKey)}return t.prototype.checkEmpty=function(){return Bf.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");wc(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return wc(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Bf.resolve()},t.prototype.getLastStreamToken=function(){return Bf.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Bf.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){wc(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&wc(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Vf(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new ud(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Bf.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Bf.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return wc(null!=n,"Failed to find local mutation batch."),Bf.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Bf.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(){return Bf.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new ud(e,0),i=new ud(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){wc(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);wc(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),Bf.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new fl(Jc);return e.forEach(function(t){var e=new ud(t,0),i=new ud(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){wc(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),Bf.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){wc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;gh.isDocumentKey(i)||(i=i.child(""));var o=new ud(new gh(i),0),a=new fl(Jc);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Bf.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;wc(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Bf.forEach(e.mutations,function(i){var o=new ud(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(){},t.prototype.containsKey=function(t,e){var n=new ud(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Bf.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(){return 0===this.mutationQueue.length&&wc(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Bf.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return wc(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return wc(n.batchId===t,"If found batch must match"),n},t}(),ld=function(){function t(t){this.persistence=t,this.queries=new up(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=ul.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new sd,this.targetCount=0,this.targetIdGenerator=Xf.forQueryCache()}return t.prototype.getTargetCount=function(){return Bf.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),Bf.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(){return Bf.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(){return Bf.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(){var t=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=t,Bf.resolve(t)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Bf.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return wc(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Bf.resolve()},t.prototype.updateQueryData=function(t,e){return wc(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Bf.resolve()},t.prototype.removeQueryData=function(t,e){return wc(0<this.targetCount,"Removing a target from an empty cache"),wc(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Bf.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),Bf.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(){return Bf.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Bf.resolve(n)},t.prototype.getQueryDataForTarget=function(){return bc("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),Bf.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),Bf.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Bf.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Bf.resolve(n)},t.prototype.containsKey=function(t,e){return Bf.resolve(this.references.containsKey(e))},t}(),fd=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new Th(gh.comparator),this.newDocumentChanges=jl(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,Bf.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,Bf.resolve(n.size)):Bf.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Bf.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return Bf.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ll();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Bf.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ll(),i=new Th(gh.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),Bf.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){wc(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Fl(),r=new gh(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof bh&&e.matches(s)&&(n=n.insert(s.key,s))}return Bf.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return Bf.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(){var t=this,e=xl();return this.newDocumentChanges.forEach(function(n){var r=t.docs.get(n),i=r?r.maybeDocument:new wh(n,ul.forDeletedDoc());e=e.insert(n,i)}),this.newDocumentChanges=jl(),Bf.resolve(e)},t.prototype.newChangeBuffer=function(){return new pd(this.sizer,this)},t.prototype.getSize=function(){return Bf.resolve(this.size)},t}(),pd=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return rn(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);wc(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var a=e.sizer(n);r+=a-o,i.push({maybeDocument:n,size:a})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(cp),dd=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new If(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new ld(this),this.indexManager=new gp,this.remoteDocumentCache=new fd(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new vd(t,new jp(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new md(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new hd(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;vc("MemoryPersistence","Starting transaction:",t);var i=new yd(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return Bf.or((n=this.mutationQueues,r=[],Dc(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),yd=function(t){this.currentSequenceNumber=t},md=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Bf.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Bf.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Bf.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return Bf.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?Bf.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(){return 0},t.prototype.isReferenced=function(t,e){var n=this;return Bf.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Bf.resolve(n.inMemoryPins.containsKey(e))}])},t}(),vd=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new up(function(t){return xf(t.path)}),this.garbageCollector=new Gp(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(){return Bf.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Bf.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?Bf.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?Bf.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Bf.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Bf.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Bf.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Bf.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw bc("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return Bf.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Bf.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Bf.resolve(void 0!==t&&n<t)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),gd=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&vc("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),_d="PersistentStream";(od=id||(id={}))[od.Initial=0]="Initial",od[od.Starting=1]="Starting",od[od.Open=2]="Open",od[od.Error=3]="Error",od[od.Backoff=4]="Backoff";var bd,wd,Ed,Td,Sd=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=id.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new gd(t,e,1e3,1.5,6e4)}return t.prototype.isStarted=function(){return this.state===id.Starting||this.state===id.Open||this.state===id.Backoff},t.prototype.isOpen=function(){return this.state===id.Open},t.prototype.start=function(){this.state!==id.Error?(wc(this.state===id.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(id.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){wc(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=id.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return this.isOpen()?[2,this.close(id.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return an(this,void 0,void 0,function(){return sn(this,function(n){switch(n.label){case 0:return wc(this.isStarted(),"Only started streams should be closed."),wc(t===id.Error||Gh(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==id.Error?this.backoff.reset():e&&e.code===Sc.RESOURCE_EXHAUSTED?(gc(e.toString()),gc("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Sc.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;wc(this.state===id.Initial,"Must be in initial state to auth"),this.state=id.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new Cc(Sc.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;wc(this.state===id.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return wc(e.state===id.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=id.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;wc(this.state===id.Error,"Should only perform backoff when in Error state"),this.state=id.Backoff,this.backoff.backoffAndRun(function(){return an(t,void 0,void 0,function(){return sn(this,function(){return wc(this.state===id.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=id.Initial,this.start(),wc(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return wc(this.isStarted(),"Can't handle server close on non-started stream"),vc(_d,"close with error: "+t),this.stream=null,this.close(id.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(vc(_d,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Cd=function(t){function e(e,n,r,i,o){var a=t.call(this,e,Sf.ListenStreamConnectionBackoff,Sf.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return rn(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Sd),Id=function(t){function e(e,n,r,i,o){var a=t.call(this,e,Sf.WriteStreamConnectionBackoff,Sf.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a}return rn(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(wc(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return wc(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){wc(this.isOpen(),"Writing handshake requires an opened stream"),wc(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;wc(this.isOpen(),"Writing mutations requires an opened stream"),wc(this.handshakeComplete_,"Handshake must be complete before writing mutations"),wc(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(Sd),Nd=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Id(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Cd(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=xl();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);wc(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Sc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Sc.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Ad=function(){function t(t){this.datastore=t,this.readVersions=ql(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof bh)e=t.version;else{if(!(t instanceof wh))throw bc("Document in a transaction was a "+t.constructor.name);e=ul.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Cc(Sc.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):0<this.mutations.length?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof wh||t instanceof bh?e.recordVersion(t):bc("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new Cc(Sc.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?vl.updateTime(e):vl.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(ul.forDeletedDoc()))throw new Cc(Sc.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?vl.updateTime(e):vl.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new El(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,ul.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}();(wd=bd||(bd={}))[wd.Unknown=0]="Unknown",wd[wd.Online=1]="Online",wd[wd.Offline=2]="Offline",(Td=Ed||(Ed={}))[Td.RemoteStore=0]="RemoteStore",Td[Td.SharedClientState=1]="SharedClientState";var kd=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=bd.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(bd.Unknown),wc(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Sf.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,wc(t.state===bd.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(bd.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===bd.Online?(this.setAndBroadcast(bd.Unknown),wc(0===this.watchStreamFailures,"watchStreamFailures must be 0"),wc(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(bd.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===bd.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(gc(e),this.shouldWarnClientIsOffline=!1):vc("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),Dd="RemoteStore",Rd=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new kd(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return an(this,void 0,void 0,function(){var t;return sn(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(bd.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(bd.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(vc(Dd,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return vc(Dd,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(bd.Unknown),[2]}})})},t.prototype.listen=function(t){wc(!Nc(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){wc(Nc(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Rc(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(bd.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){wc(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new af(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Rc(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return an(this,void 0,void 0,function(){var t=this;return sn(this,function(){return kc(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){return void 0===t&&wc(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(bd.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return an(this,void 0,void 0,function(){var n;return sn(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(bd.Online),t instanceof rf&&t.state===Yl.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof ef?this.watchChangeAggregator.handleDocumentChange(t):t instanceof nf?this.watchChangeAggregator.handleExistenceFilter(t):(wc(t instanceof rf,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(ul.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),0<=e.compareTo(n)?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;wc(!t.isEqual(ul.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return kc(n.targetChanges,function(n,r){if(0<r.resumeToken.length){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:Tc()}),e.sendUnwatchRequest(t);var r=new ll(n.query,t,Yh.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;wc(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return an(e,void 0,void 0,function(){return sn(this,function(){return Nc(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return an(this,void 0,void 0,function(){var t,e;return sn(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){wc(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},t.prototype.startWriteStream=function(){wc(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Zp)},t.prototype.onMutationResult=function(t,e){var n=this;wc(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=jf.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return an(this,void 0,void 0,function(){var e=this;return sn(this,function(){return void 0===t&&wc(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},t.prototype.handleHandshakeError=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){return Rl(t.code)?(vc(Dd,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Tc(),[2,this.localStore.setLastStreamToken(Tc()).catch(Zp)]):[2]})})},t.prototype.handleWriteError=function(t){return an(this,void 0,void 0,function(){var e,n=this;return sn(this,function(){return Rl(r=t.code)&&r!==Sc.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var r})})},t.prototype.createTransaction=function(){return new Ad(this.datastore)},t.prototype.handleCredentialChange=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(vc(Dd,"RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(bd.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(t){return an(this,void 0,void 0,function(){return sn(this,function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(bd.Unknown),e.label=4;case 4:return[2]}})})},t}(),Pd=function(){this.listeners=[]},Od=function(){function t(t){this.syncEngine=t,this.queries=new up(function(t){return t.canonicalId()}),this.onlineState=bd.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Pd,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return an(this,void 0,void 0,function(){var e,n,r,i;return sn(this,function(){return e=t.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(t))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(r);o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].applyOnlineStateChange(t)})},t}(),xd=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=bd.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(wc(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Ql.Metadata&&e.push(i)}t=new $l(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(wc(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==bd.Offline;return this.options.waitForSyncWhenOnline&&n?(wc(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===bd.Offline},t.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){wc(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=$l.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),Ld=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=jl(),i=jl(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Ql.Added:r=r.add(s.doc.key);break;case Ql.Removed:i=i.add(s.doc.key)}}return new t(e,r,i)},t}(),Md=function(t){this.key=t},Fd=function(t){this.key=t},Ud=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=jl(),this.mutatedKeys=jl(),this.documentSet=new zl(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new Jl,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof bh?e:null;h&&(wc(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:Ql.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:Ql.Modified,doc:h}),p=!0,u&&0<n.query.docComparator(h,u)&&(s=!0)):!c&&h?(r.track({type:Ql.Added,doc:h}),p=!0):c&&!h&&(r.track({type:Ql.Removed,doc:c}),p=!0,u&&(s=!0)),p&&(o=h?(a=a.add(h),f?o.add(t):o.delete(t)):(a=a.delete(t),o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:Ql.Removed,doc:c})}return wc(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;wc(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return n=t.type,i=e.type,(o=function(t){switch(t){case Ql.Added:return 1;case Ql.Modified:case Ql.Metadata:return 2;case Ql.Removed:return 0;default:return bc("Unknown ChangeType: "+t)}})(n)-o(i)||r.query.docComparator(t.doc,e.doc);var n,i,o}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Hl.Synced:Hl.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new $l(this.query,t.documentSet,i,o,t.mutatedKeys,s===Hl.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===bd.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Jl,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return wc(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=jl(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Fd(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new Md(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=jl();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return $l.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Hl.Local)},t}(),qd="SyncEngine",Vd=function(t,e,n){this.query=t,this.targetId=e,this.view=n},jd=function(t){this.key=t},Bd=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new up(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new Th(gh.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new sd,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Xf.forSyncEngine(),this.isPrimary=void 0,this.onlineState=bd.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){wc(null!==t,"SyncEngine listener cannot be null"),wc(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return an(this,void 0,void 0,function(){var e,n,r,i,o;return sn(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){var n=this,r=t.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(t.targetId).then(function(o){var a=new Ud(r,o),s=a.computeDocChanges(i),u=tf.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&n.onlineState!==bd.Offline),c=a.applyChanges(s,!0===n.isPrimary,u);wc(0===c.limboChanges.length,"View returned limbo docs before target ack from the server."),wc(!!c.snapshot,"applyChanges for new view should always return a snapshot");var h=new Vd(r,t.targetId,a);return n.queryViewsByQuery.set(r,h),n.queryViewsByTarget[t.targetId]=h,c.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){var e=this;return this.localStore.executeQuery(t.query).then(function(n){return e.localStore.remoteDocumentKeys(t.targetId).then(function(r){return an(e,void 0,void 0,function(){var e;return sn(this,function(){return e=t.view.synchronizeWithPersistedState(n,r),this.isPrimary&&this.updateTrackedLimbos(t.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(t){return an(this,void 0,void 0,function(){var e,n=this;return sn(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),wc(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Zp)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(t,e){var n=this;void 0===e&&(e=5),wc(0<=e,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();return function(){try{var e=t(r);return!Gh(e)&&e.catch&&e.then?e.catch(function(t){return Promise.reject(n.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(e){return Promise.reject(n.wrapUpdateFunctionError(e))}}().then(function(i){return r.commit().then(function(){return i}).catch(function(r){return 0===e?Promise.reject(r):n.runTransaction(t,e-1)})})},t.prototype.applyRemoteEvent=function(t){var e=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(t).then(function(n){return Dc(t.targetChanges,function(t,n){var r=e.limboResolutionsByTarget[t];r&&(wc(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<n.addedDocuments.size?r.receivedDocument=!0:0<n.modifiedDocuments.size?wc(r.receivedDocument,"Received change for limbo target document without add."):0<n.removedDocuments.size&&(wc(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),e.emitNewSnapsAndNotifyLocalStore(n,t)}).catch(Zp)},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Ed.RemoteStore||!this.isPrimary&&e===Ed.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);wc(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return an(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return sn(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new Th(gh.comparator)).insert(r,new wh(r,ul.forDeletedDoc())),o=jl().add(r),a=new Zl(ul.MIN,{},new fl(Jc),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return wc(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then(function(){return u.removeAndCleanupQuery(s)}).catch(Zp)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return an(this,void 0,void 0,function(){var r;return sn(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(vc(qd,"Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):bc("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(Zp)},t.prototype.rejectFailedWrite=function(t,e){var n=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.localStore.rejectBatch(t).then(function(r){return n.sharedClientState.updateMutationState(t,"rejected",e),n.emitNewSnapsAndNotifyLocalStore(r)}).catch(Zp)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new Th(Jc)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(wc(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Md?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof Fd?(vc(qd,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):bc("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){vc(qd,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Jh.atPath(e.path);this.limboResolutionsByTarget[n]=new jd(e),this.remoteStore.listen(new ll(r,n,Yh.LimboResolution,If.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return an(this,void 0,void 0,function(){var n,r,i,o=this;return sn(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=Ld.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){wc(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return an(this,void 0,void 0,function(){var e,n;return sn(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return an(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return sn(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),kc(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;kc(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Th(gh.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),r=[],i=[],o=function(t){n=n.then(function(){return an(e,void 0,void 0,function(){var e,n,o,a;return sn(this,function(s){switch(s.label){case 0:return(n=this.queryViewsByTarget[t])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return s.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=s.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(o=s.sent()).snapshot&&i.push(o.snapshot),[3,8];case 4:return wc(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(t)];case 5:return wc(!!(a=s.sent()),"Query data for target "+t+" not found"),[4,this.localStore.allocateQuery(a)];case 6:return e=s.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:s.sent(),s.label=8;case 8:return r.push(e),[2]}})})})},a=0,s=t;a<s.length;a++)o(s[a]);return n.then(function(){return e.syncEngineListener.onWatchChange(i),r})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return an(this,void 0,void 0,function(){var r,i=this;return sn(this,function(o){switch(o.label){case 0:if(this.isPrimary)return vc(qd,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,5];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return an(i,void 0,void 0,function(){var r;return sn(this,function(i){switch(i.label){case 0:return r=Zl.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:return i.sent(),[2]}})})},function(t){return an(i,void 0,void 0,function(){var e;return sn(this,function(n){switch(n.label){case 0:return(r=t).code!==Sc.DATA_LOSS||r.message!==hp?[3,2]:(e=[],kc(this.queryViewsByTarget,function(t){return e.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e)]);case 1:return n.sent(),[3,3];case 2:throw t;case 3:return[2]}var r})})})];case 2:return r=this.queryViewsByTarget[t],this.removeAndCleanupQuery(r),[4,this.localStore.releaseQuery(r.query,!0)];case 3:return o.sent(),this.syncEngineListener.onWatchError(r.query,n),[3,5];case 4:bc("Unexpected target state: "+e),o.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return an(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l=this;return sn(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],wc(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return wc(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return sn(this,function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(Zp)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?jl().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:jl()},t}(),Wd=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Qd="SharedClientState",Kd="firestore_clients",Hd="firestore_mutations",Gd="firestore_targets",zd=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,wc(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new Cc(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(gc(Qd,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Yd=function(){function t(t,e,n){this.targetId=t,this.state=e,wc(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Cc(r.error.code,r.error.message)),i?new t(e,r.state,o):(gc(Qd,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xd=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Wl(),a=0;i&&a<r.activeTargetIds.length;++a)i=zh(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(gc(Qd,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Jd=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&void 0!==bd[n.onlineState]&&"string"==typeof n.clientId?new t(n.clientId,bd[n.onlineState]):(gc(Qd,"Failed to parse online state: "+e),null)},t}(),$d=function(){function t(){this.activeTargetIds=Wl()}return t.prototype.addQueryTarget=function(t){wc(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Zd=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new Cc(Sc.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+r,this.activeClients[this.localClientId]=new $d,this.clientStateKeyRe=new RegExp("^"+Kd+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Hd+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Gd+"_"+a+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return an(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return sn(this,function(f){switch(f.label){case 0:return wc(!this.started,"WebStorageSharedClientState already started"),wc(null!==this.syncEngine,"syncEngine property must be set before calling start()"),wc(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=Xd.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Wl();return Dc(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=Yd.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return vc(Qd,"READ",t,e),e},t.prototype.setItem=function(t,e){vc(Qd,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){vc(Qd,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(vc(Qd,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void gc("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return an(e,void 0,void 0,function(){var e,n,r,i,o,a;return sn(this,function(){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(wc(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=If.INVALID;if(null!=t)try{var n=JSON.parse(t);wc("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){gc(Qd,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==If.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new zd(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:bd[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new Yd(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return wc(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Kd+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return Gd+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Hd+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return wc(null!==n,"Cannot parse client state key '"+t+"'"),Xd.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);wc(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return zd.fromWebStorageEntry(new Wd(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);wc(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Yd.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return Jd.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){return t.user.uid!==this.currentUser.uid?(vc(Qd,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return an(n,void 0,void 0,function(){return sn(this,function(){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return an(n,void 0,void 0,function(){return sn(this,function(){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}(),ty=function(){function t(){this.localState=new $d,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(){},t.prototype.updateMutationState=function(){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new $d,Promise.resolve()},t.prototype.handleUserChange=function(){},t.prototype.setOnlineState=function(){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(){},t}(),ey="FirestoreClient",ny=function(){function t(t,e){this.cacheSizeBytes=t,this.experimentalTabSynchronization=e}return t.prototype.lruParams=function(){return Kp.withCacheSize(this.cacheSizeBytes)},t}(),ry=function(){},iy=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Xc.newId()}return t.prototype.start=function(t){var e=this,n=new Nf,r=new Nf,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ny?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof Cc?t.code===Sc.FAILED_PRECONDITION||t.code===Sc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=$p.buildStoragePrefix(this.databaseInfo),i=new mf(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return an(n,void 0,void 0,function(){var n,o;return sn(this,function(a){switch(a.label){case 0:if(e.experimentalTabSynchronization&&!Zd.isAvailable(this.platform))throw new Cc(Sc.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.experimentalTabSynchronization?(this.sharedClientState=new Zd(this.asyncQueue,this.platform,r,this.clientId,t),[4,$p.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=a.sent(),[3,4];case 2:return this.sharedClientState=new ty,[4,$p.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=a.sent(),a.label=4;case 4:return[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=dd.createEagerPersistence(this.clientId),this.sharedClientState=new ty,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return vc(ey,"Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return an(n,void 0,void 0,function(){var n,i,o,a,s=this;return sn(this,function(u){switch(u.label){case 0:return this.localStore=new cd(this.persistence,t),e&&(this.lruScheduler=new Hp(e,this.asyncQueue,this.localStore)),n=this.platform.newSerializer(this.databaseInfo.databaseId),i=new Nd(this.asyncQueue,r,this.credentials,n),o=function(t){return s.syncEngine.applyOnlineStateChange(t,Ed.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,Ed.SharedClientState)},this.remoteStore=new Rd(this.localStore,i,this.asyncQueue,o),this.syncEngine=new Bd(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Od(this.syncEngine),[4,this.sharedClientState.start()];case 1:return u.sent(),[4,this.remoteStore.start()];case 2:return u.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return an(s,void 0,void 0,function(){return sn(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return u.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),vc(ey,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(t){var e=this;return this.asyncQueue.enqueue(function(){return an(e,void 0,void 0,function(){return sn(this,function(e){switch(e.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return e.sent(),[4,this.sharedClientState.shutdown()];case 2:return e.sent(),[4,this.persistence.shutdown(t&&t.purgePersistenceWithDataLoss)];case 3:return e.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.listen=function(t,e,n){var r=this,i=new xd(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof bh)return t;if(t instanceof wh)return null;throw new Cc(Sc.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=jl(),r=new Ud(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this,n=new Nf;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.asyncQueue.enqueue(function(){return an(e,void 0,void 0,function(){return sn(this,function(){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),oy=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),ay=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e){if(!(e instanceof Array)||e.length<1)throw new Cc(Sc.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Yc(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(Mc("FieldPath","string",n,t[n]),0===t[n].length)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new vh(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Gc("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(vh.keyField().canonicalString()),t}(),sy=new RegExp("[~\\*/\\[\\]]"),uy=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},cy=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){wc(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(Wd.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){wc(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),hy=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;wc(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new Cc(Sc.ABORTED,"getToken aborted due to token change.");return n?(wc("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new uy(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){wc(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){wc(null!=this.tokenListener,"removeChangeListener() called twice"),wc(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return wc(null===t||"string"==typeof t,"Received invalid UID: "+t),new Wd(t)},t}(),ly=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Wd.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),fy=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new ly(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Wd.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function py(t){return function(t){if("object"!=typeof t||null===t)return!1;for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(t)}var dy,yy,my=function(){function t(t){this._methodName=t}return t.delete=function(){return Pc("FieldValue.delete",arguments),vy.instance},t.serverTimestamp=function(){return Pc("FieldValue.serverTimestamp",arguments),gy.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xc("FieldValue.arrayUnion",arguments,1),new _y(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xc("FieldValue.arrayRemove",arguments,1),new by(t)},t.increment=function(t){return Mc("FieldValue.increment","number",1,t),Oc("FieldValue.increment",arguments,1),new wy(t)},t.prototype.isEqual=function(t){return this===t},t}(),vy=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return rn(e,t),e.instance=new e,e}(my),gy=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return rn(e,t),e.instance=new e,e}(my),_y=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return rn(e,t),e}(my),by=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return rn(e,t),e}(my),wy=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return rn(e,t),e}(my),Ey=Ic(my,"Use FieldValue.<field>() instead."),Ty=/^__.*__$/,Sy=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new bl(t,this.data,this.fieldMask,e)):n.push(new _l(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new wl(t,this.fieldTransforms)),n},t}(),Cy=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new bl(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new wl(t,this.fieldTransforms)),n},t}();function Iy(t){switch(t){case dy.Set:case dy.MergeSet:case dy.Update:return!0;case dy.Argument:return!1;default:throw bc("Unexpected case for UserDataSource: "+t)}}(yy=dy||(dy={}))[yy.Set=0]="Set",yy[yy.Update=1]="Update",yy[yy.MergeSet=2]="MergeSet",yy[yy.Argument=3]="Argument";var Ny=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Cc(Sc.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(Iy(this.dataSource)&&Ty.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),Ay=function(t,e){this.databaseId=t,this.key=e},ky=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Ny(dy.Set,t,vh.EMPTY_PATH);Ry("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Sy(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Ny(dy.MergeSet,t,vh.EMPTY_PATH);Ry("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new fl(vh.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof ay)l=h._internalPath;else{if("string"!=typeof h)throw bc("Expected stringOrFieldPath to be a string or a FieldPath");l=Oy(t,h)}if(!r.contains(l))throw new Cc(Sc.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=dl.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=dl.fromArray(r.fieldMask),o=r.fieldTransforms;return new Sy(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Ny(dy.Update,t,vh.EMPTY_PATH);Ry("Data must be an object, but it was:",r,e);var i=new fl(vh.comparator),o=jh.EMPTY;Dc(e,function(e,a){var s=Oy(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof vy)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=dl.fromSet(i);return new Cy(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Ny(dy.Update,t,vh.EMPTY_PATH),o=[Py(t,e)],a=[n];if(r.length%2!=0)throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Py(t,r[s])),a.push(r[s+1]);var u=new fl(vh.comparator),c=jh.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof vy)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=dl.fromSet(u);return new Cy(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Ny(dy.Argument,t,vh.EMPTY_PATH),r=this.parseData(e,n);return wc(null!=r,"Parsed data should not be null."),wc(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=xy(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Dy(t=this.runPreConverter(t,e)))return Ry("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof my)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new Th(Jc);return Rc(t)?e.path&&0<e.path.length&&e.fieldMask.push(e.path):Dc(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new jh(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=kh.INSTANCE),n.push(s),r++}return new Bh(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Iy(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof vy){if(e.dataSource!==dy.MergeSet)throw e.dataSource===dy.Update?(wc(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof gy)e.fieldTransforms.push(new yl(e.path,Tl.instance));else if(t instanceof _y){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Sl(n);e.fieldTransforms.push(new yl(e.path,r))}else if(t instanceof by){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Cl(n);e.fieldTransforms.push(new yl(e.path,i))}else if(t instanceof wy){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new Il(o);e.fieldTransforms.push(new yl(e.path,a))}else bc("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return kh.INSTANCE;if("number"==typeof t)return zh(t)?new Oh(t):new xh(t);if("boolean"==typeof t)return Dh.of(t);if("string"==typeof t)return new Lh(t);if(t instanceof Date)return new Mh(ch.fromDate(t));if(t instanceof ch)return new Mh(new ch(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof uh)return new Vh(t);if(t instanceof ah)return new Uh(t);if(t instanceof Ay)return new qh(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Qc(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Ny(dy.Argument,t,vh.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function Dy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ch||t instanceof uh||t instanceof ah||t instanceof Ay||t instanceof my)}function Ry(t,e,n){if(!Dy(n)||!Wc(n)){var r=Qc(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Py(t,e){if(e instanceof ay)return e._internalPath;if("string"==typeof e)return Oy(t,e);throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Oy(t,e){try{return function(t){if(0<=t.search(sy))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ay.bind.apply(ay,[void 0].concat(t.split("."))))}catch(e){throw new Cc(Sc.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=xy(e);throw new Cc(Sc.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function xy(t){return t instanceof Error?t.message:t.toString()}var Ly=Kp.COLLECTION_DISABLED,My=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Cc(Sc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Uc("settings","non-empty string","host",t.host),this.host=t.host,qc("settings","boolean","ssl",t.ssl),this.ssl=Ac(t.ssl,!0);if(Hc("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes"]),qc("settings","object","credentials",t.credentials),this.credentials=t.credentials,qc("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?gc("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&gc("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Ac(t.timestampsInSnapshots,!0),qc("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Kp.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Ly&&t.cacheSizeBytes<Kp.MINIMUM_CACHE_SIZE_BYTES)throw new Cc(Sc.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Kp.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes},t}(),Fy=function(){},Uy=function(){function t(e){var n=this;this._queue=new kf,this.INTERNAL={delete:function(t){return an(n,void 0,void 0,function(){return sn(this,function(){return this._firestoreClient?[2,this._firestoreClient.shutdown(t)]:[2]})})}};var r=new Fy;if("object"==typeof e.options){var i=e;r.firebaseApp=i,r.databaseId=t.databaseIdFromApp(i),r.persistenceKey=r.firebaseApp.name,r.credentials=new hy(i)}else{var o=e;if(!o.projectId)throw new Cc(Sc.INVALID_ARGUMENT,"Must provide projectId");r.databaseId=new fh(o.projectId,o.database),r.persistenceKey="[DEFAULT]",r.credentials=new cy}r.settings=new My({}),this._config=r,this._databaseId=r.databaseId}return t.prototype.settings=function(t){if(Oc("Firestore.settings",arguments,1),Mc("Firestore.settings","object",1,t),Nc(t,"persistence"))throw new Cc(Sc.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new My(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new Cc(Sc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._config.settings=e).credentials&&(this._config.credentials=function(t){if(!t)return new cy;switch(t.type){case"gapi":var e=t.client;return wc(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new fy(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Cc(Sc.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Cc(Sc.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new ny(this._config.settings.cacheSizeBytes,void 0!==t&&Ac(t.experimentalTabSynchronization,!1)))},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new ry),this._firestoreClient},t.prototype.configureClient=function(t){var e=this;wc(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),wc(!this._firestoreClient,"configureClient() called multiple times");var n=new hh(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl);return this._dataConverter=new ky(function(t){if(t instanceof jy){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new Cc(Sc.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Ay(e._config.databaseId,t._key)}return t}),this._firestoreClient=new iy(Ec.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!Nc(e,"projectId"))throw new Cc(Sc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Cc(Sc.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new fh(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new Cc(Sc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Oc("Firestore.collection",arguments,1),Mc("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Gy(yh.fromString(t),this)},t.prototype.doc=function(t){return Oc("Firestore.doc",arguments,1),Mc("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),jy.forPath(yh.fromString(t),this)},t.prototype._collectionGroup=function(t){if(Oc("Firestore.collectionGroup",arguments,1),Mc("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Ky(new Jh(yh.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return Oc("Firestore.runTransaction",arguments,1),Mc("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new qy(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Vy(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(yc()){case oc.DEBUG:return"debug";case oc.ERROR:return"error";case oc.SILENT:return"silent";default:return bc("Unknown log level: "+yc())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Oc("Firestore.setLogLevel",arguments,1),Mc("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":mc(oc.DEBUG);break;case"error":mc(oc.ERROR);break;case"silent":mc(oc.SILENT);break;default:throw new Cc(Sc.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),qy=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;Oc("Transaction.get",arguments,1);var n=Jy("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return bc("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof wh)return new Wy(e._firestore,n._key,null,!1,!1);if(r instanceof bh)return new Wy(e._firestore,n._key,r,!1,!1);throw bc("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){Lc("Transaction.set",arguments,2,3);var r=Jy("Transaction.set",t,this._firestore),i=(n=zy("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof ay?(xc("Transaction.update",arguments,3),r=Jy("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Oc("Transaction.update",arguments,2),r=Jy("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Oc("Transaction.delete",arguments,1);var e=Jy("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Vy=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){Lc("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Jy("WriteBatch.set",t,this._firestore),i=(n=zy("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,vl.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof ay?(xc("WriteBatch.update",arguments,3),r=Jy("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Oc("WriteBatch.update",arguments,2),r=Jy("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,vl.exists(!0))),this},t.prototype.delete=function(t){Oc("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Jy("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new El(e._key,vl.NONE)),this},t.prototype.commit=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new Cc(Sc.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),jy=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new gh(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Gy(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Oc("DocumentReference.collection",arguments,1),Mc("DocumentReference.collection","non-empty string",1,t),!t)throw new Cc(Sc.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=yh.fromString(t);return new Gy(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Gc("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){Lc("DocumentReference.set",arguments,1,2);var n=(e=zy("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,vl.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof ay?(xc("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Oc("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,vl.exists(!0)))},t.prototype.delete=function(){return Oc("DocumentReference.delete",arguments,0),this._firestoreClient.write([new El(this._key,vl.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Lc("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||py(t[i])||(Hc("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),qc("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=py(t[i])?t[i]:(Mc("DocumentReference.onSnapshot","function",i,t[i]),Fc("DocumentReference.onSnapshot","function",i+1,t[i+1]),Fc("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new oy({next:function(t){if(e.next){wc(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Wy(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Jh.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return Lc("DocumentReference.get",arguments,0,1),Xy("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Wy(e.firestore,e._key,t,!0,t instanceof bh&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Cc(Sc.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Cc(Sc.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),By=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Wy=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return Lc("DocumentSnapshot.data",arguments,0,1),t=Yy("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,Nh.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(Lc("DocumentSnapshot.get",arguments,1,2),e=Yy("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Py("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,Nh.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new jy(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new By(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Gc("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof jh)return this.convertObject(t,e);if(t instanceof Bh)return this.convertArray(t,e);if(t instanceof qh){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||gc("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new jy(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),Qy=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return rn(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return wc("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Wy),Ky=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){var i;Oc("Query.where",arguments,3),Mc("Query.where","non-empty string",2,n),Kc("Query.where",3,r);var o=Py("Query.where",e),a=Zh.fromString(n);if(o.isKeyField()){if(a===Zh.ARRAY_CONTAINS)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof r){if(""===r)throw new Cc(Sc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==r.indexOf("/"))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection by FieldPath.documentId(), the value provided must be a plain document ID, but '"+r+"' contains a slash.");var s=this._query.path.child(yh.fromString(r));if(!gh.isDocumentKey(s))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+s+"' is not because it has an odd number of segments ("+s.length+").");i=new qh(this.firestore._databaseId,new gh(s))}else{if(!(r instanceof jy))throw new Cc(Sc.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+Qc(r)+".");var u=r;i=new qh(this.firestore._databaseId,u._key)}}else i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var c=$h.create(o,a,i);return this.validateNewFilter(c),new t(this._query.addFilter(c),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(Lc("Query.orderBy",arguments,1,2),Fc("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=rl.ASCENDING;else{if("desc"!==n)throw new Cc(Sc.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=rl.DESCENDING}if(null!==this._query.startAt)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Py("Query.orderBy",e),o=new ol(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(Oc("Query.limit",arguments,1),Mc("Query.limit","number",1,e),e<=0)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xc("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xc("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xc("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];xc("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Gc("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Kc(t,1,e),e instanceof Wy){if(0<n.length)throw new Cc(Sc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Cc(Sc.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new qh(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Fh)throw new Cc(Sc.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(void 0===s){var u=a.field.canonicalString();throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new il(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Cc(Sc.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(yh.fromString(a));if(!gh.isDocumentKey(s))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new gh(s);i.push(new qh(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new il(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Lc("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||py(t[i])||(Hc("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),qc("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=py(t[i])?t[i]:(Mc("Query.onSnapshot","function",i,t[i]),Fc("Query.onSnapshot","function",i+1,t[i+1]),Fc("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new oy({next:function(t){e.next&&e.next(new Hy(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.get=function(t){var e=this;return Lc("Query.get",arguments,0,1),Xy("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new Hy(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Cc(Sc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.validateNewFilter=function(t){if(t instanceof tl)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===Zh.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Cc(Sc.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Hy=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new By(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Lc("QuerySnapshot.forEach",arguments,1,2),Mc("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Ky(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(Hc("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),qc("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Cc(Sc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new Qy(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return wc(e.type===Ql.Added,"Invalid event type for first snapshot"),wc(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==Ql.Metadata}).map(function(e){var r=new Qy(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==Ql.Added&&(wc(0<=(i=o.indexOf(e.doc.key)),"Index for document not found"),o=o.delete(e.doc.key)),e.type!==Ql.Removed&&(a=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case Ql.Added:return"added";case Ql.Modified:case Ql.Metadata:return"modified";case Ql.Removed:return"removed";default:return bc("Unknown change type: "+t)}}(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Gc("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new Qy(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(Hy.prototype.docChanges,t,{get:function(){return function(){throw new Cc(Sc.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Gy=function(t){function e(e,n){var r=t.call(this,Jh.atPath(e),n)||this;if(e.length%2!=1)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return rn(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new jy(new gh(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(Lc("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Xc.newId()),Mc("CollectionReference.doc","non-empty string",1,t),""===t)throw new Cc(Sc.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=yh.fromString(t);return jy.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){Oc("CollectionReference.add",arguments,1),Mc("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Ky);function zy(t,e){if(void 0===e)return{merge:!1};if(Hc(t,e,["merge","mergeFields"]),qc(t,"boolean","merge",e.merge),Vc(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof ay}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Cc(Sc.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Yy(t,e){return void 0===e?{}:(Hc(t,e,["serverTimestamps"]),jc(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Xy(t,e){Fc(t,"object",1,e),e&&(Hc(t,e,["source"]),jc(t,0,"source",e.source,["default","server","cache"]))}function Jy(t,e,n){if(e instanceof jy){if(e.firestore!==n)throw new Cc(Sc.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Gc(t,"DocumentReference",1,e)}var $y=Ic(Uy,"Use firebase.firestore() instead."),Zy=Ic(qy,"Use firebase.firestore().runTransaction() instead."),tm=Ic(Vy,"Use firebase.firestore().batch() instead."),em=Ic(jy,"Use firebase.firestore().doc() instead."),nm=Ic(Wy),rm=Ic(Qy),im=Ic(Ky),om=Ic(Hy),am=Ic(Gy,"Use firebase.firestore().collection() instead."),sm={Firestore:$y,GeoPoint:uh,Timestamp:ch,Blob:sh,Transaction:Zy,WriteBatch:tm,DocumentReference:em,DocumentSnapshot:nm,Query:im,QueryDocumentSnapshot:rm,QuerySnapshot:om,CollectionReference:am,FieldPath:ay,FieldValue:Ey,setLogLevel:Uy.setLogLevel,CACHE_SIZE_UNLIMITED:Ly};er.INTERNAL.registerService("firestore",function(t){return new Uy(t)},function(t){wc(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(sm));var um={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},cm=function(t){function e(n,r,i){var o=t.call(this,r)||this;return Object.setPrototypeOf(o,e.prototype),o.code=n,o.details=i,o}return rn(e,t),e}(Error),hm=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return an(this,void 0,void 0,function(){var t;return sn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(t=e.sent())?[2,t.accessToken]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return an(this,void 0,void 0,function(){var t;return sn(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(t=e.sent())?[2,t]:[2,void 0];case 2:return e.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return an(this,void 0,void 0,function(){var t,e;return sn(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getInstanceIdToken()];case 2:return e=n.sent(),[2,{authToken:t,instanceIdToken:e}]}})})},t}();function lm(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var fm,pm,dm=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return lm(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null===t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=parseFloat(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?lm(t,function(t){return e.decode(t)}):t},t}(),ym=function(){function t(t,e){void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new dm,this.emulatorOrigin=null,this.contextProvider=new hm(t)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(t,e){var n=this;return function(r){return n.call(t,r,e||{})}},t.prototype.postJSON=function(t,e,n){return an(this,void 0,void 0,function(){var r,i;return sn(this,function(o){switch(o.label){case 0:n.append("Content-Type","application/json"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=o.sent(),[3,4];case 3:return o.sent(),[2,{status:0,json:null}];case 4:i=null,o.label=5;case 5:return o.trys.push([5,7,,8]),[4,r.json()];case 6:return i=o.sent(),[3,8];case 7:return o.sent(),[3,8];case 8:return[2,{status:r.status,json:i}]}})})},t.prototype.call=function(t,e,n){return an(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h;return sn(this,function(l){switch(l.label){case 0:return r=this._url(t),e=this.serializer.encode(e),i={data:e},o=new Headers,[4,this.contextProvider.getContext()];case 1:return(a=l.sent()).authToken&&o.append("Authorization","Bearer "+a.authToken),a.instanceIdToken&&o.append("Firebase-Instance-ID-Token",a.instanceIdToken),s=n.timeout||7e4,[4,Promise.race([this.postJSON(r,i,o),(f=s,new Promise(function(t,e){setTimeout(function(){e(new cm("deadline-exceeded","deadline-exceeded"))},f)}))])];case 2:if(u=l.sent(),c=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e.error;if(a){var s=a.status;if("string"==typeof s){if(!um[s])return new cm("internal","internal");r=um[s]}i=s;var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new cm(r,i,o)}(u.status,u.json,this.serializer))throw c;if(!u.json)throw new cm("internal","Response is not valid JSON object.");if(void 0===(h=u.json.data)&&(h=u.json.result),void 0===h)throw new cm("internal","Response is missing data field.");return[2,{data:this.serializer.decode(h)}]}var f})})},t}();fm={Functions:ym},er.INTERNAL.registerService("functions",function(t,e,n){return new ym(t,n)},fm,void 0,!0);var mm,vm,gm,_m,bm="only-available-in-window",wm="only-available-in-sw",Em="bad-sender-id",Tm="incorrect-gcm-sender-id",Sm="permission-default",Cm="permission-blocked",Im="unsupported-browser",Nm="notifications-blocked",Am="failed-serviceworker-registration",km="sw-registration-expected",Dm="sw-reg-redundant",Rm="token-subscribe-failed",Pm="token-subscribe-no-token",Om="token-subscribe-no-push-set",xm="token-unsubscribe-failed",Lm="token-update-failed",Mm="token-update-no-token",Fm="use-sw-before-get-token",Um="invalid-delete-token",qm="delete-token-not-found",Vm="delete-scope-not-found",jm="bg-handler-function-expected",Bm="no-window-client-to-msg",Wm="unable-to-resubscribe",Qm="no-sw-in-reg",Km="bad-scope",Hm="bad-vapid-key",Gm="bad-subscription",zm="bad-token",Ym="bad-push-set",Xm="invalid-public-vapid-key",Jm="public-vapid-key-decryption-failed",$m=((pm={})[bm]="This method is available in a Window context.",pm[wm]="This method is available in a service worker context.",pm["should-be-overriden"]="This method should be overriden by extended classes.",pm[Em]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",pm[Sm]="The required permissions were not granted and dismissed instead.",pm[Cm]="The required permissions were not granted and blocked instead.",pm[Im]="This browser doesn't support the API's required to use the firebase SDK.",pm[Nm]="Notifications have been blocked.",pm[Am]="We are unable to register the default service worker. {$browserErrorMessage}",pm[km]="A service worker registration was the expected input.",pm["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",pm["invalid-saved-token"]="Unable to access details of the saved token.",pm[Dm]="The service worker being used for push was made redundant.",pm[Rm]="A problem occured while subscribing the user to FCM: {$message}",pm[Pm]="FCM returned no token when subscribing the user to push.",pm[Om]="FCM returned an invalid response when getting an FCM token.",pm[xm]="A problem occured while unsubscribing the user from FCM: {$message}",pm[Lm]="A problem occured while updating the user from FCM: {$message}",pm[Mm]="FCM returned no token when updating the user to push.",pm[Fm]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",pm[Um]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",pm[qm]="The deletion attempt for token could not be performed as the token was not found.",pm[Vm]="The deletion attempt for service worker scope could not be performed as the scope was not found.",pm[jm]="The input to setBackgroundMessageHandler() must be a function.",pm[Bm]="An attempt was made to message a non-existant window client.",pm[Wm]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",pm["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",pm["failed-to-delete-token"]="Unable to delete the currently saved token.",pm[Qm]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",pm[Tm]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",pm[Km]="The service worker scope must be a string with at least one character.",pm[Hm]="The public VAPID key is not a Uint8Array with 65 bytes.",pm[Gm]="The subscription must be a valid PushSubscription.",pm[zm]="The FCM Token used for storage / lookup was not a valid token string.",pm[Ym]="The FCM push set used for storage / lookup was not not a valid push set string.",pm["failed-delete-vapid-key"]="The VAPID key could not be deleted.",pm[Xm]="The public VAPID key must be a string.",pm[Jm]="The public VAPID key did not equal 65 bytes when decrypted.",pm),Zm=new Sn("messaging","Messaging",$m),tv=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),ev="https://fcm.googleapis.com";function nv(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function rv(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(un(arguments[e]));return t}(e)))}function iv(t){return rv(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(vm=mm||(mm={})).TYPE_OF_MSG="firebase-messaging-msg-type",vm.DATA="firebase-messaging-msg-data",(_m=gm||(gm={})).PUSH_MSG_RECEIVED="push-msg-received",_m.NOTIFICATION_CLICKED="notification-clicked";var ov=function(){function t(){}return t.prototype.getToken=function(t,e,n){return an(this,void 0,void 0,function(){var r,i,o,a,s,u,c,h;return sn(this,function(l){switch(l.label){case 0:r=iv(e.getKey("p256dh")),i=iv(e.getKey("auth")),o="authorized_entity="+t+"&endpoint="+e.endpoint+"&encryption_key="+r+"&encryption_auth="+i,nv(n.buffer,tv.buffer)||(a=iv(n),o+="&application_pub_key="+a),(s=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:s,body:o},l.label=1;case 1:return l.trys.push([1,4,,5]),[4,fetch(ev+"/fcm/connect/subscribe",u)];case 2:return[4,l.sent().json()];case 3:return c=l.sent(),[3,5];case 4:throw l.sent(),Zm.create(Rm);case 5:if(c.error)throw h=c.error.message,Zm.create(Rm,{message:h});if(!c.token)throw Zm.create(Pm);if(!c.pushSet)throw Zm.create(Om);return[2,{token:c.token,pushSet:c.pushSet}]}})})},t.prototype.updateToken=function(t,e,n,r,i){return an(this,void 0,void 0,function(){var o,a,s,u,c,h,l,f;return sn(this,function(p){switch(p.label){case 0:o=iv(r.getKey("p256dh")),a=iv(r.getKey("auth")),s="push_set="+n+"&token="+e+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+a,nv(i.buffer,tv.buffer)||(u=iv(i),s+="&application_pub_key="+u),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),h={method:"POST",headers:c,body:s},p.label=1;case 1:return p.trys.push([1,4,,5]),[4,fetch(ev+"/fcm/connect/subscribe",h)];case 2:return[4,p.sent().json()];case 3:return l=p.sent(),[3,5];case 4:throw p.sent(),Zm.create(Lm);case 5:if(l.error)throw f=l.error.message,Zm.create(Lm,{message:f});if(!l.token)throw Zm.create(Mm);return[2,l.token]}})})},t.prototype.deleteToken=function(t,e,n){return an(this,void 0,void 0,function(){var r,i,o,a,s;return sn(this,function(u){switch(u.label){case 0:r="authorized_entity="+t+"&token="+e+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(ev+"/fcm/connect/unsubscribe",o)];case 2:return[4,u.sent().json()];case 3:if((a=u.sent()).error)throw s=a.error.message,Zm.create(xm,{message:s});return[3,5];case 4:throw u.sent(),Zm.create(xm);case 5:return[2]}})})},t}();function av(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var sv="undefined",uv="fcm_token_object_Store";function cv(){var t=indexedDB.open(sv);t.onerror=function(){},t.onsuccess=function(){!function(t){if(t.objectStoreNames.contains(uv)){var e=t.transaction(uv).objectStore(uv),n=new ov,r=e.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var e=r.result;if(e){var i=e.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),e.continue()}else t.close(),indexedDB.deleteDatabase(sv)}}}(t.result)}}var hv=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(e){return e.get(t)})},t.prototype.getIndex=function(t,e){return this.createTransaction(function(n){return n.index(t).get(e)})},t.prototype.put=function(t){return this.createTransaction(function(e){return e.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(e){return e.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,e){return void 0===e&&(e="readonly"),an(this,void 0,void 0,function(){var n,r,i,o;return sn(this,function(a){switch(a.label){case 0:return[4,this.getDb()];case 1:return n=a.sent(),r=n.transaction(this.objectStoreName,e),i=r.objectStore(this.objectStoreName),[4,(s=t(i),new Promise(function(t,e){s.onsuccess=function(){t(s.result)},s.onerror=function(){e(s.error)}}))];case 2:return o=a.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}var s})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(e,n){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){e(r.result)},r.onerror=function(){t.dbPromise=null,n(r.error)},r.onupgradeneeded=function(e){return t.onDbUpgrade(r,e)}})),this.dbPromise},t}(),lv=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_token_details_db",e.dbVersion=3,e.objectStoreName="fcm_token_object_Store",e}return rn(e,t),e.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:cv();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=on({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=av(e.vapidKey)),"string"==typeof e.auth&&(n.auth=av(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=av(e.p256dh).buffer),t.update(n),t.continue()}}}},e.prototype.getTokenDetailsFromToken=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){if(!t)throw Zm.create(zm);return fv({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},e.prototype.getTokenDetailsFromSWScope=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){if(!t)throw Zm.create(Km);return fv({swScope:t}),[2,this.get(t)]})})},e.prototype.saveTokenDetails=function(t){return an(this,void 0,void 0,function(){return sn(this,function(){if(!t.swScope)throw Zm.create(Km);if(!t.vapidKey)throw Zm.create(Hm);if(!t.endpoint||!t.auth||!t.p256dh)throw Zm.create(Gm);if(!t.fcmSenderId)throw Zm.create(Em);if(!t.fcmToken)throw Zm.create(zm);if(!t.fcmPushSet)throw Zm.create(Ym);return fv(t),[2,this.put(t)]})})},e.prototype.deleteToken=function(t){return an(this,void 0,void 0,function(){var e;return sn(this,function(n){switch(n.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(Zm.create(Um))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(e=n.sent()))throw Zm.create(qm);return[4,this.delete(e.swScope)];case 2:return n.sent(),[2,e]}})})},e}(hv);function fv(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Zm.create(zm);if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Zm.create(Km);if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Zm.create(Hm);if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Zm.create(Gm);if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Zm.create(Gm);if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Zm.create(Gm);if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Zm.create(Em);if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw Zm.create(Ym)}var pv=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dbName="fcm_vapid_details_db",e.dbVersion=1,e.objectStoreName="fcm_vapid_object_Store",e}return rn(e,t),e.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},e.prototype.getVapidFromSWScope=function(t){return an(this,void 0,void 0,function(){var e;return sn(this,function(n){switch(n.label){case 0:if("string"!=typeof t||0===t.length)throw Zm.create(Km);return[4,this.get(t)];case 1:return[2,(e=n.sent())?e.vapidKey:void 0]}})})},e.prototype.saveVapidDetails=function(t,e){return an(this,void 0,void 0,function(){var n;return sn(this,function(){if("string"!=typeof t||0===t.length)throw Zm.create(Km);if(null===e||65!==e.length)throw Zm.create(Hm);return n={swScope:t,vapidKey:e},[2,this.put(n)]})})},e.prototype.deleteVapidDetails=function(t){return an(this,void 0,void 0,function(){var e;return sn(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(e=n.sent()))throw Zm.create(Vm);return[4,this.delete(t)];case 2:return n.sent(),[2,e]}})})},e}(hv),dv="messagingSenderId",yv=function(){function t(t){var e=this;if(!t.options[dv]||"string"!=typeof t.options[dv])throw Zm.create(Em);this.messagingSenderId=t.options[dv],this.tokenDetailsModel=new lv,this.vapidDetailsModel=new pv,this.iidModel=new ov,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return an(this,void 0,void 0,function(){var t,e,n,r,i;return sn(this,function(o){switch(o.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw Zm.create(Nm);return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return e=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(e,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(e.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(e,r,n,i)]:[2,this.getNewToken(e,r,n)]}})})},t.prototype.manageExistingToken=function(t,e,n,r){return an(this,void 0,void 0,function(){return sn(this,function(i){switch(i.label){case 0:return function(t,e,n){if(!n.vapidKey||!nv(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=nv(t.getKey("auth"),n.auth),o=nv(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(e,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,e,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,e,n)]}})})},t.prototype.updateToken=function(t,e,n,r){return an(this,void 0,void 0,function(){var i,o,a;return sn(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,e,n)];case 1:return i=s.sent(),o={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return s.sent(),[2,i];case 4:return a=s.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw s.sent(),a;case 6:return[2]}})})},t.prototype.getNewToken=function(t,e,n){return an(this,void 0,void 0,function(){var r,i;return sn(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,e,n)];case 1:return r=o.sent(),i={swScope:t.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:e.endpoint,auth:e.getKey("auth"),p256dh:e.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,n)];case 3:return o.sent(),[2,r.token]}})})},t.prototype.deleteToken=function(t){return an(this,void 0,void 0,function(){var e,n;return sn(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(e=r.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return an(this,void 0,void 0,function(){var e;return sn(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return e=n.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return n.sent(),[2]}})})},t.prototype.getPushSubscription=function(t,e){return t.pushManager.getSubscription().then(function(n){return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e})})},t.prototype.requestPermission=function(){throw Zm.create(bm)},t.prototype.useServiceWorker=function(){throw Zm.create(bm)},t.prototype.usePublicVapidKey=function(){throw Zm.create(bm)},t.prototype.onMessage=function(){throw Zm.create(bm)},t.prototype.onTokenRefresh=function(){throw Zm.create(bm)},t.prototype.setBackgroundMessageHandler=function(){throw Zm.create(wm)},t.prototype.delete=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}(),mv="FCM_MSG",vv=function(t){function e(e){var n=t.call(this,e)||this;return n.bgMessageHandler=null,self.addEventListener("push",function(t){n.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){n.onSubChange(t)}),self.addEventListener("notificationclick",function(t){n.onNotificationClick(t)}),n}return rn(e,t),e.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},e.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},e.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},e.prototype.onPush_=function(t){return an(this,void 0,void 0,function(){var e,n,r,i,o,a;return sn(this,function(s){switch(s.label){case 0:if(!t.data)return[2];try{e=t.data.json()}catch(s){return[2]}return[4,this.hasVisibleClients_()];case 1:return s.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=s.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return s.sent(),[2];case 5:return[2]}})})},e.prototype.onSubChange_=function(){return an(this,void 0,void 0,function(){var t,e,n,r;return sn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw e=i.sent(),Zm.create(Wm,{message:e});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},e.prototype.onNotificationClick_=function(t){return an(this,void 0,void 0,function(){var e,n,r,i;return sn(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data[mv]?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(e=t.notification.data[mv]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=_v(gm.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},e.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=on({},t.notification);return n.data=on({},t.notification.data,((e={})[mv]=t,e)),n}},e.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Zm.create(jm);this.bgMessageHandler=t},e.prototype.getWindowClient_=function(t){return an(this,void 0,void 0,function(){var e,n,r,i;return sn(this,function(o){switch(o.label){case 0:return e=new URL(t,self.location.href).href,[4,gv()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},e.prototype.attemptToMessageClient_=function(t,e){return an(this,void 0,void 0,function(){return sn(this,function(){if(!t)throw Zm.create(Bm);return t.postMessage(e),[2]})})},e.prototype.hasVisibleClients_=function(){return an(this,void 0,void 0,function(){return sn(this,function(t){switch(t.label){case 0:return[4,gv()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},e.prototype.sendMessageToWindowClients_=function(t){return an(this,void 0,void 0,function(){var e,n,r=this;return sn(this,function(i){switch(i.label){case 0:return[4,gv()];case 1:return e=i.sent(),n=_v(gm.PUSH_MSG_RECEIVED,t),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return i.sent(),[2]}})})},e.prototype.getSWRegistration_=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return[2,self.registration]})})},e.prototype.getPublicVapidKey_=function(){return an(this,void 0,void 0,function(){var t,e;return sn(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=n.sent()))throw Zm.create(km);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(e=n.sent())?[2,tv]:[2,e]}})})},e}(yv);function gv(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function _v(t,e){var n;return(n={})[mm.TYPE_OF_MSG]=t,n[mm.DATA]=e,n}var bv,wv=function(t){function e(e){var n=t.call(this,e)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.manifestCheckPromise=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=Un(function(t){n.messageObserver=t}),n.onTokenRefreshInternal=Un(function(t){n.tokenRefreshObserver=t}),n.setupSWMessageListener_(),n}return rn(e,t),e.prototype.getToken=function(){return an(this,void 0,void 0,function(){return sn(this,function(e){switch(e.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return an(this,void 0,void 0,function(){var t,e;return sn(this,function(n){switch(n.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,n.sent().json()];case 3:return e=n.sent(),[3,5];case 4:return n.sent(),[2];case 5:if(!e||!e.gcm_sender_id)return[2];if("103953800507"!==e.gcm_sender_id)throw Zm.create(Tm);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return e.sent(),[2,t.prototype.getToken.call(this)]}})})},e.prototype.requestPermission=function(){return an(this,void 0,void 0,function(){var t;return sn(this,function(e){switch(e.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=e.sent()))return[2];throw"denied"===t?Zm.create(Cm):Zm.create(Sm)}})})},e.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Zm.create(km);if(null!=this.registrationToUse)throw Zm.create(Fm);this.registrationToUse=t},e.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Zm.create(Xm);if(null!=this.publicVapidKeyToUse)throw Zm.create("use-public-key-before-get-token");var e=av(t);if(65!==e.length)throw Zm.create(Jm);this.publicVapidKeyToUse=e},e.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},e.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},e.prototype.waitForRegistrationToActivate_=function(t){var e=t.installing||t.waiting||t.active;return new Promise(function(n,r){if(e)if("activated"!==e.state)if("redundant"!==e.state){var i=function(){if("activated"===e.state)n(t);else{if("redundant"!==e.state)return;r(Zm.create(Dm))}e.removeEventListener("statechange",i)};e.addEventListener("statechange",i)}else r(Zm.create(Dm));else n(t);else r(Zm.create(Qm))})},e.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Zm.create(Am,{browserErrorMessage:t.message})}).then(function(e){return t.waitForRegistrationToActivate_(e).then(function(){return(t.registrationToUse=e).update(),e})}))},e.prototype.getPublicVapidKey_=function(){return an(this,void 0,void 0,function(){return sn(this,function(){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,tv]})})},e.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(e){if(e.data&&e.data[mm.TYPE_OF_MSG]){var n=e.data;switch(n[mm.TYPE_OF_MSG]){case gm.PUSH_MSG_RECEIVED:case gm.NOTIFICATION_CLICKED:var r=n[mm.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},e}(yv);function Ev(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}bv={isSupported:Ev},er.INTERNAL.registerService("messaging",function(t){if(!Ev())throw Zm.create(Im);return self&&"ServiceWorkerGlobalScope"in self?new vv(t):new wv(t)},bv);var Tv="firebasestorage.googleapis.com",Sv=function(){function t(t,e){this.code_=Iv(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return Iv(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),Cv={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function Iv(t){return"storage/"+t}function Nv(){return new Sv(Cv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Av(){return new Sv(Cv.CANCELED,"User canceled the upload/download.")}function kv(){return new Sv(Cv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Dv(t,e,n){return new Sv(Cv.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Rv(){return new Sv(Cv.APP_DELETED,"The Firebase app was deleted.")}function Pv(t,e){return new Sv(Cv.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Ov(t){throw new Sv(Cv.INTERNAL_ERROR,"Internal error: "+t)}var xv={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Lv(t){switch(t){case xv.RAW:case xv.BASE64:case xv.BASE64URL:case xv.DATA_URL:return;default:throw"Expected one of the event types: ["+xv.RAW+", "+xv.BASE64+", "+xv.BASE64URL+", "+xv.DATA_URL+"]."}}var Mv=function(t,e){this.data=t,this.contentType=e||null};function Fv(t,e){switch(t){case xv.RAW:return new Mv(Uv(e));case xv.BASE64:case xv.BASE64URL:return new Mv(qv(t,e));case xv.DATA_URL:return new Mv((n=new Bv(e)).base64?qv(xv.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Pv(xv.DATA_URL,"Malformed data URL.")}return Uv(e)}(n.rest),new Bv(e).contentType)}var n;throw Nv()}function Uv(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?n<t.length-1&&56320==(64512&t.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function qv(t,e){switch(t){case xv.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw Pv(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case xv.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw Pv(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw Pv(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var Vv,jv,Bv=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Pv(xv.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(r=";base64",(n=i).length>=r.length&&n.substring(n.length-r.length)===r),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)},Wv={STATE_CHANGED:"state_changed"},Qv="running",Kv="pausing",Hv="paused",Gv="success",zv="canceling",Yv="canceled",Xv="error",Jv={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function $v(t){switch(t){case Qv:case Kv:case zv:return Jv.RUNNING;case Hv:return Jv.PAUSED;case Gv:return Jv.SUCCESS;case Yv:return Jv.CANCELED;case Xv:default:return Jv.ERROR}}function Zv(t,e){for(var n in t)r=t,i=n,Object.prototype.hasOwnProperty.call(r,i)&&e(n,t[n]);var r,i}function tg(t){if(null==t)return{};var e={};return Zv(t,function(t,n){e[t]=n}),e}function eg(t){return new Promise(t)}function ng(t){return Promise.resolve(t)}function rg(t){return null!=t}function ig(t){return void 0!==t}function og(t){return"function"==typeof t}function ag(t){return"object"==typeof t}function sg(t){return"string"==typeof t||t instanceof String}function ug(t){return cg()&&t instanceof Blob}function cg(){return"undefined"!=typeof Blob}(jv=Vv||(Vv={}))[jv.NO_ERROR=0]="NO_ERROR",jv[jv.NETWORK_ERROR=1]="NETWORK_ERROR",jv[jv.ABORT=2]="ABORT";var hg=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Vv.NO_ERROR,this.sendPromise_=eg(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=Vv.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=Vv.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw Ov("cannot .send() more than once");return this.sent_=!0,this.xhr_.open(e,t,!0),rg(r)&&Zv(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())}),rg(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Ov("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Ov("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Ov("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){rg(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){rg(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),lg=function(){function t(){}return t.prototype.createXhrIo=function(){return new hg},t}();function fg(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return ag(n=e)&&!Array.isArray(n)?e:null}var pg=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n,r;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw r=e,new Sv(Cv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},t.makeFromUrl=function(e){for(var n,r=null,i="([A-Za-z0-9.\\-_]+)",o=new RegExp("^gs://"+i+"(/(.*))?$","i"),a=Tv.replace(/[.]/g,"\\."),s=[{regex:o,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+a+"/v[A-Za-z0-9_]+/b/"+i+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],u=0;u<s.length;u++){var c=s[u],h=c.regex.exec(e);if(h){var l=h[c.indices.bucket],f=h[c.indices.path];f||(f=""),r=new t(l,f),c.postModify(r);break}}if(null==r)throw n=e,new Sv(Cv.INVALID_URL,"Invalid URL '"+n+"'.");return r},t}();function dg(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function yg(t){return"https://"+Tv+"/v0"+t}function mg(t){var e=encodeURIComponent,n="?";return Zv(t,function(t,r){var i=e(t)+"="+e(r);n=n+i+"&"}),n=n.slice(0,-1)}function vg(t,e){return e}var gg=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||vg},_g=null;function bg(){if(_g)return _g;var t=[];t.push(new gg("bucket")),t.push(new gg("generation")),t.push(new gg("metageneration")),t.push(new gg("name","fullPath",!0));var e=new gg("name");e.xform=function(t,e){return!sg(n=e)||n.length<2?n:dg(n=n);var n},t.push(e);var n=new gg("size");return n.xform=function(t,e){return rg(e)?+e:e},t.push(n),t.push(new gg("timeCreated")),t.push(new gg("updated")),t.push(new gg("md5Hash",null,!0)),t.push(new gg("cacheControl",null,!0)),t.push(new gg("contentDisposition",null,!0)),t.push(new gg("contentEncoding",null,!0)),t.push(new gg("contentLanguage",null,!0)),t.push(new gg("contentType",null,!0)),t.push(new gg("metadata","customMetadata",!0)),_g=t}function wg(t,e,n){for(var r,i,o={type:"file"},a=n.length,s=0;s<a;s++){var u=n[s];o[u.local]=u.xform(o,e[u.server])}return r=o,i=t,Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new pg(t,e);return i.makeStorageReference(n)}}),o}function Eg(t,e,n){var r=fg(e);return null===r?null:wg(t,r,n)}function Tg(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function Sg(t){var e;if(!t||!ag(t))throw"Expected Metadata object.";for(var n in t){var r=t[n];if("customMetadata"===n){if(!ag(r))throw"Expected object for 'customMetadata' mapping."}else if(ag(e=r)&&null!==e)throw"Mapping for '"+n+"' cannot be an object."}}function Cg(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=t,c=n.length,l=a===s?1===(h=a)?"argument":"arguments":(h="between "+a+" and "+s,"arguments"),new Sv(Cv.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?Dv(o,t,e.message):Dv(o,t,e)}}var Ig=function(t,e){var n=this;this.validator=function(e){n.optional&&!ig(e)||t(e)},this.optional=!!e};function Ng(t,e){function n(t){if(!sg(t))throw"Expected string."}var r,i,o;return r=t?(i=n,o=t,function(t){i(t),o(t)}):n,new Ig(r,e)}function Ag(t){return new Ig(Sg,t)}function kg(){return new Ig(function(t){var e;if(!(("number"==typeof(e=t)||e instanceof Number)&&0<=t))throw"Expected a number 0 or greater."})}function Dg(t,e){return new Ig(function(e){if(!(null===e||rg(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function Rg(t){return new Ig(function(t){if(null!==t&&!og(t))throw"Expected a Function."},t)}function Pg(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(cg())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var Og=function(){function t(t,e){var n=0,r="";ug(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(ug(this.data_)){var r=(o=e,a=n,(i=this.data_).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new t(r)}var i,o,a;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(cg()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(Pg.apply(null,r))}var i=e.map(function(t){return sg(t)?Fv(xv.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var a=new Uint8Array(o),s=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]}),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}();function xg(t,e){return-1!==t.indexOf(e)}var Lg=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function Mg(t){if(!t)throw Nv()}function Fg(t,e){return function(n,r){var i=Eg(t,r,e);return Mg(null!==i),i}}function Ug(t,e){return function(n,r){var i=Eg(t,r,e);return Mg(null!==i),function(t,e){var n=fg(e);if(null===n)return null;if(!sg(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return yg("/b/"+i(n)+"/o/"+i(r))+mg({alt:"media",token:e})})[0]}(i,r)}}function qg(t){return function(e,n){var r,i,o;return(r=401===e.getStatus()?new Sv(Cv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,new Sv(Cv.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,new Sv(Cv.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):n).setServerResponseProp(n.serverResponseProp()),r}}function Vg(t){var e=qg(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Sv(Cv.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function jg(t,e,n){var r=yg(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new Lg(r,"GET",Fg(t,n),i);return o.errorHandler=Vg(e),o}function Bg(t,e,n){var r,i=tg(n);return i.fullPath=t.path,i.size=e.size(),i.contentType||(i.contentType=(r=e)&&r.type()||"application/octet-stream"),i}var Wg=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function Qg(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){Mg(!1)}return Mg(xg(e||["active"],n)),n}function Kg(t,e,n,r,i,o,a,s){var u=new Wg(0,0);if(u.total=a?(u.current=a.current,a.total):(u.current=0,r.size()),r.size()!==u.total)throw new Sv(Cv.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;0<i&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw kv();var y=e.maxUploadRetryTime(),m=new Lg(n,"POST",function(t,n){var i,a=Qg(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?Fg(e,o)(t,n):null,new Wg(s,c,"final"===a,i)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=s||null,m.errorHandler=qg(t),m}var Hg=function(t,e,n){if(og(t)||rg(e)||rg(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},Gg=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function zg(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];ng(!0).then(function(){t.apply(null,e)})}}var Yg=function(){function t(t,e,n,r,i,o){void 0===o&&(o=null);var a=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=Qv,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Cv.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Xv))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Cv.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Xv))},this.promise_=eg(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return 262144<t.size()},t.prototype.start_=function(){this.state_===Qv&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case Qv:t(n);break;case zv:e.transition_(Yv);break;case Kv:e.transition_(Hv)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n,r,i,o,a,s,u,c,h,l,f,p,d,y=(n=t.authWrapper_,r=t.location_,i=t.mappings_,o=t.blob_,a=t.metadata_,s=r.bucketOnlyServerUrl(),c={name:(u=Bg(r,o,a)).fullPath},h=yg(s),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":o.size(),"X-Goog-Upload-Header-Content-Type":u.contentType,"Content-Type":"application/json; charset=utf-8"},f=Tg(u,i),p=n.maxUploadRetryTime(),(d=new Lg(h,"POST",function(t){var e;Qg(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){Mg(!1)}return Mg(sg(e)),e},p)).urlParams=c,d.headers=l,d.body=f,d.errorHandler=qg(r),d),m=t.authWrapper_.makeRequest(y,e);(t.request_=m).getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r,i,o,a,s,u,c=(r=t.authWrapper_,i=t.location_,o=e,a=t.blob_,s=r.maxUploadRetryTime(),(u=new Lg(o,"POST",function(t){var e,n=Qg(t,["active","final"]);try{e=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){Mg(!1)}var r=parseInt(e,10);return Mg(!isNaN(r)),new Wg(r,a.size(),"final"===n)},s)).headers={"X-Goog-Upload-Command":"query"},u.errorHandler=qg(i),u),h=t.authWrapper_.makeRequest(c,n);(t.request_=h).getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new Wg(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=Kg(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(i){return t.error_=i,void t.transition_(Xv)}var a=t.authWrapper_.makeRequest(o,i);(t.request_=a).getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(Gv)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=jg(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(Gv)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=Bg(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Tg(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=Og.getBlob(c,r,h);if(null===l)throw kv();var f={name:u.fullPath},p=yg(o),d=t.maxUploadRetryTime(),y=new Lg(p,"POST",Fg(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=qg(e),y}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);(t.request_=r).getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(Gv)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case zv:case Kv:this.state_=t,null!==this.request_&&this.request_.cancel();break;case Qv:var e=this.state_===Hv;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Hv:this.state_=t,this.notifyObservers_();break;case Yv:this.error_=Av(),this.state_=t,this.notifyObservers_();break;case Xv:case Gv:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Kv:this.transition_(Hv);break;case zv:this.transition_(Yv);break;case Qv:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=$v(this.state_);return new Gg(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){void 0===e&&(e=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=Rg(!0).validator,a=Dg(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(ig(t.next)||ig(t.error)||ig(t.complete)))throw"";return}catch(t){throw i}}Cg("on",[Ng(function(){if(t!==Wv.STATE_CHANGED)throw"Expected one of the event types: ["+Wv.STATE_CHANGED+"]."}),Dg(s,!0),Rg(!0),Rg(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&Cg("on",t,arguments);var o=new Hg(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[Dg(function(t){if(null===t)throw i;s(t)}),Rg(!0),Rg(!0)];return ig(e)||ig(n)||ig(r)?c(null)(e,n,r):c(h)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e,n,r;n=t,-1!==(r=(e=this.observers_).indexOf(n))&&e.splice(r,1)},t.prototype.notifyObservers_=function(){var t,e=this;this.finishPromise_(),(t=this.observers_,Array.prototype.slice.call(t)).forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch($v(this.state_)){case Jv.SUCCESS:zg(this.resolve_.bind(null,this.snapshot))();break;case Jv.CANCELED:case Jv.ERROR:zg(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch($v(this.state_)){case Jv.RUNNING:case Jv.PAUSED:null!==t.next&&zg(t.next.bind(t,this.snapshot))();break;case Jv.SUCCESS:null!==t.complete&&zg(t.complete.bind(t))();break;case Jv.CANCELED:case Jv.ERROR:null!==t.error&&zg(t.error.bind(t,this.error_))();break;default:null!==t.error&&zg(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){Cg("resume",[],arguments);var t=this.state_===Hv||this.state_===Kv;return t&&this.transition_(Qv),t},t.prototype.pause=function(){Cg("pause",[],arguments);var t=this.state_===Qv;return t&&this.transition_(Kv),t},t.prototype.cancel=function(){Cg("cancel",[],arguments);var t=this.state_===Qv||this.state_===Kv;return t&&this.transition_(zv),t},t}(),Xg=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof pg?e:pg.makeFromUrl(e)}return t.prototype.toString=function(){return Cg("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return bg()},t.prototype.child=function(t){Cg("child",[Ng()],arguments);var e,n,r=(e=this.location.path,n=t.split("/").filter(function(t){return 0<t.length}).join("/"),0===e.length?n:e+"/"+n),i=new pg(this.location.bucket,r);return this.newRef(this.authWrapper,i)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new pg(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new pg(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return dg(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),Cg("put",[new Ig(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||cg()&&t instanceof Blob))throw"Expected Blob or File."}),Ag(!0)],arguments),this.throwIfRoot_("put"),new Yg(this,this.authWrapper,this.location,this.mappings(),new Og(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=xv.RAW),Cg("putString",[Ng(),Ng(Lv,!0),Ag(!0)],arguments),this.throwIfRoot_("putString");var r=Fv(e,t),i=tg(n);return!rg(i.contentType)&&rg(r.contentType)&&(i.contentType=r.contentType),new Yg(this,this.authWrapper,this.location,this.mappings(),new Og(r.data,!0),i)},t.prototype.delete=function(){Cg("delete",[],arguments),this.throwIfRoot_("delete");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n,r,i,o,a,s=(n=t.authWrapper,i=yg((r=t.location).fullServerUrl()),o=n.maxOperationRetryTime(),(a=new Lg(i,"DELETE",function(){},o)).successCodes=[200,204],a.errorHandler=Vg(r),a);return t.authWrapper.makeRequest(s,e).getPromise()})},t.prototype.getMetadata=function(){Cg("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=jg(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){Cg("updateMetadata",[Ag()],arguments),this.throwIfRoot_("updateMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(n){var r,i,o,a,s,u,c,h,l=(r=e.authWrapper,i=e.location,o=t,a=e.mappings(),s=yg(i.fullServerUrl()),u=Tg(o,a),c=r.maxOperationRetryTime(),(h=new Lg(s,"PATCH",Fg(r,a),c)).headers={"Content-Type":"application/json; charset=utf-8"},h.body=u,h.errorHandler=Vg(i),h);return e.authWrapper.makeRequest(l,n).getPromise()})},t.prototype.getDownloadURL=function(){Cg("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n,r,i,o,a,s,u=(n=t.authWrapper,r=t.location,i=t.mappings(),o=yg(r.fullServerUrl()),a=n.maxOperationRetryTime(),(s=new Lg(o,"GET",Ug(n,i),a)).errorHandler=Vg(r),s);return t.authWrapper.makeRequest(u,e).getPromise().then(function(t){if(null===t)throw new Sv(Cv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw e=t,new Sv(Cv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");var e},t}(),Jg=function(){function t(t){var e;this.promise_=(e=t,Promise.reject(e))}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),$g=function(){function t(){this.map_={},this.id_=-9007199254740991}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){Zv(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),Zg=function(){function t(e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var a=this.app_.options;rg(a)&&(this.bucket_=t.extractBucket_(a))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new $g}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:pg.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&rg(this.app_.INTERNAL)&&rg(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):ng(null)},t.prototype.bucket=function(){if(this.deleted_)throw Rv();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new Jg(Rv());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}(),t_=function(){function t(t,e,n,r,i,o,a,s,u,c,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h;var l=this;this.promise_=eg(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());ig(s)?i(s):i()}catch(e){o(e)}else null!==a?((r=Nv()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?Rv():Av()):o(r=new Sv(Cv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new e_(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){u||(u=!0,e.apply(null,arguments))}function h(e){i=setTimeout(function(){i=null,t(l,s())},e)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.apply(null,arguments):s()||o?c.apply(null,arguments):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},n),p}(function(e,n){if(n)e(!1,new e_(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===Vv.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=xg(t.successCodes_,o);e(!0,new e_(a,n))}else{var s=n.getErrorCode()===Vv.ABORT;e(!1,new e_(!1,null,s))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=xg([408,429],t),r=xg(this.additionalRetryCodes_,t);return e||n||r},t}(),e_=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function n_(t,e,n){var r,i,o,a,s=mg(t.urlParams),u=t.url+s,c=tg(t.headers);return r=c,null!==(i=e)&&0<i.length&&(r.Authorization="Firebase "+i),o=c,a=void 0!==er?er.SDK_VERSION:"AppManager",o["X-Firebase-Storage-Version"]="webjs/"+a,new t_(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var r_,i_=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Zg(t,function(t,e){return new Xg(t,e)},n_,this,e),this.app_=t,null!=n)this.bucket_=pg.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new pg(r,""))}this.internals_=new o_(this)}return t.prototype.ref=function(t){if(Cg("ref",[Ng(function(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new Xg(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return Cg("refFromURL",[Ng(function(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{pg.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Xg(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){Cg("setMaxUploadRetryTime",[kg()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){Cg("setMaxOperationRetryTime",[kg()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),o_=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),ng(void 0)},t}();return r_={TaskState:Jv,TaskEvent:Wv,StringFormat:xv,Storage:i_,Reference:Xg},er.INTERNAL.registerService("storage",function(t,e,n){return new i_(t,new lg,n)},r_,void 0,!0),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),er}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,r="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,o="ArrayBuffer"in t;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<a.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),p(t)},d.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),p(t)},d.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),p(t)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},_.call(b.prototype),_.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=b,t.Response=E,t.fetch=function(t,e){return new Promise(function(n,i){var o=new b(t,e),a=new XMLHttpRequest;a.onload=function(){var t,e,r={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",e=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;n(new E(i,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),o.headers.forEach(function(t,e){a.setRequestHeader(e,t)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function v(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(r&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(i&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(o&&r&&s(t))this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var t,e,n,r=y(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,n=m(e=new FileReader),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(t,e){var n,r,i=(e=e||{}).body;if(t instanceof b){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(r=(n=e.method||this.method||"GET").toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function w(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var r=setTimeout;function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(n){return void u(e.promise,n)}s(e.promise,r)}else(1===t._state?s:u)(e.promise,t._value)})):t._deferreds.push(e)}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void c(t);if("function"==typeof n)return void l((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,c(t)}catch(e){u(t,e)}var r,i}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function h(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new h(t,e,n)),n},o.prototype.finally=n,o.all=function(t){return new o(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(t,e)},n)}r[t]=a,0==--i&&e(r)}catch(a){n(a)}}for(var a=0;a<r.length;a++)o(a,r[a])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=n):f.Promise=o;var p=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("","return this")();"number"==typeof __g&&(__g=e)}),d=e(function(t){var e=t.exports={version:"2.6.5"};"number"==typeof __e&&(__e=e)}),y=(d.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),m=function(t){if(!y(t))throw TypeError(t+" is not an object!");return t},v=function(t){try{return!!t()}catch(t){return!0}},g=!v(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),_=p.document,b=y(_)&&y(_.createElement),w=function(t){return b?_.createElement(t):{}},E=!g&&!v(function(){return 7!=Object.defineProperty(w("div"),"a",{get:function(){return 7}}).a}),T=function(t,e){if(!y(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!y(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},S=Object.defineProperty,C={f:g?Object.defineProperty:function(t,e,n){if(m(t),e=T(e,!0),m(n),E)try{return S(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},I=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},N=g?function(t,e,n){return C.f(t,e,I(1,n))}:function(t,e,n){return t[e]=n,t},A={}.hasOwnProperty,k=function(t,e){return A.call(t,e)},D=0,R=Math.random(),P=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++D+R).toString(36))},O=e(function(t){var e="__core-js_shared__",n=p[e]||(p[e]={});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:d.version,mode:"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})}),x=O("native-function-to-string",Function.toString),L=e(function(t){var e=P("src"),n="toString",r=(""+x).split(n);d.inspectSource=function(t){return x.call(t)},(t.exports=function(t,n,i,o){var a="function"==typeof i;a&&(k(i,"name")||N(i,"name",n)),t[n]!==i&&(a&&(k(i,e)||N(i,e,t[n]?""+t[n]:r.join(String(n)))),t===p?t[n]=i:o?t[n]?t[n]=i:N(t,n,i):(delete t[n],N(t,n,i)))})(Function.prototype,n,function(){return"function"==typeof this&&this[e]||x.call(this)})}),M=function(t,e,n){if(function(){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},F="prototype",U=function(t,e,n){var r,i,o,a,s=t&U.F,u=t&U.G,c=t&U.S,h=t&U.P,l=t&U.B,f=u?p:c?p[e]||(p[e]={}):(p[e]||{})[F],y=u?d:d[e]||(d[e]={}),m=y[F]||(y[F]={});for(r in u&&(n=e),n)o=((i=!s&&f&&void 0!==f[r])?f:n)[r],a=l&&i?M(o,p):h&&"function"==typeof o?M(Function.call,o):o,f&&L(f,r,o,t&U.U),y[r]!=o&&N(y,r,a),h&&m[r]!=o&&(m[r]=o)};p.core=d,U.F=1,U.G=2,U.S=4,U.P=8,U.B=16,U.W=32,U.U=64,U.R=128;var q=U,V={}.toString,j=function(t){return V.call(t).slice(8,-1)},B=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==j(t)?t.split(""):Object(t)},W=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t},Q=function(t){return Object(W(t))},K=Math.ceil,H=Math.floor,G=function(t){return isNaN(t=+t)?0:(0<t?H:K)(t)},z=Math.min,Y=function(t){return 0<t?z(G(t),9007199254740991):0},X=Array.isArray||function(t){return"Array"==j(t)},J=e(function(t){var e=O("wks"),n=p.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:P)("Symbol."+t))}).store=e}),$=J("species"),Z=function(t,e){return X(n=t)&&("function"!=typeof(r=n.constructor)||r!==Array&&!X(r.prototype)||(r=void 0),y(r)&&null===(r=r[$])&&(r=void 0)),new(void 0===r?Array:r)(e);var n,r},tt=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,u=e||Z;return function(e,c,h){for(var l,f,p=Q(e),d=B(p),y=M(c,h,3),m=Y(d.length),v=0,g=n?u(e,m):r?u(e,0):void 0;v<m;v++)if((s||v in d)&&(f=y(l=d[v],v,p),t))if(n)g[v]=f;else if(f)switch(t){case 3:return!0;case 5:return l;case 6:return v;case 2:g.push(l)}else if(o)return!1;return a?-1:i||o?o:g}},et=J("unscopables"),nt=Array.prototype;null==nt[et]&&N(nt,et,{});var rt=function(t){nt[et][t]=!0},it=tt(5),ot="find",at=!0;ot in[]&&Array(1)[ot](function(){at=!1}),q(q.P+q.F*at,"Array",{find:function(t){return it(this,t,1<arguments.length?arguments[1]:void 0)}}),rt(ot),d.Array.find;var st=tt(6),ut="findIndex",ct=!0;ut in[]&&Array(1)[ut](function(){ct=!1}),q(q.P+q.F*ct,"Array",{findIndex:function(t){return st(this,t,1<arguments.length?arguments[1]:void 0)}}),rt(ut),d.Array.findIndex;var ht=function(t){return B(W(t))},lt=Math.max,ft=Math.min,pt=O("keys"),dt=function(t){return pt[t]||(pt[t]=P(t))},yt=function(t,e,n){for(var r,i,o=ht(t),a=Y(o.length),s=(i=a,(r=G(r=n))<0?lt(r+i,0):ft(r,i));s<a;s++)if(s in o&&o[s]===e)return s||0;return-1},mt=dt("IE_PROTO"),vt=function(t,e){var n,r=ht(t),i=0,o=[];for(n in r)n!=mt&&k(r,n)&&o.push(n);for(;e.length>i;)k(r,n=e[i++])&&(~yt(o,n)||o.push(n));return o},gt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),_t=Object.keys||function(t){return vt(t,gt)},bt={f:Object.getOwnPropertySymbols},wt={f:{}.propertyIsEnumerable},Et=Object.assign,Tt=!Et||v(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Et({},t)[n]||Object.keys(Et({},e)).join("")!=r})?function(t){for(var e=Q(t),n=arguments.length,r=1,i=bt.f,o=wt.f;r<n;)for(var a,s=B(arguments[r++]),u=i?_t(s).concat(i(s)):_t(s),c=u.length,h=0;h<c;)o.call(s,a=u[h++])&&(e[a]=s[a]);return e}:Et;q(q.S+q.F,"Object",{assign:Tt}),d.Object.assign;var St=J("match"),Ct=function(t,e,n){if(y(r=e)&&(void 0!==(i=r[St])?i:"RegExp"==j(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,i;return String(W(t))},It=J("match"),Nt="startsWith",At=""[Nt];q(q.P+q.F*function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[It]=!1,!"/./"[e](n)}catch(t){}}return!0}(Nt),"String",{startsWith:function(t){var e=Ct(this,t,Nt),n=Y(Math.min(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return At?At.call(e,r,n):e.slice(n,n+r.length)===r}}),d.String.startsWith,q(q.P,"String",{repeat:function(t){var e=String(W(this)),n="",r=G(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}}),d.String.repeat;var kt=e(function(t){var e=P("meta"),n=C.f,r=0,i=Object.isExtensible||function(){return!0},o=!v(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!y(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!k(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!k(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!k(t,e)&&a(t),t}}}),Dt=(kt.KEY,kt.NEED,kt.fastKey,kt.getWeak,kt.onFreeze,C.f),Rt=J("toStringTag"),Pt=function(t,e,n){t&&!k(t=n?t:t.prototype,Rt)&&Dt(t,Rt,{configurable:!0,value:e})},Ot={f:J},xt=C.f,Lt=function(t){var e=d.Symbol||(d.Symbol=p.Symbol||{});"_"==t.charAt(0)||t in e||xt(e,t,{value:Ot.f(t)})},Mt=g?Object.defineProperties:function(t,e){m(t);for(var n,r=_t(e),i=r.length,o=0;o<i;)C.f(t,n=r[o++],e[n]);return t},Ft=p.document,Ut=Ft&&Ft.documentElement,qt=dt("IE_PROTO"),Vt=function(){},jt="prototype",Bt=function(){var t,e=w("iframe"),n=gt.length;for(e.style.display="none",Ut.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),Bt=t.F;n--;)delete Bt[jt][gt[n]];return Bt()},Wt=Object.create||function(t,e){var n;return null!==t?(Vt[jt]=m(t),n=new Vt,Vt[jt]=null,n[qt]=t):n=Bt(),void 0===e?n:Mt(n,e)},Qt=gt.concat("length","prototype"),Kt={f:Object.getOwnPropertyNames||function(t){return vt(t,Qt)}},Ht=Kt.f,Gt={}.toString,zt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Yt={f:function(t){return zt&&"[object Window]"==Gt.call(t)?function(t){try{return Ht(t)}catch(t){return zt.slice()}}(t):Ht(ht(t))}},Xt=Object.getOwnPropertyDescriptor,Jt={f:g?Xt:function(t,e){if(t=ht(t),e=T(e,!0),E)try{return Xt(t,e)}catch(t){}if(k(t,e))return I(!wt.f.call(t,e),t[e])}},$t=kt.KEY,Zt=Jt.f,te=C.f,ee=Yt.f,ne=p.Symbol,re=p.JSON,ie=re&&re.stringify,oe="prototype",ae=J("_hidden"),se=J("toPrimitive"),ue={}.propertyIsEnumerable,ce=O("symbol-registry"),he=O("symbols"),le=O("op-symbols"),fe=Object[oe],pe="function"==typeof ne,de=p.QObject,ye=!de||!de[oe]||!de[oe].findChild,me=g&&v(function(){return 7!=Wt(te({},"a",{get:function(){return te(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Zt(fe,e);r&&delete fe[e],te(t,e,n),r&&t!==fe&&te(fe,e,r)}:te,ve=function(t){var e=he[t]=Wt(ne[oe]);return e._k=t,e},ge=pe&&"symbol"==typeof ne.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof ne},_e=function(t,e,n){return t===fe&&_e(le,e,n),m(t),e=T(e,!0),m(n),k(he,e)?(n.enumerable?(k(t,ae)&&t[ae][e]&&(t[ae][e]=!1),n=Wt(n,{enumerable:I(0,!1)})):(k(t,ae)||te(t,ae,I(1,{})),t[ae][e]=!0),me(t,e,n)):te(t,e,n)},be=function(t,e){m(t);for(var n,r=function(t){var e=_t(t),n=bt.f;if(n)for(var r,i=n(t),o=wt.f,a=0;i.length>a;)o.call(t,r=i[a++])&&e.push(r);return e}(e=ht(e)),i=0,o=r.length;i<o;)_e(t,n=r[i++],e[n]);return t},we=function(t){var e=ue.call(this,t=T(t,!0));return!(this===fe&&k(he,t)&&!k(le,t))&&(!(e||!k(this,t)||!k(he,t)||k(this,ae)&&this[ae][t])||e)},Ee=function(t,e){if(t=ht(t),e=T(e,!0),t!==fe||!k(he,e)||k(le,e)){var n=Zt(t,e);return!n||!k(he,e)||k(t,ae)&&t[ae][e]||(n.enumerable=!0),n}},Te=function(t){for(var e,n=ee(ht(t)),r=[],i=0;n.length>i;)k(he,e=n[i++])||e==ae||e==$t||r.push(e);return r},Se=function(t){for(var e,n=t===fe,r=ee(n?le:ht(t)),i=[],o=0;r.length>o;)!k(he,e=r[o++])||n&&!k(fe,e)||i.push(he[e]);return i};pe||(L((ne=function(){if(this instanceof ne)throw TypeError("Symbol is not a constructor!");var t=P(0<arguments.length?arguments[0]:void 0),e=function(n){this===fe&&e.call(le,n),k(this,ae)&&k(this[ae],t)&&(this[ae][t]=!1),me(this,t,I(1,n))};return g&&ye&&me(fe,t,{configurable:!0,set:e}),ve(t)})[oe],"toString",function(){return this._k}),Jt.f=Ee,C.f=_e,Kt.f=Yt.f=Te,wt.f=we,bt.f=Se,g&&L(fe,"propertyIsEnumerable",we,!0),Ot.f=function(t){return ve(J(t))}),q(q.G+q.W+q.F*!pe,{Symbol:ne});for(var Ce="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ie=0;Ce.length>Ie;)J(Ce[Ie++]);for(var Ne=_t(J.store),Ae=0;Ne.length>Ae;)Lt(Ne[Ae++]);q(q.S+q.F*!pe,"Symbol",{for:function(t){return k(ce,t+="")?ce[t]:ce[t]=ne(t)},keyFor:function(t){if(!ge(t))throw TypeError(t+" is not a symbol!");for(var e in ce)if(ce[e]===t)return e},useSetter:function(){ye=!0},useSimple:function(){ye=!1}}),q(q.S+q.F*!pe,"Object",{create:function(t,e){return void 0===e?Wt(t):be(Wt(t),e)},defineProperty:_e,defineProperties:be,getOwnPropertyDescriptor:Ee,getOwnPropertyNames:Te,getOwnPropertySymbols:Se}),re&&q(q.S+q.F*(!pe||v(function(){var t=ne();return"[null]"!=ie([t])||"{}"!=ie({a:t})||"{}"!=ie(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(y(e)||void 0!==t)&&!ge(t))return X(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!ge(e))return e}),r[1]=e,ie.apply(re,r)}}),ne[oe][se]||N(ne[oe],se,ne[oe].valueOf),Pt(ne,"Symbol"),Pt(Math,"Math",!0),Pt(p.JSON,"JSON",!0);var ke=J("toStringTag"),De="Arguments"==j(function(){return arguments}()),Re={};Re[J("toStringTag")]="z",Re+""!="[object z]"&&L(Object.prototype,"toString",function(){return"[object "+(void 0===this?"Undefined":null===this?"Null":"string"==typeof(e=function(t,e){try{return t[e]}catch(t){}}(t=Object(this),ke))?e:De?j(t):"Object"==(n=j(t))&&"function"==typeof t.callee?"Arguments":n)+"]";var t,e,n},!0),Lt("asyncIterator"),Lt("observable"),d.Symbol;var Pe={},Oe={};N(Oe,J("iterator"),function(){return this});var xe=dt("IE_PROTO"),Le=Object.prototype,Me=Object.getPrototypeOf||function(t){return t=Q(t),k(t,xe)?t[xe]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Le:null},Fe=J("iterator"),Ue=!([].keys&&"next"in[].keys()),qe="values",Ve=function(){return this},je=function(t,e,n,r,i,o,a){var s,u,c;u=e,c=r,(s=n).prototype=Wt(Oe,{next:I(1,c)}),Pt(s,u+" Iterator");var h,l,f,p=function(t){if(!Ue&&t in v)return v[t];switch(t){case"keys":case qe:return function(){return new n(this,t)}}return function(){return new n(this,t)}},d=e+" Iterator",y=i==qe,m=!1,v=t.prototype,g=v[Fe]||v["@@iterator"]||i&&v[i],_=g||p(i),b=i?y?p("entries"):_:void 0,w="Array"==e&&v.entries||g;if(w&&(f=Me(w.call(new t)))!==Object.prototype&&f.next&&(Pt(f,d,!0),"function"!=typeof f[Fe]&&N(f,Fe,Ve)),y&&g&&g.name!==qe&&(m=!0,_=function(){return g.call(this)}),(Ue||m||!v[Fe])&&N(v,Fe,_),Pe[e]=_,Pe[d]=Ve,i)if(h={values:y?_:p(qe),keys:o?_:p("keys"),entries:b},a)for(l in h)l in v||L(v,l,h[l]);else q(q.P+q.F*(Ue||m),e,h);return h},Be=function(t,e){var n,r,i=String(W(t)),o=G(e),a=i.length;return o<0||a<=o?"":(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?i.charAt(o):i.slice(o,o+2)};je(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Be(e,n),this._i+=t.length,{value:t,done:!1})});var We=function(t,e){return{value:e,done:!!t}},Qe=je(Array,"Array",function(t,e){this._t=ht(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,We(1)):We(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");Pe.Arguments=Pe.Array,rt("keys"),rt("values"),rt("entries");for(var Ke=J("iterator"),He=J("toStringTag"),Ge=Pe.Array,ze={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},Ye=_t(ze),Xe=0;Xe<Ye.length;Xe++){var Je,$e=Ye[Xe],Ze=ze[$e],tn=p[$e],en=tn&&tn.prototype;if(en&&(en[Ke]||N(en,Ke,Ge),en[He]||N(en,He,$e),Pe[$e]=Ge,Ze))for(Je in Qe)en[Je]||L(en,Je,Qe[Je],!0)}Ot.f("iterator");var nn=function(t,e){return(nn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function rn(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=rn(t[n],e[n]));return t}function on(t,e,n){t[e]=n}var an="FirebaseError",sn=Error.captureStackTrace,un=function(t,e){if(this.code=t,this.message=e,sn)sn(this,cn.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=an,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};((un.prototype=Object.create(Error.prototype)).constructor=un).prototype.name=an;var cn=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new un(i,n);for(var a in e)e.hasOwnProperty(a)&&"_"!==a.slice(-1)&&(o[a]=e[a]);return o},t}();function hn(t,e){var n=new ln(t,e);return n.subscribe.bind(n)}!function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}(function(t,e){function n(){this.constructor=t}nn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)})(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}(function(){this.blockSize=-1});var ln=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t){if("object"!=typeof t||null===t)return!1;for(var e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=fn),void 0===r.error&&(r.error=fn),void 0===r.complete&&(r.complete=fn);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function fn(){}var pn=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},dn="[DEFAULT]",yn=[],mn=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=rn(void 0,t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){yn.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){yn=yn.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var e=[];return Object.keys(t.services_).forEach(function(n){Object.keys(t.services_[n]).forEach(function(r){e.push(t.services_[n][r])})}),Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=dn),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==dn?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;rn(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(yn.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),yn=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&vn("app-deleted",{name:this.name_})},t}();function vn(t,e){throw gn.create(t,e)}mn.prototype.name&&mn.prototype.options||mn.prototype.delete||console.log("dc");var gn=new cn("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),_n=!1;try{_n="[object process]"===Object.prototype.toString.call(global.process)}catch(t){}return _n&&console.warn('\nWarning: This is a browser-targeted Firebase bundle but it appears it is being\nrun in a Node environment.  If running in a Node environment, make sure you\nare using the bundle specified by the "main" field in package.json.\n\nIf you are using Webpack, you can specify "main" as the first item in\n"resolve.mainFields":\nhttps://webpack.js.org/configuration/resolve/#resolvemainfields\n\nIf using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\nto false and "main" to true:\nhttps://github.com/rollup/rollup-plugin-node-resolve\n'),function t(){var e={},n={},r={},i={__esModule:!0,initializeApp:function(t,n){void 0===n&&(n={}),("object"!=typeof n||null===n)&&(n={name:n});var r=n;void 0===r.name&&(r.name=dn);var o=r.name;"string"==typeof o&&o||vn("bad-app-name",{name:o+""}),pn(e,o)&&vn("duplicate-app",{name:o});var a=new mn(t,r,i);return s(e[o]=a,"create"),a},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.9.2",INTERNAL:{registerService:function(t,e,s,u,c){n[t]&&vn("duplicate-service",{name:t}),n[t]=e,u&&(r[t]=u,a().forEach(function(t){u("create",t)}));var h=function(e){return void 0===e&&(e=o()),"function"!=typeof e[t]&&vn("invalid-app-argument",{name:t}),e[t]()};return void 0!==s&&rn(h,s),i[t]=h,mn.prototype[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,t).apply(this,c?e:[])},h},createFirebaseNamespace:t,extendNamespace:function(t){rn(i,t)},createSubscribe:hn,ErrorFactory:cn,removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u,Promise:Promise,deepExtend:rn}};function o(t){return pn(e,t=t||dn)||vn("no-app",{name:t}),e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){Object.keys(n).forEach(function(n){var i=u(t,n);null!==i&&r[i]&&r[i](e,t)})}function u(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return on(i,"default",i),Object.defineProperty(i,"apps",{get:a}),on(o,"App",mn),i}()}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(t){"use strict";try{(function(){t=t&&t.hasOwnProperty("default")?t.default:t,function(){var e,n=n||{},r=this;function i(t){return"string"==typeof t}function o(t){return"boolean"==typeof t}var a=/^[\w+/_-]+[=]{0,2}$/,s=null;function u(){}function c(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function h(t){return null===t}function l(t){return"array"==c(t)}function f(t){var e=c(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){return"function"==c(t)}function d(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var y="closure_uid_"+(1e9*Math.random()>>>0),m=0;function v(t,e,n){return t.call.apply(t.bind,arguments)}function g(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:g).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var w=Date.now||function(){return+new Date};function E(t,e){function n(){}n.prototype=e.prototype,t.pb=e.prototype,t.prototype=new n,(t.prototype.constructor=t).gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function T(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function S(t){if(Error.captureStackTrace)Error.captureStackTrace(this,S);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function C(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");S.call(this,n+t[r])}function I(t,e){throw new C("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function N(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function A(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function k(){this.b=this.a=null}E(S,Error),S.prototype.name="CustomError",E(C,S),C.prototype.name="AssertionError",N.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var D=new N(function(){return new R},function(t){t.reset()});function R(){this.next=this.b=this.a=null}k.prototype.add=function(t,e){var n=D.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},R.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},R.prototype.reset=function(){this.next=this.b=this.a=null};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(i(t))return i(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},O=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,o=i(t)?t.split(""):t,a=0;a<r;a++)a in o&&e.call(n,o[a],a,t)},x=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),o=i(t)?t.split(""):t,a=0;a<n;a++)a in o&&(r[a]=e.call(void 0,o[a],a,t));return r},L=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=i(t)?t.split(""):t,o=0;o<n;o++)if(o in r&&e.call(void 0,r[o],o,t))return!0;return!1};function M(t,e){return 0<=P(t,e)}function F(t,e){var n;return(n=0<=(e=P(t,e)))&&Array.prototype.splice.call(t,e,1),n}function U(t,e){!function(t,e){var n=t.length,r=i(t)?t.split(""):t;for(--n;0<=n;--n)n in r&&e.call(void 0,r[n],n,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1).length})}function q(t){return Array.prototype.concat.apply([],arguments)}function V(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var j,B=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},W=/&/g,Q=/</g,K=/>/g,H=/"/g,G=/'/g,z=/\x00/g,Y=/[\x00&<>"']/;function X(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var $=r.navigator;if($){var Z=$.userAgent;if(Z){j=Z;break t}}j=""}function tt(t){return X(j,t)}function et(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function nt(t){for(var e in t)return!1;return!0}function rt(t){var e,n={};for(e in t)n[e]=t[e];return n}var it,ot,at="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function st(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<at.length;o++)n=at[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ut(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function ct(t){return Y.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(W,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(Q,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(K,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(H,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(G,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(z,"&#0;"))),t}function ht(t){r.setTimeout(function(){throw t},0)}function lt(t,e){ot||function(){if(r.Promise&&r.Promise.resolve){var t=r.Promise.resolve(void 0);ot=function(){t.then(dt)}}else ot=function(){var t=dt;!p(r.setImmediate)||r.Window&&r.Window.prototype&&!tt("Edge")&&r.Window.prototype.setImmediate==r.setImmediate?(it||(it=function(){var t=r.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!tt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||tt("Trident")||tt("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){r.setTimeout(t,0)};var e=new t,n={},i=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).xb;n.xb=null,t()}},function(t){i.next={xb:t},i=i.next,e.port2.postMessage(0)}}()),it(t)):r.setImmediate(t)}}(),ft||(ot(),ft=!0),pt.add(t,e)}var ft=!1,pt=new k;function dt(){for(var t;n=e=void 0,n=null,(e=pt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){ht(t)}A(D,t)}var e,n;ft=!1}function yt(t,e){if(this.a=mt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=u)try{var n=this;t.call(e,function(t){At(n,vt,t)},function(t){if(!(t instanceof Lt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}At(n,gt,t)})}catch(t){At(this,gt,t)}}var mt=0,vt=2,gt=3;function _t(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}_t.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var bt=new N(function(){return new _t},function(t){t.reset()});function wt(t,e,n){var r=bt.get();return r.g=t,r.b=e,r.f=n,r}function Et(t){if(t instanceof yt)return t;var e=new yt(u);return At(e,vt,t),e}function Tt(t){return new yt(function(e,n){n(t)})}function St(t,e,n){kt(t,e,n,null)||lt(b(e,t))}function Ct(t){return new yt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Eb:!0,value:o}:{Eb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)St(t[o],b(i,o,!0),b(i,o,!1));else e(r)})}function It(t,e){t.b||t.a!=vt&&t.a!=gt||Dt(t),t.f?t.f.next=e:t.b=e,t.f=e}function Nt(t,e,n,r){var i=wt(null,null,null);return i.a=new yt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(n){o(n)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof Lt?o(e):t(i)}catch(e){o(e)}}:o}),It(i.a.c=t,i),i.a}function At(t,e,n){var r,i;t.a==mt&&(t===n&&(e=gt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,kt(n,t.Pc,t.Qc,t)||(t.i=n,t.a=e,t.c=null,Dt(t),e!=gt||n instanceof Lt||(i=n,(r=t).g=!0,lt(function(){r.g&&xt.call(null,i)}))))}function kt(t,e,n,r){if(t instanceof yt)return It(t,wt(e||u,n||null,r)),!0;if(T(t))return t.then(e,n,r),!0;if(d(t))try{var i=t.then;if(p(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function Dt(t){t.h||(t.h=!0,lt(t.Yb,t))}function Rt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function Pt(t,e,n,r){if(n==gt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Ot(e,n,r);else try{e.c?e.g.call(e.f):Ot(e,n,r)}catch(t){xt.call(null,t)}A(bt,e)}function Ot(t,e,n){e==vt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}yt.prototype.then=function(t,e,n){return Nt(this,p(t)?t:null,p(e)?e:null,n)},yt.prototype.$goog_Thenable=!0,(e=yt.prototype).ia=function(t,e){return(t=wt(t,t,e)).c=!0,It(this,t),this},e.s=function(t,e){return Nt(this,null,t,e)},e.cancel=function(t){this.a==mt&&lt(function(){!function t(e,n){if(e.a==mt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==mt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):Rt(r),Pt(r,o,gt,n)))}e.c=null}else At(e,gt,n)}(this,new Lt(t))},this)},e.Pc=function(t){this.a=mt,At(this,vt,t)},e.Qc=function(t){this.a=mt,At(this,gt,t)},e.Yb=function(){for(var t;t=Rt(this);)Pt(this,t,this.a,this.i);this.h=!1};var xt=ht;function Lt(t){S.call(this,t)}function Mt(){this.qa=this.qa,this.ja=this.ja}E(Lt,S);var Ft=0;function Ut(t){t.qa||(t.qa=!0,t.va(),0==Ft)||t[y]||(t[y]=++m)}function qt(t){return qt[" "](t),t}Mt.prototype.qa=!(Lt.prototype.name="cancel"),Mt.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},qt[" "]=u;var Vt,jt,Bt=tt("Opera"),Wt=tt("Trident")||tt("MSIE"),Qt=tt("Edge"),Kt=Qt||Wt,Ht=tt("Gecko")&&!(X(j.toLowerCase(),"webkit")&&!tt("Edge"))&&!(tt("Trident")||tt("MSIE"))&&!tt("Edge"),Gt=X(j.toLowerCase(),"webkit")&&!tt("Edge");function zt(){var t=r.document;return t?t.documentMode:void 0}t:{var Yt="",Xt=(jt=j,Ht?/rv:([^\);]+)(\)|;)/.exec(jt):Qt?/Edge\/([\d\.]+)/.exec(jt):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(jt):Gt?/WebKit\/(\S+)/.exec(jt):Bt?/(?:Version)[ \/]?(\S+)/.exec(jt):void 0);if(Xt&&(Yt=Xt?Xt[1]:""),Wt){var Jt=zt();if(null!=Jt&&Jt>parseFloat(Yt)){Vt=String(Jt);break t}}Vt=Yt}var $t,Zt={};function te(t){return e=t,n=function(){for(var e=0,n=B(String(Vt)).split("."),r=B(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=J(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==a[2].length,0==s[2].length)||J(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e},r=Zt,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n();var e,n,r}var ee=r.document;$t=ee&&Wt?zt()||("CSS1Compat"==ee.compatMode?parseInt(Vt,10):5):void 0;var ne=Object.freeze||function(t){return t},re=!Wt||9<=Number($t),ie=Wt&&!te("9"),oe=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{r.addEventListener("test",u,e),r.removeEventListener("test",u,e)}catch(t){}return t}();function ae(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function se(t,e){if(ae.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Ht){t:{try{qt(e.nodeName);var o=!0;break t}catch(t){}o=!1}o||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=i(t.pointerType)?t.pointerType:ue[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}ae.prototype.preventDefault=function(){this.Kb=!1},E(se,ae);var ue=ne({2:"touch",3:"pen",4:"mouse"});se.prototype.preventDefault=function(){se.pb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,ie)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},se.prototype.f=function(){return this.a};var ce="closure_listenable_"+(1e6*Math.random()|0),he=0;function le(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ma=i,this.key=++he,this.oa=this.Ia=!1}function fe(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Ma=null}function pe(t){this.src=t,this.a={},this.b=0}function de(t,e){var n=e.type;n in t.a&&F(t.a[n],e)&&(fe(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function ye(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Ma==r)return i}return-1}pe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=ye(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new le(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var me="closure_lm_"+(1e6*Math.random()|0),ve={};function ge(t,e,n,r,i){if(r&&r.once)be(t,e,n,r,i);else if(l(e))for(var o=0;o<e.length;o++)ge(t,e[o],n,r,i);else n=ke(n),t&&t[ce]?Re(t,e,n,d(r)?!!r.capture:!!r,i):_e(t,e,n,!1,r,i)}function _e(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a,s,u=d(i)?!!i.capture:!!i,c=Ne(t);if(c||(t[me]=c=new pe(t)),!(n=c.add(e,n,r,u,o)).proxy)if(a=Ie,r=s=re?function(t){return a.call(s.src,s.listener,t)}:function(t){if(!(t=a.call(s.src,s.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)oe||(i=u),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Te(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function be(t,e,n,r,i){if(l(e))for(var o=0;o<e.length;o++)be(t,e[o],n,r,i);else n=ke(n),t&&t[ce]?Pe(t,e,n,d(r)?!!r.capture:!!r,i):_e(t,e,n,!0,r,i)}function we(t,e,n,r,i){if(l(e))for(var o=0;o<e.length;o++)we(t,e[o],n,r,i);else r=d(r)?!!r.capture:!!r,n=ke(n),t&&t[ce]?(t=t.o,(e=String(e).toString())in t.a&&-1<(n=ye(o=t.a[e],n,r,i))&&(fe(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Ne(t))&&(e=t.a[e.toString()],t=-1,e&&(t=ye(e,n,r,i)),(n=-1<t?e[t]:null)&&Ee(n))}function Ee(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[ce])de(e.o,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Te(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ne(e))?(de(n,t),0==n.b&&(n.src=null,e[me]=null)):fe(t)}}}function Te(t){return t in ve?ve[t]:ve[t]="on"+t}function Se(t,e,n,r){var i=!0;if((t=Ne(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Ce(o,r),i=i&&!1!==o)}return i}function Ce(t,e){var n=t.listener,r=t.Ma||t.src;return t.Ia&&Ee(t),n.call(r,e)}function Ie(t,e){if(t.oa)return!0;if(re)return Ce(t,new se(e,this));if(!e)t:{e=["window","event"];for(var n=r,i=0;i<e.length;i++)if(null==(n=n[e[i]])){e=null;break t}e=n}if(e=new se(i=e,this),n=!0,!(i.keyCode<0||null!=i.returnValue)){t:{var o=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(t){o=!0}(o||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],o=e.b;o;o=o.parentNode)i.push(o);for(t=t.type,o=i.length-1;0<=o;o--){e.b=i[o];var a=Se(i[o],t,!0,e);n=n&&a}for(o=0;o<i.length;o++)e.b=i[o],a=Se(i[o],t,!1,e),n=n&&a}return n}function Ne(t){return(t=t[me])instanceof pe?t:null}var Ae="__closure_events_fn_"+(1e9*Math.random()>>>0);function ke(t){return p(t)?t:(t[Ae]||(t[Ae]=function(e){return t.handleEvent(e)}),t[Ae])}function De(){Mt.call(this),this.o=new pe(this),(this.Rb=this).Wa=null}function Re(t,e,n,r,i){t.o.add(String(e),n,!1,r,i)}function Pe(t,e,n,r,i){t.o.add(String(e),n,!0,r,i)}function Oe(t,e,n,r){if(!(e=t.o.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Ma||a.src;a.Ia&&de(t.o,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function xe(t,e,n){if(p(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:r.setTimeout(t,e||0)}function Le(t){var e=null;return new yt(function(n,r){-1==(e=xe(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw r.clearTimeout(e),t})}function Me(t){if(t.S&&"function"==typeof t.S)return t.S();if(i(t))return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function Fe(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(f(t)||i(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function Ue(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ue)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ve(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ve(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ve(t,e){return Object.prototype.hasOwnProperty.call(t,e)}E(De,Mt),De.prototype[ce]=!0,De.prototype.addEventListener=function(t,e,n,r){ge(this,t,e,n,r)},De.prototype.removeEventListener=function(t,e,n,r){we(this,t,e,n,r)},De.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Rb;var r=t.type||t;if(i(t))t=new ae(t,n);else if(t instanceof ae)t.target=t.target||n;else{var o=t;st(t=new ae(r,n),o)}if(o=!0,e)for(var a=e.length-1;0<=a;a--){var s=t.b=e[a];o=Oe(s,r,!0,t)&&o}if(o=Oe(s=t.b=n,r,!0,t)&&o,o=Oe(s,r,!1,t)&&o,e)for(a=0;a<e.length;a++)o=Oe(s=t.b=e[a],r,!1,t)&&o;return o},De.prototype.va=function(){if(De.pb.va.call(this),this.o){var t,e=this.o;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)fe(n[r]);delete e.a[t],e.b--}}this.Wa=null},(e=Ue.prototype).S=function(){qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},e.U=function(){return qe(this),this.a.concat()},e.clear=function(){this.b={},this.c=this.a.length=0},e.get=function(t,e){return Ve(this.b,t)?this.b[t]:e},e.set=function(t,e){Ve(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},e.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.b=this.o=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof Be){this.f=void 0!==e?e:t.f,We(this,t.c),this.o=t.o,this.b=t.b,Qe(this,t.i),this.g=t.g,e=t.a;var n=new on;n.c=e.c,e.a&&(n.a=new Ue(e.a),n.b=e.b),Ke(this,n),this.h=t.h}else t&&(n=String(t).match(je))?(this.f=!!e,We(this,n[1]||"",!0),this.o=Xe(n[2]||""),this.b=Xe(n[3]||"",!0),Qe(this,n[4]),this.g=Xe(n[5]||"",!0),Ke(this,n[6]||"",!0),this.h=Xe(n[7]||"")):(this.f=!!e,this.a=new on(null,this.f))}function We(t,e,n){t.c=n?Xe(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function Qe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Ke(t,e,n){var r,i;e instanceof on?(t.a=e,r=t.a,(i=t.f)&&!r.f&&(an(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),hn(this,n,t))},r)),r.f=i):(n||(e=Je(e,nn)),t.a=new on(e,t.f))}function He(t,e,n){t.a.set(e,n)}function Ge(t,e){return t.a.get(e)}function ze(t){return t instanceof Be?new Be(t):new Be(t,void 0)}function Ye(t,e){var n=new Be(null,void 0);return We(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Je(t,e,n){return i(t)?(t=encodeURI(t).replace(e,$e),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function $e(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Je(e,Ze,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Je(e,Ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Je(n,"/"==n.charAt(0)?en:tn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Je(n,rn)),t.join("")};var Ze=/[#\/\?@]/g,tn=/[#\?:]/g,en=/[#\?]/g,nn=/[#\?@]/g,rn=/#/g;function on(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(t){t.a||(t.a=new Ue,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function sn(t){var e=Fe(t);if(void 0===e)throw Error("Keys are undefined");var n=new on(null,void 0);t=Me(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];l(o)?hn(n,i,o):n.add(i,o)}return n}function un(t,e){an(t),e=ln(t,e),Ve(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ve((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&qe(t)))}function cn(t,e){return an(t),e=ln(t,e),Ve(t.a.b,e)}function hn(t,e,n){un(t,e),0<n.length&&(t.c=null,t.a.set(ln(t,e),V(n)),t.b+=n.length)}function ln(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(e=on.prototype).add=function(t,e){an(this),this.c=null,t=ln(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},e.clear=function(){this.a=this.c=null,this.b=0},e.forEach=function(t,e){an(this),this.a.forEach(function(n,r){O(n,function(n){t.call(e,n,r,this)},this)},this)},e.U=function(){an(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},e.S=function(t){an(this);var e=[];if(i(t))cn(this,t)&&(e=q(e,this.a.get(ln(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=q(e,t[n])}return e},e.set=function(t,e){return an(this),this.c=null,cn(this,t=ln(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},e.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},e.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var fn=!Wt||9<=Number($t);function pn(t,e){this.a=t===mn&&e||"",this.b=yn}function dn(t){return t instanceof pn&&t.constructor===pn&&t.b===yn?t.a:(I("expected object of type Const, got '"+t+"'"),"type_error:Const")}pn.prototype.na=!0,pn.prototype.ma=function(){return this.a},pn.prototype.toString=function(){return"Const{"+this.a+"}"};var yn={},mn={};function vn(){this.a="",this.b=En}function gn(t){return t instanceof vn&&t.constructor===vn&&t.b===En?t.a:(I("expected object of type TrustedResourceUrl, got '"+t+"' of type "+c(t)),"type_error:TrustedResourceUrl")}function _n(t,e){var n,r,i=dn(t);if(!wn.test(i))throw Error("Invalid TrustedResourceUrl format: "+i);return n=t=i.replace(bn,function(t,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw Error('Found marker, "'+n+'", in format string, "'+i+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[n])instanceof pn?dn(t):encodeURIComponent(String(t))}),(r=new vn).a=n,r}vn.prototype.na=!0,vn.prototype.ma=function(){return this.a},vn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var bn=/%{(\w+)}/g,wn=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,En={};function Tn(){this.a="",this.b=Nn}function Sn(t){return t instanceof Tn&&t.constructor===Tn&&t.b===Nn?t.a:(I("expected object of type SafeUrl, got '"+t+"' of type "+c(t)),"type_error:SafeUrl")}Tn.prototype.na=!0,Tn.prototype.ma=function(){return this.a},Tn.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Cn=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function In(t){return t instanceof Tn?t:(t="object"==typeof t&&t.na?t.ma():String(t),Cn.test(t)||(t="about:invalid#zClosurez"),An(t))}var Nn={};function An(t){var e=new Tn;return e.a=t,e}function kn(){this.a="",this.b=Dn}An("about:blank"),kn.prototype.na=!0,kn.prototype.ma=function(){return this.a},kn.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Dn={};function Rn(t){var e=new kn;return e.a=t,e}function Pn(t){var e=document;return i(t)?e.getElementById(t):t}function On(t,e){et(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:xn.hasOwnProperty(n)?t.setAttribute(xn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}Rn("<!DOCTYPE html>"),Rn(""),Rn("<br>");var xn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Ln(t,e,n){var r=arguments,o=document,a=String(r[0]),s=r[1];if(!fn&&s&&(s.name||s.type)){if(a=["<",a],s.name&&a.push(' name="',ct(s.name),'"'),s.type){a.push(' type="',ct(s.type),'"');var u={};st(u,s),delete u.type,s=u}a.push(">"),a=a.join("")}return a=o.createElement(a),s&&(i(s)?a.className=s:l(s)?a.className=s.join(" "):On(a,s)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(i(n)?t.createTextNode(n):n)}for(var o=2;o<n.length;o++){var a=n[o];!f(a)||d(a)&&0<a.nodeType?r(a):O(Mn(a)?V(a):a,r)}}(o,a,r),a}function Mn(t){if(t&&"number"==typeof t.length){if(d(t))return"function"==typeof t.item||"string"==typeof t.item;if(p(t))return"function"==typeof t.item}return!1}function Fn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(l(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),jn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":jn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Un,t,e),e.join("")}function Un(){}var qn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Vn=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function jn(t,e){e.push('"',t.replace(Vn,function(t){var e=qn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),qn[t]=e),e}),'"')}function Bn(){var t=sr();return Wt&&!!$t&&11==$t||/Edge\/\d+/.test(t)}function Wn(){return r.window&&r.window.location.href||self&&self.location&&self.location.href||""}function Qn(t,e){e=e||r.window;var n="about:blank";t&&(n=Sn(In(t))),e.location.href=n}function Kn(t){return!!((t=(t||sr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Hn(t){t=t||r.window;try{t.close()}catch(t){}}function Gn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=sr().toLowerCase(),r&&(e.target=r,X(n,"crios/")&&(e.target="_blank")),ir(sr())==nr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof Tn?n:In(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var a,s=i.join(",");if((tt("iPhone")&&!tt("iPod")&&!tt("iPad")||tt("iPad")||tt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(s=r.document.createElement("A"),e instanceof Tn||e instanceof Tn||(e="object"==typeof e&&e.na?e.ma():String(e),Cn.test(e)||(e="about:invalid#zClosurez"),e=An(e)),s.href=Sn(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=Sn(e),s&&(Kt&&X(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=Rn('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+ct(t)+'">'),s.document.write((a=t)instanceof kn&&a.constructor===kn&&a.b===Dn?a.a:(I("expected object of type SafeHtml, got '"+a+"' of type "+c(a)),"type_error:SafeHtml")),s.document.close())):(s=r.open(Sn(e),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(t){}return s}var zn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Yn=/^[^@]+@[^@]+$/;function Xn(){var t=null;return new yt(function(e){"complete"==r.document.readyState?e():(t=function(){e()},be(window,"load",t))}).s(function(e){throw we(window,"load",t),e})}function Jn(t){return t=t||sr(),!("file:"!==fr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function $n(){var t=r.window;try{return!(!t||t==t.top)}catch(t){return!1}}function Zn(){return"object"!=typeof r.window&&"function"==typeof r.importScripts}function tr(){return t.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":t.INTERNAL.hasOwnProperty("node")?"Node":Zn()?"Worker":"Browser"}function er(){var t=tr();return"ReactNative"===t||"Node"===t}var nr="Firefox",rr="Chrome";function ir(t){var e=t.toLowerCase();return X(e,"opera/")||X(e,"opr/")||X(e,"opios/")?"Opera":X(e,"iemobile")?"IEMobile":X(e,"msie")||X(e,"trident/")?"IE":X(e,"edge/")?"Edge":X(e,"firefox/")?nr:X(e,"silk/")?"Silk":X(e,"blackberry")?"Blackberry":X(e,"webos")?"Webos":!X(e,"safari/")||X(e,"chrome/")||X(e,"crios/")||X(e,"android")?!X(e,"chrome/")&&!X(e,"crios/")||X(e,"edge/")?X(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":rr:"Safari"}var or={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function ar(t,e){e=e||[];var n,r=[],i={};for(n in or)i[or[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=tr())?r=ir(i=sr()):"Worker"===r&&(r=ir(i=sr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function sr(){return r.navigator&&r.navigator.userAgent||""}function ur(t,e){t=t.split("."),e=e||r;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function cr(){try{var t=r.localStorage,e=vr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Bn()||!!r.indexedDB}catch(t){return Zn()&&!!r.indexedDB}return!1}function hr(){return(lr()||"chrome-extension:"===fr()||Jn())&&!er()&&cr()&&!Zn()}function lr(){return"http:"===fr()||"https:"===fr()}function fr(){return r.location&&r.location.protocol||null}function pr(t){return!Kn(t=t||sr())&&ir(t)!=nr}function dr(t){return void 0===t?null:Fn(t)}function yr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function mr(t){if(null!==t)return JSON.parse(t)}function vr(t){return t||Math.floor(1e9*Math.random()).toString()}function gr(t){return"Safari"!=ir(t=t||sr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function _r(){var t=r.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function br(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=sr(),e=tr(),this.b=Kn(t)||"ReactNative"===e}function wr(){var t=r.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Er(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Tr(){return!(!ur("fireauth.oauthhelper",r)&&!ur("fireauth.iframe",r))}br.prototype.get=function(){var t=r.navigator;return!t||"boolean"!=typeof t.onLine||!lr()&&"chrome-extension:"!==fr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Sr,Cr={};function Ir(t){Cr[t]||(Cr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Nr={};Object.defineProperty(Nr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Nr,"abcd",{configurable:!0,enumerable:!0,value:2}),Sr=2==Nr.abcd}catch(e){Sr=!1}function Ar(t,e,n){Sr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function kr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Ar(t,n,e[n])}function Dr(t){var e={};return kr(e,t),e}function Rr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Ar(e,n,Rr(t[n]));return e}function Pr(t){var e={},n=t[xr],r=t[Lr];if(!(t=t[Mr])||t!=Or&&!n)throw Error("Invalid provider user info!");e[Ur]=r||null,e[Fr]=n||null,Ar(this,Vr,t),Ar(this,qr,Rr(e))}var Or="EMAIL_SIGNIN",xr="email",Lr="newEmail",Mr="requestType",Fr="email",Ur="fromEmail",qr="data",Vr="operation";function jr(t,e){this.code=Wr+t,this.message=e||Qr[t]||""}function Br(t){var e=t&&t.code;return e?new jr(e.substring(Wr.length),t.message):null}E(jr,Error),jr.prototype.C=function(){return{code:this.code,message:this.message}},jr.prototype.toJSON=function(){return this.C()};var Wr="auth/",Qr={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Kr(t){var e=t[Xr];if(void 0===e)throw new jr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new jr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Hr];if(n&&"object"==typeof n){e=n[Zr];var r=n[Jr];if(n=n[$r],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new jr("argument-error",Jr+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new jr("argument-error",$r+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new jr("argument-error",Zr+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new jr("missing-android-pkg-name")}}else if(void 0!==n)throw new jr("argument-error",Hr+" property must be a non null object when specified.");if(this.f=null,(e=t[Yr])&&"object"==typeof e){if("string"==typeof(e=e[ti])&&e.length)this.f=e;else if(void 0!==e)throw new jr("argument-error",ti+" property must be a non empty string when specified.")}else if(void 0!==e)throw new jr("argument-error",Yr+" property must be a non null object when specified.");if(void 0!==(e=t[zr])&&"boolean"!=typeof e)throw new jr("argument-error",zr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Gr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new jr("argument-error",Gr+" property must be a non empty string when specified.");this.i=t||null}var Hr="android",Gr="dynamicLinkDomain",zr="handleCodeInApp",Yr="iOS",Xr="url",Jr="installApp",$r="minimumVersion",Zr="packageName",ti="bundleId";function ei(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ni=null,ri=null;function ii(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=ri[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ni){ni={},ri={};for(var t=0;t<65;t++)ni[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(ri[ni[t]]=t)&&(ri["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function oi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function ai(t){return(t=si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new oi(t):null}function si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(ii(t))}catch(t){}return null}oi.prototype.f=function(){return this.b};var ui,ci={bd:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function hi(t){for(var e in ci)if(ci[e].id===t)return{firebaseEndpoint:(t=ci[e]).bb,secureTokenEndpoint:t.jb};return null}ui=hi("__EID__")?"__EID__":void 0;var li="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),fi=["client_id","response_type","scope","redirect_uri","state"],pi={Xc:{Na:"locale",Ba:500,Aa:600,Oa:"facebook.com",ib:fi},Zc:{Na:null,Ba:500,Aa:620,Oa:"github.com",ib:fi},$c:{Na:"hl",Ba:515,Aa:680,Oa:"google.com",ib:fi},fd:{Na:"lang",Ba:485,Aa:705,Oa:"twitter.com",ib:li}};function di(t){for(var e in pi)if(pi[e].Oa==t)return pi[e];return null}function yi(t){var e={};e["facebook.com"]=bi,e["google.com"]=Ei,e["github.com"]=wi,e["twitter.com"]=Ti;var n=t&&t[vi];try{if(n)return e[n]?new e[n](t):new _i(t);if(void 0!==t[mi])return new gi(t)}catch(t){}return null}var mi="idToken",vi="providerId";function gi(t){var e=t[vi];if(!e&&t[mi]){var n=ai(t[mi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Ar(this,"providerId",e),Ar(this,"isNewUser",n)}function _i(t){gi.call(this,t),Ar(this,"profile",Rr((t=mr(t.rawUserInfo||"{}"))||{}))}function bi(t){if(_i.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function wi(t){if(_i.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Ar(this,"username",this.profile&&this.profile.login||null)}function Ei(t){if(_i.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ti(t){if(_i.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Ar(this,"username",t.screenName||null)}function Si(t){this.a=ze(t)}function Ci(t){var e=ze(t),n=Ge(e,"link"),r=Ge(ze(n),"link");return Ge(ze(e=Ge(e,"deep_link_id")),"link")||e||r||n||t}function Ii(t,e){return t.then(function(t){if(t[la]){var n=ai(t[la]);if(!n||e!=n.c)throw new jr("user-mismatch");return t}throw new jr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Wr+"user-not-found"?new jr("user-mismatch"):t})}function Ni(t,e){if(!e)throw new jr("internal-error","failed to construct a credential");this.a=e,Ar(this,"providerId",t),Ar(this,"signInMethod",t)}function Ai(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function ki(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Ar(this,"idToken",e.idToken),e.accessToken&&Ar(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Ar(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new jr("internal-error","failed to construct a credential");Ar(this,"accessToken",e.oauthToken),Ar(this,"secret",e.oauthTokenSecret)}Ar(this,"providerId",t),Ar(this,"signInMethod",n)}function Di(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:sn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Ri(t,e){this.Fc=e||[],kr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(di(t)||{}).Na||null,this.ab=null}function Pi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new jr("argument-error",'SAML provider IDs must be prefixed with "saml."');Ri.call(this,t,[])}function Oi(t){Ri.call(this,t,fi),this.a=[]}function xi(){Oi.call(this,"facebook.com")}function Li(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return d(t)&&(e=t.accessToken),(new xi).credential(null,e)}function Mi(){Oi.call(this,"github.com")}function Fi(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return d(t)&&(e=t.accessToken),(new Mi).credential(null,e)}function Ui(){Oi.call(this,"google.com"),this.ua("profile")}function qi(t,e){var n=t;return d(t)&&(n=t.idToken,e=t.accessToken),(new Ui).credential(n,e)}function Vi(){Ri.call(this,"twitter.com",li)}function ji(t,e){var n=t;if(d(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new jr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new ki("twitter.com",n,"twitter.com")}function Bi(t,e,n){this.a=t,this.c=e,Ar(this,"providerId","password"),Ar(this,"signInMethod",n===Wi.EMAIL_LINK_SIGN_IN_METHOD?Wi.EMAIL_LINK_SIGN_IN_METHOD:Wi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Wi(){kr(this,{providerId:"password",isOAuthProvider:!1})}function Qi(t,e){if(!(e=Ki(e)))throw new jr("argument-error","Invalid email link!");return new Bi(t,e,Wi.EMAIL_LINK_SIGN_IN_METHOD)}function Ki(t){var e=Ge((t=new Si(t=Ci(t))).a,"oobCode")||null;return"signIn"===(Ge(t.a,"mode")||null)&&e?e:null}function Hi(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new jr("internal-error");this.a=t,Ar(this,"providerId","phone"),Ar(this,"signInMethod","phone")}function Gi(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function zi(e){try{this.a=e||t.auth()}catch(e){throw new jr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}kr(this,{providerId:"phone",isOAuthProvider:!1})}function Yi(t,e){if(!t)throw new jr("missing-verification-id");if(!e)throw new jr("missing-verification-code");return new Hi({Ua:t,Ta:e})}function Xi(t){if(t.temporaryProof&&t.phoneNumber)return new Hi({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return qi(o,n);case"facebook.com":return Li(n);case"github.com":return Fi(n);case"twitter.com":return ji(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ni(e,a):new ki(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Oi(e).credential(o,n,i):null}}catch(t){return null}}function Ji(t){if(!t.isOAuthProvider)throw new jr("invalid-oauth-provider")}function $i(t,e,n,r,i,o){if(this.b=t,this.c=e||null,this.f=n||null,this.g=r||null,this.h=o||null,this.a=i||null,!this.f&&!this.a)throw new jr("invalid-auth-event");if(this.f&&this.a)throw new jr("invalid-auth-event");if(this.f&&!this.g)throw new jr("invalid-auth-event")}function Zi(t){return(t=t||{}).type?new $i(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Br(t.error),t.postBody):null}function to(){this.b=null,this.a=[]}E(_i,gi),E(bi,_i),E(wi,_i),E(Ei,_i),E(Ti,_i),Ni.prototype.la=function(t){return ka(t,Ai(this))},Ni.prototype.b=function(t,e){var n=Ai(this);return n.idToken=e,Da(t,n)},Ni.prototype.f=function(t,e){return Ii(Ra(t,Ai(this)),e)},Ni.prototype.C=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},ki.prototype.la=function(t){return ka(t,Di(this))},ki.prototype.b=function(t,e){var n=Di(this);return n.idToken=e,Da(t,n)},ki.prototype.f=function(t,e){return Ii(Ra(t,Di(this)),e)},ki.prototype.C=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Ri.prototype.Da=function(t){return this.zb=rt(t),this},E(Pi,Ri),E(Oi,Ri),Oi.prototype.ua=function(t){return M(this.a,t)||this.a.push(t),this},Oi.prototype.Fb=function(){return V(this.a)},Oi.prototype.credential=function(t,e,n){if(!t&&!e)throw new jr("argument-error","credential failed: must provide the ID token and/or the access token.");return new ki(this.providerId,{idToken:t||null,accessToken:e||null,nonce:n||null},this.providerId)},E(xi,Oi),Ar(xi,"PROVIDER_ID","facebook.com"),Ar(xi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),E(Mi,Oi),Ar(Mi,"PROVIDER_ID","github.com"),Ar(Mi,"GITHUB_SIGN_IN_METHOD","github.com"),E(Ui,Oi),Ar(Ui,"PROVIDER_ID","google.com"),Ar(Ui,"GOOGLE_SIGN_IN_METHOD","google.com"),E(Vi,Ri),Ar(Vi,"PROVIDER_ID","twitter.com"),Ar(Vi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Bi.prototype.la=function(t){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?as(t,qa,{email:this.a,oobCode:this.c}):as(t,ns,{email:this.a,password:this.c})},Bi.prototype.b=function(t,e){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?as(t,Va,{idToken:e,email:this.a,oobCode:this.c}):as(t,Xa,{idToken:e,email:this.a,password:this.c})},Bi.prototype.f=function(t,e){return Ii(this.la(t),e)},Bi.prototype.C=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},kr(Wi,{PROVIDER_ID:"password"}),kr(Wi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),kr(Wi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Hi.prototype.la=function(t){return t.Va(Gi(this))},Hi.prototype.b=function(t,e){var n=Gi(this);return n.idToken=e,as(t,is,n)},Hi.prototype.f=function(t,e){var n=Gi(this);return n.operation="REAUTH",Ii(t=as(t,os,n),e)},Hi.prototype.C=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},zi.prototype.Va=function(t,e){var n=this.a.b;return Et(e.verify()).then(function(r){if(!i(r))throw new jr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return(o=n,a={phoneNumber:t,recaptchaToken:r},as(o,za,a)).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new jr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}var o,a})},kr(zi,{PROVIDER_ID:"phone"}),kr(zi,{PHONE_SIGN_IN_METHOD:"phone"}),$i.prototype.C=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,postBody:this.h,error:this.a&&this.a.C()}};var eo,no=null;function ro(t){var e="unauthorized-domain",n=void 0,r=ze(t);t=r.b,"chrome-extension"==(r=r.c)?n=ut("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=ut("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",jr.call(this,e,n)}function io(t,e,n){jr.call(this,t,n),(t=e||{}).Ab&&Ar(this,"email",t.Ab),t.$&&Ar(this,"phoneNumber",t.$),t.credential&&Ar(this,"credential",t.credential)}function oo(t){if(t.code){var e=t.code||"";0==e.indexOf(Wr)&&(e=e.substring(Wr.length));var n={credential:Xi(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new jr(e,t.message||void 0);return new io(e,n,t.message)}return null}function ao(){}function so(t){return t.c||(t.c=t.b())}function uo(){}function co(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function ho(){}function lo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Gb,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function fo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function po(t,e,n){this.reset(t,e,n,void 0,void 0)}function yo(t){this.f=t,this.b=this.c=this.a=null}function mo(t,e){this.name=t,this.value=e}to.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=ur("universalLinks.subscribe",r))&&t(null,this.b))},to.prototype.unsubscribe=function(t){U(this.a,function(e){return e==t})},E(ro,jr),E(io,jr),io.prototype.C=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.C();return e&&st(t,e),t},io.prototype.toJSON=function(){return this.C()},ao.prototype.c=null,E(uo,ao),uo.prototype.a=function(){var t=co(this);return t?new ActiveXObject(t):new XMLHttpRequest},uo.prototype.b=function(){var t={};return co(this)&&(t[0]=!0,t[1]=!0),t},eo=new uo,E(ho,ao),ho.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new lo;throw Error("Unsupported browser")},ho.prototype.b=function(){return{}},(e=lo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},e.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},e.abort=function(){this.a.abort()},e.setRequestHeader=function(){},e.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},e.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,fo(this,4)},e.Gb=function(){this.status=500,this.response=this.responseText="",fo(this,4)},e.kc=function(){this.Gb()},e.gc=function(){this.status=200,fo(this,1)},e.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},po.prototype.a=null,po.prototype.reset=function(){delete this.a},mo.prototype.toString=function(){return this.name};var vo=new mo("SEVERE",1e3),go=new mo("WARNING",900),_o=new mo("CONFIG",700),bo=new mo("FINE",500);yo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(I("Root logger has no level set."),null)}(this).value)for(p(e)&&(e=e()),t=new po(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var wo,Eo={},To=null;function So(t){var e;if(To||(To=new yo(""),(Eo[""]=To).c=_o),!(e=Eo[t])){e=new yo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=So(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Eo[t]=e}return e}function Co(t,e){t&&t.log(bo,e,void 0)}function Io(t){this.f=t}function No(t){De.call(this),this.u=t,this.readyState=Ao,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=So("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}E(Io,ao),Io.prototype.a=function(){return new No(this.f)},Io.prototype.b=(wo={},function(){return wo}),E(No,De);var Ao=0;function ko(t){t.c.read().then(t.ec.bind(t)).catch(t.La.bind(t))}function Do(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Ro(t)}function Ro(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Po(t){De.call(this),this.headers=new Ue,this.D=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.m=Oo,this.v=this.O=!1}(e=No.prototype).open=function(t,e){if(this.readyState!=Ao)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Ro(this)},e.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.La.bind(this))},e.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Do(this,!1)),this.readyState=Ao},e.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Ro(this)),this.a&&(this.readyState=3,Ro(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.La.bind(this)):void 0!==r.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,ko(this)):t.text().then(this.ic.bind(this),this.La.bind(this)))))},e.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Do(this,!0):Ro(this),3==this.readyState&&ko(this)}},e.ic=function(t){this.a&&(this.response=this.responseText=t,Do(this,!0))},e.hc=function(t){this.a&&(this.response=t,Do(this,!0))},e.La=function(t){var e=this.h;e&&e.log(go,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Do(this,!0)},e.setRequestHeader=function(t,e){this.i.append(t,e)},e.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(go,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},e.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(go,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},E(Po,De);var Oo="";Po.prototype.b=So("goog.net.XhrIo");var xo=/^https?$/i,Lo=["POST","PUT"];function Mo(t,e,n,o,a){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.N=n,t.G=!1,t.c=!0,t.a=t.D?t.D.a():eo.a(),t.w=t.D?so(t.D):so(eo),t.a.onreadystatechange=_(t.Jb,t);try{Co(t.b,Ko(t,"Opening Xhr")),t.I=!0,t.a.open(n,String(e),!0),t.I=!1}catch(e){return Co(t.b,Ko(t,"Error opening Xhr: "+e.message)),void Uo(t,e)}e=o||"";var s,u=new Ue(t.headers);a&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||i(t))O(t,e,void 0);else for(var n=Fe(t),r=Me(t),o=r.length,a=0;a<o;a++)e.call(void 0,r[a],n&&n[a],t)}(a,function(t,e){u.set(e,t)}),a=function(t){t:{for(var e=Fo,n=t.length,r=i(t)?t.split(""):t,o=0;o<n;o++)if(o in r&&e.call(void 0,r[o],o,t)){e=o;break t}e=-1}return e<0?null:i(t)?t.charAt(e):t[e]}(u.U()),o=r.FormData&&e instanceof r.FormData,!M(Lo,n)||a||o||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),u.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{Bo(t),0<t.g&&(t.v=(s=t.a,Wt&&te(9)&&"number"==typeof s.timeout&&void 0!==s.ontimeout),Co(t.b,Ko(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=_(t.Ga,t)):t.u=xe(t.Ga,t.g,t)),Co(t.b,Ko(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Co(t.b,Ko(t,"Send error: "+e.message)),Uo(t,e)}}function Fo(t){return"content-type"==t.toLowerCase()}function Uo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,qo(t),jo(t)}function qo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Vo(t){if(t.c&&void 0!==n)if(t.w[1]&&4==Wo(t)&&2==Qo(t))Co(t.b,Ko(t,"Local request error detected and ignored"));else if(t.i&&4==Wo(t))xe(t.Jb,0,t);else if(t.dispatchEvent("readystatechange"),4==Wo(t)){Co(t.b,Ko(t,"Request complete")),t.c=!1;try{var e,i=Qo(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if(!(e=o)){var a;if(a=0===i){var s=String(t.l).match(je)[1]||null;if(!s&&r.self&&r.self.location){var u=r.self.location.protocol;s=u.substr(0,u.length-1)}a=!xo.test(s?s.toLowerCase():"")}e=a}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Wo(t)?t.a.statusText:""}catch(e){Co(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+Qo(t)+"]",qo(t)}}finally{jo(t)}}}function jo(t,e){if(t.a){Bo(t);var n=t.a,r=t.w[0]?u:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(vo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function Bo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(r.clearTimeout(t.u),t.u=null)}function Wo(t){return t.a?t.a.readyState:0}function Qo(t){try{return 2<Wo(t)?t.a.status:-1}catch(t){return-1}}function Ko(t,e){return e+" ["+t.N+" "+t.l+" "+Qo(t)+"]"}function Ho(t){var e=ra;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.o=0}function Go(t,e,n){t.a=!0,t.c=n,t.f=!e,Jo(t)}function zo(t){if(t.a){if(!t.l)throw new $o(t);t.l=!1}}function Yo(t,e,n,r){t.g.push([e,n,r]),t.a&&Jo(t)}function Xo(t){return L(t.g,function(t){return p(t[1])})}function Jo(t){if(t.h&&t.a&&Xo(t)){var e=t.h,n=ea[e];n&&(r.clearTimeout(n.a),delete ea[e]),t.h=0}t.b&&(t.b.o--,delete t.b),e=t.c;for(var i=n=!1;t.g.length&&!t.i;){var o=t.g.shift(),a=o[0],s=o[1];if(o=o[2],a=t.f?s:a)try{var u=a.call(o||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(T(e)||"function"==typeof r.Promise&&e instanceof r.Promise)&&(i=!0,t.i=!0)}catch(i){e=i,t.f=!0,Xo(t)||(n=!0)}}t.c=e,i&&(u=_(t.m,t,!0),i=_(t.m,t,!1),e instanceof Ho?(Yo(e,u,i),e.w=!0):e.then(u,i)),n&&(e=new ta(e),ea[e.a]=e,t.h=e.a)}function $o(){S.call(this)}function Zo(){S.call(this)}function ta(t){this.a=r.setTimeout(_(this.c,this),0),this.b=t}(e=Po.prototype).Ga=function(){void 0!==n&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Co(this.b,Ko(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},e.abort=function(){this.a&&this.c&&(Co(this.b,Ko(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jo(this))},e.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),jo(this,!0)),Po.pb.va.call(this)},e.Jb=function(){this.qa||(this.I||this.i||this.f?Vo(this):this.yc())},e.yc=function(){Vo(this)},e.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Oo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(vo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Co(this.b,"Can not get response: "+t.message),null}},Ho.prototype.cancel=function(t){if(this.a)this.c instanceof Ho&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.o--,e.o<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new Zo(this),zo(this),Go(this,!1,t))}},Ho.prototype.m=function(t,e){this.i=!1,Go(this,t,e)},Ho.prototype.then=function(t,e,n){var r,i,o=new yt(function(t,e){r=t,i=e});return Yo(this,r,function(t){t instanceof Zo?o.cancel():i(t)}),o.then(t,e,n)},Ho.prototype.$goog_Thenable=!0,E($o,S),$o.prototype.message="Deferred has already fired",$o.prototype.name="AlreadyCalledError",E(Zo,S),Zo.prototype.message="Deferred was canceled",Zo.prototype.name="CanceledError",ta.prototype.c=function(){throw delete ea[this.a],this.b};var ea={};function na(t){var e,n,i,o,u,c=document,h=gn(t),l=document.createElement("SCRIPT"),f={Lb:l,Ga:void 0},p=new Ho(f);return e=window.setTimeout(function(){ia(l,!0);var t=new sa(aa,"Timeout reached for loading script "+h);zo(p),Go(p,!1,t)},5e3),f.Ga=e,l.onload=l.onreadystatechange=function(){l.readyState&&"loaded"!=l.readyState&&"complete"!=l.readyState||(ia(l,!1,e),zo(p),Go(p,!0,null))},l.onerror=function(){ia(l,!0,e);var t=new sa(oa,"Error while loading script "+h);zo(p),Go(p,!1,t)},st(f={},{type:"text/javascript",charset:"UTF-8"}),On(l,f),i=t,(n=l).src=gn(i),null===s&&(s=(i=(i=r.document).querySelector&&i.querySelector("script[nonce]"))&&(i=i.nonce||i.getAttribute("nonce"))&&a.test(i)?i:""),(i=s)&&n.setAttribute("nonce",i),(o=c,(u=(o||document).getElementsByTagName("HEAD"))&&0!=u.length?u[0]:o.documentElement).appendChild(l),p}function ra(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&ia(t,!0,this.Ga)}}function ia(t,e,n){null!=n&&r.clearTimeout(n),t.onload=u,t.onerror=u,t.onreadystatechange=u,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var oa=0,aa=1;function sa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),S.call(this,n),this.code=t}function ua(t){this.f=t}function ca(e,n,i){if(this.b=e,e=n||{},this.i=e.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.o=e.secureTokenTimeout||fa,this.f=rt(e.secureTokenHeaders||pa),this.g=e.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=e.firebaseTimeout||da,this.a=rt(e.firebaseHeaders||ya),i&&(this.a["X-Client-Version"]=i,this.f["X-Client-Version"]=i),i="Node"==tr(),!(i=r.XMLHttpRequest||i&&t.INTERNAL.node&&t.INTERNAL.node.XMLHttpRequest)&&!Zn())throw new jr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,Zn()?this.c=new Io(self):er()?this.c=new ua(i):this.c=new ho}E(sa,S),E(ua,ao),ua.prototype.a=function(){return new this.f},ua.prototype.b=function(){return{}};var ha,la="idToken",fa=new br(3e4,6e4),pa={"Content-Type":"application/x-www-form-urlencoded"},da=new br(3e4,6e4),ya={"Content-Type":"application/json"};function ma(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function va(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function ga(t,e,n,i,o,a,s){var u;(t=!((u=ir(u=sr())!=rr?null:(u=u.match(/\sChrome\/(\d+)/i))&&2==u.length?parseInt(u[1],10):null)&&u<30||Wt&&$t&&!(9<$t))||Zn()?_(t.m,t):(ha||(ha=new yt(function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(r[ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},Yo(na(_n(_a,{onload:ba})),null,function(){e(Error("CORS_UNSUPPORTED"))},void 0))}(t,e)})),_(t.l,t)))(e,n,i,o,a,s)}ca.prototype.m=function(t,e,n,i,o,a){if(Zn()&&(void 0===r.fetch||void 0===r.Headers||void 0===r.Request))throw new jr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var s=new Po(this.c);if(a){s.g=Math.max(0,a);var u=setTimeout(function(){s.dispatchEvent("timeout")},a)}Re(s,"complete",function(){u&&clearTimeout(u);var n=null;try{n=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Co(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){n=null}e&&e(n)}),Pe(s,"ready",function(){u&&clearTimeout(u),Ut(this)}),Pe(s,"timeout",function(){u&&clearTimeout(u),Ut(this),e&&e(null)}),Mo(s,t,n,i,o)};var _a=new pn(mn,"https://apis.google.com/js/client.js?onload=%{onload}"),ba="__fcb"+Math.floor(1e6*Math.random()).toString();function wa(t){if(!i(t=t.email)||!Yn.test(t))throw new jr("invalid-email")}function Ea(t){"email"in t&&wa(t)}function Ta(t){if(!t[la])throw new jr("internal-error")}function Sa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new jr("internal-error")}else{if(!t.sessionInfo)throw new jr("missing-verification-id");if(!t.code)throw new jr("missing-verification-code")}}ca.prototype.l=function(t,e,n,r,i){var o=this;ha.then(function(){window.gapi.client.setApiKey(o.b);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},ca.prototype.Ra=function(){return as(this,Ja,{})},ca.prototype.qb=function(t,e){return as(this,Ya,{idToken:t,email:e})},ca.prototype.rb=function(t,e){return as(this,Xa,{idToken:t,password:e})};var Ca={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ia(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new jr("internal-error")}function Na(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&cn(t=new on(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Aa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=oo(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=oo(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=oo(t)):t.errorMessage&&(e=ss(t.errorMessage)),e)throw e;if(!t[la])throw new jr("internal-error")}function ka(t,e){return e.returnIdpCredential=!0,as(t,$a,e)}function Da(t,e){return e.returnIdpCredential=!0,as(t,ts,e)}function Ra(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,as(t,Za,e)}function Pa(t){if(!t.oobCode)throw new jr("invalid-action-code")}(e=ca.prototype).sb=function(t,e){var n={idToken:t},r=[];return et(Ca,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),as(this,Ya,n)},e.lb=function(t,e){return st(t={requestType:"PASSWORD_RESET",email:t},e),as(this,Qa,t)},e.mb=function(t,e){return st(t={requestType:"EMAIL_SIGNIN",email:t},e),as(this,Ba,t)},e.kb=function(t,e){return st(t={requestType:"VERIFY_EMAIL",idToken:t},e),as(this,Wa,t)},e.Va=function(t){return as(this,rs,t)},e.$a=function(t,e){return as(this,Ga,{oobCode:t,newPassword:e})},e.Ja=function(t){return as(this,xa,{oobCode:t})},e.Xa=function(t){return as(this,Oa,{oobCode:t})};var Oa={endpoint:"setAccountInfo",B:Pa,da:"email"},xa={endpoint:"resetPassword",B:Pa,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new jr("internal-error")}},La={endpoint:"signupNewUser",B:function(t){if(wa(t),!t.password)throw new jr("weak-password")},J:Ta,R:!0},Ma={endpoint:"createAuthUri"},Fa={endpoint:"deleteAccount",T:["idToken"]},Ua={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],B:function(t){if(!l(t.deleteProvider))throw new jr("internal-error")}},qa={endpoint:"emailLinkSignin",T:["email","oobCode"],B:wa,J:Ta,R:!0},Va={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],B:wa,J:Ta,R:!0},ja={endpoint:"getAccountInfo"},Ba={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new jr("internal-error");wa(t)},da:"email"},Wa={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new jr("internal-error")},da:"email"},Qa={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new jr("internal-error");wa(t)},da:"email"},Ka={vb:!0,endpoint:"getProjectConfig",Ib:"GET"},Ha={vb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new jr("internal-error")}},Ga={endpoint:"resetPassword",B:Pa,da:"email"},za={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},Ya={endpoint:"setAccountInfo",T:["idToken"],B:Ea,R:!0},Xa={endpoint:"setAccountInfo",T:["idToken"],B:function(t){if(Ea(t),!t.password)throw new jr("weak-password")},J:Ta,R:!0},Ja={endpoint:"signupNewUser",J:Ta,R:!0},$a={endpoint:"verifyAssertion",B:Ia,Pa:Na,J:Aa,R:!0},Za={endpoint:"verifyAssertion",B:Ia,Pa:Na,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new jr("user-not-found");if(t.errorMessage)throw ss(t.errorMessage);if(!t[la])throw new jr("internal-error")},R:!0},ts={endpoint:"verifyAssertion",B:function(t){if(Ia(t),!t.idToken)throw new jr("internal-error")},Pa:Na,J:Aa,R:!0},es={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new jr("invalid-custom-token")},J:Ta,R:!0},ns={endpoint:"verifyPassword",B:function(t){if(wa(t),!t.password)throw new jr("wrong-password")},J:Ta,R:!0},rs={endpoint:"verifyPhoneNumber",B:Sa,J:Ta},is={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new jr("internal-error");Sa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",oo(t);Ta(t)}},os={Xb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:Sa,J:Ta};function as(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Tt(new jr("internal-error"));var r,i=e.Ib||"POST";return Et(n).then(e.B).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var a=ze(t.g+e);He(a,"key",t.b),o&&He(a,"cb",w().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&He(a,u,r[u]);return new yt(function(e,o){ga(t,a.toString(),function(t){t?t.error?o(us(t,i||{})):e(t):o(new jr("network-request-failed"))},n,s?void 0:Fn(yr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Xb,e.vb||!1)}).then(function(t){return r=t,e.Pa?e.Pa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new jr("internal-error");return r[e.da]})}function ss(t){return us({error:{errors:[{message:t}],code:400,message:t}})}function us(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new jr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",st(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new jr(r[i],e);return!e&&t&&(e=dr(t)),new jr("internal-error",e)}function cs(t){var e;this.b=t,this.a=null,this.gb=(e=this,(ps||(ps=new yt(function(t,e){function n(){_r(),ur("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){_r(),e(Error("Network Error"))},timeout:ls.get()})}if(ur("gapi.iframes.Iframe"))t();else if(ur("gapi.load"))n();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();r[i]=function(){ur("gapi.load")?n():e(Error("Network Error"))},Et(na(i=_n(hs,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw ps=null,t}))).then(function(){return new yt(function(t,n){ur("gapi.iframes.getContext")().open({where:document.body,url:e.b,messageHandlersFilter:ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),t()}e.a=r,e.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},fs.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})}))}var hs=new pn(mn,"https://apis.google.com/js/api.js?onload=%{onload}"),ls=new br(3e4,6e4),fs=new br(5e3,15e3),ps=null;function ds(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Ye(this.i,"/__/auth/iframe"),He(this.a,"apiKey",this.g),He(this.a,"appName",this.h),this.b=null,this.c=[]}function ys(t,e,n,r,i){this.m=t,this.l=e,this.c=n,this.o=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ms(e){try{return t.app(e).auth().ya()}catch(e){return[]}}function vs(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.u=this.v=null,this.g=[],this.o=this.a=null}function gs(t){var e,n=Wn();return(e=t,as(e,Ka,{}).then(function(t){return t.authorizedDomains||[]})).then(function(t){t:{var e=ze(n),r=e.c;e=e.b;for(var i=0;i<t.length;i++){var o=t[i],a=e,s=r;if(a=0==o.indexOf("chrome-extension://")?ze(o).b==a&&"chrome-extension"==s:("http"==s||"https"==s)&&(zn.test(o)?a==o:(o=o.split(".").join("\\."),new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)))){t=!0;break t}}t=!1}if(!t)throw new ro(Wn())})}function _s(t){return t.o||(t.o=Xn().then(function(){if(!t.u){var e=t.c,n=t.h,r=ms(t.b),i=new ds(t.l,t.f,t.b);i.f=e,i.b=n,i.c=V(r||[]),t.u=i.toString()}t.i=new cs(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");var e,n;e=t.i,n=function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=Zi(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Et(n)}return n.status="ERROR",Et(n)},e.gb.then(function(){e.a.register("authEvent",n,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t)})),t.o}function bs(t){return t.m||(t.v=t.c?ar(t.c,ms(t.b)):null,t.m=new ca(t.f,hi(t.h),t.v)),t.m}function ws(t,e,n,r,i,o,a,s,u,c){return(t=new ys(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=rt(u||null),t.f=c,t.toString()}function Es(e){if(this.a=e||t.INTERNAL.reactNative&&t.INTERNAL.reactNative.AsyncStorage,!this.a)throw new jr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ts(t){this.b=t,this.a={},this.c=_(this.f,this)}ds.prototype.toString=function(){return this.f?He(this.a,"v",this.f):un(this.a.a,"v"),this.b?He(this.a,"eid",this.b):un(this.a.a,"eid"),this.c.length?He(this.a,"fw",this.c.join(",")):un(this.a.a,"fw"),this.a.toString()},ys.prototype.toString=function(){var e=Ye(this.m,"/__/auth/handler");if(He(e,"apiKey",this.l),He(e,"appName",this.c),He(e,"authType",this.o),this.a.isOAuthProvider){var n=this.a;try{var r=t.app(this.c).auth().ea()}catch(e){r=null}for(var i in n.ab=r,He(e,"providerId",this.a.providerId),r=yr((n=this.a).zb))r[i]=r[i].toString();i=n.Fc,r=rt(r);for(var o=0;o<i.length;o++){var a=i[o];a in r&&delete r[a]}n.eb&&n.ab&&!r[n.eb]&&(r[n.eb]=n.ab),nt(r)||He(e,"customParameters",dr(r))}if("function"==typeof this.a.Fb&&(n=this.a.Fb()).length&&He(e,"scopes",n.join(",")),this.i?He(e,"redirectUrl",this.i):un(e.a,"redirectUrl"),this.g?He(e,"eventId",this.g):un(e.a,"eventId"),this.h?He(e,"v",this.h):un(e.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Ge(e,s)&&He(e,s,this.b[s]);return this.f?He(e,"eid",this.f):un(e.a,"eid"),(s=ms(this.c)).length&&He(e,"fw",s.join(",")),e.toString()},(e=vs.prototype).Ea=function(t,e,n){var r=new jr("popup-closed-by-user"),i=new jr("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){var n,r;(n=o,r={type:"webStorageSupport"},_s(n).then(function(){return t=n.i,e=r,t.gb.then(function(){return new yt(function(n){t.a.send(e.type,e,n,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})});var t,e}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})).then(function(n){n||(t&&Hn(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return e=t,new yt(function(t){return function n(){Le(2e3).then(function(){if(e&&!e.closed)return n();t()})}()});var e}).then(function(){if(!a)return Le(n).then(function(){e(r)})})},e.Mb=function(){var t=sr();return!pr(t)&&!gr(t)},e.Hb=function(){return!1},e.Db=function(t,e,n,r,i,o,a){if(!t)return Tt(new jr("popup-blocked"));if(a&&!pr())return this.ga().s(function(e){Hn(t),i(e)}),r(),Et();this.a||(this.a=gs(bs(this)));var s=this;return this.a.then(function(){var e=s.ga().s(function(e){throw Hn(t),i(e),e});return r(),e}).then(function(){Ji(n),a||Qn(ws(s.l,s.f,s.b,e,n,null,o,s.c,void 0,s.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},e.Ca=function(t,e,n){this.a||(this.a=gs(bs(this)));var r=this;return this.a.then(function(){Ji(e),Qn(ws(r.l,r.f,r.b,t,e,Wn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},e.ga=function(){var t=this;return _s(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new jr("network-request-failed")})},e.Qb=function(){return!0},e.wa=function(t){this.g.push(t)},e.Ka=function(t){U(this.g,function(e){return e==t})},(e=Es.prototype).get=function(t){return Et(this.a.getItem(t)).then(function(t){return t&&mr(t)})},e.set=function(t,e){return Et(this.a.setItem(t,dr(e)))},e.P=function(t){return Et(this.a.removeItem(t))},e.Y=function(){},e.ca=function(){};var Ss,Cs=[];function Is(t){this.a=t}function Ns(t){this.c=t,this.b=!1,this.a=[]}function As(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Tt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new yt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return ks(t,c),e}).s(function(e){throw ks(t,c),e})}function ks(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),U(t.a,function(t){return t==e})}}function Ds(){if(!Os())throw new jr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=r.indexedDB,this.type="indexedDB",this.g=this.o=this.f=this.i=null,this.u=!1,this.h=null;var t,e=this;Zn()&&self?(this.o=function(){var t=Zn()?self:null;if(O(Cs,function(n){n.b==t&&(e=n)}),!e){var e=new Ts(t);Cs.push(e)}return e}(),this.o.subscribe("keyChanged",function(t,n){return Us(e).then(function(t){return 0<t.length&&O(e.a,function(e){e(t)}),{keyProcessed:M(t,n.key)}})}),this.o.subscribe("ping",function(){return Et(["keyChanged"])})):(t=r.navigator,t&&t.serviceWorker?Et().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Et(null)).then(function(t){(e.h=t)&&(e.g=new Ns(new Is(t)),As(e.g,"ping",null,!0).then(function(t){t[0].fulfilled&&M(t[0].value,"keyChanged")&&(e.u=!0)}).s(function(){}))})}function Rs(t){return new yt(function(e,n){var r=t.l.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){var i;(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):(i=t,new yt(function(t,e){var n=i.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})).then(function(){return Rs(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Ps(t){return t.m||(t.m=Rs(t)),t.m}function Os(){try{return!!r.indexedDB}catch(e){return!1}}function xs(t){return t.objectStore("firebaseLocalStorage")}function Ls(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Ms(t){return new yt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Fs(t,e){return t.g&&t.h&&((n=r.navigator)&&n.serviceWorker&&n.serviceWorker.controller||null)===t.h?As(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Et();var n}function Us(t){return Ps(t).then(function(t){var e=xs(Ls(t,!1));return e.getAll?Ms(e.getAll()):new yt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function qs(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Vs(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Et().then(function(){if(Os()){var t=vr(),r="__sak"+t;return Ss||(Ss=new Ds),(n=Ss).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){O(e.a,function(e){e(t)})}),t})}function js(){this.a={},this.type="inMemory"}function Bs(){if(!function(){var e="Node"==tr();if(!(e=Ws()||e&&t.INTERNAL.node&&t.INTERNAL.node.localStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==tr())throw new jr("internal-error","The LocalStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Ws()||t.INTERNAL.node.localStorage,this.type="localStorage"}function Ws(){try{var t=r.localStorage,e=vr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Qs(){this.type="nullStorage"}function Ks(){if(!function(){var e="Node"==tr();if(!(e=Hs()||e&&t.INTERNAL.node&&t.INTERNAL.node.sessionStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==tr())throw new jr("internal-error","The SessionStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Hs()||t.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Hs(){try{var t=r.sessionStorage,e=vr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Gs(){var t={};t.Browser=Xs,t.Node=Js,t.ReactNative=$s,t.Worker=Zs,this.a=t[tr()]}Ts.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];O(r,function(e){i.push(Et().then(function(){return e(t.origin,t.data.data)}))}),Ct(i).then(function(r){var i=[];O(r,function(t){i.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),O(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Ts.prototype.subscribe=function(t,e){nt(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},Ts.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(U(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],nt(this.a)&&this.b.removeEventListener("message",this.c)},Is.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ns.prototype.close=function(){for(;0<this.a.length;)ks(this,this.a[0]);this.b=!0},(e=Ds.prototype).set=function(t,e){var n,r=!1,i=this;return Ps(this).then(function(e){return Ms((e=xs(Ls(n=e,!0))).get(t))}).then(function(o){var a=xs(Ls(n,!0));return o?(o.value=e,Ms(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Ms(a.add(o)))}).then(function(){return i.c[t]=e,Fs(i,t)}).ia(function(){r&&i.b--})},e.get=function(t){return Ps(this).then(function(e){return Ms(xs(Ls(e,!1)).get(t))}).then(function(t){return t&&t.value})},e.P=function(t){var e=!1,n=this;return Ps(this).then(function(r){return e=!0,n.b++,Ms(xs(Ls(r,!0)).delete(t))}).then(function(){return delete n.c[t],Fs(n,t)}).ia(function(){e&&n.b--})},e.Y=function(t){var e;0==this.a.length&&(qs(e=this),function t(){e.f=setTimeout(function(){e.i=Us(e).then(function(t){0<t.length&&O(e.a,function(e){e(t)})}).then(function(){t()}).s(function(e){"STOP_EVENT"!=e.message&&t()})},800)}()),this.a.push(t)},e.ca=function(t){U(this.a,function(e){return e==t}),0==this.a.length&&qs(this)},(e=Vs.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},e.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},e.P=function(t){return this.b.then(function(e){return e.P(t)})},e.Y=function(t){this.a.push(t)},e.ca=function(t){U(this.a,function(e){return e==t})},(e=js.prototype).get=function(t){return Et(this.a[t])},e.set=function(t,e){return this.a[t]=e,Et()},e.P=function(t){return delete this.a[t],Et()},e.Y=function(){},e.ca=function(){},(e=Bs.prototype).get=function(t){var e=this;return Et().then(function(){return mr(e.a.getItem(t))})},e.set=function(t,e){var n=this;return Et().then(function(){var r=dr(e);null===r?n.P(t):n.a.setItem(t,r)})},e.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},e.Y=function(t){r.window&&ge(r.window,"storage",t)},e.ca=function(t){r.window&&we(r.window,"storage",t)},(e=Qs.prototype).get=function(){return Et(null)},e.set=function(){return Et()},e.P=function(){return Et()},e.Y=function(){},e.ca=function(){},(e=Ks.prototype).get=function(t){var e=this;return Et().then(function(){return mr(e.a.getItem(t))})},e.set=function(t,e){var n=this;return Et().then(function(){var r=dr(e);null===r?n.P(t):n.a.setItem(t,r)})},e.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},e.Y=function(){},e.ca=function(){};var zs,Ys,Xs={A:Bs,Sa:Ks},Js={A:Bs,Sa:Ks},$s={A:Es,Sa:Qs},Zs={A:Bs,Sa:Qs},tu={ad:"local",NONE:"none",cd:"session"};function eu(){var t=!(gr(sr())||!$n()),e=pr(),n=cr();this.m=t,this.h=e,this.o=n,this.a={},zs||(zs=new Gs),t=zs;try{this.g=!Bn()&&Tr()||!r.indexedDB?new t.a.A:new Vs(Zn()?new js:new t.a.A)}catch(t){this.g=new js,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new js}this.l=new js,this.f=_(this.Pb,this),this.b={}}function nu(){return Ys||(Ys=new eu),Ys}function ru(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function iu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ou(t,e,n){return n=iu(e,n),"local"==e.A&&(t.b[n]=null),ru(t,e.A).P(n)}function au(t){t.c&&(clearInterval(t.c),t.c=null)}function su(t){this.a=t,this.b=nu()}(e=eu.prototype).get=function(t,e){return ru(this,t.A).get(iu(t,e))},e.set=function(t,e,n){var r=iu(t,n),i=this,o=ru(this,t.A);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.A&&(i.b[r]=e)})},e.addListener=function(t,e,n){var i;t=iu(t,e),this.o&&(this.b[t]=r.localStorage.getItem(t)),nt(this.a)&&(ru(this,"local").Y(this.f),this.h||(Bn()||!Tr())&&r.indexedDB||!this.o||(au(i=this),i.c=setInterval(function(){for(var t in i.a){var e=r.localStorage.getItem(t),n=i.b[t];e!=n&&(i.b[t]=e,e=new se({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),i.Pb(e))}},1e3))),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},e.removeListener=function(t,e,n){t=iu(t,e),this.a[t]&&(U(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),nt(this.a)&&(ru(this,"local").ca(this.f),au(this))},e.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var i=this.b[n];void 0===i&&(i=null);var o=r.localStorage.getItem(n);o!==i&&(this.b[n]=o,this.Ya(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?ru(this,"local").ca(this.f):au(this),this.m)if(n=r.localStorage.getItem(e),(i=t.a.newValue)!==n)null!==i?r.localStorage.setItem(e,i):r.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var a=this;n=function(){void 0===t.a.a&&a.b[e]===r.localStorage.getItem(e)||(a.b[e]=r.localStorage.getItem(e),a.Ya(e))},Wt&&$t&&10==$t&&r.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else O(t,_(this.Ya,this))},e.Ya=function(t){this.a[t]&&O(this.a[t],function(t){t()})};var uu,cu={name:"authEvent",A:"local"};function hu(){this.a=nu()}function lu(t,e){this.b=fu,this.f=r.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.o=r.Int32Array?new Int32Array(64):Array(64),void 0!==uu||(uu=r.Int32Array?new Int32Array(_u):_u),this.reset()}E(lu,function(){this.b=-1});for(var fu=64,pu=fu-1,du=[],yu=0;yu<pu;yu++)du[yu]=0;var mu=q(128,du);function vu(t){for(var e=t.f,n=t.o,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|uu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function gu(t,e,n){void 0===n&&(n=e.length);var r=0,o=t.c;if(i(e))for(;r<n;)t.f[o++]=e.charCodeAt(r++),o==t.b&&(vu(t),o=0);else{if(!f(e))throw Error("message must be string or array");for(;r<n;){var a=e[r++];if(!("number"==typeof a&&0<=a&&a<=255&&a==(0|a)))throw Error("message must be a byte array");t.f[o++]=a,o==t.b&&(vu(t),o=0)}}t.c=o,t.g+=n}lu.prototype.reset=function(){this.g=this.c=0,this.a=r.Int32Array?new Int32Array(this.h):V(this.h)};var _u=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function bu(){lu.call(this,8,wu)}E(bu,lu);var wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Eu(t,e,n,r,i){this.l=t,this.i=e,this.o=n,this.m=r||null,this.u=i||null,this.h=e+":"+n,this.v=new hu,this.g=new su(this.h),this.f=null,this.b=[],this.a=this.c=null}function Tu(t){return new jr("invalid-cordova-configuration",t)}function Su(t){var e=new bu;gu(e,t),t=[];var n=8*e.g;e.c<56?gu(e,mu,56-e.c):gu(e,mu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(vu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return x(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}function Cu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Iu(t){return t.f||(t.f=t.ga().then(function(){return new yt(function(e){t.wa(function n(r){return e(r),t.Ka(n),!1}),function(t){function e(e){i=!0,o&&o.cancel(),Nu(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=Ci(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=mr(Ge(o=ze(i),"firebaseError")||null))?Br(o):null)?new $i(r.b,r.c,null,null,o):new $i(r.b,r.c,i,r.g)),i=o||n}Cu(t,i)})}var n=new $i("unknown",null,null,null,new jr("no-auth-event")),i=!1,o=Le(500).then(function(){return Nu(t).then(function(){i||Cu(t,n)})}),a=r.handleOpenURL;r.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(ur("BuildInfo.packageName",r).toLowerCase()+"://")&&e({url:t}),"function"==typeof a)try{a(t)}catch(t){console.error(t)}},no||(no=new to),no.subscribe(e)}(t)})})),t.f}function Nu(t){var e,n=null;return(e=t.g,e.b.get(cu,e.a).then(function(t){return Zi(t)})).then(function(e){return n=e,ou((e=t.g).b,cu,e.a)}).then(function(){return n})}function Au(t){this.a=t,this.b=nu()}(e=Eu.prototype).ga=function(){return this.za?this.za:this.za=(Jn(void 0)?Xn().then(function(){return new yt(function(t,e){var n=r.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Tt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof ur("universalLinks.subscribe",r))throw Tu("cordova-universal-links-plugin-fix is not installed");if(void 0===ur("BuildInfo.packageName",r))throw Tu("cordova-plugin-buildinfo is not installed");if("function"!=typeof ur("cordova.plugins.browsertab.openUrl",r))throw Tu("cordova-plugin-browsertab is not installed");if("function"!=typeof ur("cordova.InAppBrowser.open",r))throw Tu("cordova-plugin-inappbrowser is not installed")},function(){throw new jr("cordova-not-ready")})},e.Ea=function(t,e){return e(new jr("operation-not-supported-in-this-environment")),Et()},e.Db=function(){return Tt(new jr("operation-not-supported-in-this-environment"))},e.Qb=function(){return!1},e.Mb=function(){return!0},e.Hb=function(){return!0},e.Ca=function(t,e,n){if(this.c)return Tt(new jr("redirect-operation-pending"));var i=this,o=r.document,a=null,s=null,u=null,c=null;return this.c=Et().then(function(){return Ji(e),Iu(i)}).then(function(){return function(t,e,n,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new $i(e,i,null,o,new jr("no-auth-event")),s=ur("BuildInfo.packageName",r);if("string"!=typeof s)throw new jr("invalid-cordova-configuration");var u=ur("BuildInfo.displayName",r),c={};if(sr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!sr().toLowerCase().match(/android/))return Tt(new jr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Su(o),c.sessionId=o;var h=ws(t.l,t.i,t.o,e,n,null,i,t.m,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(cu,a.C(),e)}).then(function(){var e=ur("cordova.plugins.browsertab.isAvailable",r);if("function"!=typeof e)throw new jr("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=ur("cordova.plugins.browsertab.openUrl",r)))throw new jr("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=ur("cordova.InAppBrowser.open",r)))throw new jr("invalid-cordova-configuration");e=!(!(e=sr()).match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),t.a=n(h,e?"_blank":"_system","location=yes")}})})}(i,t,e,n)}).then(function(){return new yt(function(t,e){s=function(){var e=ur("cordova.plugins.browsertab.close",r);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.wa(s),u=function(){a||(a=Le(2e3).then(function(){e(new jr("redirect-cancelled-by-user"))}))},c=function(){wr()&&u()},o.addEventListener("resume",u,!1),sr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Nu(i).then(function(){throw t})})}).ia(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.Ka(s),i.c=null})},e.wa=function(t){this.b.push(t),Iu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new $i("unknown",null,null,null,new jr("no-auth-event")),t(e))})},e.Ka=function(t){U(this.b,function(e){return e==t})};var ku={name:"pendingRedirect",A:"session"};function Du(t){return ou(t.b,ku,t.a)}function Ru(t,e,n){this.u=t,this.o=e,this.l=n,this.h=[],this.f=!1,this.i=_(this.cb,this),this.b=new ju,this.m=new Ku,this.g=new Au(this.o+":"+this.l),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.m,this.c.linkViaPopup=this.m,this.c.reauthViaPopup=this.m,this.a=Pu(this.u,this.o,this.l,ui)}function Pu(e,n,r,i){var o=t.SDK_VERSION||null;return Jn()?new Eu(e,n,r,o,i):new vs(e,n,r,o,i)}function Ou(t){t.f||(t.f=!0,t.a.wa(t.i));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function xu(t){t.a.Mb()&&Ou(t).s(function(e){var n=new $i("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Uu(e)&&t.cb(n)}),t.a.Hb()||Bu(t.b)}(e=Ru.prototype).reset=function(){this.f=!1,this.a.Ka(this.i),this.a=Pu(this.u,this.o,this.l)},e.Za=function(){this.b.Za()},e.subscribe=function(t){if(M(this.h,t)||this.h.push(t),!this.f){var e=this;(n=this.g,n.b.get(ku,n.a).then(function(t){return"pending"==t})).then(function(t){t?Du(e.g).then(function(){Ou(e).s(function(t){var n=new $i("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Uu(t)&&e.cb(n)})}):xu(e)}).s(function(){xu(e)})}var n},e.unsubscribe=function(t){U(this.h,function(e){return e==t})},e.cb=function(t){if(!t)throw new jr("invalid-auth-event");for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.wb(t.b,t.c)){(e=this.c[t.b])&&e.h(t,r),e=!0;break}}return Bu(this.b),e};var Lu=new br(2e3,1e4),Mu=new br(3e4,6e4);function Fu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.i))},function(){t.reset()},i,o)}function Uu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}Ru.prototype.fa=function(){return this.b.fa()},Ru.prototype.Ca=function(t,e,n){var r,i,o=this;return(i=this.g,i.b.set(ku,"pending",i.a)).then(function(){return o.a.Ca(t,e,n).s(function(t){if(Uu(t))throw new jr("operation-not-supported-in-this-environment");return r=t,Du(o.g).then(function(){throw r})}).then(function(){return o.a.Qb()?new yt(function(){}):Du(o.g).then(function(){return o.fa()}).then(function(){}).s(function(){})})})},Ru.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},Lu.get())};var qu={};function Vu(t,e,n){var r=e+":"+n;return qu[r]||(qu[r]=new Ru(t,e,n)),qu[r]}function ju(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Bu(t){t.g||(t.g=!0,Qu(t,!1,null,null))}function Wu(t,e){if(t.b=function(){return Et(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Qu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Tt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):Wu(t,n):Wu(t,{user:null}),t.f=[],t.c=[]}function Ku(){}function Hu(){this.tb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.tb},set:function(t){this.tb=t},enumerable:!1})}function Gu(t,e){this.a=e,Ar(this,"verificationId",t)}function zu(t,e,n,r){return new zi(t).Va(e,n).then(function(t){return new Gu(t,r)})}function Yu(t){var e=si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new jr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");kr(this,{token:t,expirationTime:Er(1e3*e.exp),authTime:Er(1e3*e.auth_time),issuedAtTime:Er(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Xu(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Ju(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function $u(t){this.f=t,this.b=this.a=null,this.c=0}function Zu(t,e){var n=e[la],r=e.refreshToken;e=tc(e.expiresIn),t.b=n,t.c=e,t.a=r}function tc(t){return w()+1e3*parseInt(t,10)}function ec(t,e){return(n=t.f,r=e,new yt(function(t,e){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?ga(n,n.i+"?key="+encodeURIComponent(n.b),function(n){n?n.error?e(us(n)):n.access_token&&n.refresh_token?t(n):e(new jr("internal-error")):e(new jr("network-request-failed"))},"POST",sn(r).toString(),n.f,n.o.get()):e(new jr("internal-error"))})).then(function(e){return t.b=e.access_token,t.c=tc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e});var n,r}function nc(t,e){this.a=t||null,this.b=e||null,kr(this,{lastSignInTime:Er(e||null),creationTime:Er(t||null)})}function rc(t,e,n,r,i,o){kr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function ic(t,e){for(var n in ae.call(this,t),e)this[n]=e[n]}function oc(e,n,r){var i;this.G=[],this.l=e.apiKey,this.m=e.appName,this.u=e.authDomain||null,e=t.SDK_VERSION?ar(t.SDK_VERSION):null,this.b=new ca(this.l,hi(ui),e),this.h=new $u(this.b),fc(this,n[la]),Zu(this.h,n),Ar(this,"refreshToken",this.h.a),yc(this,r||{}),De.call(this),this.I=!1,this.u&&hr()&&(this.a=Vu(this.u,this.l,this.m)),this.N=[],this.i=null,this.w=(i=this,new Xu(function(){return i.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=i.h.c-w()-3e5;return 0<t?t:0})),this.V=_(this.Ha,this);var o=this;this.ka=null,this.ta=function(t){o.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){sc(o,t.c)},this.W=null}function ac(t,e){t.X&&we(t.X,"languageCodeChanged",t.ta),(t.X=e)&&ge(e,"languageCodeChanged",t.ta)}function sc(e,n){e.O=n,va(e.b,t.SDK_VERSION?ar(t.SDK_VERSION,e.O):null)}function uc(t,e){t.W&&we(t.W,"frameworkChanged",t.sa),(t.W=e)&&ge(e,"frameworkChanged",t.sa)}function cc(n){try{return t.app(n.m).auth()}catch(e){throw new jr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+n.m+"'!")}}function hc(t){t.D||t.w.b||(t.w.start(),we(t,"tokenChanged",t.V),ge(t,"tokenChanged",t.V))}function lc(t){we(t,"tokenChanged",t.V),t.w.stop()}function fc(t,e){t.ra=e,Ar(t,"_lat",e)}function pc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return Ct(e).then(function(){return t})}function dc(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function yc(t,e){kr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new nc(e.createdAt,e.lastLoginAt),providerData:[]})}function mc(){}function vc(t){return Et().then(function(){if(t.D)throw new jr("app-deleted")})}function gc(t){return x(t.providerData,function(t){return t.providerId})}function _c(t,e){e&&(bc(t,e.providerId),t.providerData.push(e))}function bc(t,e){U(t.providerData,function(t){return t.providerId==e})}function wc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Ar(t,e,n)}function Ec(t,e){var n,r,i;t!=e&&(kr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?Ar(t,"metadata",new nc((i=e.metadata).a,i.b)):Ar(t,"metadata",new nc),O(e.providerData,function(e){_c(t,e)}),n=t.h,r=e.h,n.b=r.b,n.a=r.a,n.c=r.c,Ar(t,"refreshToken",t.h.a))}function Tc(t){return t.F().then(function(e){var n,r,i=t.isAnonymous;return(n=t,r=e,as(n.b,ja,{idToken:r}).then(_(n.zc,n))).then(function(){return i||wc(t,"isAnonymous",!1),e})})}function Sc(t,e){e[la]&&t.ra!=e[la]&&(Zu(t.h,e),t.dispatchEvent(new ic("tokenChanged")),fc(t,e[la]),wc(t,"refreshToken",t.h.a))}function Cc(t,e){return Tc(t).then(function(){if(M(gc(t),e))return pc(t).then(function(){throw new jr("provider-already-linked")})})}function Ic(t,e,n){return Dr({user:t,credential:Xi(e),additionalUserInfo:e=yi(e),operationType:n})}function Nc(t,e){return Sc(t,e),t.reload().then(function(){return t})}function Ac(e,n,r,i,o){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));if(e.i&&!o)return Tt(e.i);var a=di(r.providerId),s=vr(e.uid+":::"),u=null;(!pr()||$n())&&e.u&&r.isOAuthProvider&&(u=ws(e.u,e.l,e.m,n,r,null,s,t.SDK_VERSION||null));var c=Gn(u,a&&a.Ba,a&&a.Aa);return i=i().then(function(){if(Dc(e),!o)return e.F().then(function(){})}).then(function(){return Fu(e.a,c,n,r,s,!!u)}).then(function(){return new yt(function(t,r){e.ha(n,null,new jr("cancelled-popup-request"),e.g||null),e.f=t,e.v=r,e.g=s,e.c=e.a.Ea(e,n,c,s)})}).then(function(t){return c&&Hn(c),t?Dr(t):null}).s(function(t){throw c&&Hn(c),t}),Rc(e,i,o)}function kc(t,e,n,r,i){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Tt(t.i);var o=null,a=vr(t.uid+":::");return r=r().then(function(){if(Dc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=a,pc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(xc,t.C(),e.a)),e}).then(function(){return t.a.Ca(e,n,a)}).s(function(e){if(o=e,t.ba)return Lc(t.ba);throw o}).then(function(){if(o)throw o}),Rc(t,r,i)}function Dc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new jr("internal-error");throw new jr("auth-domain-config-required")}}function Rc(t,e,n){var r,i,o,a=(i=e,o=n,(r=t).i&&!o?(i.cancel(),Tt(r.i)):i.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(r.i||r.dispatchEvent(new ic("userInvalidated")),r.i=t),t}));return t.G.push(a),a.ia(function(){F(t.G,a)}),a}function Pc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[la]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-w())/1e3;var r=new oc(e,n,t);return t.providerData&&O(t.providerData,function(t){t&&_c(r,Dr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Oc(t){this.a=t,this.b=nu()}ju.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},ju.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.b,r=t.c,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Qu(this,!0,null,t.a),Et()):e.xa(n,r)?function(t,e,n){n=n.xa(e.b,e.c);var r=e.f,i=e.g,o=e.h,a=!!e.b.match(/Redirect$/);n(r,i,o).then(function(e){Qu(t,a,e,null)}).s(function(e){Qu(t,a,null,e)})}(this,t,e):Tt(new jr("invalid-auth-event")):(Qu(this,!1,null,null),Et())}else Tt(new jr("invalid-auth-event"))},ju.prototype.Za=function(){this.g&&!this.i&&Qu(this,!1,null,null)},ju.prototype.fa=function(){var t=this;return new yt(function(e,n){var r,i;t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),r=t,i=new jr("timeout"),r.a&&r.a.cancel(),r.a=Le(Mu.get()).then(function(){r.b||(r.g=!0,Qu(r,!0,null,i))}))})},Ku.prototype.h=function(t,e){if(t){var n=t.b,r=t.c;t.a?(e.ha(t.b,null,t.a,t.c),Et()):e.xa(n,r)?(o=e,a=(i=t).c,s=i.b,o.xa(s,a)(i.f,i.g,i.h).then(function(t){o.ha(s,t,null,a)}).s(function(t){o.ha(s,null,t,a)})):Tt(new jr("invalid-auth-event"))}else Tt(new jr("invalid-auth-event"));var i,o,a,s},Gu.prototype.confirm=function(t){return t=Yi(this.verificationId,t),this.a(t)},Xu.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=Le(Ju(e,n)).then(function(){return t=r.document,e=null,wr()||!t?Et():new yt(function(n){e=function(){wr()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Xu.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},$u.prototype.C=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},$u.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Tt(new jr("user-token-expired")):t||!this.b||w()>this.c-3e4?this.a?ec(this,{grant_type:"refresh_token",refresh_token:this.a}):Et(null):Et({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},nc.prototype.C=function(){return{lastLoginAt:this.b,createdAt:this.a}},E(ic,ae),E(oc,De),oc.prototype.pa=function(t){this.ka=t,ma(this.b,t)},oc.prototype.ea=function(){return this.ka},oc.prototype.ya=function(){return V(this.O)},oc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Ar(oc.prototype,"providerId","firebase"),(e=oc.prototype).reload=function(){var t=this;return Rc(this,vc(this).then(function(){return Tc(t).then(function(){return pc(t)}).then(mc)}))},e.dc=function(t){return this.F(t).then(function(t){return new Yu(t)})},e.F=function(t){var e=this;return Rc(this,vc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new jr("internal-error");return t.accessToken!=e.ra&&(fc(e,t.accessToken),e.dispatchEvent(new ic("tokenChanged"))),wc(e,"refreshToken",t.refreshToken),t.accessToken}))},e.zc=function(t){if(!(t=t.users)||!t.length)throw new jr("internal-error");yc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=(r=(r=t).providerUserInfo)&&r.length?x(r,function(t){return new rc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[],n=0;n<e.length;n++)_c(this,e[n]);var r;wc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},e.hb=function(t){var e=this,n=null;return Rc(this,t.f(this.b,this.uid).then(function(t){return Sc(e,t),n=Ic(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},e.Ac=function(t){return Ir("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.hb(t).then(function(){})},e.fb=function(t){var e=this,n=null;return Rc(this,Cc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.b,n)}).then(function(t){return n=Ic(e,t,"link"),Nc(e,t)}).then(function(){return n}))},e.rc=function(t){return Ir("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.fb(t).then(function(t){return t.user})},e.sc=function(t,e){var n=this;return Rc(this,Cc(this,"phone").then(function(){return zu(cc(n),t,e,_(n.fb,n))}))},e.Bc=function(t,e){var n=this;return Rc(this,Et().then(function(){return zu(cc(n),t,e,_(n.hb,n))}),!0)},e.qb=function(t){var e=this;return Rc(this,this.F().then(function(n){return e.b.qb(n,t)}).then(function(t){return Sc(e,t),e.reload()}))},e.Tc=function(t){var e=this;return Rc(this,this.F().then(function(n){return t.b(e.b,n)}).then(function(t){return Sc(e,t),e.reload()}))},e.rb=function(t){var e=this;return Rc(this,this.F().then(function(n){return e.b.rb(n,t)}).then(function(t){return Sc(e,t),e.reload()}))},e.sb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return vc(this);var e=this;return Rc(this,this.F().then(function(n){return e.b.sb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Sc(e,t),wc(e,"displayName",t.displayName||null),wc(e,"photoURL",t.photoUrl||null),O(e.providerData,function(t){"password"===t.providerId&&(Ar(t,"displayName",e.displayName),Ar(t,"photoURL",e.photoURL))}),pc(e)}).then(mc))},e.Rc=function(t){var e=this;return Rc(this,Tc(this).then(function(n){return M(gc(e),t)?(r=e.b,i=n,o=[t],as(r,Ua,{idToken:i,deleteProvider:o})).then(function(t){var n={};return O(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),O(gc(e),function(t){n[t]||bc(e,t)}),n[zi.PROVIDER_ID]||Ar(e,"phoneNumber",null),pc(e)}):pc(e).then(function(){throw new jr("no-such-provider")});var r,i,o}))},e.delete=function(){var t=this;return Rc(this,this.F().then(function(e){return as(t.b,Fa,{idToken:e})}).then(function(){t.dispatchEvent(new ic("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");ac(t,null),uc(t,null),t.G=[],t.D=!0,lc(t),Ar(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},e.wb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},e.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},e.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?_(this.Cb,this):null},e.tc=function(t){var e=this;return Ac(this,"linkViaPopup",t,function(){return Cc(e,t.providerId).then(function(){return pc(e)})},!1)},e.Cc=function(t){return Ac(this,"reauthViaPopup",t,function(){return Et()},!0)},e.uc=function(t){var e=this;return kc(this,"linkViaRedirect",t,function(){return Cc(e,t.providerId)},!1)},e.Dc=function(t){return kc(this,"reauthViaRedirect",t,function(){return Et()},!0)},e.Bb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Rc(this,this.F().then(function(i){return Da(r.b,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=Ic(r,t,"link"),Nc(r,t)}).then(function(){return i}))},e.Cb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Rc(this,Et().then(function(){return Ii(Ra(r.b,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Ic(r,t,"reauthenticate"),Sc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},e.kb=function(t){var e=this,n=null;return Rc(this,this.F().then(function(e){return n=e,void 0===t||nt(t)?{}:ei(new Kr(t))}).then(function(t){return e.b.kb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},e.toJSON=function(){return this.C()},e.C=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.u,stsTokenManager:this.h.C(),redirectEventId:this.aa||null};return this.metadata&&st(t,this.metadata.C()),O(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var xc={name:"redirectUser",A:"session"};function Lc(t){return ou(t.b,xc,t.a)}function Mc(t){var e,n,i,o,a,s,u,c,h;this.a=t,this.b=nu(),this.c=null,this.f=(e=this,n=qc("local"),i=qc("session"),o=qc("none"),(a=e.b,s=n,u=e.a,c=iu(s,u),h=ru(a,s.A),a.get(s,u).then(function(t){var e=null;try{e=mr(r.localStorage.getItem(c))}catch(t){}if(e&&!t)return r.localStorage.removeItem(c),a.set(s,e,u);e&&t&&"localStorage"!=h.type&&r.localStorage.removeItem(c)})).then(function(){return e.b.get(i,e.a)}).then(function(t){return t?i:e.b.get(o,e.a).then(function(t){return t?o:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(Uc,e.a).then(function(t){return t?qc(t):n})})})}).then(function(t){return e.c=t,Fc(e,t.A)}).s(function(){e.c||(e.c=n)})),this.b.addListener(qc("local"),this.a,_(this.g,this))}function Fc(t,e){var n,r,i=[];for(n in tu)tu[n]!==e&&i.push(ou(t.b,qc(tu[n]),t.a));return i.push(ou(t.b,Uc,t.a)),r=i,new yt(function(t,e){var n=r.length,i=[];if(n)for(var o=function(e,r){n--,i[e]=r,0==n&&t(i)},a=function(t){e(t)},s=0;s<r.length;s++)St(r[s],b(o,s),a);else t(i)})}Mc.prototype.g=function(){var t=this,e=qc("local");Wc(this,function(){return Et().then(function(){return t.c&&"local"!=t.c.A?t.b.get(e,t.a):null}).then(function(n){if(n)return Fc(t,"local").then(function(){t.c=e})})})};var Uc={name:"persistence",A:"session"};function qc(t){return{name:"authUser",A:t}}function Vc(t,e){return Wc(t,function(){return t.b.set(t.c,e.C(),t.a)})}function jc(t){return Wc(t,function(){return ou(t.b,t.c,t.a)})}function Bc(t,e){return Wc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Pc(t||{})})})}function Wc(t,e){return t.f=t.f.then(e,e),t.f}function Qc(e){if(this.l=!1,Ar(this,"settings",new Hu),Ar(this,"app",e),!Jc(this).options||!Jc(this).options.apiKey)throw new jr("invalid-api-key");var n,r,i,o,a,s,u,c,h,l,f;e=t.SDK_VERSION?ar(t.SDK_VERSION):null,this.b=new ca(Jc(this).options&&Jc(this).options.apiKey,hi(ui),e),this.N=[],this.m=[],this.I=[],this.Tb=t.INTERNAL.createSubscribe(_(this.oc,this)),this.O=void 0,this.Ub=t.INTERNAL.createSubscribe(_(this.pc,this)),Yc(this,null),this.h=new Mc(Jc(this).options.apiKey+":"+Jc(this).name),this.w=new Oc(Jc(this).options.apiKey+":"+Jc(this).name),this.V=eh(this,(r=Jc(n=this).options.authDomain,i=(o=n,a=(s=o.w,u=Jc(o).options.authDomain,s.b.get(xc,s.a).then(function(t){return t&&u&&(t.authDomain=u),Pc(t||{})})).then(function(t){return(o.D=t)&&(t.ba=o.w),Lc(o.w)}),eh(o,a)).then(function(){return Bc(n.h,r)}).then(function(t){return t?(t.ba=n.w,n.D&&(n.D.aa||null)==(t.aa||null)?t:t.reload().then(function(){return Vc(n.h,t).then(function(){return t})}).s(function(e){return"auth/network-request-failed"==e.code?t:jc(n.h)})):null}).then(function(t){Yc(n,t||null)}),eh(n,i))),this.i=eh(this,(c=this).V.then(function(){return c.fa()}).s(function(){}).then(function(){if(!c.l)return c.ka()}).s(function(){}).then(function(){if(!c.l){c.X=!0;var t=c.h;t.b.addListener(qc("local"),t.a,c.ka)}})),this.X=!1,this.ka=_(this.Oc,this),this.Ha=_(this.Z,this),this.ra=_(this.bc,this),this.sa=_(this.mc,this),this.ta=_(this.nc,this),l=Jc(h=this).options.authDomain,f=Jc(h).options.apiKey,l&&hr()&&(h.Sb=h.V.then(function(){if(!h.l){if(h.a=Vu(l,f,Jc(h).name),h.a.subscribe(h),$c(h)&&dc($c(h)),h.D){dc(h.D);var t=h.D;t.pa(h.ea()),ac(t,h),sc(t=h.D,h.G),uc(t,h),h.D=null}return h.a}})),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.u=0,De.call(this),Object.defineProperty(this,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),this.W=null,this.G=[]}function Kc(t){ae.call(this,"languageCodeChanged"),this.g=t}function Hc(t){ae.call(this,"frameworkChanged"),this.c=t}function Gc(t){return t.Sb||Tt(new jr("auth-domain-config-required"))}function zc(t,e){var n={};return n.apiKey=Jc(t).options.apiKey,n.authDomain=Jc(t).options.authDomain,n.appName=Jc(t).name,t.V.then(function(){return r=n,i=e,o=t.w,a=t.ya(),s=new oc(r,i),o&&(s.ba=o),a&&sc(s,a),s.reload().then(function(){return s});var r,i,o,a,s}).then(function(e){return $c(t)&&e.uid==$c(t).uid?Ec($c(t),e):(Yc(t,e),dc(e)),t.Z(e)}).then(function(){th(t)})}function Yc(t,e){var n,r;$c(t)&&(n=$c(t),r=t.Ha,U(n.N,function(t){return t==r}),we($c(t),"tokenChanged",t.ra),we($c(t),"userDeleted",t.sa),we($c(t),"userInvalidated",t.ta),lc($c(t))),e&&(e.N.push(t.Ha),ge(e,"tokenChanged",t.ra),ge(e,"userDeleted",t.sa),ge(e,"userInvalidated",t.ta),0<t.u&&hc(e)),Ar(t,"currentUser",e),e&&(e.pa(t.ea()),ac(e,t),sc(e,t.G),uc(e,t))}function Xc(t,e){var n=null,r=null;return eh(t,e.then(function(e){return n=Xi(e),r=yi(e),zc(t,e)}).then(function(){return Dr({user:$c(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Jc(t){return t.app}function $c(t){return t.currentUser}function Zc(t){return $c(t)&&$c(t)._lat||null}function th(t){if(t.X){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Zc(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](Zc(t))}}function eh(t,e){return t.N.push(e),e.ia(function(){F(t.N,e)}),e}function nh(){}function rh(){this.a={},this.b=1e12}Mc.prototype.nb=function(t){var e=null,n=this;return function(t){var e=new jr("invalid-persistence-type"),n=new jr("unsupported-persistence-type");t:{for(r in tu)if(tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(tr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!cr()&&"none"!==t)throw n}}(t),Wc(this,function(){return t!=n.c.A?n.b.get(n.c,n.a).then(function(r){return e=r,Fc(n,t)}).then(function(){if(n.c=qc(t),e)return n.b.set(n.c,e,n.a)}):Et()})},E(Qc,De),E(Kc,ae),E(Hc,ae),(e=Qc.prototype).nb=function(t){return eh(this,t=this.h.nb(t))},e.pa=function(t){this.W===t||this.l||(this.W=t,ma(this.b,this.W),this.dispatchEvent(new Kc(this.ea())))},e.ea=function(){return this.W},e.Uc=function(){var t=r.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},e.vc=function(e){this.G.push(e),va(this.b,t.SDK_VERSION?ar(t.SDK_VERSION,this.G):null),this.dispatchEvent(new Hc(this.G))},e.ya=function(){return V(this.G)},e.toJSON=function(){return{apiKey:Jc(this).options.apiKey,authDomain:Jc(this).options.authDomain,appName:Jc(this).name,currentUser:$c(this)&&$c(this).C()}},e.wb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},e.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},e.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},e.ac=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var i=null,o=null,a=ka(r.b,t).then(function(t){return i=Xi(t),o=yi(t),t});return eh(this,t=r.V.then(function(){return a}).then(function(t){return zc(r,t)}).then(function(){return Dr({user:$c(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},e.Mc=function(e){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var n=this,r=di(e.providerId),i=vr(),o=null;(!pr()||$n())&&Jc(this).options.authDomain&&e.isOAuthProvider&&(o=ws(Jc(this).options.authDomain,Jc(this).options.apiKey,Jc(this).name,"signInViaPopup",e,null,i,t.SDK_VERSION||null));var a=Gn(o,r&&r.Ba,r&&r.Aa);return eh(this,r=Gc(this).then(function(t){return Fu(t,a,"signInViaPopup",e,i,!!o)}).then(function(){return new yt(function(t,e){n.ha("signInViaPopup",null,new jr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=i,n.c=n.a.Ea(n,"signInViaPopup",a,i)})}).then(function(t){return a&&Hn(a),t?Dr(t):null}).s(function(t){throw a&&Hn(a),t}))},e.Nc=function(t){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var e=this;return eh(this,Gc(this).then(function(){return Wc(t=e.h,function(){return t.b.set(Uc,t.c.A,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},e.fa=function(){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var t=this;return eh(this,Gc(this).then(function(){return t.a.fa()}).then(function(t){return t?Dr(t):null}))},e.Sc=function(t){if(!t)return Tt(new jr("null-user"));var e=this,n={};n.apiKey=Jc(this).options.apiKey,n.authDomain=Jc(this).options.authDomain,n.appName=Jc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.m};var i=t.h,o={};return o[la]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-w())/1e3,e=new oc(e,o),n&&(e.ba=n),r&&sc(e,r),Ec(e,t),e}(t,n,e.w,e.ya());return eh(this,this.i.then(function(){if(Jc(e).options.apiKey!=t.l)return r.reload()}).then(function(){return $c(e)&&t.uid==$c(e).uid?(Ec($c(e),t),e.Z(t)):(Yc(e,r),dc(r),e.Z(r))}).then(function(){th(e)}))},e.ob=function(){var t=this;return eh(this,this.i.then(function(){return $c(t)?(Yc(t,null),jc(t.h).then(function(){th(t)})):Et()}))},e.Oc=function(){var t=this;return Bc(this.h,Jc(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=$c(t)&&e){n=$c(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Ec($c(t),e),$c(t).F();($c(t)||e)&&(Yc(t,e),e&&(dc(e),e.ba=t.w),t.a&&t.a.subscribe(t),th(t))}})},e.Z=function(t){return Vc(this.h,t)},e.bc=function(){th(this),this.Z($c(this))},e.mc=function(){this.ob()},e.nc=function(){this.ob()},e.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next($c(e))})},e.pc=function(t){var e,n,r=this;n=function(){t.next($c(r))},(e=this).I.push(n),eh(e,e.i.then(function(){!e.l&&M(e.I,n)&&e.O!==e.getUid()&&(e.O=e.getUid(),n(Zc(e)))}))},e.xc=function(e,n,r){var i=this;return this.X&&t.Promise.resolve().then(function(){p(e)?e($c(i)):p(e.next)&&e.next($c(i))}),this.Tb(e,n,r)},e.wc=function(e,n,r){var i=this;return this.X&&t.Promise.resolve().then(function(){i.O=i.getUid(),p(e)?e($c(i)):p(e.next)&&e.next($c(i))}),this.Ub(e,n,r)},e.cc=function(t){var e=this;return eh(this,this.i.then(function(){return $c(e)?$c(e).F(t).then(function(t){return{accessToken:t}}):null}))},e.Nb=function(t){var e=this;return this.i.then(function(){return Xc(e,as(e.b,es,{token:t}))}).then(function(t){var n=t.user;return wc(n,"isAnonymous",!1),e.Z(n),t})},e.Gc=function(t){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Nb(t)},e.Hc=function(t,e){return Ir("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Ob(t,e)},e.Ob=function(t,e){var n=this;return this.i.then(function(){return Xc(n,as(n.b,ns,{email:t,password:e}))})},e.yb=function(t,e){var n=this;return this.i.then(function(){return Xc(n,as(n.b,La,{email:t,password:e}))})},e.Wb=function(t,e){return Ir("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.yb(t,e)},e.Jc=function(t){return Ir("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Qa(t).then(function(t){return t.user})},e.Qa=function(t){var e=this;return this.i.then(function(){return Xc(e,t.la(e.b))})},e.Ra=function(){var t=this;return this.i.then(function(){var e=$c(t);return e&&e.isAnonymous?Dr({user:e,credential:null,additionalUserInfo:Dr({providerId:null,isNewUser:!1}),operationType:"signIn"}):Xc(t,t.b.Ra()).then(function(e){var n=e.user;return wc(n,"isAnonymous",!0),t.Z(n),e})})},e.Ic=function(){return Ir("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Ra()},e.getUid=function(){return $c(this)&&$c(this).uid||null},e.Vb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&$c(this)&&hc($c(this))},e.Ec=function(t){var e=this;O(this.m,function(n){n==t&&e.u--}),this.u<0&&(this.u=0),0==this.u&&$c(this)&&lc($c(this)),this.removeAuthTokenListener(t)},e.addAuthTokenListener=function(t){var e=this;this.m.push(t),eh(this,this.i.then(function(){e.l||M(e.m,t)&&t(Zc(e))}))},e.removeAuthTokenListener=function(t){U(this.m,function(e){return e==t})},e.delete=function(){this.l=!0;for(var e=0;e<this.N.length;e++)this.N[e].cancel("app-deleted");return this.N=[],this.h&&(e=this.h).b.removeListener(qc("local"),e.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),t.Promise.resolve()},e.Zb=function(t){return Ir("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),eh(this,as(this.b,Ma,{identifier:t,continueUri:lr()?Wn():"http://localhost"}).then(function(t){return t.allProviders||[]}))},e.$b=function(t){return eh(this,as(this.b,Ma,{identifier:t,continueUri:lr()?Wn():"http://localhost"}).then(function(t){return t.signinMethods||[]}))},e.qc=function(t){return!!Ki(t)},e.mb=function(t,e){var n=this;return eh(this,Et().then(function(){var t=new Kr(e);if(!t.c)throw new jr("argument-error",zr+" must be true when sending sign in link to email");return ei(t)}).then(function(e){return n.b.mb(t,e)}).then(function(){}))},e.Vc=function(t){return this.Ja(t).then(function(t){return t.data.email})},e.$a=function(t,e){return eh(this,this.b.$a(t,e).then(function(){}))},e.Ja=function(t){return eh(this,this.b.Ja(t).then(function(t){return new Pr(t)}))},e.Xa=function(t){return eh(this,this.b.Xa(t).then(function(){}))},e.lb=function(t,e){var n=this;return eh(this,Et().then(function(){return void 0===e||nt(e)?{}:ei(new Kr(e))}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},e.Lc=function(t,e){return eh(this,zu(this,t,e,_(this.Qa,this)))},e.Kc=function(t,e){var n=this;return eh(this,Et().then(function(){var r=Qi(t,e||Wn());return n.Qa(r)}))},nh.prototype.render=function(){},nh.prototype.reset=function(){},nh.prototype.getResponse=function(){},nh.prototype.execute=function(){};var ih=null;function oh(t,e){return(e=ah(e))&&t.a[e]||null}function ah(t){return(t=void 0===t?1e12:t)?t.toString():null}function sh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Pn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ge(this.f,"click",this.i)}function uh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function ch(){}rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new sh(t,e),this.b++},rh.prototype.reset=function(t){var e=oh(this,t);t=ah(t),e&&t&&(e.delete(),delete this.a[t])},rh.prototype.getResponse=function(t){return(t=oh(this,t))?t.getResponse():null},rh.prototype.execute=function(t){(t=oh(this,t))&&t.execute()},sh.prototype.getResponse=function(){return uh(this),this.b},sh.prototype.execute=function(){uh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(e){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(e){}t.h&&t.execute()},6e4)},500))},sh.prototype.delete=function(){uh(this),this.g=!0,clearTimeout(this.a),this.a=null,we(this.f,"click",this.i)},ch.prototype.g=function(){return ih||(ih=new rh),Et(ih)},ch.prototype.c=function(){};var hh=null;function lh(){this.b=r.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var fh=new pn(mn,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),ph=new br(3e4,6e4);lh.prototype.g=function(t){var e=this;return new yt(function(n,i){var o=setTimeout(function(){i(new jr("network-request-failed"))},ph.get());!r.grecaptcha||t!==e.f&&!e.b?(r[e.a]=function(){if(r.grecaptcha){e.f=t;var a=r.grecaptcha.render;r.grecaptcha.render=function(t,n){return t=a(t,n),e.b++,t},clearTimeout(o),n(r.grecaptcha)}else clearTimeout(o),i(new jr("internal-error"));delete r[e.a]},Et(na(_n(fh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(o),i(new jr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(o),n(r.grecaptcha))})},lh.prototype.c=function(){this.b--};var dh=null;function yh(t,e,n,i,o,a,s){if(Ar(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,s=s?(hh||(hh=new ch),hh):(dh||(dh=new lh),dh),this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[gh])throw new jr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[_h],!r.document)throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Pn(e)||!this.i&&Pn(e).hasChildNodes())throw new jr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new ca(t,a||null,o||null),this.v=i||function(){return null};var u=this;this.o=[];var c=this.a[mh];this.a[mh]=function(t){if(bh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=ur(c,r);"function"==typeof e&&e(t)}};var h=this.a[vh];this.a[vh]=function(){if(bh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=ur(h,r);"function"==typeof t&&t()}}}var mh="callback",vh="expired-callback",gh="sitekey",_h="size";function bh(t,e){for(var n=0;n<t.o.length;n++)try{t.o[n](e)}catch(t){}}function wh(t,e){return t.h.push(e),e.ia(function(){F(t.h,e)}),e}function Eh(t){if(t.D)throw new jr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Th(e,n,r){var i=!1;try{this.b=r||t.app()}catch(e){throw new jr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new jr("invalid-api-key");r=this.b.options.apiKey;var o=this,a=null;try{a=this.b.auth().ya()}catch(e){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(e){}a=t.SDK_VERSION?ar(t.SDK_VERSION,a):null,yh.call(this,r,e,n,function(){try{var t=o.b.auth().ea()}catch(e){t=null}return t},a,hi(ui),i)}function Sh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new jr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Ch.length)throw new jr("internal-error","Argument validator received an unsupported number of arguments.");n=Ch[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new jr("argument-error",t+" failed: "+r)}(e=yh.prototype).za=function(){var t=this;return this.f?this.f:this.f=wh(this,Et().then(function(){if(lr()&&!Zn())return Xn();throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.v())}).then(function(e){return t.g=e,as(t.u,Ha,{})}).then(function(e){t.a[gh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},e.render=function(){Eh(this);var t=this;return wh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Pn(e);e=Ln("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},e.verify=function(){Eh(this);var t=this;return wh(this,this.render().then(function(e){return new yt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){var r;e&&(r=i,U(t.o,function(t){return t==r}),n(e))};t.o.push(i),t.i&&t.g.execute(t.c)}})}))},e.reset=function(){Eh(this),null!==this.c&&this.g.reset(this.c)},e.clear=function(){Eh(this),this.D=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Pn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},E(Th,yh);var Ch="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Ih(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:i}}function Nh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:o}}function Ah(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:d}}function kh(t,e){return{name:t||"",K:"a function",optional:!!e,M:p}}function Dh(t,e){return{name:t||"",K:"null",optional:!!e,M:h}}function Rh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.la||!n)}}}function Ph(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&i(t.type)&&p(t.verify))}}}function Oh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function xh(t,e){for(var n in e){var r=e[n].name;t[r]=Fh(r,t[n],e[n].j)}}function Lh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:b(function(t){return this[t]},n),set:b(function(t,e,n,r){Sh(t,[n],[r],!0),this[e]=r},r,n,e[n].ub),enumerable:!0})}}function Mh(t,e,n,r){t[e]=Fh(e,n,r)}function Fh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Sh(a,n,t),e.apply(this,t)}if(!n)return e;var i,o,a=(o=(o=t).split("."))[o.length-1];for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}xh(Qc.prototype,{Xa:{name:"applyActionCode",j:[Ih("code")]},Ja:{name:"checkActionCode",j:[Ih("code")]},$a:{name:"confirmPasswordReset",j:[Ih("code"),Ih("newPassword")]},yb:{name:"createUserWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Wb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Zb:{name:"fetchProvidersForEmail",j:[Ih("email")]},$b:{name:"fetchSignInMethodsForEmail",j:[Ih("email")]},fa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[Ih("emailLink")]},wc:{name:"onAuthStateChanged",j:[Oh(Ah(),kh(),"nextOrObserver"),kh("opt_error",!0),kh("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[Oh(Ah(),kh(),"nextOrObserver"),kh("opt_error",!0),kh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[Ih("email"),Oh(Ah("opt_actionCodeSettings",!0),Dh(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[Ih("email"),Ah("actionCodeSettings")]},nb:{name:"setPersistence",j:[Ih("persistence")]},Qa:{name:"signInAndRetrieveDataWithCredential",j:[Rh()]},Ra:{name:"signInAnonymously",j:[]},Ic:{name:"signInAnonymouslyAndRetrieveData",j:[]},Jc:{name:"signInWithCredential",j:[Rh()]},Nb:{name:"signInWithCustomToken",j:[Ih("token")]},Gc:{name:"signInAndRetrieveDataWithCustomToken",j:[Ih("token")]},Ob:{name:"signInWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Kc:{name:"signInWithEmailLink",j:[Ih("email"),Ih("emailLink",!0)]},Hc:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[Ih("email"),Ih("password")]},Lc:{name:"signInWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},Mc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Sc:{name:"updateCurrentUser",j:[Oh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof oc)}},Dh(),"user")]},ob:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Ih(null,!0)]},Uc:{name:"useDeviceLanguage",j:[]},Vc:{name:"verifyPasswordResetCode",j:[Ih("code")]}}),Lh(Qc.prototype,{lc:{name:"languageCode",ub:Oh(Ih(),Dh(),"languageCode")}}),(Qc.Persistence=tu).LOCAL="local",Qc.Persistence.SESSION="session",Qc.Persistence.NONE="none",xh(oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Nh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Nh("opt_forceRefresh",!0)]},fb:{name:"linkAndRetrieveDataWithCredential",j:[Rh()]},rc:{name:"linkWithCredential",j:[Rh()]},sc:{name:"linkWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},hb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Rh()]},Ac:{name:"reauthenticateWithCredential",j:[Rh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[Ih("phoneNumber"),Ph()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[Oh(Ah("opt_actionCodeSettings",!0),Dh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Ih(null,!0)]},Rc:{name:"unlink",j:[Ih("provider")]},qb:{name:"updateEmail",j:[Ih("email")]},rb:{name:"updatePassword",j:[Ih("password")]},Tc:{name:"updatePhoneNumber",j:[Rh("phone")]},sb:{name:"updateProfile",j:[Ah("profile")]}}),xh(rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),xh(nh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),xh(yt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Lh(Hu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",ub:Nh("appVerificationDisabledForTesting")}}),xh(Gu.prototype,{confirm:{name:"confirm",j:[Ih("verificationCode")]}}),Mh(Wi,"credential",function(t,e){return new Bi(t,e)},[Ih("email"),Ih("password")]),xh(xi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(xi,"credential",Li,[Oh(Ih(),Ah(),"token")]),Mh(Wi,"credentialWithLink",Qi,[Ih("email"),Ih("emailLink")]),xh(Mi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Mi,"credential",Fi,[Oh(Ih(),Ah(),"token")]),xh(Ui.prototype,{ua:{name:"addScope",j:[Ih("scope")]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Ui,"credential",qi,[Oh(Ih(),Oh(Ah(),Dh()),"idToken"),Oh(Ih(),Dh(),"accessToken",!0)]),xh(Vi.prototype,{Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(Vi,"credential",ji,[Oh(Ih(),Ah(),"token"),Ih("secret",!0)]),xh(Oi.prototype,{ua:{name:"addScope",j:[Ih("scope")]},credential:{name:"credential",j:[Oh(Ih(),Dh(),"idToken",!0),Oh(Ih(),Dh(),"accessToken",!0),Oh(Ih(),Dh(),"nonce",!0)]},Da:{name:"setCustomParameters",j:[Ah("customOAuthParameters")]}}),Mh(zi,"credential",Yi,[Ih("verificationId"),Ih("verificationCode")]),xh(zi.prototype,{Va:{name:"verifyPhoneNumber",j:[Ih("phoneNumber"),Ph()]}}),xh(jr.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(io.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(ro.prototype,{toJSON:{name:"toJSON",j:[Ih(null,!0)]}}),xh(Th.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===t||!t.INTERNAL||!t.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var e={Auth:Qc,Error:jr};Mh(e,"EmailAuthProvider",Wi,[]),Mh(e,"FacebookAuthProvider",xi,[]),Mh(e,"GithubAuthProvider",Mi,[]),Mh(e,"GoogleAuthProvider",Ui,[]),Mh(e,"TwitterAuthProvider",Vi,[]),Mh(e,"OAuthProvider",Oi,[Ih("providerId")]),Mh(e,"SAMLAuthProvider",Pi,[Ih("providerId")]),Mh(e,"PhoneAuthProvider",zi,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof Qc)}}]),Mh(e,"RecaptchaVerifier",Th,[Oh(Ih(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Ah("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(e){return!!(e&&e instanceof t.app.App)}}]),t.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:_((t=new Qc(t)).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Vb,t),removeAuthTokenListener:_(t.Ec,t)}}),t},e,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),t.INTERNAL.extendNamespace({User:oc})}()}.apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-auth - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(t){"use strict";try{(function(){t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var i=function(t,e){if(!t)throw o(e)},o=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},a=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,i>>6&63|128),63&i|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!=s){var h=a<<4&240|s>>2;if(r.push(h),64!=u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},u=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function c(t){return function t(e,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return n}for(var r in n)n.hasOwnProperty(r)&&(e[r]=t(e[r],n[r]));return e}(void 0,t)}var h=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),l=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")},f=function(){return!1},p="FirebaseError",d=Error.captureStackTrace,y=function(t,e){if(this.code=t,this.message=e,d)d(this,m.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=p,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};((y.prototype=Object.create(Error.prototype)).constructor=y).prototype.name=p;var m=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,e){void 0===e&&(e={});var n,r=this.errors[t],i=this.service+"/"+t;n=void 0===r?"Error":r.replace(this.pattern,function(t,n){var r=e[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new y(i,n);for(var a in e)e.hasOwnProperty(a)&&"_"!==a.slice(-1)&&(o[a]=e[a]);return o},t}();function v(t){return JSON.parse(t)}function g(t){return JSON.stringify(t)}var _=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=v(u(o[0])||""),n=v(u(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},b=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},w=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},E=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},T=function(t){return e={},E(t,function(t,n){e[t]=n}),e;var e},S=function(t){for(var e in t)return!1;return!0},C=function(t){var e=0;for(var n in t)e++;return e},I=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},N=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},A=function(t){for(var e in t)return e},k=function(t){function e(){var e=t.call(this)||this;e.chain_=[],e.buf_=[],e.W_=[],e.pad_=[],e.inbuf_=0,e.total_=0,e.blockSize=64,e.pad_[0]=128;for(var n=1;n<e.blockSize;++n)e.pad_[n]=0;return e.reset(),e}return n(e,t),e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},e.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},e.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},e}(function(){this.blockSize=-1}),D=function(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function R(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}function P(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(R(t,e,r)+"must be a valid function.")}function O(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(R(t,e,r)+"must be a valid context object.")}var x,L,M=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e};(L=x||(x={}))[L.DEBUG=0]="DEBUG",L[L.VERBOSE=1]="VERBOSE",L[L.INFO=2]="INFO",L[L.WARN=3]="WARN",L[L.ERROR=4]="ERROR",L[L.SILENT=5]="SILENT";var F,U,q,V,j,B,W,Q,K,H,G,z=x.INFO,Y=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case x.DEBUG:case x.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case x.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case x.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case x.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},X=function(){function t(t){this.name=t,this._logLevel=z,this._logHandler=Y}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in x))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,x.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,x.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,x.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,x.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,x.ERROR].concat(t))},t}(),J=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),g(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:v(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),$=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return b(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),Z=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new J(e)}}catch(t){}return new $},tt=Z("localStorage"),et=Z("sessionStorage"),nt=new X("@firebase/database"),rt=(F=1,function(){return F++}),it=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var o=t.charCodeAt(r);if(55296<=o&&o<=56319){var a=o-55296;i(++r<t.length,"Surrogate pair missing trail surrogate."),o=65536+(a<<10)+(t.charCodeAt(r)-56320)}e[n++]=o<128?o:(e[n++]=o<2048?o>>6|192:(e[n++]=o<65536?o>>12|224:(e[n++]=o>>18|240,o>>12&63|128),o>>6&63|128),63&o|128)}return e}(t),n=new k;n.update(e);var r=n.digest();return s.encodeByteArray(r)},ot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=ot.apply(null,t[r]):"object"==typeof t[r]?n+=g(t[r]):n+=t[r],n+=" ";return n},at=null,st=!0,ut=function(t,e){i(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(nt.logLevel=x.VERBOSE,at=nt.log.bind(nt),e&&et.set("logging_enabled",!0)):"function"==typeof t?at=t:(at=null,et.remove("logging_enabled"))},ct=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===st&&(st=!1,null===at&&!0===et.get("logging_enabled")&&ut(!0)),at){var n=ot.apply(null,t);at(n)}},ht=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];ct.apply(void 0,[t].concat(e))}},lt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+ot.apply(void 0,t);nt.error(n)},ft=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+ot.apply(void 0,t);throw nt.error(n),new Error(n)},pt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+ot.apply(void 0,t);nt.warn(n)},dt=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},yt="[MIN_NAME]",mt="[MAX_NAME]",vt=function(t,e){if(t===e)return 0;if(t===yt||e===mt)return-1;if(e===yt||t===mt)return 1;var n=Ct(t),r=Ct(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},gt=function(t,e){return t===e?0:t<e?-1:1},_t=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+g(e))},bt=function(t){if("object"!=typeof t||null===t)return g(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=g(e[i]),r+=":",r+=bt(t[e[i]]);return r+"}"},wt=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},Et=function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;++n)e(n,t[n]);else E(t,function(t,n){return e(n,t)})},Tt=function(t){var e,n,r,o,a,s,u;for(i(!dt(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(o=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),s=[],a=52;a;a-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(e?1:0),s.reverse(),u=s.join("");var c="";for(a=0;a<64;a+=8){var h=parseInt(u.substr(a,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()},St=new RegExp("^-?\\d{1,10}$"),Ct=function(t){if(St.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},It=function(t){try{t()}catch(r){setTimeout(function(){var e=r.stack||"";throw pt("Exception was thrown by user callback.",e),r},Math.floor(0))}},Nt=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},At=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!0,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(e instanceof t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)0<i[r].length&&n.push(i[r])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var r=e.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=vt(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),kt=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=M(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=M(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=M(t),0<this.parts_.length&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Dt="firebaseio.com",Rt="websocket",Pt="long_polling",Ot=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=tt.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&tt.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(i("string"==typeof t,"typeof type must == string"),i("object"==typeof e,"typeof params must == object"),t===Rt)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Pt)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return E(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}(),xt=function(t){var e=Lt(t),n=e.subdomain;"firebase"===e.domain&&ft(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||ft("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&pt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Ot(e.host,e.secure,n,r),path:new At(e.pathString)}},Lt=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):pt("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},Mt=/[\[\].#$\/\u0000-\u001F\u007F]/,Ft=/[\[\].#$\u0000-\u001F\u007F]/,Ut=10485760,qt=function(t){return"string"==typeof t&&0!==t.length&&!Mt.test(t)},Vt=function(t){return"string"==typeof t&&0!==t.length&&!Ft.test(t)},jt=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!dt(t)||t&&"object"==typeof t&&b(t,".sv")},Bt=function(t,e,n,r,i){i&&void 0===n||Wt(R(t,e,i),n,r)},Wt=function(t,e,n){var r=n instanceof At?new kt(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+r.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+r.toErrorString()+" with contents = "+e.toString());if(dt(e))throw new Error(t+"contains "+e.toString()+" "+r.toErrorString());if("string"==typeof e&&e.length>Ut/3&&M(e)>Ut)throw new Error(t+"contains a string greater than "+Ut+" utf8 bytes "+r.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,o=!1;if(E(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(o=!0,!qt(e)))throw new Error(t+" contains an invalid key ("+e+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(e),Wt(t,n,r),r.pop()}),i&&o)throw new Error(t+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Qt=function(t,e,n,r,i){if(!i||void 0!==n){var o=R(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];E(n,function(t,e){var n=new At(t);if(Wt(o,e,r.child(n)),".priority"===n.getBack()&&!jt(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!qt(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(At.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},Kt=function(t,e,n,r){if(!r||void 0!==n){if(dt(n))throw new Error(R(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!jt(n))throw new Error(R(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ht=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(R(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Gt=function(t,e,n,r){if(!(r&&void 0===n||qt(n)))throw new Error(R(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},zt=function(t,e,n,r){if(!(r&&void 0===n||Vt(n)))throw new Error(R(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Yt=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},Xt=function(t,e,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!qt(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&((r=i)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),!Vt(r)))throw new Error(R(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Jt=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){D("OnDisconnect.cancel",0,1,arguments.length),P("OnDisconnect.cancel",1,t,!0);var e=new h;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){D("OnDisconnect.remove",0,1,arguments.length),Yt("OnDisconnect.remove",this.path_),P("OnDisconnect.remove",1,t,!0);var e=new h;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){D("OnDisconnect.set",1,2,arguments.length),Yt("OnDisconnect.set",this.path_),Bt("OnDisconnect.set",1,t,this.path_,!1),P("OnDisconnect.set",2,e,!0);var n=new h;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){D("OnDisconnect.setWithPriority",2,3,arguments.length),Yt("OnDisconnect.setWithPriority",this.path_),Bt("OnDisconnect.setWithPriority",1,t,this.path_,!1),Kt("OnDisconnect.setWithPriority",2,e,!1),P("OnDisconnect.setWithPriority",3,n,!0);var r=new h;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(D("OnDisconnect.update",1,2,arguments.length),Yt("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,pt("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Qt("OnDisconnect.update",1,t,this.path_,!1),P("OnDisconnect.update",2,e,!0);var i=new h;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),$t=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return D("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),Zt=(U="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",q=0,V=[],function(t){var e,n=t===q;q=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=U.charAt(t%64),t=Math.floor(t/64);i(0===t,"Cannot push at time == 0");var o=r.join("");if(n){for(e=11;0<=e&&63===V[e];e--)V[e]=0;V[e]++}else for(e=0;e<12;e++)V[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)o+=U.charAt(V[e]);return i(20===o.length,"nextPushId: Length should be 20."),o}),te=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),ee=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new te(yt,t),r=new te(yt,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return te.MIN},t}(),ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return j},set:function(t){j=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return vt(t.name,e.name)},e.prototype.isDefinedOn=function(){throw o("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(){return!1},e.prototype.minPost=function(){return te.MIN},e.prototype.maxPost=function(){return new te(mt,j)},e.prototype.makePost=function(t){return i("string"==typeof t,"KeyIndex indexValue must always be a string."),new te(t,j)},e.prototype.toString=function(){return".key"},e}(ee),re=new ne,ie=function(t){return"number"==typeof t?"number:"+Tt(t):"string:"+t},oe=function(t){if(t.isLeafNode()){var e=t.val();i("string"==typeof e||"number"==typeof e||"object"==typeof e&&b(e,".sv"),"Priority must be a string or number.")}else i(t===B||t.isEmpty(),"priority of unexpected type.");i(t===B||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ae=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,i(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),oe(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return W},set:function(t){W=t},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=e.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(i(".priority"!==r||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+ie(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?Tt(this.value_):this.value_,this.lazyHash_=it(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(i(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,o=t.VALUE_TYPE_ORDER.indexOf(n),a=t.VALUE_TYPE_ORDER.indexOf(r);return i(0<=o,"Unknown leaf type: "+n),i(0<=a,"Unknown leaf type: "+r),o===a?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:a-o},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),se=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?vt(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return te.MIN},e.prototype.maxPost=function(){return new te(mt,new ae("[PRIORITY-POST]",K))},e.prototype.makePost=function(t,e){var n=Q(t);return new te(e,new ae("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(ee)),ue=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return 0<this.nodeStack_.length},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),ce=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:le.EMPTY_NODE,this.right=null!=o?o:le.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return le.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return le.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),he=function(){function t(){}return t.prototype.copy=function(){return this},t.prototype.insert=function(t,e){return new ce(t,e,null)},t.prototype.remove=function(){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(){return!1},t.prototype.reverseTraversal=function(){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),le=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ce.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ce.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new ue(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new ue(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new ue(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new ue(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new he,t}(),fe=Math.log(2),pe=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/fe,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),de=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,a,s=r-e;if(0==s)return null;if(1==s)return o=t[e],a=n?n(o):o,new ce(a,o.node,ce.BLACK,null,null);var u=parseInt(s/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],a=n?n(o):o,new ce(a,o.node,ce.BLACK,c,h)},o=function(e){for(var r=null,o=null,a=t.length,s=function(e,r){var o=a-e,s=a;a-=e;var c=i(o+1,s),h=t[o],l=n?n(h):h;u(new ce(l,h.node,r,null,c))},u=function(t){r=r?r.left=t:o=t},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?s(l,ce.BLACK):(s(l,ce.BLACK),s(l,ce.RED))}return o}(new pe(t.length));return new le(r||e,o)},ye={},me=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return i(se,"ChildrenNode.ts has not been loaded"),H=H||new t({".priority":ye},{".priority":se})},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var e=w(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===ye?null:e},t.prototype.hasIndex=function(t){return b(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){i(e!==re,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],a=!1,s=n.getIterator(te.Wrap),u=s.getNext();u;)a=a||e.isDefinedOn(u.node),o.push(u),u=s.getNext();r=a?de(o,e.getCompare()):ye;var c=e.toString(),h=T(this.indexSet_);h[c]=e;var l=T(this.indexes_);return l[c]=r,new t(l,h)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(I(this.indexes_,function(t,o){var a=w(r.indexSet_,o);if(i(a,"Missing index implementation for "+o),t===ye){if(a.isDefinedOn(e.node)){for(var s=[],u=n.getIterator(te.Wrap),c=u.getNext();c;)c.name!=e.name&&s.push(c),c=u.getNext();return s.push(e),de(s,a.getCompare())}return ye}var h=n.get(e.name),l=t;return h&&(l=l.remove(new te(e.name,h))),l.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(I(this.indexes_,function(t){if(t===ye)return t;var r=n.get(e.name);return r?t.remove(new te(e.name,r)):t}),this.indexSet_)},t}();function ve(t,e){return vt(t.name,e.name)}function ge(t,e){return vt(t,e)}var _e=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&oe(this.priorityNode_),this.children_.isEmpty()&&i(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return G||(G=new t(new le(ge),null,me.Default))},enumerable:!0,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||G},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?G:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(i(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r,o=new te(e,n),a=void 0;return r=n.isEmpty()?(a=this.children_.remove(e),this.indexMap_.removeFromIndexes(o,this.children_)):(a=this.children_.insert(e,n),this.indexMap_.addToIndexes(o,this.children_)),new t(a,a.isEmpty()?G:this.priorityNode_,r)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;i(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(se,function(a,s){n[a]=s.val(e),r++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!e&&o&&i<2*r){var a=[];for(var s in n)a[s]=n[s];return a}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+ie(this.getPriority().val())+":"),this.forEachChild(se,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":it(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new te(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new te(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new te(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,te.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,te.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===be?-1:0},t.prototype.withIndex=function(e){if(e===re||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===re||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(se),r=e.getIterator(se),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},t.prototype.resolveIndex_=function(t){return t===re?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),be=new(function(t){function e(){return t.call(this,new le(ge),_e.EMPTY_NODE,me.Default)||this}return n(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(){return _e.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(_e));Object.defineProperties(te,{MIN:{value:new te(yt,_e.EMPTY_NODE)},MAX:{value:new te(mt,be)}}),ne.__EMPTY_NODE=_e.EMPTY_NODE,ae.__childrenNodeConstructor=_e,B=be,K=be;var we=!0;function Ee(t,e){if(void 0===e&&(e=null),null===t)return _e.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),i(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new ae(t,Ee(e));if(t instanceof Array||!we){var n=_e.EMPTY_NODE,r=t;return E(r,function(t,e){if(b(r,t)&&"."!==t.substring(0,1)){var i=Ee(e);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}}),n.updatePriority(Ee(e))}var o=[],a=!1,s=t;if(E(s,function(t){if("string"!=typeof t||"."!==t.substring(0,1)){var e=Ee(s[t]);e.isEmpty()||(a=a||!e.getPriority().isEmpty(),o.push(new te(t,e)))}}),0==o.length)return _e.EMPTY_NODE;var u=de(o,ve,function(t){return t.name},ge);if(a){var c=de(o,se.getCompare());return new _e(u,Ee(e),new me({".priority":c},{".priority":se}))}return new _e(u,Ee(e),me.Default)}Q=Ee;var Te,Se,Ce,Ie=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?vt(t.name,e.name):n},e.prototype.isDefinedOn=function(){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return te.MIN},e.prototype.maxPost=function(){return te.MAX},e.prototype.makePost=function(t,e){var n=Ee(t);return new te(e,n)},e.prototype.toString=function(){return".value"},e}(ee)),Ne=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,i(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return n(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?vt(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=Ee(t),r=_e.EMPTY_NODE.updateChild(this.indexPath_,n);return new te(e,r)},e.prototype.maxPost=function(){var t=_e.EMPTY_NODE.updateChild(this.indexPath_,be);return new te(mt,t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(ee),Ae=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return D("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return D("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return D("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return D("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){D("DataSnapshot.child",0,1,arguments.length),e=String(e),zt("DataSnapshot.child",1,e,!1);var n=new At(e),r=this.ref_.child(n);return new t(this.node_.getChild(n),r,se)},t.prototype.hasChild=function(t){D("DataSnapshot.hasChild",1,1,arguments.length),zt("DataSnapshot.hasChild",1,t,!1);var e=new At(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return D("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;return D("DataSnapshot.forEach",1,1,arguments.length),P("DataSnapshot.forEach",1,e,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return e(new t(i,n.ref_.child(r),se))})},t.prototype.hasChildren=function(){return D("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),t.prototype.numChildren=function(){return D("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return D("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),ke=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+g(this.snapshot.exportVal())},t}(),De=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Re=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new ke("value",this,new Ae(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){i(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new De(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Pe=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,b(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new De(this,t,e):null},t.prototype.createEvent=function(t,e){i(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new ke(t.type,this,new Ae(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){i(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var n=C(e.callbacks_);if(n===C(this.callbacks_)){if(1!==n)return function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0}(this.callbacks_,function(t,n){return e.callbacks_[t]===n});var r=A(e.callbacks_),i=A(this.callbacks_);return!(i!==r||e.callbacks_[r]&&this.callbacks_[i]&&e.callbacks_[r]!==this.callbacks_[i])}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Oe=function(){function t(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return i(Te,"Reference.ts has not been loaded"),Te},set:function(t){Te=t},enumerable:!0,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===re){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=yt)throw new Error(r);if("string"!=typeof e)throw new Error(o)}if(t.hasEnd()){if(t.getIndexEndName()!=mt)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(t.getIndex()===se){if(null!=e&&!jt(e)||null!=n&&!jt(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(i(t.getIndex()instanceof Ne||t.getIndex()===Ie,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return D("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,r,i){D("Query.on",2,4,arguments.length),Ht("Query.on",1,e,!1),P("Query.on",2,n,!1);var o=t.getCancelAndContextArgs_("Query.on",r,i);if("value"===e)this.onValueEvent(n,o.cancel,o.context);else{var a={};a[e]=n,this.onChildEvent(a,o.cancel,o.context)}return n},t.prototype.onValueEvent=function(t,e,n){var r=new Re(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},t.prototype.onChildEvent=function(t,e,n){var r=new Pe(t,e,n);this.repo.addEventCallbackForQuery(this,r)},t.prototype.off=function(t,e,n){D("Query.off",0,3,arguments.length),Ht("Query.off",1,t,!0),P("Query.off",2,e,!0),O("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new Re(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new Pe(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},t.prototype.once=function(e,n,r,i){var o=this;D("Query.once",1,4,arguments.length),Ht("Query.once",1,e,!1),P("Query.once",2,n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,i),s=!0,u=new h;u.promise.catch(function(){});var c=function(t){s&&(s=!1,o.off(e,c),n&&n.bind(a.context)(t),u.resolve(t))};return this.on(e,c,function(t){o.off(e,c),a.cancel&&a.cancel.bind(a.context)(t),u.reject(t)}),u.promise},t.prototype.limitToFirst=function(e){if(D("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(D("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(D("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');zt("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new At(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Ne(n),i=this.queryParams_.orderBy(r);return t.validateQueryEndpoints_(i),new t(this.repo,this.path,i,!0)},t.prototype.orderByKey=function(){D("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(re);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){D("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(se);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){D("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(Ie);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),D("Query.startAt",0,2,arguments.length),Bt("Query.startAt",1,e,this.path,!0),Gt("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(n=e=null),new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),D("Query.endAt",0,2,arguments.length),Bt("Query.endAt",1,e,this.path,!0),Gt("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(e,n);if(t.validateLimit_(r),t.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,r,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(D("Query.equalTo",1,2,arguments.length),Bt("Query.equalTo",1,t,this.path,!1),Gt("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return D("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return D("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=bt(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(D("Query.isEqual",1,1,arguments.length),!(e instanceof t))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var n=this.repo===e.repo,r=this.path.equals(e.path),i=this.queryIdentifier()===e.queryIdentifier();return n&&r&&i},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,P(t,3,r.cancel,!0),r.context=n,O(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(R(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),t}(),xe=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return b(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return S(this.set)},t.prototype.count=function(){return C(this.set)},t.prototype.each=function(t){E(this.set,function(e,n){return t(e,n)})},t.prototype.keys=function(){var t=[];return E(this.set,function(e){t.push(e)}),t},t}(),Le=function(){function t(){this.value_=null,this.children_=null}return t.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value_=n,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,n);else{null==this.children_&&(this.children_=new xe);var r=e.getFront();this.children_.contains(r)||this.children_.add(r,new t);var i=this.children_.get(r);e=e.popFront(),i.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,!(this.children_=null);if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(se,function(t,e){n.remember(new At(t),e)}),this.forget(t)}if(null===this.children_)return!0;var r=t.getFront();return t=t.popFront(),this.children_.contains(r)&&this.children_.get(r).forget(t)&&this.children_.remove(r),!!this.children_.isEmpty()&&!(this.children_=null)},t.prototype.forEachTree=function(t,e){null!==this.value_?e(t,this.value_):this.forEachChild(function(n,r){var i=new At(t.toString()+"/"+n);r.forEachTree(i,e)})},t.prototype.forEachChild=function(t){null!==this.children_&&this.children_.each(function(e,n){t(e,n)})},t}(),Me=function(t,e){return t&&"object"==typeof t?(i(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},Fe=function(t,e){var n,r=t.getPriority().val(),i=Me(r,e);if(t.isLeafNode()){var o=t,a=Me(o.getValue(),e);return a!==o.getValue()||i!==o.getPriority().val()?new ae(a,Ee(i)):t}var s=t;return i!==(n=s).getPriority().val()&&(n=n.updatePriority(new ae(i))),s.forEachChild(se,function(t,r){var i=Fe(r,e);i!==r&&(n=n.updateImmediateChild(t,i))}),n};(Ce=Se||(Se={}))[Ce.OVERWRITE=0]="OVERWRITE",Ce[Ce.MERGE=1]="MERGE",Ce[Ce.ACK_USER_WRITE=2]="ACK_USER_WRITE",Ce[Ce.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var Ue,qe,Ve=function(){function t(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,i(!r||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),je=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Se.ACK_USER_WRITE,this.source=Ve.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return i(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new At(e));return new t(At.Empty,n,this.revert)}return i(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),Be=function(){function t(t,e){void 0===e&&(Ue||(Ue=new le(gt)),e=Ue),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return E(e,function(t,e){n=n.set(new At(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:At.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new At(n).child(i.path),value:i.value}},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),r=this.children.get(n);return null!==r?r.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var r=e.getFront(),i=(this.children.get(r)||t.Empty).set(e.popFront(),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),r=this.children.get(n);if(r){var i=r.remove(e.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?t.Empty:new t(this.value,o)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var r,i=e.getFront(),o=(this.children.get(i)||t.Empty).setTree(e.popFront(),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(At.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(t.child(r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,At.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,At.Empty,e)},t.prototype.foreachOnPath_=function(e,n,r){if(e.isEmpty())return this;this.value&&r(n,this.value);var i=e.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(e.popFront(),n.child(i),r):t.Empty},t.prototype.foreach=function(t){this.foreach_(At.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(t.child(n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t.Empty=new t(null),t}(),We=function(){function t(t,e){this.source=t,this.path=e,this.type=Se.LISTEN_COMPLETE}return t.prototype.operationForChild=function(){return this.path.isEmpty()?new t(this.source,At.Empty):new t(this.source,this.path.popFront())},t}(),Qe=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Se.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,At.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),Ke=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Se.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new At(e));return n.isEmpty()?null:n.value?new Qe(this.source,At.Empty,n.value):new t(this.source,At.Empty,n)}return i(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),He=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),Ge=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,r){return new t(new He(e,n,r),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,r){return new t(this.eventCache_,new He(e,n,r))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new He(_e.EMPTY_NODE,!1,!1),new He(_e.EMPTY_NODE,!1,!1)),t}(),ze=function(){function t(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,r){return new t(t.CHILD_CHANGED,n,e,r)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),Ye=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,o,a){i(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()==n.isEmpty()?t:(null!=a&&(n.isEmpty()?t.hasChild(e)?a.trackChildChange(ze.childRemovedChange(e,s)):i(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?a.trackChildChange(ze.childAddedChange(e,n)):a.trackChildChange(ze.childChangedChange(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(se,function(t,r){e.hasChild(t)||n.trackChildChange(ze.childRemovedChange(t,r))}),e.isLeafNode()||e.forEachChild(se,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(ze.childChangedChange(e,r,i))}else n.trackChildChange(ze.childAddedChange(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?_e.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),Xe=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;i(e==ze.CHILD_ADDED||e==ze.CHILD_CHANGED||e==ze.CHILD_REMOVED,"Only child changes supported for tracking"),i(".priority"!==n,"Only non-priority child changes can be tracked.");var r=w(this.changeMap_,n);if(r){var a=r.type;if(e==ze.CHILD_ADDED&&a==ze.CHILD_REMOVED)this.changeMap_[n]=ze.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==ze.CHILD_REMOVED&&a==ze.CHILD_ADDED)delete this.changeMap_[n];else if(e==ze.CHILD_REMOVED&&a==ze.CHILD_CHANGED)this.changeMap_[n]=ze.childRemovedChange(n,r.oldSnap);else if(e==ze.CHILD_CHANGED&&a==ze.CHILD_ADDED)this.changeMap_[n]=ze.childAddedChange(n,t.snapshotNode);else{if(e!=ze.CHILD_CHANGED||a!=ze.CHILD_CHANGED)throw o("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=ze.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e}(this.changeMap_)},t}(),Je=new(function(){function t(){}return t.prototype.getCompleteChild=function(){return null},t.prototype.getChildAfterChild=function(){return null},t}()),$e=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new He(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),Ze=function(t,e){this.viewCache=t,this.changes=e},tn=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){i(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),i(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,r,a){var s,u,c=new Xe;if(n.type===Se.OVERWRITE){var h=n;s=h.source.fromUser?this.applyUserOverwrite_(e,h.path,h.snap,r,a,c):(i(h.source.fromServer,"Unknown source."),u=h.source.tagged||e.getServerCache().isFiltered()&&!h.path.isEmpty(),this.applyServerOverwrite_(e,h.path,h.snap,r,a,u,c))}else if(n.type===Se.MERGE){var l=n;s=l.source.fromUser?this.applyUserMerge_(e,l.path,l.children,r,a,c):(i(l.source.fromServer,"Unknown source."),u=l.source.tagged||e.getServerCache().isFiltered(),this.applyServerMerge_(e,l.path,l.children,r,a,u,c))}else if(n.type===Se.ACK_USER_WRITE){var f=n;s=f.revert?this.revertUserWrite_(e,f.path,r,a,c):this.ackUserWrite_(e,f.path,f.affectedTree,r,a,c)}else{if(n.type!==Se.LISTEN_COMPLETE)throw o("Unknown operation type: "+n.type);s=this.listenComplete_(e,n.path,r,c)}var p=c.getChanges();return t.maybeAddValueEvent_(e,s,p),new Ze(s,p)},t.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(ze.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,o){var a=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var s=void 0,u=void 0;if(e.isEmpty())if(i(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var c=t.getCompleteServerSnap(),h=c instanceof _e?c:_e.EMPTY_NODE,l=n.calcCompleteEventChildren(h);s=this.filter_.updateFullNode(t.getEventCache().getNode(),l,o)}else{var f=n.calcCompleteEventCache(t.getCompleteServerSnap());s=this.filter_.updateFullNode(t.getEventCache().getNode(),f,o)}else{var p=e.getFront();if(".priority"==p){i(1==e.getLength(),"Can't have a priority with additional path components");var d=a.getNode();u=t.getServerCache().getNode();var y=n.calcEventCacheAfterServerOverwrite(e,d,u);s=null!=y?this.filter_.updatePriority(d,y):a.getNode()}else{var m=e.popFront(),v=void 0;if(a.isCompleteForChild(p)){u=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,a.getNode(),u);v=null!=g?a.getNode().getImmediateChild(p).updateChild(m,g):a.getNode().getImmediateChild(p)}else v=n.calcCompleteChild(p,t.getServerCache());s=null!=v?this.filter_.updateChild(a.getNode(),p,v,m,r,o):a.getNode()}}return t.updateEventSnap(s,a.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,Je,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new $e(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},t.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new $e(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):_e.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,r,i,o,a){var s=this,u=e;return r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())&&(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),r.foreach(function(r,c){var h=n.child(r);t.cacheHasChild_(e,h.getFront())||(u=s.applyUserOverwrite_(u,h,c,i,o,a))}),u},t.prototype.applyMerge_=function(t,e){return e.foreach(function(e,n){t=t.updateChild(e,n)}),t},t.prototype.applyServerMerge_=function(t,e,n,r,i,o,a){var s=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var u,c=t;u=e.isEmpty()?n:Be.Empty.setTree(e,n);var h=t.getServerCache().getNode();return u.children.inorderTraversal(function(e,n){if(h.hasChild(e)){var u=t.getServerCache().getNode().getImmediateChild(e),l=s.applyMerge_(u,n);c=s.applyServerOverwrite_(c,new At(e),l,r,i,o,a)}}),u.children.inorderTraversal(function(e,n){var u=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!u){var l=t.getServerCache().getNode().getImmediateChild(e),f=s.applyMerge_(l,n);c=s.applyServerOverwrite_(c,new At(e),f,r,i,o,a)}}),c},t.prototype.ackUserWrite_=function(t,e,n,r,i,o){if(null!=r.shadowingWrite(e))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,s.getNode().getChild(e),r,i,a,o);if(e.isEmpty()){var u=Be.Empty;return s.getNode().forEachChild(re,function(t,e){u=u.set(new At(t),e)}),this.applyServerMerge_(t,e,u,r,i,a,o)}return t}var c=Be.Empty;return n.foreach(function(t){var n=e.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,e,c,r,i,a,o)},t.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,Je,r)},t.prototype.revertUserWrite_=function(t,e,n,r,o){var a;if(null!=n.shadowingWrite(e))return t;var s=new $e(n,t,r),u=t.getEventCache().getNode(),c=void 0;if(e.isEmpty()||".priority"===e.getFront()){var h=void 0;if(t.getServerCache().isFullyInitialized())h=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var l=t.getServerCache().getNode();i(l instanceof _e,"serverChildren would be complete if leaf node"),h=n.calcCompleteEventChildren(l)}h=h,c=this.filter_.updateFullNode(u,h,o)}else{var f=e.getFront(),p=n.calcCompleteChild(f,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(f)&&(p=u.getImmediateChild(f)),(c=null!=p?this.filter_.updateChild(u,f,p,e.popFront(),s,o):t.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(u,f,_e.EMPTY_NODE,e.popFront(),s,o):u).isEmpty()&&t.getServerCache().isFullyInitialized()&&(a=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(c=this.filter_.updateFullNode(c,a,o))}return a=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(At.Empty),t.updateEventSnap(c,a,this.filter_.filtersNodes())},t}(),en=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===ze.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(ze.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,ze.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,ze.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,ze.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,ze.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,ze.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(t,e,n,r,i){var o=this,a=n.filter(function(t){return t.type===e});a.sort(this.compareChanges_.bind(this)),a.forEach(function(e){var n=o.materializeSingleChange_(e,i);r.forEach(function(r){r.respondsTo(e.type)&&t.push(r.createEvent(n,o.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw o("Should only compare child_ events.");var n=new te(t.childName,t.snapshotNode),r=new te(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),nn=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Ye(n.getIndex()),i=n.getNodeFilter();this.processor_=new tn(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(_e.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(_e.EMPTY_NODE,a.getNode(),null),c=new He(s,o.isFullyInitialized(),r.filtersNodes()),h=new He(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Ge(h,c),this.eventGenerator_=new en(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){i(null==t,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach(function(t){e=e;var i=t.createCancelEvent(e,r);i&&n.push(i)})}if(t){for(var o=[],a=0;a<this.eventRegistrations_.length;++a){var s=this.eventRegistrations_[a];if(s.matches(t)){if(t.hasAnyCallback()){o=o.concat(this.eventRegistrations_.slice(a+1));break}}else o.push(s)}this.eventRegistrations_=o}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Se.MERGE&&null!==t.source.queryId&&(i(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),i(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,o=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(o.viewCache),i(o.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=o.viewCache,this.generateEventsForChanges_(o.changes,o.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(se,function(t,e){n.push(ze.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(ze.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),rn=function(){function t(){this.views_={}}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return i(qe,"Reference.ts has not been loaded"),qe},set:function(t){i(!qe,"__referenceConstructor has already been defined"),qe=t},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return S(this.views_)},t.prototype.applyOperation=function(t,e,n){var r=t.source.queryId;if(null!==r){var o=w(this.views_,r);return i(null!=o,"SyncTree gave us an op for an invalid query."),o.applyOperation(t,e,n)}var a=[];return E(this.views_,function(r,i){a=a.concat(i.applyOperation(t,e,n))}),a},t.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=w(this.views_,o);if(!a){var s,u=n.calcCompleteEventCache(i?r:null);s=!!u||(u=r instanceof _e?n.calcCompleteEventChildren(r):_e.EMPTY_NODE,!1);var c=new Ge(new He(u,s,!1),new He(r,i,!1));a=new nn(t,c),this.views_[o]=a}return a.addEventRegistration(e),a.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,r){var i=e.queryIdentifier(),o=[],a=[],s=this.hasCompleteView();if("default"===i){var u=this;E(this.views_,function(t,e){a=a.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete u.views_[t],e.getQuery().getQueryParams().loadsAllData()||o.push(e.getQuery()))})}else{var c=w(this.views_,i);c&&(a=a.concat(c.removeEventRegistration(n,r)),c.isEmpty()&&(delete this.views_[i],c.getQuery().getQueryParams().loadsAllData()||o.push(c.getQuery())))}return s&&!this.hasCompleteView()&&o.push(new t.__referenceConstructor(e.repo,e.path)),{removed:o,events:a}},t.prototype.getQueryViews=function(){var t=this;return Object.keys(this.views_).map(function(e){return t.views_[e]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},t.prototype.getCompleteServerCache=function(t){var e=null;return E(this.views_,function(n,r){e=e||r.getCompleteServerCache(t)}),e},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return w(this.views_,e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;return t=this.views_,(e=N(t,function(t){return t.getQuery().getQueryParams().loadsAllData()},void 0))&&t[e]||null},t}(),on=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new Be(n));var r=this.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,a=At.relativePath(i,e);return o=o.updateChild(a,n),new t(this.writeTree_.set(i,o))}var s=new Be(n);return new t(this.writeTree_.setTree(e,s))},t.prototype.addWrites=function(t,e){var n=this;return E(e,function(e,r){n=n.addWrite(t.child(e),r)}),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,Be.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(At.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(se,function(e,n){t.push(new te(e,n))}):this.writeTree_.children.inorderTraversal(function(e,n){null!=n.value&&t.push(new te(e,n.value))}),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new Be(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(e){return t.applySubtreeWrite_(At.Empty,this.writeTree_,e)},t.Empty=new t(new Be(null)),t.applySubtreeWrite_=function(e,n,r){if(null!=n.value)return r.updateChild(e,n.value);var o=null;return n.children.inorderTraversal(function(n,a){".priority"===n?(i(null!==a.value,"Priority writes must always be leaf nodes"),o=a.value):r=t.applySubtreeWrite_(e.child(n),a,r)}),r.getChild(e).isEmpty()||null===o||(r=r.updateChild(e.child(".priority"),o)),r},t}(),an=function(){function t(){this.visibleWrites_=on.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new sn(t,this)},t.prototype.addOverwrite=function(t,e,n,r){i(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){i(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex(function(e){return e.writeId===t});i(0<=n,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var o=r.visible,a=!1,s=this.allWrites_.length-1;o&&0<=s;){var u=this.allWrites_[s];u.visible&&(n<=s&&this.recordContainsPath_(u,r.path)?o=!1:r.path.contains(u.path)&&(a=!0)),s--}if(o){if(a)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var c=r.children;E(c,function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(e);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(At.Empty)){var a=t.layerTree_(this.allWrites_,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return c=n||_e.EMPTY_NODE,a.apply(c)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var u=this.visibleWrites_.childCompoundWrite(e);if(u.isEmpty())return n;if(null!=n||u.hasCompleteWrite(At.Empty)){var c=n||_e.EMPTY_NODE;return u.apply(c)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=_e.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(t);if(r)return r.isLeafNode()||r.forEachChild(se,function(t,e){n=n.updateImmediateChild(t,e)}),n;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(se,function(t,e){var r=i.childCompoundWrite(new At(t)).apply(e);n=n.updateImmediateChild(t,r)}),i.getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){n=n.updateImmediateChild(t.name,t.node)}),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){i(n||r,"Either existingEventSnap or existingServerSnap must exist");var o=t.child(e);if(this.visibleWrites_.hasCompleteWrite(o))return null;var a=this.visibleWrites_.childCompoundWrite(o);return a.isEmpty()?r.getChild(e):a.apply(r.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(At.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},t.prototype.recordContainsPath_=function(t,e){return t.snap?t.path.contains(e):!!N(t.children,function(n,r){return t.path.child(r).contains(e)})},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,At.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var r=on.Empty,i=0;i<t.length;++i){var a=t[i];if(e(a)){var s=a.path,u=void 0;if(a.snap)n.contains(s)?(u=At.relativePath(n,s),r=r.addWrite(u,a.snap)):s.contains(n)&&(u=At.relativePath(s,n),r=r.addWrite(At.Empty,a.snap.getChild(u)));else{if(!a.children)throw o("WriteRecord should have .snap or .children");if(n.contains(s))u=At.relativePath(n,s),r=r.addWrites(u,a.children);else if(s.contains(n))if((u=At.relativePath(s,n)).isEmpty())r=r.addWrites(At.Empty,a.children);else{var c=w(a.children,u.getFront());if(c){var h=c.getChild(u.popFront());r=r.addWrite(At.Empty,h)}}}}}return r},t}(),sn=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),un=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=Be.Empty,this.pendingWriteTree_=new an,this.tagToQueryMap_={},this.queryToTagMap_={}}return t.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new Qe(Ve.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=Be.fromObject(e);return this.applyOperationToSyncPoints_(new Ke(Ve.User,t,r))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=Be.Empty;return null!=n.snap?r=r.set(At.Empty,!0):E(n.children,function(t,e){r=r.set(new At(t),e)}),this.applyOperationToSyncPoints_(new je(n.path,r,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Qe(Ve.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=Be.fromObject(e);return this.applyOperationToSyncPoints_(new Ke(Ve.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new We(Ve.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,r){var i=this.queryKeyForTag_(r);if(null==i)return[];var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=At.relativePath(a,e),c=new Qe(Ve.forServerTaggedQuery(s),u,n);return this.applyTaggedOperation_(a,c)},t.prototype.applyTaggedQueryMerge=function(e,n,r){var i=this.queryKeyForTag_(r);if(i){var o=t.parseQueryKey_(i),a=o.path,s=o.queryId,u=At.relativePath(a,e),c=Be.fromObject(n),h=new Ke(Ve.forServerTaggedQuery(s),u,c);return this.applyTaggedOperation_(a,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var r=this.queryKeyForTag_(n);if(r){var i=t.parseQueryKey_(r),o=i.path,a=i.queryId,s=At.relativePath(o,e),u=new We(Ve.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.addEventRegistration=function(e,n){var r=e.path,o=null,a=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=At.relativePath(t,r);o=o||e.getCompleteServerCache(n),a=a||e.hasCompleteView()});var s,u=this.syncPointTree_.get(r);u?(a=a||u.hasCompleteView(),o=o||u.getCompleteServerCache(At.Empty)):(u=new rn,this.syncPointTree_=this.syncPointTree_.set(r,u)),null!=o?s=!0:(s=!1,o=_e.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(At.Empty);n&&(o=o.updateImmediateChild(t,n))}));var c=u.viewExistsForQuery(e);if(!c&&!e.getQueryParams().loadsAllData()){var h=t.makeQueryKey_(e);i(!(h in this.queryToTagMap_),"View does not exist, but we have a tag");var l=t.getNextQueryTag_();this.queryToTagMap_[h]=l,this.tagToQueryMap_["_"+l]=h}var f=this.pendingWriteTree_.childWrites(r),p=u.addEventRegistration(e,n,f,o,s);if(!c&&!a){var d=u.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,n,r){var i=this,o=e.path,a=this.syncPointTree_.get(o),s=[];if(a&&("default"===e.queryIdentifier()||a.viewExistsForQuery(e))){var u=a.removeEventRegistration(e,n,r);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;s=u.events;var h=-1!==c.findIndex(function(t){return t.getQueryParams().loadsAllData()}),l=this.syncPointTree_.findOnPath(o,function(t,e){return e.hasCompleteView()});if(h&&!l){var f=this.syncPointTree_.subtree(o);if(!f.isEmpty())for(var p=this.collectDistinctViewsForSubTree_(f),d=0;d<p.length;++d){var y=p[d],m=y.getQuery(),v=this.createListenerForView_(y);this.listenProvider_.startListening(t.queryForListening_(m),this.tagForQuery_(m),v.hashFn,v.onComplete)}}!l&&0<c.length&&!r&&(h?this.listenProvider_.stopListening(t.queryForListening_(e),null):c.forEach(function(e){var n=i.queryToTagMap_[t.makeQueryKey_(e)];i.listenProvider_.stopListening(t.queryForListening_(e),n)})),this.removeTags_(c)}return s},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(t,function(e,n){var r=At.relativePath(e,t),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(t,r,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),E(n,function(t,e){r=r.concat(e)}),r})},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var r=e[n];if(!r.getQueryParams().loadsAllData()){var i=t.makeQueryKey_(r),o=this.queryToTagMap_[i];delete this.queryToTagMap_[i],delete this.tagToQueryMap_["_"+o]}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var r=e.path,o=this.tagForQuery_(e),a=this.createListenerForView_(n),s=this.listenProvider_.startListening(t.queryForListening_(e),o,a.hashFn,a.onComplete),u=this.syncPointTree_.subtree(r);if(o)i(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var c=u.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),E(n,function(t,e){r=r.concat(e)}),r}),h=0;h<c.length;++h){var l=c[h];this.listenProvider_.stopListening(t.queryForListening_(l),this.tagForQuery_(l))}return s},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||_e.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?e.applyTaggedListenComplete(n.path,r):e.applyListenComplete(n.path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,n);return e.removeEventRegistration(n,null,i)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return i(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new At(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return w(this.queryToTagMap_,n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);i(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(At.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(At.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(At.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,r){var i=this,o=e.get(At.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(At.Empty));var a=[];return e.children.inorderTraversal(function(e,o){var s=n?n.getImmediateChild(e):null,u=r.child(e),c=t.operationForChild(e);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))}),o&&(a=a.concat(o.applyOperation(t,r,n))),a},t.nextQueryTag_=1,t}(),cn=function(){function t(){this.rootNode_=_e.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),hn=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(ct("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',pt(t)},t}(),ln=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),b(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return c(this.counters_)},t}(),fn=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new ln),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),pn=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=T(t);return this.last_&&E(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),dn=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new pn(t);var n=1e4+2e4*Math.random();Nt(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;E(e,function(e,i){0<i&&b(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),Nt(this.reportStats_.bind(this),Math.floor(6e5*Math.random()))},t}(),yn=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new mn(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.equals(t)})},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_(function(e){return e.contains(t)||t.contains(e)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),mn=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();at&&ct("event: "+e.toString()),It(n)}}},t.prototype.getPath=function(){return this.path_},t}(),vn=function(){function t(t){this.allowedEvents_=t,this.listeners_={},i(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){i(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),gn=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return n(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return i("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(vn),_n=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||l()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return n(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return i("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(vn),bn=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&It(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),wn=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ht(t),this.stats_=fn.getCollection(e),this.urlFn=function(t){return e.connectionURL(Pt,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new bn(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(f()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new En(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1],o=t[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"==r)n.id=i,n.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(i,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t[0],i=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,i)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),!f()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Dt)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!f()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=g(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=a(e),s.encodeByteArray(n,!0)),i=wt(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!f()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=g(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),En=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new xe,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,f())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=rt(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var o="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(o='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){ct("frame writing exception"),e.stack&&ct(e.stack),ct(e)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||ct("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var e=this;if(this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))),f()&&this.myID){var n={disconn:"t"};n.id=this.myID,n.pw=this.myPW;var r=this.urlFn(n);t.nodeRestRequest(r)}var i=this.onDisconnect;i&&(this.onDisconnect=null,i())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;f()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){ct("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(t){}},Math.floor(1))},t}(),Tn=null;"undefined"!=typeof MozWebSocket?Tn=MozWebSocket:"undefined"!=typeof WebSocket&&(Tn=WebSocket);var Sn=function(){function e(t,n,r,i){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ht(this.connId),this.stats_=fn.getCollection(n),this.connURL=e.connectionURL_(n,r,i)}return e.connectionURL_=function(t,e,n){var r={v:"5"};return!f()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Dt)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Rt,r)},e.prototype.open=function(e,n){var r=this;this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,tt.set("previous_websocket_failure",!0);try{if(f()){var i={headers:{"User-Agent":"Firebase/5/"+t.SDK_VERSION+"/"+process.platform+"/Node"}},o=process.env,a=0==this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new Tn(this.connURL,[],i)}else this.mySock=new Tn(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var s=e.message||e.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(t){r.handleIncomingFrame(t)},this.mySock.onerror=function(t){r.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&r.log_(e),r.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&1<n.length&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Tn&&!e.forceDisallow_},e.previouslyFailed=function(){return tt.isInMemoryStorage||!0===tt.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){tt.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=v(e);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},e.prototype.extractFrameCount_=function(t){if(i(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},e.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(t){this.resetKeepAlive();var e=g(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=wt(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},e.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Cn=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[wn,Sn]},enumerable:!0,configurable:!0}),t.prototype.initTransports_=function(e){var n=Sn&&Sn.isAvailable(),r=n&&!Sn.previouslyFailed();if(e.webSocketOnly&&(n||pt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Sn];else{var i=this.transports_=[];Et(t.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&i.push(e)})}},t.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},t}(),In=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ht("c:"+this.id+":"),this.transportManager_=new Cn(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Nt(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!=e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=_t("t",t),n=_t("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=_t("t",t),n=_t("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=_t("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?lt("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):lt("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&pt("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Nt(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Nt(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(tt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Nn=function(){function t(){}return t.prototype.put=function(){},t.prototype.merge=function(){},t.prototype.refreshAuthToken=function(){},t.prototype.onDisconnectPut=function(){},t.prototype.onDisconnectMerge=function(){},t.prototype.onDisconnectCancel=function(){},t.prototype.reportStats=function(){},t}(),An=function(e){function r(t,n,i,o,a,s){var u=e.call(this)||this;if(u.repoInfo_=t,u.onDataUpdate_=n,u.onConnectStatus_=i,u.onServerInfoUpdate_=o,u.authTokenProvider_=a,u.authOverride_=s,u.id=r.nextPersistentConnectionId_++,u.log_=ht("p:"+u.id+":"),u.interruptReasons_={},u.listens_={},u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=1e3,u.maxReconnectDelay_=3e5,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,s&&!f())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),gn.getInstance().on("visible",u.onVisible_,u),-1===t.host.indexOf("fblocal")&&_n.getInstance().on("online",u.onOnline_,u),u}return n(r,e),r.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,o={r:r,a:t,b:e};this.log_(g(o)),i(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[r]=n)},r.prototype.listen=function(t,e,n,r){var o=t.queryIdentifier(),a=t.path.toString();this.log_("Listen called for "+a+" "+o),this.listens_[a]=this.listens_[a]||{},i(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),i(!this.listens_[a][o],"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[a][o]=s,this.connected_&&this.sendListen_(s)},r.prototype.sendListen_=function(t){var e=this,n=t.query,i=n.path.toString(),o=n.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};t.tag&&(a.q=n.queryObject(),a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,function(a){var s=a.d,u=a.s;r.warnOnListenWarnings_(s,n),(e.listens_[i]&&e.listens_[i][o])===t&&(e.log_("listen response",a),"ok"!==u&&e.removeListen_(i,o),t.onComplete&&t.onComplete(u,s))})},r.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&b(t,"w")){var n=w(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();pt("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},r.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},r.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=_(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},r.prototype.tryAuth=function(){var t,e=this;if(this.connected_&&this.authToken_){var n=this.authToken_,r=(t=_(n).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",i={cred:n};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(r,i,function(t){var r=t.s,i=t.d||"error";e.authToken_===n&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},r.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),i(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},r.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},r.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},r.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},r.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},r.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},r.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},r.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},r.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},r.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},r.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}})}},r.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+g(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},r.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):lt("Unrecognized action received from server: "+g(t)+"\nAre you using the latest client?")},r.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},r.prototype.scheduleConnect_=function(t){var e=this;i(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},r.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},r.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},r.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},r.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+r.nextConnectionId_++,a=this,s=this.lastSessionId,u=!1,c=null,h=function(){c?c.close():(u=!0,n())};this.realtime_={close:h,sendRequest:function(t){i(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(t)}};var l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(l).then(function(r){u?ct("getToken() completed but was canceled"):(ct("getToken() completed. Creating connection."),a.authToken_=r&&r.accessToken,c=new In(o,a.repoInfo_,t,e,n,function(t){pt(t+" ("+a.repoInfo_.toString()+")"),a.interrupt("server_kill")},s))}).then(null,function(t){a.log_("Failed to get token: "+t),u||h()})}},r.prototype.interrupt=function(t){ct("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},r.prototype.resume=function(t){ct("Resuming connection for reason: "+t),delete this.interruptReasons_[t],S(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},r.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},r.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},r.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return bt(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},r.prototype.removeListen_=function(t,e){var n,r=new At(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===C(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},r.prototype.onAuthRevoked_=function(t,e){ct("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},r.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},r.prototype.restoreState_=function(){var t=this;this.tryAuth(),E(this.listens_,function(e,n){E(n,function(e,n){t.sendListen_(n)})});for(var e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}},r.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+t.SDK_VERSION.replace(/\./g,"-")]=1,l()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},r.prototype.shouldReconnect_=function(){var t=_n.getInstance().currentlyOnline();return S(this.interruptReasons_)&&t},r.nextPersistentConnectionId_=0,r.nextConnectionId_=0,r}(Nn),kn=function(t){function e(e,n,r){var i=t.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=ht("p:rest:"),i.listens_={},i}return n(e,t),e.prototype.reportStats=function(){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(i(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=e.getListenId_(t,r),u={};this.listens_[s]=u;var c=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",c,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),w(o.listens_,s)===u&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.refreshAuthToken=function(){},e.prototype.restRequest_=function(t,e,n){var r=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then(function(i){var o=i&&i.accessToken;o&&(e.auth=o);var a,s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+(a=[],E(e,function(t,e){Array.isArray(e)?e.forEach(function(e){a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),a.length?"&"+a.join("&"):"");r.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(n&&4===u.readyState){r.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var t=null;if(200<=u.status&&u.status<300){try{t=v(u.responseText)}catch(t){pt("Failed to parse JSON response for "+s+": "+u.responseText)}n(null,t)}else 401!==u.status&&404!==u.status&&pt("Got unsuccessful REST response for "+s+" Status: "+u.status),n(u.status);n=null}},u.open("GET",s,!0),u.send()})},e}(Nn),Dn="repo_interrupt",Rn=function(){function t(t,e,n){var r=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new yn,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Le,this.persistentConnection_=null;var i=new hn(n);if(this.stats_=fn.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new kn(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{g(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new An(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){r.server_.refreshAuthToken(t)}),this.statsReporter_=fn.getOrCreateReporter(t,function(){return new dn(r.stats_,r.server_)}),this.transactions_init_(),this.infoData_=new cn,this.infoSyncTree_=new un({startListening:function(t,e,n,i){var o=[],a=r.infoData_.getNode(t.path);return a.isEmpty()||(o=r.infoSyncTree_.applyServerOverwrite(t.path,a),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new un({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,function(e,n){var o=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,o)}),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new At(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new At(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=I(e,function(t){return Ee(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Ee(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=I(e,function(t){return Ee(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Ee(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;Et(t,function(t,n){e.updateInfo_(n,t)})},t.prototype.updateInfo_=function(t,e){var n=new At("/.info/"+t),r=Ee(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,r){var i=this;this.log_("set",{path:t.toString(),value:e,priority:n});var o=this.generateServerValues(),a=Ee(e,n),s=Fe(a,o),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(t,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(t.toString(),a.val(!0),function(e,n){var o="ok"===e;o||pt("set at "+t+" failed: "+e);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(t,a),i.callOnCompleteCallback(r,e,n)});var h=this.abortTransactions_(t);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(t,e,n){var r=this;this.log_("update",{path:t.toString(),value:e});var i=!0,o=this.generateServerValues(),a={};if(E(e,function(t,e){i=!1;var n=Ee(e);a[t]=Fe(n,o)}),i)ct("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),u=this.serverSyncTree_.applyUserMerge(t,a,s);this.eventQueue_.queueEvents(u),this.server_.merge(t.toString(),e,function(e,i){var o="ok"===e;o||pt("update at "+t+" failed: "+e);var a=r.serverSyncTree_.ackUserWrite(s,!o),u=0<a.length?r.rerunTransactions_(t):t;r.eventQueue_.raiseEventsForChangedPath(u,a),r.callOnCompleteCallback(n,e,i)}),E(e,function(e){var n=r.abortTransactions_(t.child(e));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e,n,r,i=this.generateServerValues(),o=(e=this.onDisconnect_,n=i,r=new Le,e.forEachTree(new At(""),function(t,e){r.remember(t,Fe(e,n))}),r),a=[];o.forEachTree(At.Empty,function(e,n){a=a.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var r=t.abortTransactions_(e);t.rerunTransactions_(r)}),this.onDisconnect_=new Le,this.eventQueue_.raiseEventsForChangedPath(At.Empty,a)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,r,i)})},t.prototype.onDisconnectSet=function(t,e,n){var r=this,i=Ee(e);this.server_.onDisconnectPut(t.toString(),i.val(!0),function(e,o){"ok"===e&&r.onDisconnect_.remember(t,i),r.callOnCompleteCallback(n,e,o)})},t.prototype.onDisconnectSetWithPriority=function(t,e,n,r){var i=this,o=Ee(e,n);this.server_.onDisconnectPut(t.toString(),o.val(!0),function(e,n){"ok"===e&&i.onDisconnect_.remember(t,o),i.callOnCompleteCallback(r,e,n)})},t.prototype.onDisconnectUpdate=function(t,e,n){var r=this;if(S(e))return ct("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,function(i,o){"ok"===i&&E(e,function(e,n){var i=Ee(n);r.onDisconnect_.remember(t.child(e),i)}),r.callOnCompleteCallback(n,i,o)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(Dn)},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(Dn)},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new pn(this.stats_)),this.statsListener_.get()):this.stats_.get();var n=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);E(e,function(t,e){for(var r=t.length;r<n+2;r++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),ct.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&It(function(){if("ok"==e)t(null);else{var r=(e||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,t(o)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new Wn(this))},enumerable:!0,configurable:!0}),t}(),Pn=function(){function t(e){this.indexedFilter_=new Ye(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new te(e,n))||(n=_e.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=_e.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(_e.EMPTY_NODE);var i=this;return e.forEachChild(se,function(t,e){i.matches(new te(t,e))||(r=r.updateImmediateChild(t,_e.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),On=function(){function t(t){this.rangedFilter_=new Pn(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new te(e,n))||(n=_e.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=_e.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=_e.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(_e.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,_e.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,o){var a;if(this.reverse_){var s=this.index_.getCompare();a=function(t,e){return s(e,t)}}else a=this.index_.getCompare();var u=t;i(u.numChildren()==this.limit_,"");var c=new te(e,n),h=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(u.hasChild(e)){for(var f=u.getImmediateChild(e),p=r.getChildAfterChild(this.index_,h,this.reverse_);null!=p&&(p.name==e||u.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:a(p,c);if(l&&!n.isEmpty()&&0<=d)return null!=o&&o.trackChildChange(ze.childChangedChange(e,n,f)),u.updateImmediateChild(e,n);null!=o&&o.trackChildChange(ze.childRemovedChange(e,f));var y=u.updateImmediateChild(e,_e.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=o&&o.trackChildChange(ze.childAddedChange(p.name,p.node)),y.updateImmediateChild(p.name,p.node)):y}return n.isEmpty()?t:l&&0<=a(h,c)?(null!=o&&(o.trackChildChange(ze.childRemovedChange(h.name,h.node)),o.trackChildChange(ze.childAddedChange(e,n))),u.updateImmediateChild(e,n).updateImmediateChild(h.name,_e.EMPTY_NODE)):t},t}(),xn=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=se}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return i(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return i(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:yt},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return i(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return i(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:mt},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return i(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,n.indexStartName_=null!=e?(n.startNameSet_=!0,e):(n.startNameSet_=!1,""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,n.indexEndName_=void 0!==e?(n.endNameSet_=!0,e):(n.endNameSet_=!1,""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=r}return this.index_!==se&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==se},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new Ye(this.getIndex()):this.hasLimit()?new On(this):new Pn(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(e=this.index_===se?n.PRIORITY_INDEX:this.index_===Ie?n.VALUE_INDEX:this.index_===re?n.KEY_INDEX:(i(this.index_ instanceof Ne,"Unrecognized index type!"),this.index_.toString()),r[n.ORDER_BY]=g(e),this.startSet_&&(r[n.START_AT]=g(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+g(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=g(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+g(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Ln=function(t){function e(e,n){if(!(e instanceof Rn))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,xn.DEFAULT,!1)||this}return n(e,t),e.prototype.getKey=function(){return D("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){var n,r,i,o;return D("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof At||(null===this.path.getFront()?(n="Reference.child",o=!(r=1),(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),zt(n,r,i,o)):zt("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){D("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){D("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){D("Reference.set",1,2,arguments.length),Yt("Reference.set",this.path),Bt("Reference.set",1,t,this.path,!1),P("Reference.set",2,e,!0);var n=new h;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(D("Reference.update",1,2,arguments.length),Yt("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,pt("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Qt("Reference.update",1,t,this.path,!1),P("Reference.update",2,e,!0);var i=new h;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},e.prototype.setWithPriority=function(t,e,n){if(D("Reference.setWithPriority",2,3,arguments.length),Yt("Reference.setWithPriority",this.path),Bt("Reference.setWithPriority",1,t,this.path,!1),Kt("Reference.setWithPriority",2,e,!1),P("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new h;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},e.prototype.remove=function(t){return D("Reference.remove",0,1,arguments.length),Yt("Reference.remove",this.path),P("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(D("Reference.transaction",1,3,arguments.length),Yt("Reference.transaction",this.path),P("Reference.transaction",1,t,!1),P("Reference.transaction",2,e,!0),function(t,e,n){if(void 0!==n&&"boolean"!=typeof n)throw new Error(R("Reference.transaction",3,!0)+"must be a boolean.")}(0,0,n),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new h;return"function"==typeof e&&r.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,n,i){t?r.reject(t):r.resolve(new $t(n,i)),"function"==typeof e&&e(t,n,i)},n),r.promise},e.prototype.setPriority=function(t,e){D("Reference.setPriority",1,2,arguments.length),Yt("Reference.setPriority",this.path),Kt("Reference.setPriority",1,t,!1),P("Reference.setPriority",2,e,!0);var n=new h;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){D("Reference.push",0,2,arguments.length),Yt("Reference.push",this.path),Bt("Reference.push",1,t,this.path,!0),P("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=Zt(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},e.prototype.onDisconnect=function(){return Yt("Reference.onDisconnect",this.path),new Jt(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),e}(Oe);Oe.__referenceConstructor=Ln,rn.__referenceConstructor=Ln;var Mn,Fn,Un=function(){this.children={},this.childCount=0,this.value=null},qn=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Un),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n,r=e instanceof At?e:new At(e),i=this;null!==(n=r.getFront());)i=new t(n,i,w(i.node_.children,n)||new Un),r=r.popFront();return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){i(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return 0<this.node_.childCount},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;E(this.node_.children,function(r,i){e(new t(r,n,i))})},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild(function(e){e.forEachDescendant(t,!0,n)}),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild(function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)})},t.prototype.path=function(){return new At(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=b(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();(Fn=Mn||(Mn={}))[Fn.RUN=0]="RUN",Fn[Fn.SENT=1]="SENT",Fn[Fn.COMPLETED=2]="COMPLETED",Fn[Fn.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Fn[Fn.NEEDS_ABORT=4]="NEEDS_ABORT",Rn.MAX_TRANSACTION_RETRIES_=25,Rn.prototype.transactions_init_=function(){this.transactionQueueTree_=new qn},Rn.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var o=function(){},a=new Ln(this,t);a.on("value",o);var s={path:t,update:e,onComplete:n,status:null,order:rt(),applyLocally:r,retryCount:0,unwatcher:function(){a.off("value",o)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=this.getLatestState_(t);s.currentInputSnapshot=u;var c=s.update(u.val());if(void 0===c){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var h=new Ae(s.currentInputSnapshot,new Ln(this,s.path),se);s.onComplete(null,!1,h)}}else{Wt("transaction failed: Data returned ",c,s.path),s.status=Mn.RUN;var l=this.transactionQueueTree_.subTree(t),f=l.getValue()||[];f.push(s),l.setValue(f);var p=void 0;"object"==typeof c&&null!==c&&b(c,".priority")?(p=w(c,".priority"),i(jt(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(this.serverSyncTree_.calcCompleteEventCache(t)||_e.EMPTY_NODE).getPriority().val(),p=p;var d=this.generateServerValues(),y=Ee(c,p),m=Fe(y,d);s.currentOutputSnapshotRaw=y,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,m,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},Rn.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||_e.EMPTY_NODE},Rn.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);i(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===Mn.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},Rn.prototype.sendTransactionQueue_=function(t,e){for(var n=this,r=e.map(function(t){return t.currentWriteId}),o=this.getLatestState_(t,r),a=o,s=o.hash(),u=0;u<e.length;u++){var c=e[u];i(c.status===Mn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=Mn.SENT,c.retryCount++;var h=At.relativePath(t,c.path);a=a.updateChild(h,c.currentOutputSnapshotRaw)}var l=a.val(!0),f=t;this.server_.put(f.toString(),l,function(r){n.log_("transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<e.length;a++){if(e[a].status=Mn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(e[a].currentWriteId)),e[a].onComplete){var s=e[a].currentOutputSnapshotResolved,u=new Ln(n,e[a].path),c=new Ae(s,u,se);o.push(e[a].onComplete.bind(null,null,!0,c))}e[a].unwatcher()}for(n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,i),a=0;a<o.length;a++)It(o[a])}else{if("datastale"===r)for(a=0;a<e.length;a++)e[a].status===Mn.SENT_NEEDS_ABORT?e[a].status=Mn.NEEDS_ABORT:e[a].status=Mn.RUN;else for(pt("transaction at "+f.toString()+" failed: "+r),a=0;a<e.length;a++)e[a].status=Mn.NEEDS_ABORT,e[a].abortReason=r;n.rerunTransactions_(t)}},s)},Rn.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},Rn.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],o=[],a=t.filter(function(t){return t.status===Mn.RUN}).map(function(t){return t.currentWriteId}),s=0;s<t.length;s++){var u=t[s],c=At.relativePath(e,u.path),h=!1,l=void 0;if(i(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),u.status===Mn.NEEDS_ABORT)h=!0,l=u.abortReason,o=o.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else if(u.status===Mn.RUN)if(u.retryCount>=Rn.MAX_TRANSACTION_RETRIES_)h=!0,l="maxretry",o=o.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0));else{var f=this.getLatestState_(u.path,a);u.currentInputSnapshot=f;var p=t[s].update(f.val());if(void 0!==p){Wt("transaction failed: Data returned ",p,u.path);var d=Ee(p);"object"==typeof p&&null!=p&&b(p,".priority")||(d=d.updatePriority(f.getPriority()));var y=u.currentWriteId,m=this.generateServerValues(),v=Fe(d,m);u.currentOutputSnapshotRaw=d,u.currentOutputSnapshotResolved=v,u.currentWriteId=this.getNextWriteId_(),a.splice(a.indexOf(y),1),o=(o=o.concat(this.serverSyncTree_.applyUserOverwrite(u.path,v,u.currentWriteId,u.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(y,!0))}else h=!0,l="nodata",o=o.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,o),o=[],h&&(t[s].status=Mn.COMPLETED,n=t[s].unwatcher,setTimeout(n,Math.floor(0)),t[s].onComplete))if("nodata"===l){var g=new Ln(this,t[s].path),_=t[s].currentInputSnapshot,w=new Ae(_,g,se);r.push(t[s].onComplete.bind(null,null,!1,w))}else r.push(t[s].onComplete.bind(null,new Error(l),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),s=0;s<r.length;s++)It(r[s]);this.sendReadyTransactions_()}},Rn.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},Rn.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},Rn.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},Rn.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Mn.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},Rn.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},Rn.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],o=-1,a=0;a<e.length;a++)e[a].status===Mn.SENT_NEEDS_ABORT||(e[a].status===Mn.SENT?(i(o===a-1,"All SENT items should be at beginning of queue."),e[o=a].status=Mn.SENT_NEEDS_ABORT,e[a].abortReason="set"):(i(e[a].status===Mn.RUN,"Unexpected transaction status in abort"),e[a].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[a].currentWriteId,!0)),e[a].onComplete&&n.push(e[a].onComplete.bind(null,new Error("set"),!1,null))));for(-1===o?t.setValue(null):e.length=o+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r),a=0;a<n.length;a++)It(n[a])}};var Vn,jn="databaseURL",Bn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return Vn||(Vn=new t),Vn},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options[jn];void 0===n&&ft("Can't determine Firebase Database URL.  Be sure to include "+jn+" option when calling firebase.initializeApp().");var r=xt(n),i=r.repoInfo;return Xt("Invalid Firebase Database URL",1,r),r.path.isEmpty()||ft("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=w(this.repos_,t.app.name);e&&w(e,t.repoInfo_.toURLString())===t||ft("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=w(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=w(n,t.toURLString());return r&&ft("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Rn(t,this.useRestClient_,e),n[t.toURLString()]=r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),Wn=function(){function t(t){(this.repo_=t)instanceof Rn||ft("Don't call new Database() directly - please use firebase.database()."),this.root_=new Ln(t,At.Empty),this.INTERNAL=new Qn(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),D("database.ref",0,1,arguments.length),t instanceof Ln?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),D(e,1,1,arguments.length);var n=xt(t);Xt(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&ft(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&ft("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){D("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){D("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),Qn=function(){function t(t){this.database=t}return t.prototype.delete=function(){return t=this,i=function(){return r(this,function(){return this.database.checkDeleted_("delete"),Bn.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})},new((n=e=void 0)||(n=Promise))(function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(a,s)}u((i=i.apply(t,e||[])).next())});var t,e,n,i},t}(),Kn=Object.freeze({forceLongPolling:function(){Sn.forceDisallow(),wn.forceAllow()},forceWebSockets:function(){wn.forceDisallow()},isWebSocketsAvailable:function(){return Sn.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),Hn=An;An.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},An.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var Gn,zn=In,Yn=Ot,Xn=Object.freeze({DataConnection:Hn,RealTimeConnection:zn,hijackHash:function(t){var e=An.prototype.put;return An.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){An.prototype.put=e}},ConnectionTarget:Yn,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){Bn.getInstance().forceRestClient(t)}}),Jn=Wn.ServerValue;Gn=t.INTERNAL.registerService("database",function(t,e,n){return Bn.getInstance().databaseFromApp(t,n)},{Reference:Ln,Query:Oe,Database:Wn,DataSnapshot:Ae,enableLogging:ut,INTERNAL:Kn,ServerValue:Jn,TEST_ACCESS:Xn},null,!0),f()&&(module.exports=Gn)}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database - be sure to load firebase-app.js first.")}});var config={apiKey:"AIzaSyBBIpucY5Jb771J8jcuN2EySA9lBxOCtmk",authDomain:"final-project-8ef92.firebaseapp.com",databaseURL:"https://final-project-8ef92-default-rtdb.firebaseio.com",projectId:"final-project-8ef92",storageBucket:"final-project-8ef92.appspot.com",messagingSenderId:"615088429447",appId:"1:615088429447:web:3db5a96710281327be9b22"};firebase.initializeApp(config);